[0m19:24:07.041989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000274DEE78EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000274DFFDFED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000274DFFDFB10>]}


============================== 19:24:07.053120 | 48f892e0-b70c-46da-b8dc-0bab21106751 ==============================
[0m19:24:07.053120 [info ] [MainThread]: Running with dbt=1.11.2
[0m19:24:07.054630 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'no_print': 'None', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'printer_width': '80', 'write_json': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'empty': 'False', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'invocation_command': 'dbt run', 'indirect_selection': 'eager', 'use_colors': 'True', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m19:24:34.554672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '48f892e0-b70c-46da-b8dc-0bab21106751', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000274DF311BA0>]}
[0m19:24:34.708094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '48f892e0-b70c-46da-b8dc-0bab21106751', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000274EFC03570>]}
[0m19:24:34.709673 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m19:24:36.428437 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m19:24:36.431089 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m19:24:36.432656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '48f892e0-b70c-46da-b8dc-0bab21106751', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000274EFB29850>]}
[0m19:24:41.298624 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'dim_customer' in the 'models' section of file 'models\dimensions\schema.yml'
[0m19:24:41.531959 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `relationships` defined on
'fact_sales_order_tt' in package 'glamira_analytics'
(models\dimensions\schema.yml). Arguments to generic tests should be nested
under the `arguments` property.
[0m19:24:41.533709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '48f892e0-b70c-46da-b8dc-0bab21106751', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000274FF65F4D0>]}
[0m19:24:41.774475 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.glamira_analytics.stg_glamira__location' (models\staging\staging_summary\stg_glamira__location.sql) depends on a source named 'glamira_src.raw_ip_location' which was not found
[0m19:24:41.776430 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 3 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m19:24:41.779203 [debug] [MainThread]: Command `dbt run` failed at 19:24:41.778773 after 35.12 seconds
[0m19:24:41.780396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000274DFE43E70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000274FFA90590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000274FF646B60>]}
[0m19:24:41.781484 [debug] [MainThread]: Flushing usage events
[0m19:24:44.378746 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:26:21.518248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB338B8EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB34A1FED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB34A1FB10>]}


============================== 19:26:21.529186 | 7dd63249-b4c7-478c-b3a8-8534e9558796 ==============================
[0m19:26:21.529186 [info ] [MainThread]: Running with dbt=1.11.2
[0m19:26:21.531528 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'no_print': 'None', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'printer_width': '80', 'write_json': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'empty': 'False', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'fail_fast': 'False', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'invocation_command': 'dbt run', 'indirect_selection': 'eager', 'use_colors': 'True', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m19:26:35.925862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7dd63249-b4c7-478c-b3a8-8534e9558796', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB33D51BA0>]}
[0m19:26:36.052474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7dd63249-b4c7-478c-b3a8-8534e9558796', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB4452B570>]}
[0m19:26:36.053370 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m19:26:37.326338 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m19:26:37.328326 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m19:26:37.329770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '7dd63249-b4c7-478c-b3a8-8534e9558796', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB446C1850>]}
[0m19:26:39.803017 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'dim_customer' in the 'models' section of file 'models\dimensions\schema.yml'
[0m19:26:40.019722 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `relationships` defined on
'fact_sales_order_tt' in package 'glamira_analytics'
(models\dimensions\schema.yml). Arguments to generic tests should be nested
under the `arguments` property.
[0m19:26:40.021184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '7dd63249-b4c7-478c-b3a8-8534e9558796', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB5411F4D0>]}
[0m19:26:40.322563 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.glamira_analytics.stg_glamira__location' (models\staging\staging_summary\stg_glamira__location.sql) depends on a source named 'glamira_src.raw_ip_location' which was not found
[0m19:26:40.324352 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 3 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m19:26:40.326730 [debug] [MainThread]: Command `dbt run` failed at 19:26:40.326360 after 19.18 seconds
[0m19:26:40.327781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB34883E70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB5458E970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001FB54172B60>]}
[0m19:26:40.328765 [debug] [MainThread]: Flushing usage events
[0m19:26:42.224403 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:48:33.235426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002474FC78EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024750DD7ED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024750DD7B10>]}


============================== 19:48:33.248118 | 06c38c48-bbb2-4838-884f-6b1d4ff3fc4e ==============================
[0m19:48:33.248118 [info ] [MainThread]: Running with dbt=1.11.2
[0m19:48:33.250325 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'no_print': 'None', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'printer_width': '80', 'write_json': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'empty': 'None', 'cache_selected_only': 'False', 'fail_fast': 'False', 'debug': 'False', 'log_format': 'default', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'use_colors': 'True', 'indirect_selection': 'eager', 'invocation_command': 'dbt clean', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m19:48:33.658406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '06c38c48-bbb2-4838-884f-6b1d4ff3fc4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024750111BA0>]}
[0m19:48:33.729834 [debug] [MainThread]: Command `dbt clean` succeeded at 19:48:33.729143 after 0.93 seconds
[0m19:48:33.731002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024750D318C0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024750D31040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024750C63750>]}
[0m19:48:33.732164 [debug] [MainThread]: Flushing usage events
[0m19:48:35.945528 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:48:51.514516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000230BC3F8EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000230BD55FED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000230BD55FB10>]}


============================== 19:48:51.525678 | 1bb98427-a0c2-4de4-9254-411910c35b4b ==============================
[0m19:48:51.525678 [info ] [MainThread]: Running with dbt=1.11.2
[0m19:48:51.528107 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'no_print': 'None', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'printer_width': '80', 'write_json': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'empty': 'False', 'cache_selected_only': 'False', 'fail_fast': 'False', 'debug': 'False', 'log_format': 'default', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'use_colors': 'True', 'invocation_command': 'dbt run', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m19:49:05.513748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1bb98427-a0c2-4de4-9254-411910c35b4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000230BC891BA0>]}
[0m19:49:05.593547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1bb98427-a0c2-4de4-9254-411910c35b4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000230CCFBF570>]}
[0m19:49:05.594395 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m19:49:06.605914 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m19:49:06.607436 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m19:49:06.608712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1bb98427-a0c2-4de4-9254-411910c35b4b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000230DC115850>]}
[0m19:49:08.882806 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'dim_customer' in the 'models' section of file 'models\dimensions\schema.yml'
[0m19:49:09.086903 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `relationships` defined on
'fact_sales_order_tt' in package 'glamira_analytics'
(models\dimensions\schema.yml). Arguments to generic tests should be nested
under the `arguments` property.
[0m19:49:09.087970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '1bb98427-a0c2-4de4-9254-411910c35b4b', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000230DCC2F4D0>]}
[0m19:49:09.277981 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.glamira_analytics.dim_fx_rate_usd' (models\dimensions\dim_fx_rate_usd.sql) depends on a node named 'exchange_rate_usd' which was not found
[0m19:49:09.279703 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 3 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m19:49:09.282297 [debug] [MainThread]: Command `dbt run` failed at 19:49:09.281907 after 18.01 seconds
[0m19:49:09.283443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000230BD3C3E70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000230DD09E970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000230DCC92B60>]}
[0m19:49:09.284654 [debug] [MainThread]: Flushing usage events
[0m19:49:11.149777 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:15:41.566934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA258F8EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA26A5FED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA26A5FB10>]}


============================== 20:15:41.579885 | cadec08d-6cff-49b3-88be-e83971fad285 ==============================
[0m20:15:41.579885 [info ] [MainThread]: Running with dbt=1.11.2
[0m20:15:41.582131 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'no_print': 'None', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'printer_width': '80', 'write_json': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'empty': 'False', 'cache_selected_only': 'False', 'fail_fast': 'False', 'debug': 'False', 'log_format': 'default', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'invocation_command': 'dbt run', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m20:15:53.554669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cadec08d-6cff-49b3-88be-e83971fad285', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA25D91BA0>]}
[0m20:15:53.687954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cadec08d-6cff-49b3-88be-e83971fad285', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA455FF570>]}
[0m20:15:53.689184 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m20:15:54.941660 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m20:15:54.945053 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m20:15:54.947472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'cadec08d-6cff-49b3-88be-e83971fad285', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA36529850>]}
[0m20:15:57.268687 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found two schema.yml entries for the same resource named fact_sales_order_tt. Resources and their associated columns may only be described a single time. To fix this, remove one of the resource entries for fact_sales_order_tt in this file:
   - models\dimensions\schema.yml
  
[0m20:15:57.271566 [debug] [MainThread]: Command `dbt run` failed at 20:15:57.271156 after 16.05 seconds
[0m20:15:57.272763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA461698B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA46169E50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001DA268C3E70>]}
[0m20:15:57.273935 [debug] [MainThread]: Flushing usage events
[0m20:16:00.095445 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:27:28.565179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000257E1F38EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000257E309FED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000257E309FB10>]}


============================== 20:27:28.571636 | 1ea7a035-8722-433e-aea9-a69cad6b22ef ==============================
[0m20:27:28.571636 [info ] [MainThread]: Running with dbt=1.11.2
[0m20:27:28.572867 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'no_print': 'None', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'write_json': 'True', 'empty': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'invocation_command': 'dbt run', 'indirect_selection': 'eager', 'use_colors': 'True', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m20:27:40.123255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1ea7a035-8722-433e-aea9-a69cad6b22ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000257E23D1BA0>]}
[0m20:27:40.218722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1ea7a035-8722-433e-aea9-a69cad6b22ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025781D3B570>]}
[0m20:27:40.219814 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m20:27:41.337476 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m20:27:41.339133 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m20:27:41.340072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1ea7a035-8722-433e-aea9-a69cad6b22ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000257826CD850>]}
[0m20:27:43.473199 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `relationships` defined on
'fact_sales_order_tt' in package 'glamira_analytics'
(models\dimensions\schema.yml). Arguments to generic tests should be nested
under the `arguments` property.
[0m20:27:43.474454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '1ea7a035-8722-433e-aea9-a69cad6b22ef', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025782AFF4D0>]}
[0m20:27:43.865381 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.glamira_analytics.analytics
- seeds.Project7.exchange_rate_usd
- seeds.Project7
[0m20:27:43.882924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1ea7a035-8722-433e-aea9-a69cad6b22ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025782B3B850>]}
[0m20:27:44.047147 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m20:27:44.051331 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m20:27:44.101137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1ea7a035-8722-433e-aea9-a69cad6b22ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025782E9F040>]}
[0m20:27:44.102096 [info ] [MainThread]: Found 15 models, 1 seed, 5 data tests, 4 sources, 537 macros
[0m20:27:44.103460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1ea7a035-8722-433e-aea9-a69cad6b22ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025782CFBE90>]}
[0m20:27:44.107549 [info ] [MainThread]: 
[0m20:27:44.108678 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:27:44.110282 [info ] [MainThread]: 
[0m20:27:44.112100 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:27:44.119918 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m20:27:44.120963 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:27:44.122550 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m20:27:44.124075 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:27:46.794961 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_stone-album-475912-b9, now create_stone-album-475912-b9_analytics_dev_staging)
[0m20:27:46.795847 [debug] [ThreadPool]: Creating schema "database: "stone-album-475912-b9"
schema: "analytics_dev_staging"
"
[0m20:27:46.808831 [debug] [ThreadPool]: On create_stone-album-475912-b9_analytics_dev_staging: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "connection_name": "create_stone-album-475912-b9_analytics_dev_staging"} */
create schema if not exists `stone-album-475912-b9`.`analytics_dev_staging`
  
[0m20:27:46.809413 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:27:48.948084 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:4295295c-f9a8-468a-81eb-97e2cab8c378&page=queryresults
[0m20:27:52.830317 [debug] [ThreadPool]: SQL status: OK in 3.881 seconds
[0m20:27:56.773313 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev'
[0m20:27:56.774305 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:27:56.775087 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_staging'
[0m20:27:56.776186 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:27:57.951410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1ea7a035-8722-433e-aea9-a69cad6b22ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025782E828E0>]}
[0m20:27:57.952287 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:27:57.967308 [debug] [Thread-3 (]: Began running node model.glamira_analytics.stg_fact_sales_order_tt
[0m20:27:57.968079 [debug] [Thread-4 (]: Began running node model.glamira_analytics.stg_fx_rate
[0m20:27:57.968674 [debug] [Thread-1 (]: Began running node model.glamira_analytics.stg_dim_location
[0m20:27:57.969247 [debug] [Thread-2 (]: Began running node model.glamira_analytics.stg_dim_product
[0m20:27:57.970011 [info ] [Thread-3 (]: 3 of 15 START sql view model analytics_dev_staging.stg_fact_sales_order_tt ..... [RUN]
[0m20:27:57.970923 [info ] [Thread-4 (]: 4 of 15 START sql view model analytics_dev_staging.stg_fx_rate ................. [RUN]
[0m20:27:57.972043 [info ] [Thread-1 (]: 1 of 15 START sql view model analytics_dev_staging.stg_dim_location ............ [RUN]
[0m20:27:57.974155 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fact_sales_order_tt'
[0m20:27:57.973061 [info ] [Thread-2 (]: 2 of 15 START sql view model analytics_dev_staging.stg_dim_product ............. [RUN]
[0m20:27:57.975196 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fx_rate'
[0m20:27:57.975924 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_location'
[0m20:27:57.976558 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.stg_fact_sales_order_tt
[0m20:27:57.977210 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_product'
[0m20:27:57.977901 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.stg_fx_rate
[0m20:27:57.978839 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.stg_dim_location
[0m20:27:57.995323 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m20:27:57.996005 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.stg_dim_product
[0m20:27:58.000579 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.stg_fx_rate"
[0m20:27:58.007309 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_location"
[0m20:27:58.017590 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_product"
[0m20:27:58.023419 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.stg_fx_rate
[0m20:27:58.029019 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.stg_fact_sales_order_tt
[0m20:27:58.071997 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m20:27:58.079254 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.stg_fx_rate"
[0m20:27:58.080608 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.stg_dim_product
[0m20:27:58.081693 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.stg_dim_location
[0m20:27:58.086836 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_product"
[0m20:27:58.091651 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_location"
[0m20:27:58.094554 [debug] [Thread-2 (]: On model.glamira_analytics.stg_dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_product"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
  OPTIONS()
  as WITH source AS (
    SELECT DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`product` -- Updated source
)

, renamed AS (
    SELECT
        SAFE_CAST(product_id AS INT64) AS product_id
        ,CAST(name AS STRING) AS product_name
        ,CAST(url AS STRING) AS product_url
        ,CAST(sku AS STRING) AS product_sku
        ,CAST(product_type AS STRING) AS product_type_name
        ,CAST(category_name AS STRING) AS category_name
        ,CAST(collection AS STRING) AS collection_name
        ,SAFE_CAST(min_price AS NUMERIC) AS min_price
        ,SAFE_CAST(max_price AS NUMERIC) AS max_price
    FROM source
    WHERE product_id IS NOT NULL
)

SELECT * FROM renamed;


[0m20:27:58.095925 [debug] [Thread-4 (]: On model.glamira_analytics.stg_fx_rate: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fx_rate"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
  OPTIONS()
  as WITH source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`raw_layer`.`exchange_rate_usd`
)

, renamed AS (
    SELECT
        CAST(currency AS STRING) AS currency_code
        ,CAST(rate_to_usd AS NUMERIC) AS rate_to_usd
        ,CAST(as_of_gmt AS TIMESTAMP) AS rate_timestamp
    FROM source
)

SELECT * FROM renamed;


[0m20:27:58.097243 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m20:27:58.098378 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:27:58.099669 [debug] [Thread-1 (]: On model.glamira_analytics.stg_dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_location"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
  OPTIONS()
  as WITH source AS (
    SELECT DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`ip_location` -- Updated source
    WHERE status = 'success'
)

, renamed AS (
    SELECT
        CAST(ip AS STRING) AS ip_address
        ,CAST(country_short AS STRING) AS country_code
        ,CAST(country_long AS STRING) AS country_name
        ,CAST(region AS STRING) AS region_name
        ,CAST(city AS STRING) AS city_name
    FROM source
    WHERE country_short <> '-' 
      AND country_short IS NOT NULL
)

, gen_id AS (
    SELECT
        -- Generating a hash to act as the Natural Key for location
        FARM_FINGERPRINT(CONCAT(country_code, region_name, city_name)) AS location_id
        ,ip_address
        ,country_code
        ,country_name
        ,region_name
        ,city_name
    FROM renamed
)

SELECT * FROM gen_id;


[0m20:27:58.101832 [debug] [Thread-3 (]: On model.glamira_analytics.stg_fact_sales_order_tt: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fact_sales_order_tt"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
  OPTIONS()
  as WITH source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`raw_layer`.`summary` -- Updated source
    WHERE collection = 'checkout_success'
)

/* 1. Remove failed URLs */
, filter_url AS (
    SELECT *
    FROM source 
    WHERE current_url NOT LIKE 'file://%'
)

/* 2. Unnest cart_products */
, unnested AS (
    SELECT 
        s.*
        ,cp
    FROM filter_url s
    CROSS JOIN UNNEST(s.cart_products) AS cp
)

, renamed AS (
    SELECT
        -- Cleaning IDs
        SAFE_CAST(REGEXP_REPLACE(CAST(s.order_id AS STRING), r'\..*', '') AS INT64) AS order_id
        
        ,cp.price AS raw_price
        
        ,SAFE_CAST(REGEXP_REPLACE(CAST(cp.product_id AS STRING), r'\..*', '') AS INT64) AS product_id
        
        ,SAFE_CAST(REGEXP_REPLACE(CAST(s.user_id_db AS STRING), r'\..*', '') AS INT64) AS user_id
        
        ,SAFE_CAST(REGEXP_REPLACE(CAST(s.store_id AS STRING), r'\..*', '') AS INT64) AS store_id
        
        ,cp.qty AS quantity
        
        ,s.time_stamp
        
        -- Handling Timestamps
        ,DATETIME(TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64)), s.timezone) AS local_time
        
        ,s.currency
        
        -- Standardizing Currency Codes
        ,CASE 
            WHEN s.currency IN ('USD', 'USD $') THEN 'USD'
            WHEN s.currency = 'HKD $'    THEN 'HKD'
            WHEN s.currency = 'NZD $'    THEN 'NZD'
            WHEN s.currency = 'MXN $'    THEN 'MXN'
            WHEN s.currency = 'Kƒç'       THEN 'CZK'
            WHEN s.currency = 'Ft'       THEN 'HUF'
            WHEN s.currency = 'z≈Ç'       THEN 'PLN'
            WHEN s.currency = '‚Çπ'        THEN 'INR'
            WHEN s.currency = '–ª–≤.'      THEN 'BGN'
            WHEN s.currency = '‚Ç´'        THEN 'VND'
            WHEN s.currency = '‚Ç±'        THEN 'PHP'
            WHEN s.currency = '‚Ç≤'        THEN 'PYG'
            WHEN s.currency = 'CRC ‚Ç°'    THEN 'CRC'
            WHEN s.currency = 'COP $'    THEN 'COP'
            WHEN s.currency = 'BOB Bs'   THEN 'BOB'
            WHEN s.currency = 'GTQ Q'    THEN 'GTQ'
            WHEN s.currency = 'PEN S/.'  THEN 'PEN'
            WHEN s.currency = 'DOP $'    THEN 'DOP'
            WHEN s.currency = 'CLP'      THEN 'CLP'
            WHEN s.currency = 'Lei'      THEN 'RON'
            WHEN s.currency = 'UYU'      THEN 'UYU'
            WHEN s.currency = 'din.'     THEN 'RSD'
            WHEN s.currency = 'kn'       THEN 'HRK'
            WHEN s.currency = 'ÿØ.ŸÉ.'     THEN 'KWD'
            WHEN s.currency = 'CHF'      THEN 'CHF'
            WHEN s.currency = 'kr'       THEN 'SEK'
            WHEN s.currency = '‚Ç¨'        THEN 'EUR'
            WHEN s.currency = '¬£'        THEN 'GBP'
            WHEN s.currency = 'AU$'      THEN 'AUD'
            WHEN s.currency = 'CA$'      THEN 'CAD'
            WHEN s.currency = '¬•'        THEN 'JPY'
            ELSE 'USD' 
        END AS currency_code
        
        ,cp.price * cp.qty AS line_total
        ,s.email AS email_address
        ,s.ip AS ip_address
        
        -- Generating Location ID Hash
        ,FARM_FINGERPRINT(CONCAT(
            CAST(s.country_short AS STRING), 
            CAST(s.region AS STRING), 
            CAST(s.city AS STRING)
        )) AS location_id

    FROM unnested s
)

SELECT * FROM renamed;


[0m20:27:58.104724 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m20:27:58.106807 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m20:27:59.580815 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:757e5ef4-4c1f-4dce-afa4-a44b6711c2d2&page=queryresults
[0m20:27:59.583278 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:e19dab85-7b66-4b9a-879d-d2458d129987&page=queryresults
[0m20:27:59.795223 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:e19dab85-7b66-4b9a-879d-d2458d129987&page=queryresults
[0m20:27:59.994456 [debug] [Thread-1 (]: Database Error in model stg_dim_location (models\staging\stg_dim_location.sql)
  Unrecognized name: status at [9:11]
  compiled code at target\run\glamira_analytics\models\staging\stg_dim_location.sql
[0m20:27:59.998118 [debug] [Thread-2 (]: SQL status: OK in 0.416 seconds
[0m20:28:00.036193 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1ea7a035-8722-433e-aea9-a69cad6b22ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025783778230>]}
[0m20:28:00.036927 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1ea7a035-8722-433e-aea9-a69cad6b22ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000257838AC0E0>]}
[0m20:28:00.037999 [error] [Thread-1 (]: 1 of 15 ERROR creating sql view model analytics_dev_staging.stg_dim_location ... [[31mERROR[0m in 2.02s]
[0m20:28:00.040312 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.stg_dim_location
[0m20:28:00.039126 [info ] [Thread-2 (]: 2 of 15 OK created sql view model analytics_dev_staging.stg_dim_product ........ [[32mCREATE VIEW (0 processed)[0m in 2.06s]
[0m20:28:00.041378 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.stg_dim_location' to be skipped because of status 'error'.  Reason: Database Error in model stg_dim_location (models\staging\stg_dim_location.sql)
  Unrecognized name: status at [9:11]
  compiled code at target\run\glamira_analytics\models\staging\stg_dim_location.sql.
[0m20:28:00.042256 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.stg_dim_product
[0m20:28:00.044355 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_location
[0m20:28:00.046718 [debug] [Thread-2 (]: Began running node model.glamira_analytics.dim_product
[0m20:28:00.045707 [info ] [Thread-1 (]: 5 of 15 SKIP relation analytics_dev.dim_location ............................... [[33mSKIP[0m]
[0m20:28:00.049017 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_location
[0m20:28:00.048140 [info ] [Thread-2 (]: 6 of 15 START sql view model analytics_dev.dim_product ......................... [RUN]
[0m20:28:00.050235 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_dim_product, now model.glamira_analytics.dim_product)
[0m20:28:00.050984 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.dim_product
[0m20:28:00.056596 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.dim_product"
[0m20:28:00.060177 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.dim_product
[0m20:28:00.070625 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:28:00.095735 [debug] [Thread-2 (]: Compilation Error in model dim_product (models\dimensions\dim_product.sql)
  Trying to create view `stone-album-475912-b9`.`analytics_dev`.`dim_product`, but it currently exists as a table. Either drop `stone-album-475912-b9`.`analytics_dev`.`dim_product` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model dim_product (models\dimensions\dim_product.sql)
[0m20:28:00.096784 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1ea7a035-8722-433e-aea9-a69cad6b22ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025783873C40>]}
[0m20:28:00.097832 [error] [Thread-2 (]: 6 of 15 ERROR creating sql view model analytics_dev.dim_product ................ [[31mERROR[0m in 0.05s]
[0m20:28:00.099805 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.dim_product
[0m20:28:00.101345 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.dim_product' to be skipped because of status 'error'.  Reason: Compilation Error in model dim_product (models\dimensions\dim_product.sql)
  Trying to create view `stone-album-475912-b9`.`analytics_dev`.`dim_product`, but it currently exists as a table. Either drop `stone-album-475912-b9`.`analytics_dev`.`dim_product` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model dim_product (models\dimensions\dim_product.sql).
[0m20:28:00.301220 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:271af7bd-fa37-4b83-a213-4b2a456ebe4f&page=queryresults
[0m20:28:00.302096 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:271af7bd-fa37-4b83-a213-4b2a456ebe4f&page=queryresults
[0m20:28:00.312739 [debug] [Thread-4 (]: Database Error in model stg_fx_rate (models\staging\stg_fx_rate.sql)
  Not found: Table stone-album-475912-b9:raw_layer.exchange_rate_usd was not found in location asia-southeast1
  compiled code at target\run\glamira_analytics\models\staging\stg_fx_rate.sql
[0m20:28:00.313796 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1ea7a035-8722-433e-aea9-a69cad6b22ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025783662510>]}
[0m20:28:00.315097 [error] [Thread-4 (]: 4 of 15 ERROR creating sql view model analytics_dev_staging.stg_fx_rate ........ [[31mERROR[0m in 2.34s]
[0m20:28:00.316628 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.stg_fx_rate
[0m20:28:00.317854 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.stg_fx_rate' to be skipped because of status 'error'.  Reason: Database Error in model stg_fx_rate (models\staging\stg_fx_rate.sql)
  Not found: Table stone-album-475912-b9:raw_layer.exchange_rate_usd was not found in location asia-southeast1
  compiled code at target\run\glamira_analytics\models\staging\stg_fx_rate.sql.
[0m20:28:00.319233 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_fx_rate_usd
[0m20:28:00.320292 [info ] [Thread-1 (]: 7 of 15 SKIP relation analytics_dev.dim_fx_rate_usd ............................ [[33mSKIP[0m]
[0m20:28:00.322768 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_fx_rate_usd
[0m20:28:00.401617 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:dc742e89-f64f-40f9-8c19-3d69c806151d&page=queryresults
[0m20:28:00.608100 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:dc742e89-f64f-40f9-8c19-3d69c806151d&page=queryresults
[0m20:28:00.618233 [debug] [Thread-3 (]: Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Field name qty does not exist in STRUCT<currency STRING, option ARRAY<STRUCT<value_id INT64, value_label STRING, option_id INT64, ...>>, price FLOAT64, ...> at [41:13]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m20:28:00.619100 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1ea7a035-8722-433e-aea9-a69cad6b22ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000025783660C50>]}
[0m20:28:00.619995 [error] [Thread-3 (]: 3 of 15 ERROR creating sql view model analytics_dev_staging.stg_fact_sales_order_tt  [[31mERROR[0m in 2.65s]
[0m20:28:00.622404 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.stg_fact_sales_order_tt
[0m20:28:00.624337 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.stg_fact_sales_order_tt' to be skipped because of status 'error'.  Reason: Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Field name qty does not exist in STRUCT<currency STRING, option ARRAY<STRUCT<value_id INT64, value_label STRING, option_id INT64, ...>>, price FLOAT64, ...> at [41:13]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql.
[0m20:28:00.626288 [debug] [Thread-3 (]: Began running node model.glamira_analytics.fact_sales_order_tt
[0m20:28:00.626868 [debug] [Thread-4 (]: Began running node model.glamira_analytics.dim_store
[0m20:28:00.627459 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_user
[0m20:28:00.628616 [debug] [Thread-2 (]: Began running node model.glamira_analytics.dim_date
[0m20:28:00.629698 [info ] [Thread-3 (]: 11 of 15 SKIP relation analytics_dev.fact_sales_order_tt ....................... [[33mSKIP[0m]
[0m20:28:00.630712 [info ] [Thread-4 (]: 9 of 15 SKIP relation analytics_dev.dim_store .................................. [[33mSKIP[0m]
[0m20:28:00.634188 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.fact_sales_order_tt
[0m20:28:00.632281 [info ] [Thread-1 (]: 10 of 15 SKIP relation analytics_dev.dim_user .................................. [[33mSKIP[0m]
[0m20:28:00.634966 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.dim_store
[0m20:28:00.633355 [info ] [Thread-2 (]: 8 of 15 SKIP relation analytics_dev.dim_date ................................... [[33mSKIP[0m]
[0m20:28:00.636151 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_user
[0m20:28:00.637425 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.dim_date
[0m20:28:00.639318 [debug] [Thread-2 (]: Began running node model.glamira_analytics.mart_product_type
[0m20:28:00.640684 [debug] [Thread-4 (]: Began running node model.glamira_analytics.mart_overall
[0m20:28:00.641477 [debug] [Thread-1 (]: Began running node model.glamira_analytics.mart_product
[0m20:28:00.642104 [debug] [Thread-3 (]: Began running node model.glamira_analytics.mart_country
[0m20:28:00.642761 [info ] [Thread-2 (]: 15 of 15 SKIP relation analytics_dev.mart_product_type ......................... [[33mSKIP[0m]
[0m20:28:00.643359 [info ] [Thread-4 (]: 13 of 15 SKIP relation analytics_dev.mart_overall .............................. [[33mSKIP[0m]
[0m20:28:00.644470 [info ] [Thread-1 (]: 14 of 15 SKIP relation analytics_dev.mart_product .............................. [[33mSKIP[0m]
[0m20:28:00.646306 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.mart_product_type
[0m20:28:00.645266 [info ] [Thread-3 (]: 12 of 15 SKIP relation analytics_dev.mart_country .............................. [[33mSKIP[0m]
[0m20:28:00.647635 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.mart_overall
[0m20:28:00.648537 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.mart_product
[0m20:28:00.649536 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.mart_country
[0m20:28:00.652067 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:28:00.653165 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:28:00.653814 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m20:28:00.654784 [debug] [MainThread]: Connection 'create_stone-album-475912-b9_analytics_dev_staging' was properly closed.
[0m20:28:00.655855 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev' was properly closed.
[0m20:28:00.656947 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_staging' was properly closed.
[0m20:28:00.657828 [debug] [MainThread]: Connection 'model.glamira_analytics.stg_fact_sales_order_tt' was properly closed.
[0m20:28:00.658380 [debug] [MainThread]: Connection 'model.glamira_analytics.stg_fx_rate' was properly closed.
[0m20:28:00.658829 [debug] [MainThread]: Connection 'model.glamira_analytics.stg_dim_location' was properly closed.
[0m20:28:00.659259 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_product' was properly closed.
[0m20:28:00.659824 [info ] [MainThread]: 
[0m20:28:00.660540 [info ] [MainThread]: Finished running 1 incremental model, 4 table models, 10 view models in 0 hours 0 minutes and 16.55 seconds (16.55s).
[0m20:28:00.663900 [debug] [MainThread]: Command end result
[0m20:28:00.710668 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m20:28:00.713823 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m20:28:00.725761 [debug] [MainThread]: Wrote artifact RunExecutionResult to D:\Project 7\glamira_analytics\target\run_results.json
[0m20:28:00.726544 [info ] [MainThread]: 
[0m20:28:00.727511 [info ] [MainThread]: [31mCompleted with 4 errors, 0 partial successes, and 0 warnings:[0m
[0m20:28:00.728401 [info ] [MainThread]: 
[0m20:28:00.729448 [error] [MainThread]: [31mFailure in model stg_dim_location (models\staging\stg_dim_location.sql)[0m
[0m20:28:00.730325 [error] [MainThread]:   Database Error in model stg_dim_location (models\staging\stg_dim_location.sql)
  Unrecognized name: status at [9:11]
  compiled code at target\run\glamira_analytics\models\staging\stg_dim_location.sql
[0m20:28:00.731020 [info ] [MainThread]: 
[0m20:28:00.731879 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\staging\stg_dim_location.sql
[0m20:28:00.732597 [info ] [MainThread]: 
[0m20:28:00.733953 [error] [MainThread]: [31mFailure in model dim_product (models\dimensions\dim_product.sql)[0m
[0m20:28:00.735306 [error] [MainThread]:   Compilation Error in model dim_product (models\dimensions\dim_product.sql)
  Trying to create view `stone-album-475912-b9`.`analytics_dev`.`dim_product`, but it currently exists as a table. Either drop `stone-album-475912-b9`.`analytics_dev`.`dim_product` manually, or run dbt with `--full-refresh` and dbt will drop it for you.
  
  > in macro bigquery__handle_existing_table (macros\materializations\view.sql)
  > called by macro handle_existing_table (macros\relations\view\replace.sql)
  > called by macro bigquery__create_or_replace_view (macros\relations\view\replace.sql)
  > called by macro materialization_view_bigquery (macros\materializations\view.sql)
  > called by model dim_product (models\dimensions\dim_product.sql)
[0m20:28:00.736192 [info ] [MainThread]: 
[0m20:28:00.736952 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\dimensions\dim_product.sql
[0m20:28:00.737870 [info ] [MainThread]: 
[0m20:28:00.738773 [error] [MainThread]: [31mFailure in model stg_fx_rate (models\staging\stg_fx_rate.sql)[0m
[0m20:28:00.739732 [error] [MainThread]:   Database Error in model stg_fx_rate (models\staging\stg_fx_rate.sql)
  Not found: Table stone-album-475912-b9:raw_layer.exchange_rate_usd was not found in location asia-southeast1
  compiled code at target\run\glamira_analytics\models\staging\stg_fx_rate.sql
[0m20:28:00.740643 [info ] [MainThread]: 
[0m20:28:00.741955 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\staging\stg_fx_rate.sql
[0m20:28:00.743217 [info ] [MainThread]: 
[0m20:28:00.744444 [error] [MainThread]: [31mFailure in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)[0m
[0m20:28:00.745766 [error] [MainThread]:   Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Field name qty does not exist in STRUCT<currency STRING, option ARRAY<STRUCT<value_id INT64, value_label STRING, option_id INT64, ...>>, price FLOAT64, ...> at [41:13]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m20:28:00.746729 [info ] [MainThread]: 
[0m20:28:00.748264 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m20:28:00.749746 [info ] [MainThread]: 
[0m20:28:00.750895 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=4 SKIP=10 NO-OP=0 TOTAL=15
[0m20:28:00.752470 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 3 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m20:28:00.754263 [debug] [MainThread]: Command `dbt run` failed at 20:28:00.753995 after 32.47 seconds
[0m20:28:00.755012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002578381B0B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000257838D3B90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000257838D39B0>]}
[0m20:28:00.755748 [debug] [MainThread]: Flushing usage events
[0m20:28:04.798765 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:35:16.765293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25C818EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25D97FED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25D97FB10>]}


============================== 20:35:16.773004 | 838bf03e-87d3-4f48-8c90-42331ddd9d54 ==============================
[0m20:35:16.773004 [info ] [MainThread]: Running with dbt=1.11.2
[0m20:35:16.774158 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'no_print': 'None', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'write_json': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'empty': 'None', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'fail_fast': 'False', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'use_colors': 'True', 'indirect_selection': 'eager', 'invocation_command': 'dbt seed', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m20:35:28.047412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '838bf03e-87d3-4f48-8c90-42331ddd9d54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F25CCB1BA0>]}
[0m20:35:28.131273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '838bf03e-87d3-4f48-8c90-42331ddd9d54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F26D43F570>]}
[0m20:35:28.132164 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m20:35:29.383013 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m20:35:29.675568 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 2 files changed.
[0m20:35:29.676414 [debug] [MainThread]: Partial parsing: added file: glamira_analytics://seeds\exchange_rate_usd.csv
[0m20:35:29.676824 [debug] [MainThread]: Partial parsing: deleted file: glamira_analytics://seeds\dim_fx_rate.csv
[0m20:35:29.677341 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\staging\stg_fact_sales_order_tt.sql
[0m20:35:29.677843 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\staging\stg_dim_location.sql
[0m20:35:30.260550 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.glamira_analytics.analytics
- seeds.Project7
- seeds.Project7.exchange_rate_usd
[0m20:35:30.277892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '838bf03e-87d3-4f48-8c90-42331ddd9d54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F27D145C50>]}
[0m20:35:30.424170 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m20:35:30.427432 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m20:35:30.470114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '838bf03e-87d3-4f48-8c90-42331ddd9d54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F27CF7AE40>]}
[0m20:35:30.471157 [info ] [MainThread]: Found 15 models, 5 data tests, 1 seed, 4 sources, 537 macros
[0m20:35:30.472136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '838bf03e-87d3-4f48-8c90-42331ddd9d54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F27D067D90>]}
[0m20:35:30.475360 [info ] [MainThread]: 
[0m20:35:30.476071 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:35:30.476641 [info ] [MainThread]: 
[0m20:35:30.477427 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:35:30.479311 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m20:35:30.480316 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:35:32.508194 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev'
[0m20:35:32.509043 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:35:32.509781 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_staging'
[0m20:35:32.511340 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:35:33.529809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '838bf03e-87d3-4f48-8c90-42331ddd9d54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F27D32A680>]}
[0m20:35:33.530571 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:35:33.537169 [debug] [Thread-1 (]: Began running node seed.glamira_analytics.exchange_rate_usd
[0m20:35:33.538178 [info ] [Thread-1 (]: 1 of 1 START seed file analytics_dev.exchange_rate_usd ......................... [RUN]
[0m20:35:33.539259 [debug] [Thread-1 (]: Acquiring new bigquery connection 'seed.glamira_analytics.exchange_rate_usd'
[0m20:35:33.539946 [debug] [Thread-1 (]: Began compiling node seed.glamira_analytics.exchange_rate_usd
[0m20:35:33.540609 [debug] [Thread-1 (]: Began executing node seed.glamira_analytics.exchange_rate_usd
[0m20:35:33.664318 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m20:35:37.321213 [debug] [Thread-1 (]: On seed.glamira_analytics.exchange_rate_usd: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "seed.glamira_analytics.exchange_rate_usd"} */

    alter table `stone-album-475912-b9`.`analytics_dev`.`exchange_rate_usd` set OPTIONS()
  
[0m20:35:37.919762 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:29b2f643-a4ac-4c7c-a801-1eaee0d6c2af&page=queryresults
[0m20:35:38.328902 [debug] [Thread-1 (]: SQL status: OK in 0.408 seconds
[0m20:35:38.339070 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.glamira_analytics.exchange_rate_usd"
[0m20:35:38.370337 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '838bf03e-87d3-4f48-8c90-42331ddd9d54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F27D9B5310>]}
[0m20:35:38.371694 [info ] [Thread-1 (]: 1 of 1 OK loaded seed file analytics_dev.exchange_rate_usd ..................... [[32mINSERT 34[0m in 4.83s]
[0m20:35:38.373411 [debug] [Thread-1 (]: Finished running node seed.glamira_analytics.exchange_rate_usd
[0m20:35:38.375764 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:35:38.377000 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:35:38.377586 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m20:35:38.378178 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev' was properly closed.
[0m20:35:38.378758 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_staging' was properly closed.
[0m20:35:38.379311 [debug] [MainThread]: Connection 'seed.glamira_analytics.exchange_rate_usd' was properly closed.
[0m20:35:38.379959 [info ] [MainThread]: 
[0m20:35:38.380735 [info ] [MainThread]: Finished running 1 seed in 0 hours 0 minutes and 7.90 seconds (7.90s).
[0m20:35:38.382361 [debug] [MainThread]: Command end result
[0m20:35:38.438195 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m20:35:38.443378 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m20:35:38.456250 [debug] [MainThread]: Wrote artifact RunExecutionResult to D:\Project 7\glamira_analytics\target\run_results.json
[0m20:35:38.457475 [info ] [MainThread]: 
[0m20:35:38.459109 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:35:38.460535 [info ] [MainThread]: 
[0m20:35:38.461478 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m20:35:38.462835 [debug] [MainThread]: Command `dbt seed` succeeded at 20:35:38.462638 after 21.96 seconds
[0m20:35:38.463382 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F27CFBFE30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F26D5900F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F26D5932F0>]}
[0m20:35:38.463899 [debug] [MainThread]: Flushing usage events
[0m20:35:40.171616 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:36:11.209504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3C5E64EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3C6FCFED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3C6FCFB10>]}


============================== 20:36:11.217289 | 7f024323-fa1c-40bf-b2fb-af5f49667474 ==============================
[0m20:36:11.217289 [info ] [MainThread]: Running with dbt=1.11.2
[0m20:36:11.218769 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'no_print': 'None', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'printer_width': '80', 'write_json': 'True', 'empty': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'indirect_selection': 'eager', 'use_colors': 'True', 'invocation_command': 'dbt run --full-refresh', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m20:36:26.941094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7f024323-fa1c-40bf-b2fb-af5f49667474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3C6301BA0>]}
[0m20:36:27.052705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7f024323-fa1c-40bf-b2fb-af5f49667474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3D699F570>]}
[0m20:36:27.053668 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m20:36:27.951377 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m20:36:28.226366 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m20:36:28.228986 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\staging\_src_glamira.yml
[0m20:36:28.229662 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\staging\stg_fx_rate.sql
[0m20:36:28.771795 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `relationships` defined on
'fact_sales_order_tt' in package 'glamira_analytics'
(models\dimensions\schema.yml). Arguments to generic tests should be nested
under the `arguments` property.
[0m20:36:28.773301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '7f024323-fa1c-40bf-b2fb-af5f49667474', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3E5BC7950>]}
[0m20:36:29.062754 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.glamira_analytics.analytics
- seeds.Project7.exchange_rate_usd
- seeds.Project7
[0m20:36:29.077966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7f024323-fa1c-40bf-b2fb-af5f49667474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3E6807D40>]}
[0m20:36:29.214683 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m20:36:29.217909 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m20:36:29.259632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7f024323-fa1c-40bf-b2fb-af5f49667474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3E6B9CD70>]}
[0m20:36:29.260359 [info ] [MainThread]: Found 1 seed, 15 models, 5 data tests, 3 sources, 537 macros
[0m20:36:29.261104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f024323-fa1c-40bf-b2fb-af5f49667474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3E6AE58B0>]}
[0m20:36:29.264318 [info ] [MainThread]: 
[0m20:36:29.265120 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:36:29.266031 [info ] [MainThread]: 
[0m20:36:29.267469 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:36:29.276399 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m20:36:29.277191 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:36:29.277892 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m20:36:29.278680 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:36:31.170881 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev'
[0m20:36:31.172074 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:36:31.173235 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_staging'
[0m20:36:31.175061 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:36:32.061496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f024323-fa1c-40bf-b2fb-af5f49667474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3E6A9EE10>]}
[0m20:36:32.062287 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:36:32.068381 [debug] [Thread-2 (]: Began running node model.glamira_analytics.stg_dim_product
[0m20:36:32.073488 [debug] [Thread-1 (]: Began running node model.glamira_analytics.stg_dim_location
[0m20:36:32.074331 [debug] [Thread-4 (]: Began running node model.glamira_analytics.stg_fx_rate
[0m20:36:32.075059 [debug] [Thread-3 (]: Began running node model.glamira_analytics.stg_fact_sales_order_tt
[0m20:36:32.075959 [info ] [Thread-2 (]: 2 of 15 START sql view model analytics_dev_staging.stg_dim_product ............. [RUN]
[0m20:36:32.076844 [info ] [Thread-1 (]: 1 of 15 START sql view model analytics_dev_staging.stg_dim_location ............ [RUN]
[0m20:36:32.077943 [info ] [Thread-4 (]: 4 of 15 START sql view model analytics_dev_staging.stg_fx_rate ................. [RUN]
[0m20:36:32.080119 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_product'
[0m20:36:32.079008 [info ] [Thread-3 (]: 3 of 15 START sql view model analytics_dev_staging.stg_fact_sales_order_tt ..... [RUN]
[0m20:36:32.081311 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_location'
[0m20:36:32.082279 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fx_rate'
[0m20:36:32.082993 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.stg_dim_product
[0m20:36:32.083802 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fact_sales_order_tt'
[0m20:36:32.084544 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.stg_dim_location
[0m20:36:32.085242 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.stg_fx_rate
[0m20:36:32.097775 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_product"
[0m20:36:32.098639 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.stg_fact_sales_order_tt
[0m20:36:32.103607 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_location"
[0m20:36:32.108906 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.stg_fx_rate"
[0m20:36:32.115180 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m20:36:32.116664 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.stg_dim_product
[0m20:36:32.123502 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.stg_dim_location
[0m20:36:32.124580 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.stg_fx_rate
[0m20:36:32.166910 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_product"
[0m20:36:32.172277 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_location"
[0m20:36:32.177522 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.stg_fx_rate"
[0m20:36:32.178363 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.stg_fact_sales_order_tt
[0m20:36:32.183396 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m20:36:32.185288 [debug] [Thread-1 (]: On model.glamira_analytics.stg_dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_location"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
  OPTIONS()
  as WITH source AS (
    SELECT DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`ip_location`
)

, renamed AS (
    SELECT
        CAST(ip AS STRING) AS ip_address
        ,CAST(country_short AS STRING) AS country_code
        ,CAST(country_long AS STRING) AS country_name
        ,CAST(region AS STRING) AS region_name
        ,CAST(city AS STRING) AS city_name
    FROM source
    WHERE country_short <> '-' 
      AND country_short IS NOT NULL
)

, gen_id AS (
    SELECT
        FARM_FINGERPRINT(CONCAT(country_code, region_name, city_name)) AS location_id
        ,ip_address
        ,country_code
        ,country_name
        ,region_name
        ,city_name
    FROM renamed
)

SELECT * FROM gen_id;


[0m20:36:32.186259 [debug] [Thread-2 (]: On model.glamira_analytics.stg_dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_product"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
  OPTIONS()
  as WITH source AS (
    SELECT DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`product` -- Updated source
)

, renamed AS (
    SELECT
        SAFE_CAST(product_id AS INT64) AS product_id
        ,CAST(name AS STRING) AS product_name
        ,CAST(url AS STRING) AS product_url
        ,CAST(sku AS STRING) AS product_sku
        ,CAST(product_type AS STRING) AS product_type_name
        ,CAST(category_name AS STRING) AS category_name
        ,CAST(collection AS STRING) AS collection_name
        ,SAFE_CAST(min_price AS NUMERIC) AS min_price
        ,SAFE_CAST(max_price AS NUMERIC) AS max_price
    FROM source
    WHERE product_id IS NOT NULL
)

SELECT * FROM renamed;


[0m20:36:32.187272 [debug] [Thread-4 (]: On model.glamira_analytics.stg_fx_rate: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fx_rate"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
  OPTIONS()
  as WITH source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev`.`exchange_rate_usd`
)

, renamed AS (
    SELECT
        CAST(currency AS STRING) AS currency_code
        ,CAST(rate_to_usd AS NUMERIC) AS rate_to_usd
        ,CAST(as_of_gmt AS TIMESTAMP) AS rate_timestamp
    FROM source
)

SELECT * FROM renamed;


[0m20:36:32.188576 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m20:36:32.189944 [debug] [Thread-3 (]: On model.glamira_analytics.stg_fact_sales_order_tt: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fact_sales_order_tt"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
  OPTIONS()
  as WITH source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`raw_layer`.`summary` -- Updated source
    WHERE collection = 'checkout_success'
)

/* 1. Remove failed URLs */
, filter_url AS (
    SELECT *
    FROM source 
    WHERE current_url NOT LIKE 'file://%'
)

/* 2. Unnest cart_products */
, unnested AS (
    SELECT 
        s.*
        ,cp
    FROM filter_url s
    CROSS JOIN UNNEST(s.cart_products) AS cp
)

, renamed AS (
    SELECT
        -- Cleaning IDs
        SAFE_CAST(REGEXP_REPLACE(CAST(s.order_id AS STRING), r'\..*', '') AS INT64) AS order_id
        
        ,cp.price AS raw_price
        
        ,SAFE_CAST(REGEXP_REPLACE(CAST(cp.product_id AS STRING), r'\..*', '') AS INT64) AS product_id
        
        ,SAFE_CAST(REGEXP_REPLACE(CAST(s.user_id_db AS STRING), r'\..*', '') AS INT64) AS user_id
        
        ,SAFE_CAST(REGEXP_REPLACE(CAST(s.store_id AS STRING), r'\..*', '') AS INT64) AS store_id
        
        ,CAST(cp.quantity AS INT64) AS quantity
        
        ,s.time_stamp
        
        -- Handling Timestamps
        ,DATETIME(TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64)), s.timezone) AS local_time
        
        ,s.currency
        
        -- Standardizing Currency Codes
        ,CASE 
            WHEN s.currency IN ('USD', 'USD $') THEN 'USD'
            WHEN s.currency = 'HKD $'    THEN 'HKD'
            WHEN s.currency = 'NZD $'    THEN 'NZD'
            WHEN s.currency = 'MXN $'    THEN 'MXN'
            WHEN s.currency = 'Kƒç'       THEN 'CZK'
            WHEN s.currency = 'Ft'       THEN 'HUF'
            WHEN s.currency = 'z≈Ç'       THEN 'PLN'
            WHEN s.currency = '‚Çπ'        THEN 'INR'
            WHEN s.currency = '–ª–≤.'      THEN 'BGN'
            WHEN s.currency = '‚Ç´'        THEN 'VND'
            WHEN s.currency = '‚Ç±'        THEN 'PHP'
            WHEN s.currency = '‚Ç≤'        THEN 'PYG'
            WHEN s.currency = 'CRC ‚Ç°'    THEN 'CRC'
            WHEN s.currency = 'COP $'    THEN 'COP'
            WHEN s.currency = 'BOB Bs'   THEN 'BOB'
            WHEN s.currency = 'GTQ Q'    THEN 'GTQ'
            WHEN s.currency = 'PEN S/.'  THEN 'PEN'
            WHEN s.currency = 'DOP $'    THEN 'DOP'
            WHEN s.currency = 'CLP'      THEN 'CLP'
            WHEN s.currency = 'Lei'      THEN 'RON'
            WHEN s.currency = 'UYU'      THEN 'UYU'
            WHEN s.currency = 'din.'     THEN 'RSD'
            WHEN s.currency = 'kn'       THEN 'HRK'
            WHEN s.currency = 'ÿØ.ŸÉ.'     THEN 'KWD'
            WHEN s.currency = 'CHF'      THEN 'CHF'
            WHEN s.currency = 'kr'       THEN 'SEK'
            WHEN s.currency = '‚Ç¨'        THEN 'EUR'
            WHEN s.currency = '¬£'        THEN 'GBP'
            WHEN s.currency = 'AU$'      THEN 'AUD'
            WHEN s.currency = 'CA$'      THEN 'CAD'
            WHEN s.currency = '¬•'        THEN 'JPY'
            ELSE 'USD' 
        END AS currency_code
        
        ,cp.price * CAST(cp.quantity AS INT64) AS line_total
        ,s.email AS email_address
        ,s.ip AS ip_address
        
        -- Generating Location ID Hash
        ,FARM_FINGERPRINT(CONCAT(
            CAST(s.country_short AS STRING), 
            CAST(s.region AS STRING), 
            CAST(s.city AS STRING)
        )) AS location_id

    FROM unnested s
)

SELECT * FROM renamed;


[0m20:36:32.191323 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m20:36:32.192221 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:36:32.193594 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m20:36:34.438772 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:ba3d8cda-58d0-4479-a879-564702f8dda9&page=queryresults
[0m20:36:34.448423 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:551e762f-bdb1-4eb6-af18-a1fa56766728&page=queryresults
[0m20:36:34.452482 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:b1de51c8-77b6-4396-a665-69dc7dbf0e96&page=queryresults
[0m20:36:34.508663 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:3fc3fe7b-9ddf-485d-996c-f067d55e543d&page=queryresults
[0m20:36:34.613818 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:551e762f-bdb1-4eb6-af18-a1fa56766728&page=queryresults
[0m20:36:34.629076 [debug] [Thread-1 (]: Database Error in model stg_dim_location (models\staging\stg_dim_location.sql)
  Unrecognized name: country_short; Did you mean country_code? at [19:11]
  compiled code at target\run\glamira_analytics\models\staging\stg_dim_location.sql
[0m20:36:34.634528 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f024323-fa1c-40bf-b2fb-af5f49667474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3E6B95910>]}
[0m20:36:34.636008 [error] [Thread-1 (]: 1 of 15 ERROR creating sql view model analytics_dev_staging.stg_dim_location ... [[31mERROR[0m in 2.55s]
[0m20:36:34.637507 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.stg_dim_location
[0m20:36:34.638851 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.stg_dim_location' to be skipped because of status 'error'.  Reason: Database Error in model stg_dim_location (models\staging\stg_dim_location.sql)
  Unrecognized name: country_short; Did you mean country_code? at [19:11]
  compiled code at target\run\glamira_analytics\models\staging\stg_dim_location.sql.
[0m20:36:34.640838 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_location
[0m20:36:34.641593 [info ] [Thread-1 (]: 5 of 15 SKIP relation analytics_dev.dim_location ............................... [[33mSKIP[0m]
[0m20:36:34.642578 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_location
[0m20:36:34.714851 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:3fc3fe7b-9ddf-485d-996c-f067d55e543d&page=queryresults
[0m20:36:34.725135 [debug] [Thread-3 (]: Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Field name quantity does not exist in STRUCT<currency STRING, option ARRAY<STRUCT<value_id INT64, value_label STRING, option_id INT64, ...>>, price FLOAT64, ...> at [41:18]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m20:36:34.726164 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f024323-fa1c-40bf-b2fb-af5f49667474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3C62A0190>]}
[0m20:36:34.727209 [error] [Thread-3 (]: 3 of 15 ERROR creating sql view model analytics_dev_staging.stg_fact_sales_order_tt  [[31mERROR[0m in 2.64s]
[0m20:36:34.728291 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.stg_fact_sales_order_tt
[0m20:36:34.729266 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.stg_fact_sales_order_tt' to be skipped because of status 'error'.  Reason: Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Field name quantity does not exist in STRUCT<currency STRING, option ARRAY<STRUCT<value_id INT64, value_label STRING, option_id INT64, ...>>, price FLOAT64, ...> at [41:18]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql.
[0m20:36:34.730542 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_date
[0m20:36:34.731399 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_store
[0m20:36:34.732160 [info ] [Thread-1 (]: 6 of 15 SKIP relation analytics_dev.dim_date ................................... [[33mSKIP[0m]
[0m20:36:34.734434 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_date
[0m20:36:34.732924 [info ] [Thread-3 (]: 7 of 15 SKIP relation analytics_dev.dim_store .................................. [[33mSKIP[0m]
[0m20:36:34.735932 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_user
[0m20:36:34.736942 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_store
[0m20:36:34.738851 [debug] [Thread-3 (]: Began running node model.glamira_analytics.fact_sales_order_tt
[0m20:36:34.737913 [info ] [Thread-1 (]: 8 of 15 SKIP relation analytics_dev.dim_user ................................... [[33mSKIP[0m]
[0m20:36:34.741404 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_user
[0m20:36:34.740412 [info ] [Thread-3 (]: 9 of 15 SKIP relation analytics_dev.fact_sales_order_tt ........................ [[33mSKIP[0m]
[0m20:36:34.742793 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.fact_sales_order_tt
[0m20:36:34.744199 [debug] [Thread-1 (]: Began running node model.glamira_analytics.mart_country
[0m20:36:34.745097 [debug] [Thread-3 (]: Began running node model.glamira_analytics.mart_overall
[0m20:36:34.745977 [info ] [Thread-1 (]: 10 of 15 SKIP relation analytics_dev.mart_country .............................. [[33mSKIP[0m]
[0m20:36:34.747830 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.mart_country
[0m20:36:34.746704 [info ] [Thread-3 (]: 11 of 15 SKIP relation analytics_dev.mart_overall .............................. [[33mSKIP[0m]
[0m20:36:34.748999 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.mart_overall
[0m20:36:34.816559 [debug] [Thread-2 (]: SQL status: OK in 0.377 seconds
[0m20:36:34.817591 [debug] [Thread-4 (]: SQL status: OK in 0.364 seconds
[0m20:36:34.942075 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f024323-fa1c-40bf-b2fb-af5f49667474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3E6BAC050>]}
[0m20:36:34.945153 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f024323-fa1c-40bf-b2fb-af5f49667474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3E6C18250>]}
[0m20:36:34.946144 [info ] [Thread-2 (]: 2 of 15 OK created sql view model analytics_dev_staging.stg_dim_product ........ [[32mCREATE VIEW (0 processed)[0m in 2.86s]
[0m20:36:34.948041 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.stg_dim_product
[0m20:36:34.947025 [info ] [Thread-4 (]: 4 of 15 OK created sql view model analytics_dev_staging.stg_fx_rate ............ [[32mCREATE VIEW (0 processed)[0m in 2.86s]
[0m20:36:34.949220 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.stg_fx_rate
[0m20:36:34.950012 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_product
[0m20:36:34.951777 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_fx_rate_usd
[0m20:36:34.951103 [info ] [Thread-1 (]: 12 of 15 START sql view model analytics_dev.dim_product ........................ [RUN]
[0m20:36:34.953832 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_dim_location, now model.glamira_analytics.dim_product)
[0m20:36:34.952987 [info ] [Thread-3 (]: 13 of 15 START sql view model analytics_dev.dim_fx_rate_usd .................... [RUN]
[0m20:36:34.955259 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.dim_product
[0m20:36:34.956186 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_fact_sales_order_tt, now model.glamira_analytics.dim_fx_rate_usd)
[0m20:36:34.962553 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.dim_product"
[0m20:36:34.963561 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.dim_fx_rate_usd
[0m20:36:34.969812 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.dim_fx_rate_usd"
[0m20:36:34.971484 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.dim_product
[0m20:36:34.984547 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:36:34.985234 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.dim_fx_rate_usd
[0m20:36:34.991957 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.dim_fx_rate_usd"
[0m20:36:34.998788 [debug] [Thread-3 (]: On model.glamira_analytics.dim_fx_rate_usd: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_fx_rate_usd"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev`.`dim_fx_rate_usd`
  OPTIONS()
  as WITH stg_fx AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
)

SELECT
    currency_code AS from_currency_code
    ,'USD' AS to_currency_code
    ,rate_to_usd
    ,rate_timestamp
FROM stg_fx;


[0m20:36:34.999467 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:36:35.945361 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.dim_product"
[0m20:36:35.951742 [debug] [Thread-1 (]: On model.glamira_analytics.dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_product"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev`.`dim_product`
  OPTIONS()
  as WITH dim_product__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
)

, dim_product__null_handle AS (
    SELECT
        product_id
        ,COALESCE(product_name, 'Undefined') AS product_name
        ,COALESCE(product_url, 'Undefined') AS product_url
        ,COALESCE(sku, 'Undefined') AS product_sku
        ,COALESCE(product_type, 'Undefined') AS product_type_name
        ,COALESCE(NULLIF(TRIM(category_name), ''), 'Undefined') AS category_name 
        ,COALESCE(NULLIF(TRIM(collection_name), ''), 'Undefined') AS collection_name
        ,min_price
        ,max_price
    FROM dim_product__source 
)

, dim_product__add_key AS (
    SELECT
        -- Surrogate Key
        FARM_FINGERPRINT(CAST(product_id AS STRING)) AS product_key
        -- Natural Key
        ,CAST(product_id AS STRING) AS product_id
        ,product_name
        ,product_url
        ,product_sku
        ,product_type_name
        ,category_name
        ,collection_name
        ,min_price
        ,max_price
    FROM dim_product__null_handle
)

, dim_product__union_undefined AS (
    SELECT 
        * FROM dim_product__add_key

    UNION ALL

    SELECT 
        -1 AS product_key
        ,'-1' AS product_id
        ,'Undefined' AS product_name
        ,'Undefined' AS product_url
        ,'Undefined' AS product_sku
        ,'Undefined' AS product_type_name
        ,'Undefined' AS category_name
        ,'Undefined' AS collection_name
        ,0 AS min_price
        ,0 AS max_price
)

SELECT 
    *
FROM dim_product__union_undefined;


[0m20:36:36.657946 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:bde84bea-0786-421d-b81e-7d861365bba8&page=queryresults
[0m20:36:36.964794 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:6664598f-2814-4439-8dd4-dac6600b5db4&page=queryresults
[0m20:36:37.066863 [debug] [Thread-3 (]: SQL status: OK in 0.408 seconds
[0m20:36:37.072138 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f024323-fa1c-40bf-b2fb-af5f49667474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3E728B050>]}
[0m20:36:37.073408 [info ] [Thread-3 (]: 13 of 15 OK created sql view model analytics_dev.dim_fx_rate_usd ............... [[32mCREATE VIEW (0 processed)[0m in 2.12s]
[0m20:36:37.074716 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_fx_rate_usd
[0m20:36:37.169390 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:6664598f-2814-4439-8dd4-dac6600b5db4&page=queryresults
[0m20:36:37.178016 [debug] [Thread-1 (]: Database Error in model dim_product (models\dimensions\dim_product.sql)
  Unrecognized name: sku at [16:19]
  compiled code at target\run\glamira_analytics\models\dimensions\dim_product.sql
[0m20:36:37.178731 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f024323-fa1c-40bf-b2fb-af5f49667474', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3E728BDD0>]}
[0m20:36:37.179513 [error] [Thread-1 (]: 12 of 15 ERROR creating sql view model analytics_dev.dim_product ............... [[31mERROR[0m in 2.23s]
[0m20:36:37.180466 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_product
[0m20:36:37.181727 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.dim_product' to be skipped because of status 'error'.  Reason: Database Error in model dim_product (models\dimensions\dim_product.sql)
  Unrecognized name: sku at [16:19]
  compiled code at target\run\glamira_analytics\models\dimensions\dim_product.sql.
[0m20:36:37.183172 [debug] [Thread-2 (]: Began running node model.glamira_analytics.mart_product
[0m20:36:37.184281 [debug] [Thread-4 (]: Began running node model.glamira_analytics.mart_product_type
[0m20:36:37.185336 [info ] [Thread-2 (]: 14 of 15 SKIP relation analytics_dev.mart_product .............................. [[33mSKIP[0m]
[0m20:36:37.187562 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.mart_product
[0m20:36:37.186190 [info ] [Thread-4 (]: 15 of 15 SKIP relation analytics_dev.mart_product_type ......................... [[33mSKIP[0m]
[0m20:36:37.189556 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.mart_product_type
[0m20:36:37.191960 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:36:37.193016 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:36:37.193494 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m20:36:37.193971 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m20:36:37.194405 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev' was properly closed.
[0m20:36:37.194835 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_staging' was properly closed.
[0m20:36:37.195268 [debug] [MainThread]: Connection 'model.glamira_analytics.stg_dim_product' was properly closed.
[0m20:36:37.195666 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_product' was properly closed.
[0m20:36:37.196007 [debug] [MainThread]: Connection 'model.glamira_analytics.stg_fx_rate' was properly closed.
[0m20:36:37.196345 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_fx_rate_usd' was properly closed.
[0m20:36:37.196847 [info ] [MainThread]: 
[0m20:36:37.197396 [info ] [MainThread]: Finished running 1 incremental model, 4 table models, 10 view models in 0 hours 0 minutes and 7.93 seconds (7.93s).
[0m20:36:37.200093 [debug] [MainThread]: Command end result
[0m20:36:37.250623 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m20:36:37.253993 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m20:36:37.262432 [debug] [MainThread]: Wrote artifact RunExecutionResult to D:\Project 7\glamira_analytics\target\run_results.json
[0m20:36:37.262967 [info ] [MainThread]: 
[0m20:36:37.263943 [info ] [MainThread]: [31mCompleted with 3 errors, 0 partial successes, and 0 warnings:[0m
[0m20:36:37.264968 [info ] [MainThread]: 
[0m20:36:37.266023 [error] [MainThread]: [31mFailure in model stg_dim_location (models\staging\stg_dim_location.sql)[0m
[0m20:36:37.267032 [error] [MainThread]:   Database Error in model stg_dim_location (models\staging\stg_dim_location.sql)
  Unrecognized name: country_short; Did you mean country_code? at [19:11]
  compiled code at target\run\glamira_analytics\models\staging\stg_dim_location.sql
[0m20:36:37.267843 [info ] [MainThread]: 
[0m20:36:37.268721 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\staging\stg_dim_location.sql
[0m20:36:37.270214 [info ] [MainThread]: 
[0m20:36:37.271602 [error] [MainThread]: [31mFailure in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)[0m
[0m20:36:37.273006 [error] [MainThread]:   Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Field name quantity does not exist in STRUCT<currency STRING, option ARRAY<STRUCT<value_id INT64, value_label STRING, option_id INT64, ...>>, price FLOAT64, ...> at [41:18]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m20:36:37.274034 [info ] [MainThread]: 
[0m20:36:37.275403 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m20:36:37.276224 [info ] [MainThread]: 
[0m20:36:37.277144 [error] [MainThread]: [31mFailure in model dim_product (models\dimensions\dim_product.sql)[0m
[0m20:36:37.278716 [error] [MainThread]:   Database Error in model dim_product (models\dimensions\dim_product.sql)
  Unrecognized name: sku at [16:19]
  compiled code at target\run\glamira_analytics\models\dimensions\dim_product.sql
[0m20:36:37.279865 [info ] [MainThread]: 
[0m20:36:37.280726 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\dimensions\dim_product.sql
[0m20:36:37.281488 [info ] [MainThread]: 
[0m20:36:37.282215 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=3 SKIP=9 NO-OP=0 TOTAL=15
[0m20:36:37.283267 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 3 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m20:36:37.284621 [debug] [MainThread]: Command `dbt run` failed at 20:36:37.284438 after 26.32 seconds
[0m20:36:37.285208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3E6B03830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3E73B7DD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B3E73B77D0>]}
[0m20:36:37.286037 [debug] [MainThread]: Flushing usage events
[0m20:36:39.323907 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:47:14.442882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001852EE88EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001852FFEFED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001852FFEFB10>]}


============================== 21:47:14.450702 | a0844d9b-11e1-40d6-837d-48676045c560 ==============================
[0m21:47:14.450702 [info ] [MainThread]: Running with dbt=1.11.2
[0m21:47:14.452014 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'no_print': 'None', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'printer_width': '80', 'write_json': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'empty': 'False', 'cache_selected_only': 'False', 'fail_fast': 'False', 'debug': 'False', 'log_format': 'default', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'use_colors': 'True', 'invocation_command': 'dbt run --full-refresh', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m21:47:28.021939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a0844d9b-11e1-40d6-837d-48676045c560', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001852F321BA0>]}
[0m21:47:28.099351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a0844d9b-11e1-40d6-837d-48676045c560', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001853F9CF570>]}
[0m21:47:28.100199 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m21:47:29.075625 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m21:47:29.233696 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m21:47:29.234760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a0844d9b-11e1-40d6-837d-48676045c560', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001854F720F50>]}
[0m21:47:31.581620 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `relationships` defined on
'fact_sales_order_tt' in package 'glamira_analytics'
(models\dimensions\schema.yml). Arguments to generic tests should be nested
under the `arguments` property.
[0m21:47:31.582833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'a0844d9b-11e1-40d6-837d-48676045c560', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001854F577D40>]}
[0m21:47:31.746639 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.glamira_analytics.stg_dim_location' (models\staging\stg_dim_location.sql) depends on a source named 'glamira_src.raw_ip_location' which was not found
[0m21:47:31.747667 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 3 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m21:47:31.749561 [debug] [MainThread]: Command `dbt run` failed at 21:47:31.749292 after 17.55 seconds
[0m21:47:31.750371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001852FE53E70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001854F7D8D70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001854F683380>]}
[0m21:47:31.751109 [debug] [MainThread]: Flushing usage events
[0m21:47:34.094408 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:49:52.018941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E0F228EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E1038FED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E1038FB10>]}


============================== 21:49:52.025753 | 74f67b4a-c021-4b50-84fc-6c16aa6dc9e5 ==============================
[0m21:49:52.025753 [info ] [MainThread]: Running with dbt=1.11.2
[0m21:49:52.026865 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'no_print': 'None', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'write_json': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'empty': 'False', 'cache_selected_only': 'False', 'fail_fast': 'False', 'debug': 'False', 'log_format': 'default', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'use_colors': 'True', 'invocation_command': 'dbt run --full-refresh', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m21:50:01.681203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '74f67b4a-c021-4b50-84fc-6c16aa6dc9e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E0F6C1BA0>]}
[0m21:50:01.757933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '74f67b4a-c021-4b50-84fc-6c16aa6dc9e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E1FF8F570>]}
[0m21:50:01.758796 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m21:50:02.587717 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m21:50:02.728340 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m21:50:02.729140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '74f67b4a-c021-4b50-84fc-6c16aa6dc9e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E2FB00F50>]}
[0m21:50:04.457881 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `relationships` defined on
'fact_sales_order_tt' in package 'glamira_analytics'
(models\dimensions\schema.yml). Arguments to generic tests should be nested
under the `arguments` property.
[0m21:50:04.458885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '74f67b4a-c021-4b50-84fc-6c16aa6dc9e5', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E2F95BD40>]}
[0m21:50:04.625852 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.glamira_analytics.stg_dim_location' (models\staging\stg_dim_location.sql) depends on a source named '_src_glamira.ip_location' which was not found
[0m21:50:04.626951 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 3 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m21:50:04.628588 [debug] [MainThread]: Command `dbt run` failed at 21:50:04.628342 after 12.86 seconds
[0m21:50:04.629434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E101F3E70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E2FBB8D70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E2FA67380>]}
[0m21:50:04.630199 [debug] [MainThread]: Flushing usage events
[0m21:50:06.872396 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:51:51.165712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000124C3808EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000124C496FED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000124C496FB10>]}


============================== 21:51:51.171839 | a77e5bfc-2137-4380-8007-045d9916e34b ==============================
[0m21:51:51.171839 [info ] [MainThread]: Running with dbt=1.11.2
[0m21:51:51.173005 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'no_print': 'None', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'write_json': 'True', 'empty': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'invocation_command': 'dbt run --full-refresh', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m21:52:00.914363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a77e5bfc-2137-4380-8007-045d9916e34b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000124C3CA1BA0>]}
[0m21:52:00.991260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a77e5bfc-2137-4380-8007-045d9916e34b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000124E356F570>]}
[0m21:52:00.992133 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m21:52:01.783758 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m21:52:01.924169 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m21:52:01.924982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a77e5bfc-2137-4380-8007-045d9916e34b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000124E40D4F50>]}
[0m21:52:03.669098 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `relationships` defined on
'fact_sales_order_tt' in package 'glamira_analytics'
(models\dimensions\schema.yml). Arguments to generic tests should be nested
under the `arguments` property.
[0m21:52:03.670162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'a77e5bfc-2137-4380-8007-045d9916e34b', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000124E3F2BD40>]}
[0m21:52:03.835949 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.glamira_analytics.stg_dim_location' (models\staging\stg_dim_location.sql) depends on a source named 'raw_layer.ip_location' which was not found
[0m21:52:03.837025 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 3 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m21:52:03.838687 [debug] [MainThread]: Command `dbt run` failed at 21:52:03.838421 after 12.85 seconds
[0m21:52:03.839496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000124C47D3E70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000124E4188D70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000124E4037380>]}
[0m21:52:03.840324 [debug] [MainThread]: Flushing usage events
[0m21:52:05.471370 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:54:00.538597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000194786E8EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001947984FED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001947984FB10>]}


============================== 21:54:00.546316 | 85499c62-02f6-4565-bcc6-de25a29094c7 ==============================
[0m21:54:00.546316 [info ] [MainThread]: Running with dbt=1.11.2
[0m21:54:00.547322 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'no_print': 'None', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'printer_width': '80', 'write_json': 'True', 'empty': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'fail_fast': 'False', 'debug': 'False', 'log_format': 'default', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'invocation_command': 'dbt run --full-refresh', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m21:54:10.221862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '85499c62-02f6-4565-bcc6-de25a29094c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019478B81BA0>]}
[0m21:54:10.298798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '85499c62-02f6-4565-bcc6-de25a29094c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019418F27570>]}
[0m21:54:10.299631 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m21:54:11.094670 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m21:54:11.232914 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m21:54:11.234137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '85499c62-02f6-4565-bcc6-de25a29094c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000194193A0F50>]}
[0m21:54:13.014990 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.glamira_analytics.analytics
[0m21:54:13.031822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '85499c62-02f6-4565-bcc6-de25a29094c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000194193532F0>]}
[0m21:54:13.139251 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m21:54:13.142294 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m21:54:13.180630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '85499c62-02f6-4565-bcc6-de25a29094c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019419520AD0>]}
[0m21:54:13.181283 [info ] [MainThread]: Found 15 models, 1 seed, 3 sources, 537 macros
[0m21:54:13.182044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '85499c62-02f6-4565-bcc6-de25a29094c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019419250870>]}
[0m21:54:13.187006 [info ] [MainThread]: 
[0m21:54:13.187793 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:54:13.188269 [info ] [MainThread]: 
[0m21:54:13.189154 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:54:13.196468 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m21:54:13.198286 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:54:13.199237 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m21:54:13.200055 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:54:15.234990 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev'
[0m21:54:15.235846 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:54:15.236605 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_staging'
[0m21:54:15.237786 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:54:16.157815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '85499c62-02f6-4565-bcc6-de25a29094c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019419541610>]}
[0m21:54:16.158599 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:54:16.165000 [debug] [Thread-2 (]: Began running node model.glamira_analytics.stg_dim_product
[0m21:54:16.165747 [debug] [Thread-4 (]: Began running node model.glamira_analytics.stg_fx_rate
[0m21:54:16.166467 [debug] [Thread-1 (]: Began running node model.glamira_analytics.stg_dim_location
[0m21:54:16.167205 [debug] [Thread-3 (]: Began running node model.glamira_analytics.stg_fact_sales_order_tt
[0m21:54:16.168010 [info ] [Thread-2 (]: 2 of 15 START sql view model analytics_dev_staging.stg_dim_product ............. [RUN]
[0m21:54:16.168683 [info ] [Thread-4 (]: 4 of 15 START sql view model analytics_dev_staging.stg_fx_rate ................. [RUN]
[0m21:54:16.171525 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_product'
[0m21:54:16.169707 [info ] [Thread-1 (]: 1 of 15 START sql view model analytics_dev_staging.stg_dim_location ............ [RUN]
[0m21:54:16.172580 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fx_rate'
[0m21:54:16.170736 [info ] [Thread-3 (]: 3 of 15 START sql view model analytics_dev_staging.stg_fact_sales_order_tt ..... [RUN]
[0m21:54:16.173603 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.stg_dim_product
[0m21:54:16.174508 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_location'
[0m21:54:16.175332 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.stg_fx_rate
[0m21:54:16.176885 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fact_sales_order_tt'
[0m21:54:16.189532 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_product"
[0m21:54:16.190320 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.stg_dim_location
[0m21:54:16.194065 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.stg_fx_rate"
[0m21:54:16.194925 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.stg_fact_sales_order_tt
[0m21:54:16.201510 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_location"
[0m21:54:16.207098 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m21:54:16.208043 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.stg_dim_product
[0m21:54:16.225912 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.stg_fx_rate
[0m21:54:16.266704 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_product"
[0m21:54:16.269700 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.stg_fx_rate"
[0m21:54:16.270957 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.stg_dim_location
[0m21:54:16.272075 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.stg_fact_sales_order_tt
[0m21:54:16.277898 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_location"
[0m21:54:16.278820 [debug] [Thread-2 (]: On model.glamira_analytics.stg_dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_product"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
  OPTIONS()
  as WITH stg_dim_product__source AS (
    SELECT DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`product`
)

, stg_dim_product__rename AS (
    SELECT
        SAFE_CAST(product_id AS INT64) AS product_id,
        CAST(name AS STRING) AS product_name,
        CAST(url AS STRING) AS product_url,
        CAST(sku AS STRING) AS product_sku, 
        CAST(product_type AS STRING) AS product_type,
        CAST(category_name AS STRING) AS category_name,
        CAST(collection AS STRING) AS collection_name,
        SAFE_CAST(min_price AS NUMERIC) AS min_price,
        SAFE_CAST(max_price AS NUMERIC) AS max_price
    FROM stg_dim_product__source
    WHERE product_id IS NOT NULL
)

SELECT * FROM stg_dim_product__rename;


[0m21:54:16.283892 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m21:54:16.284899 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:54:16.285789 [debug] [Thread-4 (]: On model.glamira_analytics.stg_fx_rate: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fx_rate"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
  OPTIONS()
  as WITH source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev`.`exchange_rate_usd`
)

, renamed AS (
    SELECT
        CAST(currency AS STRING) AS currency_code
        ,CAST(rate_to_usd AS NUMERIC) AS rate_to_usd
        ,CAST(as_of_gmt AS TIMESTAMP) AS rate_timestamp
    FROM source
)

SELECT * FROM renamed;


[0m21:54:16.287907 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:54:16.289597 [debug] [Thread-1 (]: On model.glamira_analytics.stg_dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_location"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
  OPTIONS()
  as WITH stg_dim_location__source AS (
    SELECT 
        DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`ip_location`
)

, stg_dim_location__rename AS (
    SELECT
        CAST(ip AS STRING) AS ip_address,
        CAST(country_code AS STRING) AS country_short_name, 
        CAST(country_long AS STRING) AS country_long_name,
        CAST(region AS STRING) AS region_name,
        CAST(city AS STRING) AS city_name
    FROM stg_dim_location__sourc
    WHERE country_code <> '-' 
        AND country_code IS NOT NULL
)

, stg_dim_location__gen_key AS (
    SELECT
        FARM_FINGERPRINT(country_short_name ||region_name ||city_name) AS location_id,
        ip_address,
        country_short_name,
        country_long_name,
        region_name,
        city_name
    FROM stg_dim_location__rename
)

SELECT * FROM stg_dim_location__gen_key;


[0m21:54:16.291493 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m21:54:16.294020 [debug] [Thread-3 (]: On model.glamira_analytics.stg_fact_sales_order_tt: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fact_sales_order_tt"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
  OPTIONS()
  as WITH source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`raw_layer`.`summary`
    WHERE collection = 'checkout_success'
)

/* 1. Remove failed URLs */
, filter_url AS (
    SELECT *
    FROM source 
    WHERE current_url NOT LIKE 'file://%'
)

/* 2. Unnest cart_products */
, unnested AS (
    SELECT 
        s.*
        ,cp
    FROM filter_url s
    CROSS JOIN UNNEST(s.cart_products) AS cp
)

, renamed AS (
    SELECT
        -- IDs
        SAFE_CAST(REGEXP_REPLACE(CAST(s.order_id AS STRING), r'\..*', '') AS INT64) AS order_id
        ,SAFE_CAST(REGEXP_REPLACE(CAST(cp.product_id AS STRING), r'\..*', '') AS INT64) AS product_id
        ,SAFE_CAST(REGEXP_REPLACE(CAST(s.user_id_db AS STRING), r'\..*', '') AS INT64) AS user_id
        ,SAFE_CAST(REGEXP_REPLACE(CAST(s.store_id AS STRING), r'\..*', '') AS INT64) AS store_id
        
        -- METRICS (Fixing the missing quantity issue)
        ,1 AS quantity
        ,CAST(cp.price AS NUMERIC) AS unit_price
        ,CAST(cp.price * 1 AS NUMERIC) AS line_total
        
        -- DATES
        ,s.time_stamp
        ,DATETIME(TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64)), s.timezone) AS local_time
        
        -- CURRENCY STANDARDIZATION
        ,s.currency
        ,CASE 
            WHEN s.currency IN ('USD', 'USD $') THEN 'USD'
            WHEN s.currency = 'HKD $'    THEN 'HKD'
            WHEN s.currency = 'NZD $'    THEN 'NZD'
            WHEN s.currency = 'MXN $'    THEN 'MXN'
            WHEN s.currency = 'Kƒç'       THEN 'CZK'
            WHEN s.currency = 'Ft'       THEN 'HUF'
            WHEN s.currency = 'z≈Ç'       THEN 'PLN'
            WHEN s.currency = '‚Çπ'        THEN 'INR'
            WHEN s.currency = '–ª–≤.'      THEN 'BGN'
            WHEN s.currency = '‚Ç´'        THEN 'VND'
            WHEN s.currency = '‚Ç±'        THEN 'PHP'
            WHEN s.currency = '‚Ç≤'        THEN 'PYG'
            WHEN s.currency = 'CRC ‚Ç°'    THEN 'CRC'
            WHEN s.currency = 'COP $'    THEN 'COP'
            WHEN s.currency = 'BOB Bs'   THEN 'BOB'
            WHEN s.currency = 'GTQ Q'    THEN 'GTQ'
            WHEN s.currency = 'PEN S/.'  THEN 'PEN'
            WHEN s.currency = 'DOP $'    THEN 'DOP'
            WHEN s.currency = 'CLP'      THEN 'CLP'
            WHEN s.currency = 'Lei'      THEN 'RON'
            WHEN s.currency = 'UYU'      THEN 'UYU'
            WHEN s.currency = 'din.'     THEN 'RSD'
            WHEN s.currency = 'kn'       THEN 'HRK'
            WHEN s.currency = 'ÿØ.ŸÉ.'     THEN 'KWD'
            WHEN s.currency = 'CHF'      THEN 'CHF'
            WHEN s.currency = 'kr'       THEN 'SEK' 
            WHEN s.currency = '‚Ç¨'        THEN 'EUR'
            WHEN s.currency = '¬£'        THEN 'GBP'
            WHEN s.currency = 'AU$'      THEN 'AUD'
            WHEN s.currency = 'CA$'      THEN 'CAD'
            WHEN s.currency = '¬•'        THEN 'JPY'
            ELSE 'USD' 
        END AS currency_code
        
        -- LOCATION INFO
        ,s.email AS email_address
        ,s.ip AS ip_address
        
        -- LOCATION HASH (Must match stg_dim_location logic)
        ,FARM_FINGERPRINT(CONCAT(
            CAST(s.country_short AS STRING), 
            CAST(s.region AS STRING), 
            CAST(s.city AS STRING)
        )) AS location_id

    FROM unnested s
)

SELECT * FROM renamed;


[0m21:54:16.296629 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:54:17.787061 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:bb4e12ae-d58d-4349-8815-982dccd70d02&page=queryresults
[0m21:54:17.788794 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:6d7646bc-5a7f-4299-87b8-af310477337b&page=queryresults
[0m21:54:17.789619 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:6d7646bc-5a7f-4299-87b8-af310477337b&page=queryresults
[0m21:54:17.890902 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:ebd8af94-9153-4cdd-84fd-1d1bc329b4e5&page=queryresults
[0m21:54:17.892133 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:cdbb6284-fec7-48d9-8701-f83f46a28622&page=queryresults
[0m21:54:17.944228 [debug] [Thread-1 (]: Database Error in model stg_dim_location (models\staging\stg_dim_location.sql)
  Table "stg_dim_location__sourc" must be qualified with a dataset (e.g. dataset.table).
  compiled code at target\run\glamira_analytics\models\staging\stg_dim_location.sql
[0m21:54:17.947598 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85499c62-02f6-4565-bcc6-de25a29094c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019419C285D0>]}
[0m21:54:17.948640 [error] [Thread-1 (]: 1 of 15 ERROR creating sql view model analytics_dev_staging.stg_dim_location ... [[31mERROR[0m in 1.77s]
[0m21:54:17.949789 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.stg_dim_location
[0m21:54:17.951146 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.stg_dim_location' to be skipped because of status 'error'.  Reason: Database Error in model stg_dim_location (models\staging\stg_dim_location.sql)
  Table "stg_dim_location__sourc" must be qualified with a dataset (e.g. dataset.table).
  compiled code at target\run\glamira_analytics\models\staging\stg_dim_location.sql.
[0m21:54:17.953451 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_location
[0m21:54:17.954049 [info ] [Thread-1 (]: 5 of 15 SKIP relation analytics_dev.dim_location ............................... [[33mSKIP[0m]
[0m21:54:17.955208 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_location
[0m21:54:18.094288 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:cdbb6284-fec7-48d9-8701-f83f46a28622&page=queryresults
[0m21:54:18.104045 [debug] [Thread-3 (]: Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Name timezone not found inside s at [43:69]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m21:54:18.104869 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85499c62-02f6-4565-bcc6-de25a29094c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019478B20190>]}
[0m21:54:18.105675 [error] [Thread-3 (]: 3 of 15 ERROR creating sql view model analytics_dev_staging.stg_fact_sales_order_tt  [[31mERROR[0m in 1.93s]
[0m21:54:18.106634 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.stg_fact_sales_order_tt
[0m21:54:18.107910 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.stg_fact_sales_order_tt' to be skipped because of status 'error'.  Reason: Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Name timezone not found inside s at [43:69]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql.
[0m21:54:18.109186 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_store
[0m21:54:18.110008 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_date
[0m21:54:18.111143 [info ] [Thread-3 (]: 7 of 15 SKIP relation analytics_dev.dim_store .................................. [[33mSKIP[0m]
[0m21:54:18.113011 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_store
[0m21:54:18.111864 [info ] [Thread-1 (]: 6 of 15 SKIP relation analytics_dev.dim_date ................................... [[33mSKIP[0m]
[0m21:54:18.114096 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_user
[0m21:54:18.115323 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_date
[0m21:54:18.116467 [info ] [Thread-3 (]: 8 of 15 SKIP relation analytics_dev.dim_user ................................... [[33mSKIP[0m]
[0m21:54:18.117724 [debug] [Thread-1 (]: Began running node model.glamira_analytics.fact_sales_order_tt
[0m21:54:18.118946 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_user
[0m21:54:18.120168 [info ] [Thread-1 (]: 9 of 15 SKIP relation analytics_dev.fact_sales_order_tt ........................ [[33mSKIP[0m]
[0m21:54:18.121427 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.fact_sales_order_tt
[0m21:54:18.122557 [debug] [Thread-3 (]: Began running node model.glamira_analytics.mart_country
[0m21:54:18.123204 [debug] [Thread-1 (]: Began running node model.glamira_analytics.mart_overall
[0m21:54:18.123925 [info ] [Thread-3 (]: 10 of 15 SKIP relation analytics_dev.mart_country .............................. [[33mSKIP[0m]
[0m21:54:18.125459 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.mart_country
[0m21:54:18.124601 [info ] [Thread-1 (]: 11 of 15 SKIP relation analytics_dev.mart_overall .............................. [[33mSKIP[0m]
[0m21:54:18.126638 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.mart_overall
[0m21:54:18.200046 [debug] [Thread-2 (]: SQL status: OK in 0.412 seconds
[0m21:54:18.401575 [debug] [Thread-4 (]: SQL status: OK in 0.509 seconds
[0m21:54:19.474228 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85499c62-02f6-4565-bcc6-de25a29094c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019419561050>]}
[0m21:54:19.478788 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85499c62-02f6-4565-bcc6-de25a29094c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000194197E0D50>]}
[0m21:54:19.480164 [info ] [Thread-4 (]: 4 of 15 OK created sql view model analytics_dev_staging.stg_fx_rate ............ [[32mCREATE VIEW (0 processed)[0m in 3.30s]
[0m21:54:19.483365 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.stg_fx_rate
[0m21:54:19.481682 [info ] [Thread-2 (]: 2 of 15 OK created sql view model analytics_dev_staging.stg_dim_product ........ [[32mCREATE VIEW (0 processed)[0m in 3.31s]
[0m21:54:19.485169 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.stg_dim_product
[0m21:54:19.486064 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_fx_rate_usd
[0m21:54:19.488468 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_product
[0m21:54:19.487532 [info ] [Thread-3 (]: 12 of 15 START sql view model analytics_dev.dim_fx_rate_usd .................... [RUN]
[0m21:54:19.491815 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_fact_sales_order_tt, now model.glamira_analytics.dim_fx_rate_usd)
[0m21:54:19.490349 [info ] [Thread-1 (]: 13 of 15 START sql view model analytics_dev.dim_product ........................ [RUN]
[0m21:54:19.492970 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.dim_fx_rate_usd
[0m21:54:19.493746 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_dim_location, now model.glamira_analytics.dim_product)
[0m21:54:19.498319 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.dim_fx_rate_usd"
[0m21:54:19.499401 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.dim_product
[0m21:54:19.504753 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.dim_product"
[0m21:54:19.506095 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.dim_fx_rate_usd
[0m21:54:19.511207 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.dim_fx_rate_usd"
[0m21:54:19.511844 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.dim_product
[0m21:54:19.515859 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.dim_product"
[0m21:54:19.518086 [debug] [Thread-3 (]: On model.glamira_analytics.dim_fx_rate_usd: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_fx_rate_usd"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev`.`dim_fx_rate_usd`
  OPTIONS()
  as WITH stg_fx AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
)

SELECT
    currency_code AS from_currency_code
    ,'USD' AS to_currency_code
    ,rate_to_usd
    ,rate_timestamp
FROM stg_fx;


[0m21:54:19.519556 [debug] [Thread-1 (]: On model.glamira_analytics.dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_product"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev`.`dim_product`
  OPTIONS()
  as WITH dim_product__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
)
, dim_product__null_handle AS (
    SELECT
        product_id,
        coalesce(product_name,'XNA') AS product_name,
        coalesce(product_url,'XNA') AS product_url,
        coalesce(product_sku,'XNA') AS product_sku,
        coalesce(product_type,'XNA') AS product_type,
        coalesce(NULLIF(TRIM(category_name),''),'XNA') AS category_name, 
        coalesce(NULLIF(TRIM(collection_name),''),'XNA') AS collection_name,
        min_price,
        max_price
    FROM dim_product__source 
)

, dim_product__add_key AS (
    SELECT
        FARM_FINGERPRINT(CAST(product_id AS STRING)) AS product_key
        ,CAST(product_id AS STRING) AS product_id
        ,product_name
        ,product_url
        -- FIX: Changed 'sku' to 'product_sku'
        ,product_sku
        ,product_type_name
        ,category_name
        ,collection_name
        ,min_price
        ,max_price
    FROM dim_product__null_handle
)

, dim_product__union_undefined AS (
    SELECT 
        * FROM dim_product__add_key

    UNION ALL

    SELECT 
        -1 AS product_key
        ,'-1' AS product_id
        ,'Undefined' AS product_name
        ,'Undefined' AS product_url
        ,'Undefined' AS product_sku
        ,'Undefined' AS product_type_name
        ,'Undefined' AS category_name
        ,'Undefined' AS collection_name
        ,0 AS min_price
        ,0 AS max_price
)

SELECT * FROM dim_product__union_undefined;


[0m21:54:19.520391 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:54:19.521035 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:54:20.958306 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:424c4b37-7679-4a19-b88d-b0c89ee42df7&page=queryresults
[0m21:54:20.959623 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:800ddb63-09ef-4be2-832c-ca0479e282ad&page=queryresults
[0m21:54:21.162851 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:424c4b37-7679-4a19-b88d-b0c89ee42df7&page=queryresults
[0m21:54:21.173856 [debug] [Thread-1 (]: Database Error in model dim_product (models\dimensions\dim_product.sql)
  Unrecognized name: product_type_name; Did you mean product_name? at [32:10]
  compiled code at target\run\glamira_analytics\models\dimensions\dim_product.sql
[0m21:54:21.174605 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85499c62-02f6-4565-bcc6-de25a29094c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019419FA58B0>]}
[0m21:54:21.175429 [error] [Thread-1 (]: 13 of 15 ERROR creating sql view model analytics_dev.dim_product ............... [[31mERROR[0m in 1.68s]
[0m21:54:21.176351 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_product
[0m21:54:21.177607 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.dim_product' to be skipped because of status 'error'.  Reason: Database Error in model dim_product (models\dimensions\dim_product.sql)
  Unrecognized name: product_type_name; Did you mean product_name? at [32:10]
  compiled code at target\run\glamira_analytics\models\dimensions\dim_product.sql.
[0m21:54:21.178960 [debug] [Thread-2 (]: Began running node model.glamira_analytics.mart_product_type
[0m21:54:21.179785 [debug] [Thread-4 (]: Began running node model.glamira_analytics.mart_product
[0m21:54:21.180619 [info ] [Thread-2 (]: 15 of 15 SKIP relation analytics_dev.mart_product_type ......................... [[33mSKIP[0m]
[0m21:54:21.182344 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.mart_product_type
[0m21:54:21.181465 [info ] [Thread-4 (]: 14 of 15 SKIP relation analytics_dev.mart_product .............................. [[33mSKIP[0m]
[0m21:54:21.183454 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.mart_product
[0m21:54:21.468753 [debug] [Thread-3 (]: SQL status: OK in 0.508 seconds
[0m21:54:21.473835 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85499c62-02f6-4565-bcc6-de25a29094c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000194198324B0>]}
[0m21:54:21.474878 [info ] [Thread-3 (]: 12 of 15 OK created sql view model analytics_dev.dim_fx_rate_usd ............... [[32mCREATE VIEW (0 processed)[0m in 1.98s]
[0m21:54:21.476083 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_fx_rate_usd
[0m21:54:21.478188 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:54:21.479041 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:54:21.479413 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m21:54:21.479768 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m21:54:21.480114 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev' was properly closed.
[0m21:54:21.480463 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_staging' was properly closed.
[0m21:54:21.480799 [debug] [MainThread]: Connection 'model.glamira_analytics.stg_dim_product' was properly closed.
[0m21:54:21.481126 [debug] [MainThread]: Connection 'model.glamira_analytics.stg_fx_rate' was properly closed.
[0m21:54:21.481447 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_product' was properly closed.
[0m21:54:21.481771 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_fx_rate_usd' was properly closed.
[0m21:54:21.482240 [info ] [MainThread]: 
[0m21:54:21.483007 [info ] [MainThread]: Finished running 1 incremental model, 4 table models, 10 view models in 0 hours 0 minutes and 8.29 seconds (8.29s).
[0m21:54:21.486107 [debug] [MainThread]: Command end result
[0m21:54:21.528351 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m21:54:21.531433 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m21:54:21.540050 [debug] [MainThread]: Wrote artifact RunExecutionResult to D:\Project 7\glamira_analytics\target\run_results.json
[0m21:54:21.541164 [info ] [MainThread]: 
[0m21:54:21.542548 [info ] [MainThread]: [31mCompleted with 3 errors, 0 partial successes, and 0 warnings:[0m
[0m21:54:21.543623 [info ] [MainThread]: 
[0m21:54:21.544844 [error] [MainThread]: [31mFailure in model stg_dim_location (models\staging\stg_dim_location.sql)[0m
[0m21:54:21.545849 [error] [MainThread]:   Database Error in model stg_dim_location (models\staging\stg_dim_location.sql)
  Table "stg_dim_location__sourc" must be qualified with a dataset (e.g. dataset.table).
  compiled code at target\run\glamira_analytics\models\staging\stg_dim_location.sql
[0m21:54:21.546638 [info ] [MainThread]: 
[0m21:54:21.547703 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\staging\stg_dim_location.sql
[0m21:54:21.548567 [info ] [MainThread]: 
[0m21:54:21.549572 [error] [MainThread]: [31mFailure in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)[0m
[0m21:54:21.550522 [error] [MainThread]:   Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Name timezone not found inside s at [43:69]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m21:54:21.551554 [info ] [MainThread]: 
[0m21:54:21.552541 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m21:54:21.553454 [info ] [MainThread]: 
[0m21:54:21.554592 [error] [MainThread]: [31mFailure in model dim_product (models\dimensions\dim_product.sql)[0m
[0m21:54:21.555343 [error] [MainThread]:   Database Error in model dim_product (models\dimensions\dim_product.sql)
  Unrecognized name: product_type_name; Did you mean product_name? at [32:10]
  compiled code at target\run\glamira_analytics\models\dimensions\dim_product.sql
[0m21:54:21.555918 [info ] [MainThread]: 
[0m21:54:21.556616 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\dimensions\dim_product.sql
[0m21:54:21.557266 [info ] [MainThread]: 
[0m21:54:21.558085 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=3 SKIP=9 NO-OP=0 TOTAL=15
[0m21:54:21.559992 [debug] [MainThread]: Command `dbt run` failed at 21:54:21.559755 after 21.26 seconds
[0m21:54:21.560611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019419C57BF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019419FA4B30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000019419FA7DD0>]}
[0m21:54:21.561189 [debug] [MainThread]: Flushing usage events
[0m21:54:23.518428 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:54:54.725307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C45B1B8EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C45C31FED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C45C31FB10>]}


============================== 21:54:54.732009 | a83474fb-e420-4092-b9ea-b4a5219bff8f ==============================
[0m21:54:54.732009 [info ] [MainThread]: Running with dbt=1.11.2
[0m21:54:54.733125 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'no_print': 'None', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'printer_width': '80', 'write_json': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'empty': 'False', 'cache_selected_only': 'False', 'fail_fast': 'False', 'debug': 'False', 'log_format': 'default', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'invocation_command': 'dbt run --full-refresh', 'indirect_selection': 'eager', 'use_colors': 'True', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m21:55:05.002324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a83474fb-e420-4092-b9ea-b4a5219bff8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C45B651BA0>]}
[0m21:55:05.078833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a83474fb-e420-4092-b9ea-b4a5219bff8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C47AED3570>]}
[0m21:55:05.079675 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m21:55:05.954405 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m21:55:06.165286 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:55:06.166085 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\dimensions\dim_product.sql
[0m21:55:06.523512 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.glamira_analytics.analytics
[0m21:55:06.548273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a83474fb-e420-4092-b9ea-b4a5219bff8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C47BAA5950>]}
[0m21:55:06.666669 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m21:55:06.670227 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m21:55:06.741408 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a83474fb-e420-4092-b9ea-b4a5219bff8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C47AF73110>]}
[0m21:55:06.742575 [info ] [MainThread]: Found 15 models, 1 seed, 3 sources, 537 macros
[0m21:55:06.743780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a83474fb-e420-4092-b9ea-b4a5219bff8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C47B9D7850>]}
[0m21:55:06.750830 [info ] [MainThread]: 
[0m21:55:06.752207 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:55:06.753642 [info ] [MainThread]: 
[0m21:55:06.755693 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:55:06.766755 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m21:55:06.767815 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:55:06.768891 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m21:55:06.770404 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:55:08.663108 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev'
[0m21:55:08.664314 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:55:08.665311 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_staging'
[0m21:55:08.667180 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:55:09.574385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a83474fb-e420-4092-b9ea-b4a5219bff8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C47BD0D090>]}
[0m21:55:09.575183 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:55:09.583000 [debug] [Thread-1 (]: Began running node model.glamira_analytics.stg_dim_location
[0m21:55:09.584014 [debug] [Thread-3 (]: Began running node model.glamira_analytics.stg_fact_sales_order_tt
[0m21:55:09.584737 [debug] [Thread-4 (]: Began running node model.glamira_analytics.stg_fx_rate
[0m21:55:09.585625 [debug] [Thread-2 (]: Began running node model.glamira_analytics.stg_dim_product
[0m21:55:09.586631 [info ] [Thread-1 (]: 1 of 15 START sql view model analytics_dev_staging.stg_dim_location ............ [RUN]
[0m21:55:09.588084 [info ] [Thread-3 (]: 3 of 15 START sql view model analytics_dev_staging.stg_fact_sales_order_tt ..... [RUN]
[0m21:55:09.589127 [info ] [Thread-4 (]: 4 of 15 START sql view model analytics_dev_staging.stg_fx_rate ................. [RUN]
[0m21:55:09.591393 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_location'
[0m21:55:09.590260 [info ] [Thread-2 (]: 2 of 15 START sql view model analytics_dev_staging.stg_dim_product ............. [RUN]
[0m21:55:09.592656 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fact_sales_order_tt'
[0m21:55:09.593691 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fx_rate'
[0m21:55:09.594431 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.stg_dim_location
[0m21:55:09.595326 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_product'
[0m21:55:09.596037 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.stg_fact_sales_order_tt
[0m21:55:09.596697 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.stg_fx_rate
[0m21:55:09.608803 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_location"
[0m21:55:09.610017 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.stg_dim_product
[0m21:55:09.616036 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m21:55:09.620846 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.stg_fx_rate"
[0m21:55:09.626066 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_product"
[0m21:55:09.627579 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.stg_dim_location
[0m21:55:09.648430 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.stg_fact_sales_order_tt
[0m21:55:09.692904 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_location"
[0m21:55:09.699691 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m21:55:09.700536 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.stg_dim_product
[0m21:55:09.701701 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.stg_fx_rate
[0m21:55:09.713692 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.stg_fx_rate"
[0m21:55:09.708157 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_product"
[0m21:55:09.715415 [debug] [Thread-3 (]: On model.glamira_analytics.stg_fact_sales_order_tt: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fact_sales_order_tt"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
  OPTIONS()
  as WITH source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`raw_layer`.`summary`
    WHERE collection = 'checkout_success'
)

/* 1. Remove failed URLs */
, filter_url AS (
    SELECT *
    FROM source 
    WHERE current_url NOT LIKE 'file://%'
)

/* 2. Unnest cart_products */
, unnested AS (
    SELECT 
        s.*
        ,cp
    FROM filter_url s
    CROSS JOIN UNNEST(s.cart_products) AS cp
)

, renamed AS (
    SELECT
        -- IDs
        SAFE_CAST(REGEXP_REPLACE(CAST(s.order_id AS STRING), r'\..*', '') AS INT64) AS order_id
        ,SAFE_CAST(REGEXP_REPLACE(CAST(cp.product_id AS STRING), r'\..*', '') AS INT64) AS product_id
        ,SAFE_CAST(REGEXP_REPLACE(CAST(s.user_id_db AS STRING), r'\..*', '') AS INT64) AS user_id
        ,SAFE_CAST(REGEXP_REPLACE(CAST(s.store_id AS STRING), r'\..*', '') AS INT64) AS store_id
        
        -- METRICS (Fixing the missing quantity issue)
        ,1 AS quantity
        ,CAST(cp.price AS NUMERIC) AS unit_price
        ,CAST(cp.price * 1 AS NUMERIC) AS line_total
        
        -- DATES
        ,s.time_stamp
        ,DATETIME(TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64)), s.timezone) AS local_time
        
        -- CURRENCY STANDARDIZATION
        ,s.currency
        ,CASE 
            WHEN s.currency IN ('USD', 'USD $') THEN 'USD'
            WHEN s.currency = 'HKD $'    THEN 'HKD'
            WHEN s.currency = 'NZD $'    THEN 'NZD'
            WHEN s.currency = 'MXN $'    THEN 'MXN'
            WHEN s.currency = 'Kƒç'       THEN 'CZK'
            WHEN s.currency = 'Ft'       THEN 'HUF'
            WHEN s.currency = 'z≈Ç'       THEN 'PLN'
            WHEN s.currency = '‚Çπ'        THEN 'INR'
            WHEN s.currency = '–ª–≤.'      THEN 'BGN'
            WHEN s.currency = '‚Ç´'        THEN 'VND'
            WHEN s.currency = '‚Ç±'        THEN 'PHP'
            WHEN s.currency = '‚Ç≤'        THEN 'PYG'
            WHEN s.currency = 'CRC ‚Ç°'    THEN 'CRC'
            WHEN s.currency = 'COP $'    THEN 'COP'
            WHEN s.currency = 'BOB Bs'   THEN 'BOB'
            WHEN s.currency = 'GTQ Q'    THEN 'GTQ'
            WHEN s.currency = 'PEN S/.'  THEN 'PEN'
            WHEN s.currency = 'DOP $'    THEN 'DOP'
            WHEN s.currency = 'CLP'      THEN 'CLP'
            WHEN s.currency = 'Lei'      THEN 'RON'
            WHEN s.currency = 'UYU'      THEN 'UYU'
            WHEN s.currency = 'din.'     THEN 'RSD'
            WHEN s.currency = 'kn'       THEN 'HRK'
            WHEN s.currency = 'ÿØ.ŸÉ.'     THEN 'KWD'
            WHEN s.currency = 'CHF'      THEN 'CHF'
            WHEN s.currency = 'kr'       THEN 'SEK' 
            WHEN s.currency = '‚Ç¨'        THEN 'EUR'
            WHEN s.currency = '¬£'        THEN 'GBP'
            WHEN s.currency = 'AU$'      THEN 'AUD'
            WHEN s.currency = 'CA$'      THEN 'CAD'
            WHEN s.currency = '¬•'        THEN 'JPY'
            ELSE 'USD' 
        END AS currency_code
        
        -- LOCATION INFO
        ,s.email AS email_address
        ,s.ip AS ip_address
        
        -- LOCATION HASH (Must match stg_dim_location logic)
        ,FARM_FINGERPRINT(CONCAT(
            CAST(s.country_short AS STRING), 
            CAST(s.region AS STRING), 
            CAST(s.city AS STRING)
        )) AS location_id

    FROM unnested s
)

SELECT * FROM renamed;


[0m21:55:09.716679 [debug] [Thread-1 (]: On model.glamira_analytics.stg_dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_location"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
  OPTIONS()
  as WITH stg_dim_location__source AS (
    SELECT 
        DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`ip_location`
)

, stg_dim_location__rename AS (
    SELECT
        CAST(ip AS STRING) AS ip_address,
        CAST(country_code AS STRING) AS country_short_name, 
        CAST(country_long AS STRING) AS country_long_name,
        CAST(region AS STRING) AS region_name,
        CAST(city AS STRING) AS city_name
    FROM stg_dim_location__sourc
    WHERE country_code <> '-' 
        AND country_code IS NOT NULL
)

, stg_dim_location__gen_key AS (
    SELECT
        FARM_FINGERPRINT(country_short_name ||region_name ||city_name) AS location_id,
        ip_address,
        country_short_name,
        country_long_name,
        region_name,
        city_name
    FROM stg_dim_location__rename
)

SELECT * FROM stg_dim_location__gen_key;


[0m21:55:09.717854 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:55:09.719138 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m21:55:09.720225 [debug] [Thread-4 (]: On model.glamira_analytics.stg_fx_rate: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fx_rate"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
  OPTIONS()
  as WITH source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev`.`exchange_rate_usd`
)

, renamed AS (
    SELECT
        CAST(currency AS STRING) AS currency_code
        ,CAST(rate_to_usd AS NUMERIC) AS rate_to_usd
        ,CAST(as_of_gmt AS TIMESTAMP) AS rate_timestamp
    FROM source
)

SELECT * FROM renamed;


[0m21:55:09.721373 [debug] [Thread-2 (]: On model.glamira_analytics.stg_dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_product"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
  OPTIONS()
  as WITH stg_dim_product__source AS (
    SELECT DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`product`
)

, stg_dim_product__rename AS (
    SELECT
        SAFE_CAST(product_id AS INT64) AS product_id,
        CAST(name AS STRING) AS product_name,
        CAST(url AS STRING) AS product_url,
        CAST(sku AS STRING) AS product_sku, 
        CAST(product_type AS STRING) AS product_type,
        CAST(category_name AS STRING) AS category_name,
        CAST(collection AS STRING) AS collection_name,
        SAFE_CAST(min_price AS NUMERIC) AS min_price,
        SAFE_CAST(max_price AS NUMERIC) AS max_price
    FROM stg_dim_product__source
    WHERE product_id IS NOT NULL
)

SELECT * FROM stg_dim_product__rename;


[0m21:55:09.724148 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:55:09.725865 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:55:10.896273 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:db769415-b55f-4c9e-91a3-29e0fc12620b&page=queryresults
[0m21:55:10.897516 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:b61aa435-6054-43b7-8b80-0387059e981d&page=queryresults
[0m21:55:10.898860 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:b61aa435-6054-43b7-8b80-0387059e981d&page=queryresults
[0m21:55:10.914573 [debug] [Thread-1 (]: Database Error in model stg_dim_location (models\staging\stg_dim_location.sql)
  Table "stg_dim_location__sourc" must be qualified with a dataset (e.g. dataset.table).
  compiled code at target\run\glamira_analytics\models\staging\stg_dim_location.sql
[0m21:55:10.917685 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a83474fb-e420-4092-b9ea-b4a5219bff8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C47BDF59D0>]}
[0m21:55:10.919033 [error] [Thread-1 (]: 1 of 15 ERROR creating sql view model analytics_dev_staging.stg_dim_location ... [[31mERROR[0m in 1.32s]
[0m21:55:10.920426 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.stg_dim_location
[0m21:55:10.921704 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.stg_dim_location' to be skipped because of status 'error'.  Reason: Database Error in model stg_dim_location (models\staging\stg_dim_location.sql)
  Table "stg_dim_location__sourc" must be qualified with a dataset (e.g. dataset.table).
  compiled code at target\run\glamira_analytics\models\staging\stg_dim_location.sql.
[0m21:55:10.924213 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_location
[0m21:55:10.925146 [info ] [Thread-1 (]: 5 of 15 SKIP relation analytics_dev.dim_location ............................... [[33mSKIP[0m]
[0m21:55:10.926427 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_location
[0m21:55:10.996960 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:6739e5b3-f1cc-48cc-8dc4-5cfcb8e45956&page=queryresults
[0m21:55:11.100350 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:52c416e0-6388-4a09-8f37-7401cf1a8dc0&page=queryresults
[0m21:55:11.304648 [debug] [Thread-4 (]: SQL status: OK in 0.406 seconds
[0m21:55:11.305878 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:52c416e0-6388-4a09-8f37-7401cf1a8dc0&page=queryresults
[0m21:55:11.316274 [debug] [Thread-3 (]: Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Name timezone not found inside s at [43:69]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m21:55:11.317290 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a83474fb-e420-4092-b9ea-b4a5219bff8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C47BA4ADB0>]}
[0m21:55:11.318213 [error] [Thread-3 (]: 3 of 15 ERROR creating sql view model analytics_dev_staging.stg_fact_sales_order_tt  [[31mERROR[0m in 1.72s]
[0m21:55:11.319809 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.stg_fact_sales_order_tt
[0m21:55:11.321026 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.stg_fact_sales_order_tt' to be skipped because of status 'error'.  Reason: Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Name timezone not found inside s at [43:69]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql.
[0m21:55:11.322960 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_store
[0m21:55:11.323754 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_date
[0m21:55:11.324532 [info ] [Thread-3 (]: 7 of 15 SKIP relation analytics_dev.dim_store .................................. [[33mSKIP[0m]
[0m21:55:11.326575 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_store
[0m21:55:11.325350 [info ] [Thread-1 (]: 6 of 15 SKIP relation analytics_dev.dim_date ................................... [[33mSKIP[0m]
[0m21:55:11.328037 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_user
[0m21:55:11.329358 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_date
[0m21:55:11.330301 [info ] [Thread-3 (]: 8 of 15 SKIP relation analytics_dev.dim_user ................................... [[33mSKIP[0m]
[0m21:55:11.331735 [debug] [Thread-1 (]: Began running node model.glamira_analytics.fact_sales_order_tt
[0m21:55:11.333004 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_user
[0m21:55:11.333949 [info ] [Thread-1 (]: 9 of 15 SKIP relation analytics_dev.fact_sales_order_tt ........................ [[33mSKIP[0m]
[0m21:55:11.335717 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.fact_sales_order_tt
[0m21:55:11.337580 [debug] [Thread-3 (]: Began running node model.glamira_analytics.mart_country
[0m21:55:11.338442 [debug] [Thread-1 (]: Began running node model.glamira_analytics.mart_overall
[0m21:55:11.339249 [info ] [Thread-3 (]: 10 of 15 SKIP relation analytics_dev.mart_country .............................. [[33mSKIP[0m]
[0m21:55:11.340255 [info ] [Thread-1 (]: 11 of 15 SKIP relation analytics_dev.mart_overall .............................. [[33mSKIP[0m]
[0m21:55:11.341990 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.mart_country
[0m21:55:11.344755 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.mart_overall
[0m21:55:11.406499 [debug] [Thread-2 (]: SQL status: OK in 0.409 seconds
[0m21:55:11.475879 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a83474fb-e420-4092-b9ea-b4a5219bff8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C47C1FC370>]}
[0m21:55:11.478126 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a83474fb-e420-4092-b9ea-b4a5219bff8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C47C1FB020>]}
[0m21:55:11.479168 [info ] [Thread-4 (]: 4 of 15 OK created sql view model analytics_dev_staging.stg_fx_rate ............ [[32mCREATE VIEW (0 processed)[0m in 1.88s]
[0m21:55:11.481197 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.stg_fx_rate
[0m21:55:11.480055 [info ] [Thread-2 (]: 2 of 15 OK created sql view model analytics_dev_staging.stg_dim_product ........ [[32mCREATE VIEW (0 processed)[0m in 1.88s]
[0m21:55:11.482811 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.stg_dim_product
[0m21:55:11.483576 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_fx_rate_usd
[0m21:55:11.484970 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_product
[0m21:55:11.484387 [info ] [Thread-3 (]: 12 of 15 START sql view model analytics_dev.dim_fx_rate_usd .................... [RUN]
[0m21:55:11.487886 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_fact_sales_order_tt, now model.glamira_analytics.dim_fx_rate_usd)
[0m21:55:11.486909 [info ] [Thread-1 (]: 13 of 15 START sql view model analytics_dev.dim_product ........................ [RUN]
[0m21:55:11.488927 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.dim_fx_rate_usd
[0m21:55:11.489779 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_dim_location, now model.glamira_analytics.dim_product)
[0m21:55:11.495551 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.dim_fx_rate_usd"
[0m21:55:11.496486 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.dim_product
[0m21:55:11.503527 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.dim_product"
[0m21:55:11.504905 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.dim_fx_rate_usd
[0m21:55:11.508694 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.dim_fx_rate_usd"
[0m21:55:11.509835 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.dim_product
[0m21:55:11.514424 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.dim_product"
[0m21:55:11.515712 [debug] [Thread-3 (]: On model.glamira_analytics.dim_fx_rate_usd: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_fx_rate_usd"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev`.`dim_fx_rate_usd`
  OPTIONS()
  as WITH stg_fx AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
)

SELECT
    currency_code AS from_currency_code
    ,'USD' AS to_currency_code
    ,rate_to_usd
    ,rate_timestamp
FROM stg_fx;


[0m21:55:11.516508 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:55:11.517298 [debug] [Thread-1 (]: On model.glamira_analytics.dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_product"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev`.`dim_product`
  OPTIONS()
  as WITH dim_product__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
)
, dim_product__null_handle AS (
    SELECT
        product_id,
        coalesce(product_name,'XNA') AS product_name,
        coalesce(product_url,'XNA') AS product_url,
        coalesce(product_sku,'XNA') AS product_sku,
        coalesce(product_type,'XNA') AS product_type,
        coalesce(NULLIF(TRIM(category_name),''),'XNA') AS category_name, 
        coalesce(NULLIF(TRIM(collection_name),''),'XNA') AS collection_name,
        min_price,
        max_price
    FROM dim_product__source 
)

, dim_product__add_key AS (
    SELECT
        FARM_FINGERPRINT(CAST(product_id AS STRING)) AS product_key
        ,CAST(product_id AS STRING) AS product_id
        ,product_name
        ,product_url
        -- FIX: Changed 'sku' to 'product_sku'
        ,product_sku
        ,product_name
        ,category_name
        ,collection_name
        ,min_price
        ,max_price
    FROM dim_product__null_handle
)

, dim_product__union_undefined AS (
    SELECT 
        * FROM dim_product__add_key

    UNION ALL

    SELECT 
        -1 AS product_key
        ,'-1' AS product_id
        ,'Undefined' AS product_name
        ,'Undefined' AS product_url
        ,'Undefined' AS product_sku
        ,'Undefined' AS product_type_name
        ,'Undefined' AS category_name
        ,'Undefined' AS collection_name
        ,0 AS min_price
        ,0 AS max_price
)

SELECT * FROM dim_product__union_undefined;


[0m21:55:11.518590 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:55:12.942233 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:7fcca40a-daf0-4284-ab5e-553271241735&page=queryresults
[0m21:55:13.044098 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:f4031094-4e18-40eb-8d0e-9cebe47534ce&page=queryresults
[0m21:55:13.248951 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:f4031094-4e18-40eb-8d0e-9cebe47534ce&page=queryresults
[0m21:55:13.259270 [debug] [Thread-1 (]: Database Error in model dim_product (models\dimensions\dim_product.sql)
  CREATE VIEW has columns with duplicate name product_name at [6:6]
  compiled code at target\run\glamira_analytics\models\dimensions\dim_product.sql
[0m21:55:13.260050 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a83474fb-e420-4092-b9ea-b4a5219bff8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C46BD87E00>]}
[0m21:55:13.260799 [error] [Thread-1 (]: 13 of 15 ERROR creating sql view model analytics_dev.dim_product ............... [[31mERROR[0m in 1.77s]
[0m21:55:13.261699 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_product
[0m21:55:13.262800 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.dim_product' to be skipped because of status 'error'.  Reason: Database Error in model dim_product (models\dimensions\dim_product.sql)
  CREATE VIEW has columns with duplicate name product_name at [6:6]
  compiled code at target\run\glamira_analytics\models\dimensions\dim_product.sql.
[0m21:55:13.264122 [debug] [Thread-4 (]: Began running node model.glamira_analytics.mart_product
[0m21:55:13.265083 [debug] [Thread-2 (]: Began running node model.glamira_analytics.mart_product_type
[0m21:55:13.266105 [info ] [Thread-4 (]: 14 of 15 SKIP relation analytics_dev.mart_product .............................. [[33mSKIP[0m]
[0m21:55:13.267980 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.mart_product
[0m21:55:13.266923 [info ] [Thread-2 (]: 15 of 15 SKIP relation analytics_dev.mart_product_type ......................... [[33mSKIP[0m]
[0m21:55:13.269465 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.mart_product_type
[0m21:55:13.350442 [debug] [Thread-3 (]: SQL status: OK in 0.407 seconds
[0m21:55:13.355890 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a83474fb-e420-4092-b9ea-b4a5219bff8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C47C471CD0>]}
[0m21:55:13.356941 [info ] [Thread-3 (]: 12 of 15 OK created sql view model analytics_dev.dim_fx_rate_usd ............... [[32mCREATE VIEW (0 processed)[0m in 1.87s]
[0m21:55:13.358264 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_fx_rate_usd
[0m21:55:13.360466 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:55:13.361519 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:55:13.362115 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m21:55:13.362615 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m21:55:13.363105 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev' was properly closed.
[0m21:55:13.363615 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_staging' was properly closed.
[0m21:55:13.364126 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_product' was properly closed.
[0m21:55:13.364632 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_fx_rate_usd' was properly closed.
[0m21:55:13.365116 [debug] [MainThread]: Connection 'model.glamira_analytics.stg_fx_rate' was properly closed.
[0m21:55:13.365545 [debug] [MainThread]: Connection 'model.glamira_analytics.stg_dim_product' was properly closed.
[0m21:55:13.366161 [info ] [MainThread]: 
[0m21:55:13.366813 [info ] [MainThread]: Finished running 1 incremental model, 4 table models, 10 view models in 0 hours 0 minutes and 6.61 seconds (6.61s).
[0m21:55:13.370123 [debug] [MainThread]: Command end result
[0m21:55:13.417831 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m21:55:13.421346 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m21:55:13.429757 [debug] [MainThread]: Wrote artifact RunExecutionResult to D:\Project 7\glamira_analytics\target\run_results.json
[0m21:55:13.430273 [info ] [MainThread]: 
[0m21:55:13.431407 [info ] [MainThread]: [31mCompleted with 3 errors, 0 partial successes, and 0 warnings:[0m
[0m21:55:13.432620 [info ] [MainThread]: 
[0m21:55:13.433789 [error] [MainThread]: [31mFailure in model stg_dim_location (models\staging\stg_dim_location.sql)[0m
[0m21:55:13.434910 [error] [MainThread]:   Database Error in model stg_dim_location (models\staging\stg_dim_location.sql)
  Table "stg_dim_location__sourc" must be qualified with a dataset (e.g. dataset.table).
  compiled code at target\run\glamira_analytics\models\staging\stg_dim_location.sql
[0m21:55:13.436102 [info ] [MainThread]: 
[0m21:55:13.437473 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\staging\stg_dim_location.sql
[0m21:55:13.438682 [info ] [MainThread]: 
[0m21:55:13.440063 [error] [MainThread]: [31mFailure in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)[0m
[0m21:55:13.441109 [error] [MainThread]:   Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Name timezone not found inside s at [43:69]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m21:55:13.442215 [info ] [MainThread]: 
[0m21:55:13.443908 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m21:55:13.445009 [info ] [MainThread]: 
[0m21:55:13.445980 [error] [MainThread]: [31mFailure in model dim_product (models\dimensions\dim_product.sql)[0m
[0m21:55:13.447047 [error] [MainThread]:   Database Error in model dim_product (models\dimensions\dim_product.sql)
  CREATE VIEW has columns with duplicate name product_name at [6:6]
  compiled code at target\run\glamira_analytics\models\dimensions\dim_product.sql
[0m21:55:13.447773 [info ] [MainThread]: 
[0m21:55:13.448434 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\dimensions\dim_product.sql
[0m21:55:13.448992 [info ] [MainThread]: 
[0m21:55:13.449802 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=3 SKIP=9 NO-OP=0 TOTAL=15
[0m21:55:13.451517 [debug] [MainThread]: Command `dbt run` failed at 21:55:13.451294 after 18.93 seconds
[0m21:55:13.452344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C47BAA8BF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C47C58FEF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001C47C58F950>]}
[0m21:55:13.453211 [debug] [MainThread]: Flushing usage events
[0m21:55:15.401068 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:57:45.144936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B82AA24EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B82BB8FED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B82BB8FB10>]}


============================== 21:57:45.151312 | abda06cf-0170-427e-82fc-2542df19ae6e ==============================
[0m21:57:45.151312 [info ] [MainThread]: Running with dbt=1.11.2
[0m21:57:45.152666 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'no_print': 'None', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'write_json': 'True', 'empty': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'invocation_command': 'dbt run --full-refresh', 'indirect_selection': 'eager', 'use_colors': 'True', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m21:57:55.805940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'abda06cf-0170-427e-82fc-2542df19ae6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B82AEC1BA0>]}
[0m21:57:55.955567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'abda06cf-0170-427e-82fc-2542df19ae6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B83B653570>]}
[0m21:57:55.956574 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m21:57:56.939310 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m21:57:57.099933 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m21:57:57.101044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'abda06cf-0170-427e-82fc-2542df19ae6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B83B7AE150>]}
[0m21:57:59.060291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'abda06cf-0170-427e-82fc-2542df19ae6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B84B3FF2F0>]}
[0m21:57:59.166964 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m21:57:59.170149 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m21:57:59.205980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'abda06cf-0170-427e-82fc-2542df19ae6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B84B4EA430>]}
[0m21:57:59.206673 [info ] [MainThread]: Found 15 models, 1 seed, 3 sources, 537 macros
[0m21:57:59.207597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'abda06cf-0170-427e-82fc-2542df19ae6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B84B2EE750>]}
[0m21:57:59.212575 [info ] [MainThread]: 
[0m21:57:59.213478 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:57:59.214613 [info ] [MainThread]: 
[0m21:57:59.215880 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:57:59.225156 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m21:57:59.226455 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:57:59.227731 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m21:57:59.229131 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:57:59.230379 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m21:57:59.231734 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:58:01.190035 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_stone-album-475912-b9, now create_stone-album-475912-b9_analytics_dev_dimensions)
[0m21:58:01.190901 [debug] [ThreadPool]: Creating schema "database: "stone-album-475912-b9"
schema: "analytics_dev_dimensions"
"
[0m21:58:01.203646 [debug] [ThreadPool]: On create_stone-album-475912-b9_analytics_dev_dimensions: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "connection_name": "create_stone-album-475912-b9_analytics_dev_dimensions"} */
create schema if not exists `stone-album-475912-b9`.`analytics_dev_dimensions`
  
[0m21:58:01.204218 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:58:02.056973 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:ddae0bad-0278-4f0e-870a-52d335af5551&page=queryresults
[0m21:58:04.857743 [debug] [ThreadPool]: SQL status: OK in 2.800 seconds
[0m21:58:04.941183 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_staging'
[0m21:58:04.942334 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:58:04.943225 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_dimensions'
[0m21:58:04.944350 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:58:04.945044 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev'
[0m21:58:04.946716 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:58:05.993244 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'abda06cf-0170-427e-82fc-2542df19ae6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B84B80D9D0>]}
[0m21:58:05.994183 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:58:06.001381 [debug] [Thread-3 (]: Began running node model.glamira_analytics.stg_fact_sales_order_tt
[0m21:58:06.002464 [debug] [Thread-4 (]: Began running node model.glamira_analytics.stg_fx_rate
[0m21:58:06.003562 [debug] [Thread-1 (]: Began running node model.glamira_analytics.stg_dim_location
[0m21:58:06.004337 [debug] [Thread-2 (]: Began running node model.glamira_analytics.stg_dim_product
[0m21:58:06.005300 [info ] [Thread-3 (]: 3 of 15 START sql view model analytics_dev_staging.stg_fact_sales_order_tt ..... [RUN]
[0m21:58:06.006344 [info ] [Thread-4 (]: 4 of 15 START sql view model analytics_dev_staging.stg_fx_rate ................. [RUN]
[0m21:58:06.007560 [info ] [Thread-1 (]: 1 of 15 START sql view model analytics_dev_staging.stg_dim_location ............ [RUN]
[0m21:58:06.010249 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fact_sales_order_tt'
[0m21:58:06.009080 [info ] [Thread-2 (]: 2 of 15 START sql view model analytics_dev_staging.stg_dim_product ............. [RUN]
[0m21:58:06.011394 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fx_rate'
[0m21:58:06.012385 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_location'
[0m21:58:06.013212 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.stg_fact_sales_order_tt
[0m21:58:06.014175 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_product'
[0m21:58:06.015082 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.stg_fx_rate
[0m21:58:06.016036 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.stg_dim_location
[0m21:58:06.028520 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m21:58:06.029296 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.stg_dim_product
[0m21:58:06.034124 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.stg_fx_rate"
[0m21:58:06.038259 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_location"
[0m21:58:06.044659 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_product"
[0m21:58:06.046025 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.stg_fact_sales_order_tt
[0m21:58:06.088460 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m21:58:06.089409 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.stg_fx_rate
[0m21:58:06.094510 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.stg_fx_rate"
[0m21:58:06.095384 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.stg_dim_product
[0m21:58:06.096262 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.stg_dim_location
[0m21:58:06.100928 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_product"
[0m21:58:06.110220 [debug] [Thread-3 (]: On model.glamira_analytics.stg_fact_sales_order_tt: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fact_sales_order_tt"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
  OPTIONS()
  as WITH source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`raw_layer`.`summary`
    WHERE collection = 'checkout_success'
)

/* 1. Remove failed URLs */
, filter_url AS (
    SELECT *
    FROM source 
    WHERE current_url NOT LIKE 'file://%'
)

/* 2. Unnest cart_products */
, unnested AS (
    SELECT 
        s.*
        ,cp
    FROM filter_url s
    CROSS JOIN UNNEST(s.cart_products) AS cp
)

, renamed AS (
    SELECT
        -- IDs
        SAFE_CAST(REGEXP_REPLACE(CAST(s.order_id AS STRING), r'\..*', '') AS INT64) AS order_id
        ,SAFE_CAST(REGEXP_REPLACE(CAST(cp.product_id AS STRING), r'\..*', '') AS INT64) AS product_id
        ,SAFE_CAST(REGEXP_REPLACE(CAST(s.user_id_db AS STRING), r'\..*', '') AS INT64) AS user_id
        ,SAFE_CAST(REGEXP_REPLACE(CAST(s.store_id AS STRING), r'\..*', '') AS INT64) AS store_id
        
        -- METRICS (Fixing the missing quantity issue)
        ,1 AS quantity
        ,CAST(cp.price AS NUMERIC) AS unit_price
        ,CAST(cp.price * 1 AS NUMERIC) AS line_total
        
        -- DATES
        ,s.time_stamp
        ,DATETIME(TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64)), s.timezone) AS local_time
        
        -- CURRENCY STANDARDIZATION
        ,s.currency
        ,CASE 
            WHEN s.currency IN ('USD', 'USD $') THEN 'USD'
            WHEN s.currency = 'HKD $'    THEN 'HKD'
            WHEN s.currency = 'NZD $'    THEN 'NZD'
            WHEN s.currency = 'MXN $'    THEN 'MXN'
            WHEN s.currency = 'Kƒç'       THEN 'CZK'
            WHEN s.currency = 'Ft'       THEN 'HUF'
            WHEN s.currency = 'z≈Ç'       THEN 'PLN'
            WHEN s.currency = '‚Çπ'        THEN 'INR'
            WHEN s.currency = '–ª–≤.'      THEN 'BGN'
            WHEN s.currency = '‚Ç´'        THEN 'VND'
            WHEN s.currency = '‚Ç±'        THEN 'PHP'
            WHEN s.currency = '‚Ç≤'        THEN 'PYG'
            WHEN s.currency = 'CRC ‚Ç°'    THEN 'CRC'
            WHEN s.currency = 'COP $'    THEN 'COP'
            WHEN s.currency = 'BOB Bs'   THEN 'BOB'
            WHEN s.currency = 'GTQ Q'    THEN 'GTQ'
            WHEN s.currency = 'PEN S/.'  THEN 'PEN'
            WHEN s.currency = 'DOP $'    THEN 'DOP'
            WHEN s.currency = 'CLP'      THEN 'CLP'
            WHEN s.currency = 'Lei'      THEN 'RON'
            WHEN s.currency = 'UYU'      THEN 'UYU'
            WHEN s.currency = 'din.'     THEN 'RSD'
            WHEN s.currency = 'kn'       THEN 'HRK'
            WHEN s.currency = 'ÿØ.ŸÉ.'     THEN 'KWD'
            WHEN s.currency = 'CHF'      THEN 'CHF'
            WHEN s.currency = 'kr'       THEN 'SEK' 
            WHEN s.currency = '‚Ç¨'        THEN 'EUR'
            WHEN s.currency = '¬£'        THEN 'GBP'
            WHEN s.currency = 'AU$'      THEN 'AUD'
            WHEN s.currency = 'CA$'      THEN 'CAD'
            WHEN s.currency = '¬•'        THEN 'JPY'
            ELSE 'USD' 
        END AS currency_code
        
        -- LOCATION INFO
        ,s.email AS email_address
        ,s.ip AS ip_address
        
        -- LOCATION HASH (Must match stg_dim_location logic)
        ,FARM_FINGERPRINT(CONCAT(
            CAST(s.country_short AS STRING), 
            CAST(s.region AS STRING), 
            CAST(s.city AS STRING)
        )) AS location_id

    FROM unnested s
)

SELECT * FROM renamed;


[0m21:58:06.112355 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_location"
[0m21:58:06.113262 [debug] [Thread-4 (]: On model.glamira_analytics.stg_fx_rate: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fx_rate"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
  OPTIONS()
  as WITH source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev`.`exchange_rate_usd`
)

, renamed AS (
    SELECT
        CAST(currency AS STRING) AS currency_code
        ,CAST(rate_to_usd AS NUMERIC) AS rate_to_usd
        ,CAST(as_of_gmt AS TIMESTAMP) AS rate_timestamp
    FROM source
)

SELECT * FROM renamed;


[0m21:58:06.114175 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:58:06.115211 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:58:06.116861 [debug] [Thread-2 (]: On model.glamira_analytics.stg_dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_product"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
  OPTIONS()
  as WITH stg_dim_product__source AS (
    SELECT DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`product`
)

, stg_dim_product__rename AS (
    SELECT
        SAFE_CAST(product_id AS INT64) AS product_id,
        CAST(name AS STRING) AS product_name,
        CAST(url AS STRING) AS product_url,
        CAST(sku AS STRING) AS product_sku, 
        CAST(product_type AS STRING) AS product_type,
        CAST(category_name AS STRING) AS category_name,
        CAST(collection AS STRING) AS collection_name,
        SAFE_CAST(min_price AS NUMERIC) AS min_price,
        SAFE_CAST(max_price AS NUMERIC) AS max_price
    FROM stg_dim_product__source
    WHERE product_id IS NOT NULL
)

SELECT * FROM stg_dim_product__rename;


[0m21:58:06.118637 [debug] [Thread-1 (]: On model.glamira_analytics.stg_dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_location"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
  OPTIONS()
  as WITH stg_dim_location__source AS (
    SELECT 
        DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`ip_location`
)

, stg_dim_location__rename AS (
    SELECT
        CAST(ip AS STRING) AS ip_address,
        CAST(country_code AS STRING) AS country_short_name, 
        CAST(country_long AS STRING) AS country_long_name,
        CAST(region AS STRING) AS region_name,
        CAST(city AS STRING) AS city_name
    FROM stg_dim_location__sourc
    WHERE country_code <> '-' 
        AND country_code IS NOT NULL
)

, stg_dim_location__gen_key AS (
    SELECT
        FARM_FINGERPRINT(country_short_name ||region_name ||city_name) AS location_id,
        ip_address,
        country_short_name,
        country_long_name,
        region_name,
        city_name
    FROM stg_dim_location__rename
)

SELECT * FROM stg_dim_location__gen_key;


[0m21:58:06.120116 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:58:06.121958 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m21:58:07.214019 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:33a2866d-ed9b-4802-87ec-be654fe86390&page=queryresults
[0m21:58:07.215996 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:fee37bf0-f9b5-433a-8ee2-715abeaca3e6&page=queryresults
[0m21:58:07.217401 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:8b5649b8-0055-46ef-a99d-15abd22fbe0f&page=queryresults
[0m21:58:07.315100 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:a6643892-0354-44b5-ae26-25526b11f848&page=queryresults
[0m21:58:07.315975 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:a6643892-0354-44b5-ae26-25526b11f848&page=queryresults
[0m21:58:07.330817 [debug] [Thread-1 (]: Database Error in model stg_dim_location (models\staging\stg_dim_location.sql)
  Table "stg_dim_location__sourc" must be qualified with a dataset (e.g. dataset.table).
  compiled code at target\run\glamira_analytics\models\staging\stg_dim_location.sql
[0m21:58:07.334200 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abda06cf-0170-427e-82fc-2542df19ae6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B84BE6CC00>]}
[0m21:58:07.335690 [error] [Thread-1 (]: 1 of 15 ERROR creating sql view model analytics_dev_staging.stg_dim_location ... [[31mERROR[0m in 1.32s]
[0m21:58:07.337307 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.stg_dim_location
[0m21:58:07.339039 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.stg_dim_location' to be skipped because of status 'error'.  Reason: Database Error in model stg_dim_location (models\staging\stg_dim_location.sql)
  Table "stg_dim_location__sourc" must be qualified with a dataset (e.g. dataset.table).
  compiled code at target\run\glamira_analytics\models\staging\stg_dim_location.sql.
[0m21:58:07.342102 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_location
[0m21:58:07.343266 [info ] [Thread-1 (]: 5 of 15 SKIP relation analytics_dev_dimensions.dim_location .................... [[33mSKIP[0m]
[0m21:58:07.344511 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_location
[0m21:58:07.389703 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:fee37bf0-f9b5-433a-8ee2-715abeaca3e6&page=queryresults
[0m21:58:07.407486 [debug] [Thread-3 (]: Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Name timezone not found inside s at [43:69]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m21:58:07.408734 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abda06cf-0170-427e-82fc-2542df19ae6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B84BE2DDB0>]}
[0m21:58:07.410220 [error] [Thread-3 (]: 3 of 15 ERROR creating sql view model analytics_dev_staging.stg_fact_sales_order_tt  [[31mERROR[0m in 1.40s]
[0m21:58:07.411575 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.stg_fact_sales_order_tt
[0m21:58:07.412491 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.stg_fact_sales_order_tt' to be skipped because of status 'error'.  Reason: Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Name timezone not found inside s at [43:69]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql.
[0m21:58:07.413998 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_date
[0m21:58:07.415024 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_store
[0m21:58:07.416246 [info ] [Thread-1 (]: 6 of 15 SKIP relation analytics_dev_dimensions.dim_date ........................ [[33mSKIP[0m]
[0m21:58:07.418045 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_date
[0m21:58:07.417156 [info ] [Thread-3 (]: 7 of 15 SKIP relation analytics_dev_dimensions.dim_store ....................... [[33mSKIP[0m]
[0m21:58:07.418885 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_user
[0m21:58:07.419576 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_store
[0m21:58:07.420872 [debug] [Thread-3 (]: Began running node model.glamira_analytics.fact_sales_order_tt
[0m21:58:07.420239 [info ] [Thread-1 (]: 8 of 15 SKIP relation analytics_dev_dimensions.dim_user ........................ [[33mSKIP[0m]
[0m21:58:07.422437 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_user
[0m21:58:07.421811 [info ] [Thread-3 (]: 9 of 15 SKIP relation analytics_dev_dimensions.fact_sales_order_tt ............. [[33mSKIP[0m]
[0m21:58:07.424007 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.fact_sales_order_tt
[0m21:58:07.425127 [debug] [Thread-1 (]: Began running node model.glamira_analytics.mart_country
[0m21:58:07.426234 [debug] [Thread-3 (]: Began running node model.glamira_analytics.mart_overall
[0m21:58:07.427379 [info ] [Thread-1 (]: 10 of 15 SKIP relation analytics_dev.mart_country .............................. [[33mSKIP[0m]
[0m21:58:07.429896 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.mart_country
[0m21:58:07.428377 [info ] [Thread-3 (]: 11 of 15 SKIP relation analytics_dev.mart_overall .............................. [[33mSKIP[0m]
[0m21:58:07.431344 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.mart_overall
[0m21:58:07.623231 [debug] [Thread-2 (]: SQL status: OK in 0.408 seconds
[0m21:58:07.624337 [debug] [Thread-4 (]: SQL status: OK in 0.406 seconds
[0m21:58:07.684217 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abda06cf-0170-427e-82fc-2542df19ae6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B84BD25C50>]}
[0m21:58:07.686546 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abda06cf-0170-427e-82fc-2542df19ae6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B84BD26050>]}
[0m21:58:07.687518 [info ] [Thread-4 (]: 4 of 15 OK created sql view model analytics_dev_staging.stg_fx_rate ............ [[32mCREATE VIEW (0 processed)[0m in 1.67s]
[0m21:58:07.689638 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.stg_fx_rate
[0m21:58:07.688528 [info ] [Thread-2 (]: 2 of 15 OK created sql view model analytics_dev_staging.stg_dim_product ........ [[32mCREATE VIEW (0 processed)[0m in 1.67s]
[0m21:58:07.690966 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.stg_dim_product
[0m21:58:07.692087 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_fx_rate_usd
[0m21:58:07.694822 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_product
[0m21:58:07.693888 [info ] [Thread-1 (]: 12 of 15 START sql table model analytics_dev_dimensions.dim_fx_rate_usd ........ [RUN]
[0m21:58:07.696612 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_dim_location, now model.glamira_analytics.dim_fx_rate_usd)
[0m21:58:07.695856 [info ] [Thread-3 (]: 13 of 15 START sql table model analytics_dev_dimensions.dim_product ............ [RUN]
[0m21:58:07.697533 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.dim_fx_rate_usd
[0m21:58:07.698449 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_fact_sales_order_tt, now model.glamira_analytics.dim_product)
[0m21:58:07.703655 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.dim_fx_rate_usd"
[0m21:58:07.704401 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.dim_product
[0m21:58:07.709357 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.dim_product"
[0m21:58:07.711895 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.dim_fx_rate_usd
[0m21:58:07.740366 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.dim_product
[0m21:58:07.766525 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.dim_fx_rate_usd"
[0m21:58:07.770342 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.dim_product"
[0m21:58:07.772295 [debug] [Thread-1 (]: On model.glamira_analytics.dim_fx_rate_usd: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_fx_rate_usd"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_fx_rate_usd`
      
    
    

    
    OPTIONS()
    as (
      WITH stg_fx AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
)

SELECT
    currency_code AS from_currency_code
    ,'USD' AS to_currency_code
    ,rate_to_usd
    ,rate_timestamp
FROM stg_fx
    );
  
[0m21:58:07.773618 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:58:07.774870 [debug] [Thread-3 (]: On model.glamira_analytics.dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_product"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_product__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
)
, dim_product__null_handle AS (
    SELECT
        product_id,
        coalesce(product_name,'XNA') AS product_name,
        coalesce(product_url,'XNA') AS product_url,
        coalesce(product_sku,'XNA') AS product_sku,
        coalesce(product_type,'XNA') AS product_type,
        coalesce(NULLIF(TRIM(category_name),''),'XNA') AS category_name, 
        coalesce(NULLIF(TRIM(collection_name),''),'XNA') AS collection_name,
        min_price,
        max_price
    FROM dim_product__source 
)

, dim_product__add_key AS (
    SELECT
        FARM_FINGERPRINT(CAST(product_id AS STRING)) AS product_key
        ,CAST(product_id AS STRING) AS product_id
        ,product_name
        ,product_url
        -- FIX: Changed 'sku' to 'product_sku'
        ,product_sku
        ,product_name
        ,category_name
        ,collection_name
        ,min_price
        ,max_price
    FROM dim_product__null_handle
)

, dim_product__union_undefined AS (
    SELECT 
        * FROM dim_product__add_key

    UNION ALL

    SELECT 
        -1 AS product_key
        ,'-1' AS product_id
        ,'Undefined' AS product_name
        ,'Undefined' AS product_url
        ,'Undefined' AS product_sku
        ,'Undefined' AS product_type_name
        ,'Undefined' AS category_name
        ,'Undefined' AS collection_name
        ,0 AS min_price
        ,0 AS max_price
)

SELECT * FROM dim_product__union_undefined
    );
  
[0m21:58:07.777583 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:58:09.464303 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:09e986e0-3437-4b53-a821-9562536b1c31&page=queryresults
[0m21:58:09.570417 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:04c2038c-011c-49fe-b307-82f741c27422&page=queryresults
[0m21:58:09.740819 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:04c2038c-011c-49fe-b307-82f741c27422&page=queryresults
[0m21:58:09.752977 [debug] [Thread-3 (]: Database Error in model dim_product (models\dimensions\dim_product.sql)
  CREATE TABLE has columns with duplicate name product_name at [14:7]
  compiled code at target\run\glamira_analytics\models\dimensions\dim_product.sql
[0m21:58:09.754005 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abda06cf-0170-427e-82fc-2542df19ae6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B84BF27410>]}
[0m21:58:09.755620 [error] [Thread-3 (]: 13 of 15 ERROR creating sql table model analytics_dev_dimensions.dim_product ... [[31mERROR[0m in 2.06s]
[0m21:58:09.757723 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_product
[0m21:58:09.759895 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.dim_product' to be skipped because of status 'error'.  Reason: Database Error in model dim_product (models\dimensions\dim_product.sql)
  CREATE TABLE has columns with duplicate name product_name at [14:7]
  compiled code at target\run\glamira_analytics\models\dimensions\dim_product.sql.
[0m21:58:09.761618 [debug] [Thread-4 (]: Began running node model.glamira_analytics.mart_product
[0m21:58:09.763000 [debug] [Thread-2 (]: Began running node model.glamira_analytics.mart_product_type
[0m21:58:09.763776 [info ] [Thread-4 (]: 14 of 15 SKIP relation analytics_dev.mart_product .............................. [[33mSKIP[0m]
[0m21:58:09.765492 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.mart_product
[0m21:58:09.764602 [info ] [Thread-2 (]: 15 of 15 SKIP relation analytics_dev.mart_product_type ......................... [[33mSKIP[0m]
[0m21:58:09.766548 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.mart_product_type
[0m21:58:11.099809 [debug] [Thread-1 (]: SQL status: OK in 1.635 seconds
[0m21:58:11.517032 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'abda06cf-0170-427e-82fc-2542df19ae6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B84BF263F0>]}
[0m21:58:11.518112 [info ] [Thread-1 (]: 12 of 15 OK created sql table model analytics_dev_dimensions.dim_fx_rate_usd ... [[32mCREATE TABLE (34.0 rows, 1.3 KiB processed)[0m in 3.82s]
[0m21:58:11.520042 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_fx_rate_usd
[0m21:58:11.522279 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:58:11.523218 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:58:11.523709 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m21:58:11.524173 [debug] [MainThread]: Connection 'create_stone-album-475912-b9_analytics_dev_dimensions' was properly closed.
[0m21:58:11.524608 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m21:58:11.525049 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_staging' was properly closed.
[0m21:58:11.525505 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_dimensions' was properly closed.
[0m21:58:11.525943 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev' was properly closed.
[0m21:58:11.526367 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_product' was properly closed.
[0m21:58:11.526790 [debug] [MainThread]: Connection 'model.glamira_analytics.stg_fx_rate' was properly closed.
[0m21:58:11.527215 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_fx_rate_usd' was properly closed.
[0m21:58:11.527646 [debug] [MainThread]: Connection 'model.glamira_analytics.stg_dim_product' was properly closed.
[0m21:58:11.528276 [info ] [MainThread]: 
[0m21:58:11.528993 [info ] [MainThread]: Finished running 1 incremental model, 10 table models, 4 view models in 0 hours 0 minutes and 12.31 seconds (12.31s).
[0m21:58:11.532878 [debug] [MainThread]: Command end result
[0m21:58:11.578326 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m21:58:11.582035 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m21:58:11.602953 [debug] [MainThread]: Wrote artifact RunExecutionResult to D:\Project 7\glamira_analytics\target\run_results.json
[0m21:58:11.604705 [info ] [MainThread]: 
[0m21:58:11.606506 [info ] [MainThread]: [31mCompleted with 3 errors, 0 partial successes, and 0 warnings:[0m
[0m21:58:11.607701 [info ] [MainThread]: 
[0m21:58:11.610072 [error] [MainThread]: [31mFailure in model stg_dim_location (models\staging\stg_dim_location.sql)[0m
[0m21:58:11.612124 [error] [MainThread]:   Database Error in model stg_dim_location (models\staging\stg_dim_location.sql)
  Table "stg_dim_location__sourc" must be qualified with a dataset (e.g. dataset.table).
  compiled code at target\run\glamira_analytics\models\staging\stg_dim_location.sql
[0m21:58:11.613464 [info ] [MainThread]: 
[0m21:58:11.614810 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\staging\stg_dim_location.sql
[0m21:58:11.616167 [info ] [MainThread]: 
[0m21:58:11.617983 [error] [MainThread]: [31mFailure in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)[0m
[0m21:58:11.621154 [error] [MainThread]:   Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Name timezone not found inside s at [43:69]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m21:58:11.623515 [info ] [MainThread]: 
[0m21:58:11.628276 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m21:58:11.629469 [info ] [MainThread]: 
[0m21:58:11.631014 [error] [MainThread]: [31mFailure in model dim_product (models\dimensions\dim_product.sql)[0m
[0m21:58:11.632312 [error] [MainThread]:   Database Error in model dim_product (models\dimensions\dim_product.sql)
  CREATE TABLE has columns with duplicate name product_name at [14:7]
  compiled code at target\run\glamira_analytics\models\dimensions\dim_product.sql
[0m21:58:11.633107 [info ] [MainThread]: 
[0m21:58:11.634218 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\dimensions\dim_product.sql
[0m21:58:11.635727 [info ] [MainThread]: 
[0m21:58:11.637186 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=3 SKIP=9 NO-OP=0 TOTAL=15
[0m21:58:11.638969 [debug] [MainThread]: Command `dbt run` failed at 21:58:11.638722 after 26.74 seconds
[0m21:58:11.639642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B84BF264B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B84B37B5F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B82B4EA2D0>]}
[0m21:58:11.640153 [debug] [MainThread]: Flushing usage events
[0m21:58:13.660256 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:04:58.038850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AC8B134EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AC8C29FED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AC8C29FB10>]}


============================== 22:04:58.045045 | ee197fa4-9e7e-4a57-8910-57e54c3d36d8 ==============================
[0m22:04:58.045045 [info ] [MainThread]: Running with dbt=1.11.2
[0m22:04:58.046408 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'no_print': 'None', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'write_json': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'empty': 'False', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'fail_fast': 'False', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'invocation_command': 'dbt run --full-refresh', 'use_colors': 'True', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m22:05:07.838436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ee197fa4-9e7e-4a57-8910-57e54c3d36d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AC8B5D1BA0>]}
[0m22:05:07.920641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ee197fa4-9e7e-4a57-8910-57e54c3d36d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AC9BD37570>]}
[0m22:05:07.921494 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m22:05:08.771315 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m22:05:09.001520 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m22:05:09.002349 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\staging\stg_fact_sales_order_tt.sql
[0m22:05:09.002960 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\staging\stg_dim_location.sql
[0m22:05:09.003497 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\dimensions\dim_product.sql
[0m22:05:09.346246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ee197fa4-9e7e-4a57-8910-57e54c3d36d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ACABA45950>]}
[0m22:05:09.458752 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:05:09.462529 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:05:09.502441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ee197fa4-9e7e-4a57-8910-57e54c3d36d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002AC9BD7B110>]}
[0m22:05:09.503141 [info ] [MainThread]: Found 15 models, 1 seed, 3 sources, 537 macros
[0m22:05:09.503796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ee197fa4-9e7e-4a57-8910-57e54c3d36d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ACAB97AA50>]}
[0m22:05:09.506980 [info ] [MainThread]: 
[0m22:05:09.507726 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:05:09.508275 [info ] [MainThread]: 
[0m22:05:09.509048 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:05:09.516603 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:05:09.517831 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:05:09.518930 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:05:09.520156 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:05:09.521056 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:05:09.521955 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:05:11.693700 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_dimensions'
[0m22:05:11.694525 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:05:11.695260 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_staging'
[0m22:05:11.696425 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:05:11.697172 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev'
[0m22:05:11.698824 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:05:12.611002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ee197fa4-9e7e-4a57-8910-57e54c3d36d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ACABCB2000>]}
[0m22:05:12.611757 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:05:12.618024 [debug] [Thread-3 (]: Began running node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:05:12.618770 [debug] [Thread-4 (]: Began running node model.glamira_analytics.stg_fx_rate
[0m22:05:12.619325 [debug] [Thread-1 (]: Began running node model.glamira_analytics.stg_dim_location
[0m22:05:12.619917 [debug] [Thread-2 (]: Began running node model.glamira_analytics.stg_dim_product
[0m22:05:12.620875 [info ] [Thread-3 (]: 3 of 15 START sql view model analytics_dev_staging.stg_fact_sales_order_tt ..... [RUN]
[0m22:05:12.621639 [info ] [Thread-4 (]: 4 of 15 START sql view model analytics_dev_staging.stg_fx_rate ................. [RUN]
[0m22:05:12.622584 [info ] [Thread-1 (]: 1 of 15 START sql view model analytics_dev_staging.stg_dim_location ............ [RUN]
[0m22:05:12.624598 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fact_sales_order_tt'
[0m22:05:12.623540 [info ] [Thread-2 (]: 2 of 15 START sql view model analytics_dev_staging.stg_dim_product ............. [RUN]
[0m22:05:12.625632 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fx_rate'
[0m22:05:12.626351 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_location'
[0m22:05:12.626938 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:05:12.627711 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_product'
[0m22:05:12.628349 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.stg_fx_rate
[0m22:05:12.628923 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.stg_dim_location
[0m22:05:12.642440 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m22:05:12.643139 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.stg_dim_product
[0m22:05:12.648585 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.stg_fx_rate"
[0m22:05:12.653263 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_location"
[0m22:05:12.658728 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_product"
[0m22:05:12.660478 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:05:12.701481 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m22:05:12.702312 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.stg_dim_location
[0m22:05:12.707635 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_location"
[0m22:05:12.708450 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.stg_fx_rate
[0m22:05:12.709732 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.stg_dim_product
[0m22:05:12.714855 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.stg_fx_rate"
[0m22:05:12.720755 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_product"
[0m22:05:12.721897 [debug] [Thread-3 (]: On model.glamira_analytics.stg_fact_sales_order_tt: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fact_sales_order_tt"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
  OPTIONS()
  as WITH stg_fact_sales_order_tt__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`raw_layer`.`summary`
    WHERE collection = 'checkout_success'
)

/* 1. Remove failed URLs */
, stg_fact_sales_order_tt__remove_url_fail AS (
    SELECT *
    FROM stg_fact_sales_order_tt__source 
    WHERE current_url NOT LIKE 'file://%'
)

/* 2. Unnest cart_products */
, stg_fact_sales_order_tt__unnest AS (
    SELECT 
        s.*, 
        cp
    FROM stg_fact_sales_order_tt__remove_url_fail s
    CROSS JOIN UNNEST(s.cart_products) AS cp
)

, stg_fact_sales_order_tt__rename AS (
    SELECT
        SAFE_CAST(REGEXP_REPLACE(CAST(s.order_id AS STRING), r'\..*', '') AS INT64) AS order_id,
        
        -- Hardcoded quantity
        1 AS quantity,

        SAFE_CAST(REGEXP_REPLACE(CAST(cp.product_id AS STRING), r'\..*', '') AS INT64) AS product_id,
        SAFE_CAST(REGEXP_REPLACE(CAST(s.user_id_db AS STRING), r'\..*', '') AS INT64) AS user_id,
        SAFE_CAST(REGEXP_REPLACE(CAST(s.store_id AS STRING), r'\..*', '') AS INT64) AS store_id,
        
        TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64)) AS time_stamp,
        
        -- FIX: Removed s.timezone reference. Defaults to UTC.
        DATETIME(TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64))) AS local_time,
        
        CASE 
            WHEN s.currency IN ('USD', 'USD $') THEN 'USD'
            WHEN s.currency = 'HKD $'    THEN 'HKD'
            WHEN s.currency = 'NZD $'    THEN 'NZD'
            WHEN s.currency = 'MXN $'    THEN 'MXN'
            WHEN s.currency = 'Kƒç'       THEN 'CZK'
            WHEN s.currency = 'Ft'       THEN 'HUF'
            WHEN s.currency = 'z≈Ç'       THEN 'PLN'
            WHEN s.currency = '‚Çπ'        THEN 'INR'
            WHEN s.currency = '–ª–≤.'      THEN 'BGN'
            WHEN s.currency = '‚Ç´'        THEN 'VND'
            WHEN s.currency = '‚Ç±'        THEN 'PHP'
            WHEN s.currency = '‚Ç≤'        THEN 'PYG'
            WHEN s.currency = 'CRC ‚Ç°'    THEN 'CRC'
            WHEN s.currency = 'COP $'    THEN 'COP'
            WHEN s.currency = 'BOB Bs'   THEN 'BOB'
            WHEN s.currency = 'GTQ Q'    THEN 'GTQ'
            WHEN s.currency = 'PEN S/.'  THEN 'PEN'
            WHEN s.currency = 'DOP $'    THEN 'DOP'
            WHEN s.currency = 'CLP'      THEN 'CLP'
            WHEN s.currency = 'Lei'      THEN 'RON'
            WHEN s.currency = 'UYU'      THEN 'UYU'
            WHEN s.currency = 'din.'     THEN 'RSD'
            WHEN s.currency = 'kn'       THEN 'HRK'
            WHEN s.currency = 'ÿØ.ŸÉ.'     THEN 'KWD'
            WHEN s.currency = 'CHF'      THEN 'CHF'
            WHEN s.currency = 'kr'       THEN 'SEK'
            WHEN s.currency = '‚Ç¨'        THEN 'EUR'
            WHEN s.currency = '¬£'        THEN 'GBP'
            WHEN s.currency = 'AU$'      THEN 'AUD'
            WHEN s.currency = 'CA$'      THEN 'CAD'
            WHEN s.currency = '¬•'        THEN 'JPY'
            ELSE 'USD' 
        END AS currency_code,

        CAST(cp.price * 1 AS NUMERIC) AS line_total,
        
        s.email AS email_address,
        s.ip AS ip_address,

        FARM_FINGERPRINT(CONCAT(
            CAST(s.country_short AS STRING), 
            CAST(s.region AS STRING), 
            CAST(s.city AS STRING)
        )) AS location_id

    FROM stg_fact_sales_order_tt__unnest s
)

SELECT * FROM stg_fact_sales_order_tt__rename;


[0m22:05:12.723572 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:05:12.724770 [debug] [Thread-1 (]: On model.glamira_analytics.stg_dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_location"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
  OPTIONS()
  as WITH stg_dim_location__source AS (
    SELECT 
        DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`ip_location`
)

, stg_dim_location__rename AS (
    SELECT
        CAST(ip AS STRING) AS ip_address,
        CAST(country_code AS STRING) AS country_short_name,
        CAST(country_long AS STRING) AS country_long_name,
        CAST(region AS STRING) AS region_name,
        CAST(city AS STRING) AS city_name
    FROM stg_dim_location__source
    WHERE country_code <> '-' 
      AND country_code IS NOT NULL
)

, stg_dim_location__gen_key AS (
    SELECT
        FARM_FINGERPRINT(country_short_name || region_name || city_name) AS location_id,
        ip_address,
        country_short_name,
        country_long_name,
        region_name,
        city_name
    FROM stg_dim_location__rename
)

SELECT * FROM stg_dim_location__gen_key;


[0m22:05:12.726993 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m22:05:12.729757 [debug] [Thread-4 (]: On model.glamira_analytics.stg_fx_rate: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fx_rate"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
  OPTIONS()
  as WITH source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev`.`exchange_rate_usd`
)

, renamed AS (
    SELECT
        CAST(currency AS STRING) AS currency_code
        ,CAST(rate_to_usd AS NUMERIC) AS rate_to_usd
        ,CAST(as_of_gmt AS TIMESTAMP) AS rate_timestamp
    FROM source
)

SELECT * FROM renamed;


[0m22:05:12.731132 [debug] [Thread-2 (]: On model.glamira_analytics.stg_dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_product"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
  OPTIONS()
  as WITH stg_dim_product__source AS (
    SELECT DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`product`
)

, stg_dim_product__rename AS (
    SELECT
        SAFE_CAST(product_id AS INT64) AS product_id,
        CAST(name AS STRING) AS product_name,
        CAST(url AS STRING) AS product_url,
        CAST(sku AS STRING) AS product_sku, 
        CAST(product_type AS STRING) AS product_type,
        CAST(category_name AS STRING) AS category_name,
        CAST(collection AS STRING) AS collection_name,
        SAFE_CAST(min_price AS NUMERIC) AS min_price,
        SAFE_CAST(max_price AS NUMERIC) AS max_price
    FROM stg_dim_product__source
    WHERE product_id IS NOT NULL
)

SELECT * FROM stg_dim_product__rename;


[0m22:05:12.732025 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:05:12.733252 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:05:13.929656 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:0d9cc099-eec0-4926-938d-c7d21e4a1a8e&page=queryresults
[0m22:05:14.031768 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:4b0070d3-2cc4-489e-9faa-f1891000d7be&page=queryresults
[0m22:05:14.135204 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:0d9cc099-eec0-4926-938d-c7d21e4a1a8e&page=queryresults
[0m22:05:14.137852 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:9702b0dc-f4cd-44cb-b137-9a5c57e21cd9&page=queryresults
[0m22:05:14.152256 [debug] [Thread-1 (]: Database Error in model stg_dim_location (models\staging\stg_dim_location.sql)
  Unrecognized name: country_long; Did you mean country_code? at [16:14]
  compiled code at target\run\glamira_analytics\models\staging\stg_dim_location.sql
[0m22:05:14.155348 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee197fa4-9e7e-4a57-8910-57e54c3d36d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ACABCF22D0>]}
[0m22:05:14.156463 [error] [Thread-1 (]: 1 of 15 ERROR creating sql view model analytics_dev_staging.stg_dim_location ... [[31mERROR[0m in 1.53s]
[0m22:05:14.157932 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.stg_dim_location
[0m22:05:14.159376 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.stg_dim_location' to be skipped because of status 'error'.  Reason: Database Error in model stg_dim_location (models\staging\stg_dim_location.sql)
  Unrecognized name: country_long; Did you mean country_code? at [16:14]
  compiled code at target\run\glamira_analytics\models\staging\stg_dim_location.sql.
[0m22:05:14.161587 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_location
[0m22:05:14.162310 [info ] [Thread-1 (]: 5 of 15 SKIP relation analytics_dev_dimensions.dim_location .................... [[33mSKIP[0m]
[0m22:05:14.163471 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_location
[0m22:05:14.237750 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:1d69c732-6664-4dee-8555-a540be5458c0&page=queryresults
[0m22:05:14.442499 [debug] [Thread-4 (]: SQL status: OK in 0.410 seconds
[0m22:05:14.441614 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:1d69c732-6664-4dee-8555-a540be5458c0&page=queryresults
[0m22:05:14.452876 [debug] [Thread-3 (]: Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Name email not found inside s at [81:11]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m22:05:14.453657 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee197fa4-9e7e-4a57-8910-57e54c3d36d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ACAB9EB750>]}
[0m22:05:14.454492 [error] [Thread-3 (]: 3 of 15 ERROR creating sql view model analytics_dev_staging.stg_fact_sales_order_tt  [[31mERROR[0m in 1.83s]
[0m22:05:14.455828 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:05:14.457080 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.stg_fact_sales_order_tt' to be skipped because of status 'error'.  Reason: Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Name email not found inside s at [81:11]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql.
[0m22:05:14.459660 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_store
[0m22:05:14.460361 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_date
[0m22:05:14.461428 [info ] [Thread-3 (]: 7 of 15 SKIP relation analytics_dev_dimensions.dim_store ....................... [[33mSKIP[0m]
[0m22:05:14.463909 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_store
[0m22:05:14.462769 [info ] [Thread-1 (]: 6 of 15 SKIP relation analytics_dev_dimensions.dim_date ........................ [[33mSKIP[0m]
[0m22:05:14.464846 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_user
[0m22:05:14.465997 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_date
[0m22:05:14.468229 [debug] [Thread-1 (]: Began running node model.glamira_analytics.fact_sales_order_tt
[0m22:05:14.467085 [info ] [Thread-3 (]: 8 of 15 SKIP relation analytics_dev_dimensions.dim_user ........................ [[33mSKIP[0m]
[0m22:05:14.469583 [info ] [Thread-1 (]: 9 of 15 SKIP relation analytics_dev_dimensions.fact_sales_order_tt ............. [[33mSKIP[0m]
[0m22:05:14.470716 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_user
[0m22:05:14.472048 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.fact_sales_order_tt
[0m22:05:14.473949 [debug] [Thread-3 (]: Began running node model.glamira_analytics.mart_country
[0m22:05:14.474805 [debug] [Thread-1 (]: Began running node model.glamira_analytics.mart_overall
[0m22:05:14.476104 [info ] [Thread-3 (]: 10 of 15 SKIP relation analytics_dev.mart_country .............................. [[33mSKIP[0m]
[0m22:05:14.478268 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.mart_country
[0m22:05:14.476913 [info ] [Thread-1 (]: 11 of 15 SKIP relation analytics_dev.mart_overall .............................. [[33mSKIP[0m]
[0m22:05:14.479608 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.mart_overall
[0m22:05:14.544407 [debug] [Thread-2 (]: SQL status: OK in 0.403 seconds
[0m22:05:14.603163 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee197fa4-9e7e-4a57-8910-57e54c3d36d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ACAC189770>]}
[0m22:05:14.605730 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee197fa4-9e7e-4a57-8910-57e54c3d36d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ACAC38A210>]}
[0m22:05:14.606866 [info ] [Thread-4 (]: 4 of 15 OK created sql view model analytics_dev_staging.stg_fx_rate ............ [[32mCREATE VIEW (0 processed)[0m in 1.98s]
[0m22:05:14.608909 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.stg_fx_rate
[0m22:05:14.607828 [info ] [Thread-2 (]: 2 of 15 OK created sql view model analytics_dev_staging.stg_dim_product ........ [[32mCREATE VIEW (0 processed)[0m in 1.98s]
[0m22:05:14.610217 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.stg_dim_product
[0m22:05:14.610930 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_fx_rate_usd
[0m22:05:14.612253 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_product
[0m22:05:14.611729 [info ] [Thread-3 (]: 12 of 15 START sql table model analytics_dev_dimensions.dim_fx_rate_usd ........ [RUN]
[0m22:05:14.613869 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_fact_sales_order_tt, now model.glamira_analytics.dim_fx_rate_usd)
[0m22:05:14.613210 [info ] [Thread-1 (]: 13 of 15 START sql table model analytics_dev_dimensions.dim_product ............ [RUN]
[0m22:05:14.614887 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.dim_fx_rate_usd
[0m22:05:14.615840 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_dim_location, now model.glamira_analytics.dim_product)
[0m22:05:14.621460 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.dim_fx_rate_usd"
[0m22:05:14.622449 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.dim_product
[0m22:05:14.627959 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.dim_product"
[0m22:05:14.629155 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.dim_fx_rate_usd
[0m22:05:14.644611 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:05:14.646930 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.dim_product
[0m22:05:14.685169 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.dim_product"
[0m22:05:14.688015 [debug] [Thread-1 (]: On model.glamira_analytics.dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_product"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_product__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
)

, dim_product__null_handle AS (
    SELECT
        product_id,
        COALESCE(product_name, 'Undefined') AS product_name,
        COALESCE(product_url, 'Undefined') AS product_url,
        COALESCE(product_sku, 'Undefined') AS product_sku,
        COALESCE(product_type, 'Undefined') AS product_type,
        COALESCE(NULLIF(TRIM(category_name), ''), 'Undefined') AS category_name, 
        COALESCE(NULLIF(TRIM(collection_name), ''), 'Undefined') AS collection_name,
        min_price,
        max_price
    FROM dim_product__source 
)

, dim_product__add_key AS (
    SELECT
        FARM_FINGERPRINT(CAST(product_id AS STRING)) AS product_key,
        *
    FROM dim_product__null_handle
)

, dim_product__union_undefined AS (
    SELECT 
        * FROM dim_product__add_key

    UNION ALL

    SELECT 
        -1 AS product_key,
        -1 AS product_id,
        'Undefined' AS product_name,
        'Undefined' AS product_url,
        'Undefined' AS product_sku,
        'Undefined' AS product_type,
        'Undefined' AS category_name,
        'Undefined' AS collection_name,
        0 AS min_price,
        0 AS max_price
)

SELECT * FROM dim_product__union_undefined
    );
  
[0m22:05:14.689123 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:05:15.673777 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.dim_fx_rate_usd"
[0m22:05:15.675318 [debug] [Thread-3 (]: On model.glamira_analytics.dim_fx_rate_usd: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_fx_rate_usd"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_fx_rate_usd`
      
    
    

    
    OPTIONS()
    as (
      WITH stg_fx AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
)

SELECT
    currency_code AS from_currency_code
    ,'USD' AS to_currency_code
    ,rate_to_usd
    ,rate_timestamp
FROM stg_fx
    );
  
[0m22:05:15.991678 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:f2b46c25-881f-496e-82a9-f5bf4c857c7e&page=queryresults
[0m22:05:16.353273 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:f8b3ea2b-7423-4f3a-82c3-ff26c2359ff1&page=queryresults
[0m22:05:17.920418 [debug] [Thread-1 (]: SQL status: OK in 1.928 seconds
[0m22:05:18.141190 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee197fa4-9e7e-4a57-8910-57e54c3d36d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ACABAE6040>]}
[0m22:05:18.142298 [info ] [Thread-1 (]: 13 of 15 OK created sql table model analytics_dev_dimensions.dim_product ....... [[32mCREATE TABLE (18.6k rows, 2.7 MiB processed)[0m in 3.53s]
[0m22:05:18.143475 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_product
[0m22:05:18.144486 [debug] [Thread-4 (]: Began running node model.glamira_analytics.mart_product
[0m22:05:18.145142 [debug] [Thread-2 (]: Began running node model.glamira_analytics.mart_product_type
[0m22:05:18.145816 [info ] [Thread-4 (]: 14 of 15 SKIP relation analytics_dev.mart_product .............................. [[33mSKIP[0m]
[0m22:05:18.147294 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.mart_product
[0m22:05:18.146396 [info ] [Thread-2 (]: 15 of 15 SKIP relation analytics_dev.mart_product_type ......................... [[33mSKIP[0m]
[0m22:05:18.148451 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.mart_product_type
[0m22:05:18.227414 [debug] [Thread-3 (]: SQL status: OK in 1.873 seconds
[0m22:05:18.435585 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee197fa4-9e7e-4a57-8910-57e54c3d36d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ACAC4257F0>]}
[0m22:05:18.436643 [info ] [Thread-3 (]: 12 of 15 OK created sql table model analytics_dev_dimensions.dim_fx_rate_usd ... [[32mCREATE TABLE (34.0 rows, 1.3 KiB processed)[0m in 3.82s]
[0m22:05:18.438855 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_fx_rate_usd
[0m22:05:18.441262 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:05:18.442229 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:05:18.442722 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:05:18.443170 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:05:18.443608 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:05:18.444042 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_dimensions' was properly closed.
[0m22:05:18.444480 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_staging' was properly closed.
[0m22:05:18.444920 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev' was properly closed.
[0m22:05:18.445351 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_fx_rate_usd' was properly closed.
[0m22:05:18.445779 [debug] [MainThread]: Connection 'model.glamira_analytics.stg_fx_rate' was properly closed.
[0m22:05:18.446209 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_product' was properly closed.
[0m22:05:18.446642 [debug] [MainThread]: Connection 'model.glamira_analytics.stg_dim_product' was properly closed.
[0m22:05:18.447263 [info ] [MainThread]: 
[0m22:05:18.447926 [info ] [MainThread]: Finished running 1 incremental model, 10 table models, 4 view models in 0 hours 0 minutes and 8.94 seconds (8.94s).
[0m22:05:18.451142 [debug] [MainThread]: Command end result
[0m22:05:18.495788 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:05:18.498817 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:05:18.507407 [debug] [MainThread]: Wrote artifact RunExecutionResult to D:\Project 7\glamira_analytics\target\run_results.json
[0m22:05:18.507958 [info ] [MainThread]: 
[0m22:05:18.508651 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m22:05:18.509310 [info ] [MainThread]: 
[0m22:05:18.510070 [error] [MainThread]: [31mFailure in model stg_dim_location (models\staging\stg_dim_location.sql)[0m
[0m22:05:18.510831 [error] [MainThread]:   Database Error in model stg_dim_location (models\staging\stg_dim_location.sql)
  Unrecognized name: country_long; Did you mean country_code? at [16:14]
  compiled code at target\run\glamira_analytics\models\staging\stg_dim_location.sql
[0m22:05:18.511483 [info ] [MainThread]: 
[0m22:05:18.512208 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\staging\stg_dim_location.sql
[0m22:05:18.512835 [info ] [MainThread]: 
[0m22:05:18.513523 [error] [MainThread]: [31mFailure in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)[0m
[0m22:05:18.514364 [error] [MainThread]:   Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Name email not found inside s at [81:11]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m22:05:18.515126 [info ] [MainThread]: 
[0m22:05:18.515928 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m22:05:18.516776 [info ] [MainThread]: 
[0m22:05:18.517944 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=2 SKIP=9 NO-OP=0 TOTAL=15
[0m22:05:18.522037 [debug] [MainThread]: Command `dbt run` failed at 22:05:18.521674 after 20.73 seconds
[0m22:05:18.527178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ACAC14C950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ACABC68170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002ACABD33110>]}
[0m22:05:18.528464 [debug] [MainThread]: Flushing usage events
[0m22:05:22.272833 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:09:02.272321 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002203EDE8EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002203FF4FED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002203FF4FB10>]}


============================== 22:09:02.279533 | f76c4077-4fc8-4e36-a14f-2bc8848bbd26 ==============================
[0m22:09:02.279533 [info ] [MainThread]: Running with dbt=1.11.2
[0m22:09:02.280714 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'no_print': 'None', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'write_json': 'True', 'empty': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'fail_fast': 'False', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'use_colors': 'True', 'invocation_command': 'dbt run --full-refresh', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m22:09:11.956942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f76c4077-4fc8-4e36-a14f-2bc8848bbd26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002203F281BA0>]}
[0m22:09:12.034596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f76c4077-4fc8-4e36-a14f-2bc8848bbd26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002204F9AB570>]}
[0m22:09:12.035432 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m22:09:12.856368 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m22:09:13.082745 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m22:09:13.083597 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\staging\stg_dim_location.sql
[0m22:09:13.084117 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\staging\stg_fact_sales_order_tt.sql
[0m22:09:13.439368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f76c4077-4fc8-4e36-a14f-2bc8848bbd26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002205F6B5950>]}
[0m22:09:13.557556 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:09:13.560527 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:09:13.600130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f76c4077-4fc8-4e36-a14f-2bc8848bbd26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002204F967110>]}
[0m22:09:13.600778 [info ] [MainThread]: Found 15 models, 1 seed, 3 sources, 537 macros
[0m22:09:13.601488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f76c4077-4fc8-4e36-a14f-2bc8848bbd26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002205F5E75B0>]}
[0m22:09:13.604522 [info ] [MainThread]: 
[0m22:09:13.605205 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:09:13.605728 [info ] [MainThread]: 
[0m22:09:13.606449 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:09:13.612874 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:09:13.614248 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:09:13.615641 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:09:13.616953 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:09:13.617825 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:09:13.618648 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:09:15.650569 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev'
[0m22:09:15.651460 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:09:15.652234 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_dimensions'
[0m22:09:15.653480 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:09:15.655394 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_staging'
[0m22:09:15.656519 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:09:16.567597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f76c4077-4fc8-4e36-a14f-2bc8848bbd26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002205F91DA50>]}
[0m22:09:16.568375 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:09:16.574449 [debug] [Thread-3 (]: Began running node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:09:16.575195 [debug] [Thread-4 (]: Began running node model.glamira_analytics.stg_fx_rate
[0m22:09:16.575819 [debug] [Thread-1 (]: Began running node model.glamira_analytics.stg_dim_location
[0m22:09:16.576589 [debug] [Thread-2 (]: Began running node model.glamira_analytics.stg_dim_product
[0m22:09:16.577502 [info ] [Thread-3 (]: 3 of 15 START sql view model analytics_dev_staging.stg_fact_sales_order_tt ..... [RUN]
[0m22:09:16.578208 [info ] [Thread-4 (]: 4 of 15 START sql view model analytics_dev_staging.stg_fx_rate ................. [RUN]
[0m22:09:16.581156 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fact_sales_order_tt'
[0m22:09:16.579180 [info ] [Thread-1 (]: 1 of 15 START sql view model analytics_dev_staging.stg_dim_location ............ [RUN]
[0m22:09:16.582410 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fx_rate'
[0m22:09:16.579980 [info ] [Thread-2 (]: 2 of 15 START sql view model analytics_dev_staging.stg_dim_product ............. [RUN]
[0m22:09:16.583348 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:09:16.584147 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_location'
[0m22:09:16.584784 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.stg_fx_rate
[0m22:09:16.585666 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_product'
[0m22:09:16.596944 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m22:09:16.597637 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.stg_dim_location
[0m22:09:16.603956 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.stg_fx_rate"
[0m22:09:16.604939 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.stg_dim_product
[0m22:09:16.609732 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_location"
[0m22:09:16.615376 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_product"
[0m22:09:16.616782 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:09:16.618204 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.stg_fx_rate
[0m22:09:16.663559 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.stg_dim_product
[0m22:09:16.692517 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.stg_fx_rate"
[0m22:09:16.698422 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_product"
[0m22:09:16.699905 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m22:09:16.700765 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.stg_dim_location
[0m22:09:16.706996 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_location"
[0m22:09:16.708400 [debug] [Thread-4 (]: On model.glamira_analytics.stg_fx_rate: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fx_rate"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
  OPTIONS()
  as WITH source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev`.`exchange_rate_usd`
)

, renamed AS (
    SELECT
        CAST(currency AS STRING) AS currency_code
        ,CAST(rate_to_usd AS NUMERIC) AS rate_to_usd
        ,CAST(as_of_gmt AS TIMESTAMP) AS rate_timestamp
    FROM source
)

SELECT * FROM renamed;


[0m22:09:16.709425 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:09:16.710464 [debug] [Thread-2 (]: On model.glamira_analytics.stg_dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_product"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
  OPTIONS()
  as WITH stg_dim_product__source AS (
    SELECT DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`product`
)

, stg_dim_product__rename AS (
    SELECT
        SAFE_CAST(product_id AS INT64) AS product_id,
        CAST(name AS STRING) AS product_name,
        CAST(url AS STRING) AS product_url,
        CAST(sku AS STRING) AS product_sku, 
        CAST(product_type AS STRING) AS product_type,
        CAST(category_name AS STRING) AS category_name,
        CAST(collection AS STRING) AS collection_name,
        SAFE_CAST(min_price AS NUMERIC) AS min_price,
        SAFE_CAST(max_price AS NUMERIC) AS max_price
    FROM stg_dim_product__source
    WHERE product_id IS NOT NULL
)

SELECT * FROM stg_dim_product__rename;


[0m22:09:16.712305 [debug] [Thread-3 (]: On model.glamira_analytics.stg_fact_sales_order_tt: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fact_sales_order_tt"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
  OPTIONS()
  as WITH stg_fact_sales_order_tt__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`raw_layer`.`summary`
    WHERE collection = 'checkout_success'
)

/* 1. Remove failed URLs */
, stg_fact_sales_order_tt__remove_url_fail AS (
    SELECT *
    FROM stg_fact_sales_order_tt__source 
    WHERE current_url NOT LIKE 'file://%'
)

/* 2. Unnest cart_products */
, stg_fact_sales_order_tt__unnest AS (
    SELECT 
        s.*, 
        cp
    FROM stg_fact_sales_order_tt__remove_url_fail s
    CROSS JOIN UNNEST(s.cart_products) AS cp
)

, stg_fact_sales_order_tt__rename AS (
    SELECT
        SAFE_CAST(REGEXP_REPLACE(CAST(s.order_id AS STRING), r'\..*', '') AS INT64) AS order_id,
        
        1 AS quantity,

        SAFE_CAST(REGEXP_REPLACE(CAST(cp.product_id AS STRING), r'\..*', '') AS INT64) AS product_id,
        SAFE_CAST(REGEXP_REPLACE(CAST(s.user_id_db AS STRING), r'\..*', '') AS INT64) AS user_id,
        SAFE_CAST(REGEXP_REPLACE(CAST(s.store_id AS STRING), r'\..*', '') AS INT64) AS store_id,
        
        TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64)) AS time_stamp,
        DATETIME(TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64))) AS local_time,
        
        CASE 
            WHEN s.currency IN ('USD', 'USD $') THEN 'USD'
            WHEN s.currency = 'HKD $'    THEN 'HKD'
            WHEN s.currency = 'NZD $'    THEN 'NZD'
            WHEN s.currency = 'MXN $'    THEN 'MXN'
            WHEN s.currency = 'Kƒç'       THEN 'CZK'
            WHEN s.currency = 'Ft'       THEN 'HUF'
            WHEN s.currency = 'z≈Ç'       THEN 'PLN'
            WHEN s.currency = '‚Çπ'        THEN 'INR'
            WHEN s.currency = '–ª–≤.'      THEN 'BGN'
            WHEN s.currency = '‚Ç´'        THEN 'VND'
            WHEN s.currency = '‚Ç±'        THEN 'PHP'
            WHEN s.currency = '‚Ç≤'        THEN 'PYG'
            WHEN s.currency = 'CRC ‚Ç°'    THEN 'CRC'
            WHEN s.currency = 'COP $'    THEN 'COP'
            WHEN s.currency = 'BOB Bs'   THEN 'BOB'
            WHEN s.currency = 'GTQ Q'    THEN 'GTQ'
            WHEN s.currency = 'PEN S/.'  THEN 'PEN'
            WHEN s.currency = 'DOP $'    THEN 'DOP'
            WHEN s.currency = 'CLP'      THEN 'CLP'
            WHEN s.currency = 'Lei'      THEN 'RON'
            WHEN s.currency = 'UYU'      THEN 'UYU'
            WHEN s.currency = 'din.'     THEN 'RSD'
            WHEN s.currency = 'kn'       THEN 'HRK'
            WHEN s.currency = 'ÿØ.ŸÉ.'     THEN 'KWD'
            WHEN s.currency = 'CHF'      THEN 'CHF'
            WHEN s.currency = 'kr'       THEN 'SEK'
            WHEN s.currency = '‚Ç¨'        THEN 'EUR'
            WHEN s.currency = '¬£'        THEN 'GBP'
            WHEN s.currency = 'AU$'      THEN 'AUD'
            WHEN s.currency = 'CA$'      THEN 'CAD'
            WHEN s.currency = '¬•'        THEN 'JPY'
            ELSE 'USD' 
        END AS currency_code,

        CAST(cp.price * 1 AS NUMERIC) AS line_total,
        
        -- FIX: Removed s.email (column does not exist)
        s.ip AS ip_address,

        FARM_FINGERPRINT(CONCAT(
            CAST(s.country_short AS STRING), 
            CAST(s.region AS STRING), 
            CAST(s.city AS STRING)
        )) AS location_id

    FROM stg_fact_sales_order_tt__unnest s
)

SELECT * FROM stg_fact_sales_order_tt__rename;


[0m22:09:16.713453 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:09:16.714549 [debug] [Thread-1 (]: On model.glamira_analytics.stg_dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_location"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
  OPTIONS()
  as WITH stg_dim_location__source AS (
    SELECT 
        DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`ip_location`
)

, stg_dim_location__rename AS (
    SELECT
        CAST(ip AS STRING) AS ip_address,
        CAST(country_code AS STRING) AS country_short_name,
        
        CAST(country_code AS STRING) AS country_long_name,
        
        CAST(region AS STRING) AS region_name,
        CAST(city AS STRING) AS city_name
    FROM stg_dim_location__source
    WHERE country_code <> '-' 
      AND country_code IS NOT NULL
)

, stg_dim_location__gen_key AS (
    SELECT
        FARM_FINGERPRINT(country_short_name || region_name || city_name) AS location_id,
        ip_address,
        country_short_name,
        country_long_name,
        region_name,
        city_name
    FROM stg_dim_location__rename
)

SELECT * FROM stg_dim_location__gen_key;


[0m22:09:16.715928 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:09:16.717773 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m22:09:17.793782 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:4813dd46-7cf7-4f23-a945-02680027f100&page=queryresults
[0m22:09:17.891857 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:379d9b69-5f42-4462-aef9-af49487b623c&page=queryresults
[0m22:09:17.989191 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:63f5aaa1-4afe-41ff-bffa-5e5ad2a28f5f&page=queryresults
[0m22:09:18.095755 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:7d8e99ce-0d46-4ebb-a7ab-f6439dee5e99&page=queryresults
[0m22:09:18.194438 [debug] [Thread-4 (]: SQL status: OK in 0.400 seconds
[0m22:09:18.193551 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:63f5aaa1-4afe-41ff-bffa-5e5ad2a28f5f&page=queryresults
[0m22:09:18.216492 [debug] [Thread-3 (]: Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Name country_short not found inside s at [82:20]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m22:09:18.220570 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f76c4077-4fc8-4e36-a14f-2bc8848bbd26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002205F9BE5D0>]}
[0m22:09:18.221746 [error] [Thread-3 (]: 3 of 15 ERROR creating sql view model analytics_dev_staging.stg_fact_sales_order_tt  [[31mERROR[0m in 1.64s]
[0m22:09:18.223032 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:09:18.224008 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.stg_fact_sales_order_tt' to be skipped because of status 'error'.  Reason: Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Name country_short not found inside s at [82:20]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql.
[0m22:09:18.225883 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_date
[0m22:09:18.226605 [info ] [Thread-3 (]: 5 of 15 SKIP relation analytics_dev_dimensions.dim_date ........................ [[33mSKIP[0m]
[0m22:09:18.227581 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_date
[0m22:09:18.228423 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_store
[0m22:09:18.229159 [info ] [Thread-3 (]: 6 of 15 SKIP relation analytics_dev_dimensions.dim_store ....................... [[33mSKIP[0m]
[0m22:09:18.229905 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_store
[0m22:09:18.230500 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_user
[0m22:09:18.231205 [info ] [Thread-3 (]: 7 of 15 SKIP relation analytics_dev_dimensions.dim_user ........................ [[33mSKIP[0m]
[0m22:09:18.232546 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_user
[0m22:09:18.233534 [debug] [Thread-3 (]: Began running node model.glamira_analytics.fact_sales_order_tt
[0m22:09:18.234453 [info ] [Thread-3 (]: 8 of 15 SKIP relation analytics_dev_dimensions.fact_sales_order_tt ............. [[33mSKIP[0m]
[0m22:09:18.235898 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.fact_sales_order_tt
[0m22:09:18.236825 [debug] [Thread-3 (]: Began running node model.glamira_analytics.mart_overall
[0m22:09:18.237408 [info ] [Thread-3 (]: 9 of 15 SKIP relation analytics_dev.mart_overall ............................... [[33mSKIP[0m]
[0m22:09:18.238160 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.mart_overall
[0m22:09:18.296497 [debug] [Thread-2 (]: SQL status: OK in 0.404 seconds
[0m22:09:18.365906 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f76c4077-4fc8-4e36-a14f-2bc8848bbd26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002205FDCCC00>]}
[0m22:09:18.368327 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f76c4077-4fc8-4e36-a14f-2bc8848bbd26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220600AF430>]}
[0m22:09:18.369282 [info ] [Thread-2 (]: 2 of 15 OK created sql view model analytics_dev_staging.stg_dim_product ........ [[32mCREATE VIEW (0 processed)[0m in 1.78s]
[0m22:09:18.371216 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.stg_dim_product
[0m22:09:18.370134 [info ] [Thread-4 (]: 4 of 15 OK created sql view model analytics_dev_staging.stg_fx_rate ............ [[32mCREATE VIEW (0 processed)[0m in 1.79s]
[0m22:09:18.372461 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.stg_fx_rate
[0m22:09:18.373250 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_product
[0m22:09:18.374632 [debug] [Thread-2 (]: Began running node model.glamira_analytics.dim_fx_rate_usd
[0m22:09:18.374078 [info ] [Thread-3 (]: 10 of 15 START sql table model analytics_dev_dimensions.dim_product ............ [RUN]
[0m22:09:18.376366 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_fact_sales_order_tt, now model.glamira_analytics.dim_product)
[0m22:09:18.375642 [info ] [Thread-2 (]: 11 of 15 START sql table model analytics_dev_dimensions.dim_fx_rate_usd ........ [RUN]
[0m22:09:18.377220 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.dim_product
[0m22:09:18.377836 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_dim_product, now model.glamira_analytics.dim_fx_rate_usd)
[0m22:09:18.382357 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.dim_product"
[0m22:09:18.383528 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.dim_fx_rate_usd
[0m22:09:18.388041 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.dim_fx_rate_usd"
[0m22:09:18.389757 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.dim_product
[0m22:09:18.390670 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.dim_fx_rate_usd
[0m22:09:18.409308 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:09:18.413699 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:09:18.443228 [debug] [Thread-1 (]: SQL status: OK in 0.347 seconds
[0m22:09:18.448482 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f76c4077-4fc8-4e36-a14f-2bc8848bbd26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022060145450>]}
[0m22:09:18.449615 [info ] [Thread-1 (]: 1 of 15 OK created sql view model analytics_dev_staging.stg_dim_location ....... [[32mCREATE VIEW (0 processed)[0m in 1.86s]
[0m22:09:18.450837 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.stg_dim_location
[0m22:09:18.451730 [debug] [Thread-4 (]: Began running node model.glamira_analytics.dim_location
[0m22:09:18.452601 [info ] [Thread-4 (]: 12 of 15 START sql table model analytics_dev_dimensions.dim_location ........... [RUN]
[0m22:09:18.453537 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_fx_rate, now model.glamira_analytics.dim_location)
[0m22:09:18.454237 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.dim_location
[0m22:09:18.458899 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.dim_location"
[0m22:09:18.460434 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.dim_location
[0m22:09:18.497882 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.dim_location"
[0m22:09:18.501010 [debug] [Thread-4 (]: On model.glamira_analytics.dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_location"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_location`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_location__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
)

, dim_location__null_handle AS (
    SELECT
        location_id
        ,ip_address
        ,COALESCE(country_short_name, 'Undefined') AS country_code
        ,COALESCE(country_long_name, 'Undefined') AS country_name
        ,COALESCE(region_name, 'Undefined') AS region_name
        ,COALESCE(city_name, 'Undefined') AS city_name
    FROM dim_location__source 
)

, dim_location__add_key AS (
    SELECT
        -- Surrogate Key
        FARM_FINGERPRINT(CAST(location_id AS STRING)) AS location_key
        -- Natural Key
        ,CAST(location_id AS STRING) AS location_id
        ,ip_address
        ,country_code
        ,country_name
        ,region_name
        ,city_name
    FROM dim_location__null_handle
)

, dim_location__union_undefined AS (
    SELECT 
        * FROM dim_location__add_key

    UNION ALL

    SELECT 
        -1 AS location_key
        ,'-1' AS location_id
        ,'Undefined' AS ip_address
        ,'Undefined' AS country_code
        ,'Undefined' AS country_name
        ,'Undefined' AS region_name
        ,'Undefined' AS city_name
)

SELECT 
    *
FROM dim_location__union_undefined
    );
  
[0m22:09:18.502036 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:09:19.221495 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.dim_product"
[0m22:09:19.223248 [debug] [Thread-3 (]: On model.glamira_analytics.dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_product"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_product__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
)

, dim_product__null_handle AS (
    SELECT
        product_id,
        COALESCE(product_name, 'Undefined') AS product_name,
        COALESCE(product_url, 'Undefined') AS product_url,
        COALESCE(product_sku, 'Undefined') AS product_sku,
        COALESCE(product_type, 'Undefined') AS product_type,
        COALESCE(NULLIF(TRIM(category_name), ''), 'Undefined') AS category_name, 
        COALESCE(NULLIF(TRIM(collection_name), ''), 'Undefined') AS collection_name,
        min_price,
        max_price
    FROM dim_product__source 
)

, dim_product__add_key AS (
    SELECT
        FARM_FINGERPRINT(CAST(product_id AS STRING)) AS product_key,
        *
    FROM dim_product__null_handle
)

, dim_product__union_undefined AS (
    SELECT 
        * FROM dim_product__add_key

    UNION ALL

    SELECT 
        -1 AS product_key,
        -1 AS product_id,
        'Undefined' AS product_name,
        'Undefined' AS product_url,
        'Undefined' AS product_sku,
        'Undefined' AS product_type,
        'Undefined' AS category_name,
        'Undefined' AS collection_name,
        0 AS min_price,
        0 AS max_price
)

SELECT * FROM dim_product__union_undefined
    );
  
[0m22:09:19.304234 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.dim_fx_rate_usd"
[0m22:09:19.305885 [debug] [Thread-2 (]: On model.glamira_analytics.dim_fx_rate_usd: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_fx_rate_usd"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_fx_rate_usd`
      
    
    

    
    OPTIONS()
    as (
      WITH stg_fx AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
)

SELECT
    currency_code AS from_currency_code
    ,'USD' AS to_currency_code
    ,rate_to_usd
    ,rate_timestamp
FROM stg_fx
    );
  
[0m22:09:19.934034 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:74bfd494-dcb8-44e8-ae1f-d169194fee9f&page=queryresults
[0m22:09:19.939893 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:ec91ee3f-f210-4d83-b08c-6ec7593d5c3e&page=queryresults
[0m22:09:20.242598 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:75ab55e6-a9bd-4e5d-8e3f-3ab1cade626c&page=queryresults
[0m22:09:21.879048 [debug] [Thread-3 (]: SQL status: OK in 1.944 seconds
[0m22:09:22.081436 [debug] [Thread-2 (]: SQL status: OK in 2.141 seconds
[0m22:09:22.154185 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f76c4077-4fc8-4e36-a14f-2bc8848bbd26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220601A5240>]}
[0m22:09:22.155278 [info ] [Thread-3 (]: 10 of 15 OK created sql table model analytics_dev_dimensions.dim_product ....... [[32mCREATE TABLE (18.6k rows, 2.7 MiB processed)[0m in 3.78s]
[0m22:09:22.157146 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_product
[0m22:09:22.158079 [debug] [Thread-3 (]: Began running node model.glamira_analytics.mart_product_type
[0m22:09:22.158710 [debug] [Thread-1 (]: Began running node model.glamira_analytics.mart_product
[0m22:09:22.159337 [info ] [Thread-3 (]: 14 of 15 SKIP relation analytics_dev.mart_product_type ......................... [[33mSKIP[0m]
[0m22:09:22.160785 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.mart_product_type
[0m22:09:22.159939 [info ] [Thread-1 (]: 13 of 15 SKIP relation analytics_dev.mart_product .............................. [[33mSKIP[0m]
[0m22:09:22.162022 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.mart_product
[0m22:09:22.291544 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f76c4077-4fc8-4e36-a14f-2bc8848bbd26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220600A5730>]}
[0m22:09:22.292611 [info ] [Thread-2 (]: 11 of 15 OK created sql table model analytics_dev_dimensions.dim_fx_rate_usd ... [[32mCREATE TABLE (34.0 rows, 1.3 KiB processed)[0m in 3.91s]
[0m22:09:22.293866 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.dim_fx_rate_usd
[0m22:09:25.561471 [debug] [Thread-4 (]: SQL status: OK in 5.318 seconds
[0m22:09:25.768754 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f76c4077-4fc8-4e36-a14f-2bc8848bbd26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220600A6CF0>]}
[0m22:09:25.769877 [info ] [Thread-4 (]: 12 of 15 OK created sql table model analytics_dev_dimensions.dim_location ...... [[32mCREATE TABLE (2.1m rows, 189.5 MiB processed)[0m in 7.32s]
[0m22:09:25.771608 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.dim_location
[0m22:09:25.772604 [debug] [Thread-3 (]: Began running node model.glamira_analytics.mart_country
[0m22:09:25.773410 [info ] [Thread-3 (]: 15 of 15 SKIP relation analytics_dev.mart_country .............................. [[33mSKIP[0m]
[0m22:09:25.774338 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.mart_country
[0m22:09:25.776410 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:09:25.777348 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:09:25.777832 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:09:25.778277 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:09:25.778723 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:09:25.779150 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev' was properly closed.
[0m22:09:25.779572 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_dimensions' was properly closed.
[0m22:09:25.779999 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_staging' was properly closed.
[0m22:09:25.780418 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_product' was properly closed.
[0m22:09:25.780791 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_location' was properly closed.
[0m22:09:25.781169 [debug] [MainThread]: Connection 'model.glamira_analytics.stg_dim_location' was properly closed.
[0m22:09:25.781546 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_fx_rate_usd' was properly closed.
[0m22:09:25.782118 [info ] [MainThread]: 
[0m22:09:25.782700 [info ] [MainThread]: Finished running 1 incremental model, 10 table models, 4 view models in 0 hours 0 minutes and 12.18 seconds (12.18s).
[0m22:09:25.785707 [debug] [MainThread]: Command end result
[0m22:09:25.828819 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:09:25.832396 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:09:25.844091 [debug] [MainThread]: Wrote artifact RunExecutionResult to D:\Project 7\glamira_analytics\target\run_results.json
[0m22:09:25.844597 [info ] [MainThread]: 
[0m22:09:25.845719 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:09:25.846860 [info ] [MainThread]: 
[0m22:09:25.847623 [error] [MainThread]: [31mFailure in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)[0m
[0m22:09:25.849324 [error] [MainThread]:   Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Name country_short not found inside s at [82:20]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m22:09:25.850741 [info ] [MainThread]: 
[0m22:09:25.852042 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m22:09:25.852930 [info ] [MainThread]: 
[0m22:09:25.853673 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=8 NO-OP=0 TOTAL=15
[0m22:09:25.855110 [debug] [MainThread]: Command `dbt run` failed at 22:09:25.854897 after 23.83 seconds
[0m22:09:25.855780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002203F0ED8B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002205F997770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000220600A54F0>]}
[0m22:09:25.856262 [debug] [MainThread]: Flushing usage events
[0m22:09:27.918710 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:28:48.056910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002377D3E8EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002377E54FED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002377E54FB10>]}


============================== 22:28:48.064376 | 1bf15b95-b385-4b5a-8d5a-bdda0f2043db ==============================
[0m22:28:48.064376 [info ] [MainThread]: Running with dbt=1.11.2
[0m22:28:48.065508 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'no_print': 'None', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'write_json': 'True', 'empty': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'invocation_command': 'dbt run --full-refresh', 'indirect_selection': 'eager', 'use_colors': 'True', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m22:28:57.781806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1bf15b95-b385-4b5a-8d5a-bdda0f2043db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002377D881BA0>]}
[0m22:28:57.861675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1bf15b95-b385-4b5a-8d5a-bdda0f2043db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002370E043570>]}
[0m22:28:57.862565 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m22:28:58.734640 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m22:28:58.950174 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:28:58.951007 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\staging\stg_fact_sales_order_tt.sql
[0m22:28:59.290832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1bf15b95-b385-4b5a-8d5a-bdda0f2043db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002371DF79950>]}
[0m22:28:59.396862 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:28:59.399953 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:28:59.442472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1bf15b95-b385-4b5a-8d5a-bdda0f2043db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002370E057110>]}
[0m22:28:59.443178 [info ] [MainThread]: Found 15 models, 1 seed, 3 sources, 537 macros
[0m22:28:59.443859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1bf15b95-b385-4b5a-8d5a-bdda0f2043db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002371DEAB310>]}
[0m22:28:59.447005 [info ] [MainThread]: 
[0m22:28:59.447750 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:28:59.448298 [info ] [MainThread]: 
[0m22:28:59.449092 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:28:59.457057 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:28:59.458124 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:28:59.459141 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:28:59.460284 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:28:59.461176 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:28:59.462062 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:29:01.772201 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev'
[0m22:29:01.773022 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:29:01.773751 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_staging'
[0m22:29:01.774960 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:29:01.775990 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_dimensions'
[0m22:29:01.778036 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:29:02.692700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1bf15b95-b385-4b5a-8d5a-bdda0f2043db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002371E1917E0>]}
[0m22:29:02.693469 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:29:02.699671 [debug] [Thread-2 (]: Began running node model.glamira_analytics.stg_dim_product
[0m22:29:02.700470 [debug] [Thread-3 (]: Began running node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:29:02.701054 [debug] [Thread-4 (]: Began running node model.glamira_analytics.stg_fx_rate
[0m22:29:02.701930 [debug] [Thread-1 (]: Began running node model.glamira_analytics.stg_dim_location
[0m22:29:02.703162 [info ] [Thread-2 (]: 2 of 15 START sql view model analytics_dev_staging.stg_dim_product ............. [RUN]
[0m22:29:02.704148 [info ] [Thread-3 (]: 3 of 15 START sql view model analytics_dev_staging.stg_fact_sales_order_tt ..... [RUN]
[0m22:29:02.705138 [info ] [Thread-4 (]: 4 of 15 START sql view model analytics_dev_staging.stg_fx_rate ................. [RUN]
[0m22:29:02.707181 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_product'
[0m22:29:02.706132 [info ] [Thread-1 (]: 1 of 15 START sql view model analytics_dev_staging.stg_dim_location ............ [RUN]
[0m22:29:02.708360 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fact_sales_order_tt'
[0m22:29:02.709127 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fx_rate'
[0m22:29:02.709689 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.stg_dim_product
[0m22:29:02.710426 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_location'
[0m22:29:02.711058 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:29:02.711607 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.stg_fx_rate
[0m22:29:02.724372 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_product"
[0m22:29:02.725243 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.stg_dim_location
[0m22:29:02.731623 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m22:29:02.736761 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.stg_fx_rate"
[0m22:29:02.742181 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_location"
[0m22:29:02.743847 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.stg_dim_product
[0m22:29:02.789496 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_product"
[0m22:29:02.790550 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:29:02.796598 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m22:29:02.797551 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.stg_dim_location
[0m22:29:02.803724 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_location"
[0m22:29:02.804489 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.stg_fx_rate
[0m22:29:02.805462 [debug] [Thread-2 (]: On model.glamira_analytics.stg_dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_product"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
  OPTIONS()
  as WITH stg_dim_product__source AS (
    SELECT DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`product`
)

, stg_dim_product__rename AS (
    SELECT
        SAFE_CAST(product_id AS INT64) AS product_id,
        CAST(name AS STRING) AS product_name,
        CAST(url AS STRING) AS product_url,
        CAST(sku AS STRING) AS product_sku, 
        CAST(product_type AS STRING) AS product_type,
        CAST(category_name AS STRING) AS category_name,
        CAST(collection AS STRING) AS collection_name,
        SAFE_CAST(min_price AS NUMERIC) AS min_price,
        SAFE_CAST(max_price AS NUMERIC) AS max_price
    FROM stg_dim_product__source
    WHERE product_id IS NOT NULL
)

SELECT * FROM stg_dim_product__rename;


[0m22:29:02.810505 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.stg_fx_rate"
[0m22:29:02.811410 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:29:02.812530 [debug] [Thread-3 (]: On model.glamira_analytics.stg_fact_sales_order_tt: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fact_sales_order_tt"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
  OPTIONS()
  as WITH stg_fact_sales_order_tt__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`raw_layer`.`summary`
    WHERE collection = 'checkout_success'
)

/* 1. Remove failed URLs */
, stg_fact_sales_order_tt__remove_url_fail AS (
    SELECT *
    FROM stg_fact_sales_order_tt__source 
    WHERE current_url NOT LIKE 'file://%'
)

/* 2. Unnest cart_products */
, stg_fact_sales_order_tt__unnest AS (
    SELECT 
        s.*, 
        cp
    FROM stg_fact_sales_order_tt__remove_url_fail s
    CROSS JOIN UNNEST(s.cart_products) AS cp
)

, stg_fact_sales_order_tt__rename AS (
    SELECT
        SAFE_CAST(REGEXP_REPLACE(CAST(s.order_id AS STRING), r'\..*', '') AS INT64) AS order_id,
        
        1 AS quantity,

        SAFE_CAST(REGEXP_REPLACE(CAST(cp.product_id AS STRING), r'\..*', '') AS INT64) AS product_id,
        SAFE_CAST(REGEXP_REPLACE(CAST(s.user_id_db AS STRING), r'\..*', '') AS INT64) AS user_id,
        SAFE_CAST(REGEXP_REPLACE(CAST(s.store_id AS STRING), r'\..*', '') AS INT64) AS store_id,
        
        TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64)) AS time_stamp,
        DATETIME(TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64))) AS local_time,
        
        CASE 
            WHEN s.currency IN ('USD', 'USD $') THEN 'USD'
            WHEN s.currency = 'HKD $'    THEN 'HKD'
            WHEN s.currency = 'NZD $'    THEN 'NZD'
            WHEN s.currency = 'MXN $'    THEN 'MXN'
            WHEN s.currency = 'Kƒç'       THEN 'CZK'
            WHEN s.currency = 'Ft'       THEN 'HUF'
            WHEN s.currency = 'z≈Ç'       THEN 'PLN'
            WHEN s.currency = '‚Çπ'        THEN 'INR'
            WHEN s.currency = '–ª–≤.'      THEN 'BGN'
            WHEN s.currency = '‚Ç´'        THEN 'VND'
            WHEN s.currency = '‚Ç±'        THEN 'PHP'
            WHEN s.currency = '‚Ç≤'        THEN 'PYG'
            WHEN s.currency = 'CRC ‚Ç°'    THEN 'CRC'
            WHEN s.currency = 'COP $'    THEN 'COP'
            WHEN s.currency = 'BOB Bs'   THEN 'BOB'
            WHEN s.currency = 'GTQ Q'    THEN 'GTQ'
            WHEN s.currency = 'PEN S/.'  THEN 'PEN'
            WHEN s.currency = 'DOP $'    THEN 'DOP'
            WHEN s.currency = 'CLP'      THEN 'CLP'
            WHEN s.currency = 'Lei'      THEN 'RON'
            WHEN s.currency = 'UYU'      THEN 'UYU'
            WHEN s.currency = 'din.'     THEN 'RSD'
            WHEN s.currency = 'kn'       THEN 'HRK'
            WHEN s.currency = 'ÿØ.ŸÉ.'     THEN 'KWD'
            WHEN s.currency = 'CHF'      THEN 'CHF'
            WHEN s.currency = 'kr'       THEN 'SEK'
            WHEN s.currency = '‚Ç¨'        THEN 'EUR'
            WHEN s.currency = '¬£'        THEN 'GBP'
            WHEN s.currency = 'AU$'      THEN 'AUD'
            WHEN s.currency = 'CA$'      THEN 'CAD'
            WHEN s.currency = '¬•'        THEN 'JPY'
            ELSE 'USD' 
        END AS currency_code,

        CAST(cp.price * 1 AS NUMERIC) AS line_total,
        
        s.ip AS ip_address,

        -- FIX: Changed 'country_short' to 'country_code'
        FARM_FINGERPRINT(CONCAT(
            CAST(s.country_code AS STRING), 
            CAST(s.region AS STRING), 
            CAST(s.city AS STRING)
        )) AS location_id

    FROM stg_fact_sales_order_tt__unnest s
)

SELECT * FROM stg_fact_sales_order_tt__rename;


[0m22:29:02.814472 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:29:02.815326 [debug] [Thread-1 (]: On model.glamira_analytics.stg_dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_location"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
  OPTIONS()
  as WITH stg_dim_location__source AS (
    SELECT 
        DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`ip_location`
)

, stg_dim_location__rename AS (
    SELECT
        CAST(ip AS STRING) AS ip_address,
        CAST(country_code AS STRING) AS country_short_name,
        
        CAST(country_code AS STRING) AS country_long_name,
        
        CAST(region AS STRING) AS region_name,
        CAST(city AS STRING) AS city_name
    FROM stg_dim_location__source
    WHERE country_code <> '-' 
      AND country_code IS NOT NULL
)

, stg_dim_location__gen_key AS (
    SELECT
        FARM_FINGERPRINT(country_short_name || region_name || city_name) AS location_id,
        ip_address,
        country_short_name,
        country_long_name,
        region_name,
        city_name
    FROM stg_dim_location__rename
)

SELECT * FROM stg_dim_location__gen_key;


[0m22:29:02.817311 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m22:29:02.818362 [debug] [Thread-4 (]: On model.glamira_analytics.stg_fx_rate: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fx_rate"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
  OPTIONS()
  as WITH source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev`.`exchange_rate_usd`
)

, renamed AS (
    SELECT
        CAST(currency AS STRING) AS currency_code
        ,CAST(rate_to_usd AS NUMERIC) AS rate_to_usd
        ,CAST(as_of_gmt AS TIMESTAMP) AS rate_timestamp
    FROM source
)

SELECT * FROM renamed;


[0m22:29:02.820673 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:29:04.009114 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:19972075-105d-4ee2-8b5b-c829b5aa454a&page=queryresults
[0m22:29:04.010322 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:ae4a17b7-a9db-4c63-94db-12352b34ba59&page=queryresults
[0m22:29:04.111177 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:1fbde17c-8502-4e02-ac3e-1d8bf26c163c&page=queryresults
[0m22:29:04.214623 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:19972075-105d-4ee2-8b5b-c829b5aa454a&page=queryresults
[0m22:29:04.229763 [debug] [Thread-3 (]: Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Name country_code not found inside s at [82:20]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m22:29:04.232756 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1bf15b95-b385-4b5a-8d5a-bdda0f2043db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002371E2465D0>]}
[0m22:29:04.233684 [error] [Thread-3 (]: 3 of 15 ERROR creating sql view model analytics_dev_staging.stg_fact_sales_order_tt  [[31mERROR[0m in 1.52s]
[0m22:29:04.234749 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:29:04.235976 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.stg_fact_sales_order_tt' to be skipped because of status 'error'.  Reason: Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Name country_code not found inside s at [82:20]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql.
[0m22:29:04.238837 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_date
[0m22:29:04.239576 [info ] [Thread-3 (]: 5 of 15 SKIP relation analytics_dev_dimensions.dim_date ........................ [[33mSKIP[0m]
[0m22:29:04.240408 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_date
[0m22:29:04.241158 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_store
[0m22:29:04.241919 [info ] [Thread-3 (]: 6 of 15 SKIP relation analytics_dev_dimensions.dim_store ....................... [[33mSKIP[0m]
[0m22:29:04.242688 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_store
[0m22:29:04.243231 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_user
[0m22:29:04.243772 [info ] [Thread-3 (]: 7 of 15 SKIP relation analytics_dev_dimensions.dim_user ........................ [[33mSKIP[0m]
[0m22:29:04.244773 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_user
[0m22:29:04.245922 [debug] [Thread-3 (]: Began running node model.glamira_analytics.fact_sales_order_tt
[0m22:29:04.246986 [info ] [Thread-3 (]: 8 of 15 SKIP relation analytics_dev_dimensions.fact_sales_order_tt ............. [[33mSKIP[0m]
[0m22:29:04.248103 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.fact_sales_order_tt
[0m22:29:04.249190 [debug] [Thread-3 (]: Began running node model.glamira_analytics.mart_overall
[0m22:29:04.250064 [info ] [Thread-3 (]: 9 of 15 SKIP relation analytics_dev.mart_overall ............................... [[33mSKIP[0m]
[0m22:29:04.251254 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.mart_overall
[0m22:29:04.418637 [debug] [Thread-2 (]: SQL status: OK in 0.408 seconds
[0m22:29:04.419518 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:ffa06c8a-7faa-444d-b3d4-152f594d3a04&page=queryresults
[0m22:29:04.522800 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1bf15b95-b385-4b5a-8d5a-bdda0f2043db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002371E6C5020>]}
[0m22:29:04.524634 [debug] [Thread-1 (]: SQL status: OK in 0.413 seconds
[0m22:29:04.523717 [info ] [Thread-2 (]: 2 of 15 OK created sql view model analytics_dev_staging.stg_dim_product ........ [[32mCREATE VIEW (0 processed)[0m in 1.82s]
[0m22:29:04.529250 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.stg_dim_product
[0m22:29:04.531776 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1bf15b95-b385-4b5a-8d5a-bdda0f2043db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000023716A2B110>]}
[0m22:29:04.533665 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_product
[0m22:29:04.532996 [info ] [Thread-1 (]: 1 of 15 OK created sql view model analytics_dev_staging.stg_dim_location ....... [[32mCREATE VIEW (0 processed)[0m in 1.82s]
[0m22:29:04.536442 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.stg_dim_location
[0m22:29:04.535050 [info ] [Thread-3 (]: 10 of 15 START sql table model analytics_dev_dimensions.dim_product ............ [RUN]
[0m22:29:04.537639 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_fact_sales_order_tt, now model.glamira_analytics.dim_product)
[0m22:29:04.538638 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.dim_product
[0m22:29:04.544470 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.dim_product"
[0m22:29:04.545322 [debug] [Thread-2 (]: Began running node model.glamira_analytics.dim_location
[0m22:29:04.546163 [info ] [Thread-2 (]: 11 of 15 START sql table model analytics_dev_dimensions.dim_location ........... [RUN]
[0m22:29:04.547099 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_dim_product, now model.glamira_analytics.dim_location)
[0m22:29:04.548025 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.dim_location
[0m22:29:04.553286 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.dim_location"
[0m22:29:04.554569 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.dim_product
[0m22:29:04.569334 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:29:04.571715 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.dim_location
[0m22:29:04.575970 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:29:04.826770 [debug] [Thread-4 (]: SQL status: OK in 0.406 seconds
[0m22:29:04.833047 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1bf15b95-b385-4b5a-8d5a-bdda0f2043db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002371E9FD750>]}
[0m22:29:04.834256 [info ] [Thread-4 (]: 4 of 15 OK created sql view model analytics_dev_staging.stg_fx_rate ............ [[32mCREATE VIEW (0 processed)[0m in 2.12s]
[0m22:29:04.836589 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.stg_fx_rate
[0m22:29:04.837813 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_fx_rate_usd
[0m22:29:04.838749 [info ] [Thread-1 (]: 12 of 15 START sql table model analytics_dev_dimensions.dim_fx_rate_usd ........ [RUN]
[0m22:29:04.839833 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_dim_location, now model.glamira_analytics.dim_fx_rate_usd)
[0m22:29:04.840784 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.dim_fx_rate_usd
[0m22:29:04.846296 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.dim_fx_rate_usd"
[0m22:29:04.847880 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.dim_fx_rate_usd
[0m22:29:04.850817 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:29:05.472124 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.dim_product"
[0m22:29:05.474970 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.dim_location"
[0m22:29:05.476494 [debug] [Thread-3 (]: On model.glamira_analytics.dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_product"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_product__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
)

, dim_product__null_handle AS (
    SELECT
        product_id,
        COALESCE(product_name, 'Undefined') AS product_name,
        COALESCE(product_url, 'Undefined') AS product_url,
        COALESCE(product_sku, 'Undefined') AS product_sku,
        COALESCE(product_type, 'Undefined') AS product_type,
        COALESCE(NULLIF(TRIM(category_name), ''), 'Undefined') AS category_name, 
        COALESCE(NULLIF(TRIM(collection_name), ''), 'Undefined') AS collection_name,
        min_price,
        max_price
    FROM dim_product__source 
)

, dim_product__add_key AS (
    SELECT
        FARM_FINGERPRINT(CAST(product_id AS STRING)) AS product_key,
        *
    FROM dim_product__null_handle
)

, dim_product__union_undefined AS (
    SELECT 
        * FROM dim_product__add_key

    UNION ALL

    SELECT 
        -1 AS product_key,
        -1 AS product_id,
        'Undefined' AS product_name,
        'Undefined' AS product_url,
        'Undefined' AS product_sku,
        'Undefined' AS product_type,
        'Undefined' AS category_name,
        'Undefined' AS collection_name,
        0 AS min_price,
        0 AS max_price
)

SELECT * FROM dim_product__union_undefined
    );
  
[0m22:29:05.478748 [debug] [Thread-2 (]: On model.glamira_analytics.dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_location"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_location`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_location__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
)

, dim_location__null_handle AS (
    SELECT
        location_id
        ,ip_address
        ,COALESCE(country_short_name, 'Undefined') AS country_code
        ,COALESCE(country_long_name, 'Undefined') AS country_name
        ,COALESCE(region_name, 'Undefined') AS region_name
        ,COALESCE(city_name, 'Undefined') AS city_name
    FROM dim_location__source 
)

, dim_location__add_key AS (
    SELECT
        -- Surrogate Key
        FARM_FINGERPRINT(CAST(location_id AS STRING)) AS location_key
        -- Natural Key
        ,CAST(location_id AS STRING) AS location_id
        ,ip_address
        ,country_code
        ,country_name
        ,region_name
        ,city_name
    FROM dim_location__null_handle
)

, dim_location__union_undefined AS (
    SELECT 
        * FROM dim_location__add_key

    UNION ALL

    SELECT 
        -1 AS location_key
        ,'-1' AS location_id
        ,'Undefined' AS ip_address
        ,'Undefined' AS country_code
        ,'Undefined' AS country_name
        ,'Undefined' AS region_name
        ,'Undefined' AS city_name
)

SELECT 
    *
FROM dim_location__union_undefined
    );
  
[0m22:29:05.749041 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.dim_fx_rate_usd"
[0m22:29:05.750610 [debug] [Thread-1 (]: On model.glamira_analytics.dim_fx_rate_usd: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_fx_rate_usd"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_fx_rate_usd`
      
    
    

    
    OPTIONS()
    as (
      WITH stg_fx AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
)

SELECT
    currency_code AS from_currency_code
    ,'USD' AS to_currency_code
    ,rate_to_usd
    ,rate_timestamp
FROM stg_fx
    );
  
[0m22:29:06.170532 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:1f04d793-e056-4243-9f6e-6129dbc676aa&page=queryresults
[0m22:29:06.368355 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:6cdaa5b6-be36-4b79-be57-402250d47148&page=queryresults
[0m22:29:06.464956 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:25d9847c-723a-4bfd-866a-e59cc058ab1d&page=queryresults
[0m22:29:07.944220 [debug] [Thread-3 (]: SQL status: OK in 1.575 seconds
[0m22:29:08.145349 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1bf15b95-b385-4b5a-8d5a-bdda0f2043db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002371E2C8670>]}
[0m22:29:08.146561 [info ] [Thread-3 (]: 10 of 15 OK created sql table model analytics_dev_dimensions.dim_product ....... [[32mCREATE TABLE (18.6k rows, 2.7 MiB processed)[0m in 3.61s]
[0m22:29:08.147821 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_product
[0m22:29:08.148795 [debug] [Thread-4 (]: Began running node model.glamira_analytics.mart_product
[0m22:29:08.149485 [debug] [Thread-3 (]: Began running node model.glamira_analytics.mart_product_type
[0m22:29:08.150120 [info ] [Thread-4 (]: 13 of 15 SKIP relation analytics_dev.mart_product .............................. [[33mSKIP[0m]
[0m22:29:08.151185 [info ] [Thread-3 (]: 14 of 15 SKIP relation analytics_dev.mart_product_type ......................... [[33mSKIP[0m]
[0m22:29:08.152313 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.mart_product
[0m22:29:08.153230 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.mart_product_type
[0m22:29:08.205096 [debug] [Thread-1 (]: SQL status: OK in 1.739 seconds
[0m22:29:08.411865 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1bf15b95-b385-4b5a-8d5a-bdda0f2043db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002371E958EF0>]}
[0m22:29:08.412967 [info ] [Thread-1 (]: 12 of 15 OK created sql table model analytics_dev_dimensions.dim_fx_rate_usd ... [[32mCREATE TABLE (34.0 rows, 1.3 KiB processed)[0m in 3.57s]
[0m22:29:08.414199 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_fx_rate_usd
[0m22:29:10.865090 [debug] [Thread-2 (]: SQL status: OK in 4.694 seconds
[0m22:29:11.072711 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1bf15b95-b385-4b5a-8d5a-bdda0f2043db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002371E95A090>]}
[0m22:29:11.073774 [info ] [Thread-2 (]: 11 of 15 OK created sql table model analytics_dev_dimensions.dim_location ...... [[32mCREATE TABLE (2.1m rows, 189.5 MiB processed)[0m in 6.53s]
[0m22:29:11.075046 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.dim_location
[0m22:29:11.076056 [debug] [Thread-4 (]: Began running node model.glamira_analytics.mart_country
[0m22:29:11.076886 [info ] [Thread-4 (]: 15 of 15 SKIP relation analytics_dev.mart_country .............................. [[33mSKIP[0m]
[0m22:29:11.077856 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.mart_country
[0m22:29:11.080129 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:29:11.081464 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:29:11.082168 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:29:11.082803 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:29:11.083375 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:29:11.084038 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev' was properly closed.
[0m22:29:11.084950 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_staging' was properly closed.
[0m22:29:11.085937 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_dimensions' was properly closed.
[0m22:29:11.086631 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_location' was properly closed.
[0m22:29:11.087270 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_product' was properly closed.
[0m22:29:11.087960 [debug] [MainThread]: Connection 'model.glamira_analytics.stg_fx_rate' was properly closed.
[0m22:29:11.088585 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_fx_rate_usd' was properly closed.
[0m22:29:11.089310 [info ] [MainThread]: 
[0m22:29:11.090025 [info ] [MainThread]: Finished running 1 incremental model, 10 table models, 4 view models in 0 hours 0 minutes and 11.64 seconds (11.64s).
[0m22:29:11.094234 [debug] [MainThread]: Command end result
[0m22:29:11.140342 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:29:11.143601 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:29:11.152227 [debug] [MainThread]: Wrote artifact RunExecutionResult to D:\Project 7\glamira_analytics\target\run_results.json
[0m22:29:11.152820 [info ] [MainThread]: 
[0m22:29:11.153789 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:29:11.154558 [info ] [MainThread]: 
[0m22:29:11.155222 [error] [MainThread]: [31mFailure in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)[0m
[0m22:29:11.155873 [error] [MainThread]:   Database Error in model stg_fact_sales_order_tt (models\staging\stg_fact_sales_order_tt.sql)
  Name country_code not found inside s at [82:20]
  compiled code at target\run\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m22:29:11.156442 [info ] [MainThread]: 
[0m22:29:11.157056 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\staging\stg_fact_sales_order_tt.sql
[0m22:29:11.157591 [info ] [MainThread]: 
[0m22:29:11.158140 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=8 NO-OP=0 TOTAL=15
[0m22:29:11.159421 [debug] [MainThread]: Command `dbt run` failed at 22:29:11.159179 after 23.41 seconds
[0m22:29:11.160054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002371E07FB30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002371E25A570>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002371E25AC90>]}
[0m22:29:11.160586 [debug] [MainThread]: Flushing usage events
[0m22:29:14.857773 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:32:26.968051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F64F18EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F6607FED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F6607FB10>]}


============================== 22:32:26.975299 | d93f6ead-5875-4c49-a1c2-bc4360796cd8 ==============================
[0m22:32:26.975299 [info ] [MainThread]: Running with dbt=1.11.2
[0m22:32:26.976671 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'no_print': 'None', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'write_json': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'empty': 'False', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'use_colors': 'True', 'invocation_command': 'dbt run --full-refresh', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m22:32:37.539675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd93f6ead-5875-4c49-a1c2-bc4360796cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F653B1BA0>]}
[0m22:32:37.621406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd93f6ead-5875-4c49-a1c2-bc4360796cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F05617570>]}
[0m22:32:37.622276 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m22:32:38.519632 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m22:32:38.745727 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:32:38.746563 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\staging\stg_fact_sales_order_tt.sql
[0m22:32:39.105492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd93f6ead-5875-4c49-a1c2-bc4360796cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F05B3D950>]}
[0m22:32:39.216469 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:32:39.219783 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:32:39.259921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd93f6ead-5875-4c49-a1c2-bc4360796cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F05683110>]}
[0m22:32:39.260631 [info ] [MainThread]: Found 15 models, 1 seed, 3 sources, 537 macros
[0m22:32:39.261286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd93f6ead-5875-4c49-a1c2-bc4360796cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F05A6B310>]}
[0m22:32:39.264389 [info ] [MainThread]: 
[0m22:32:39.265159 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:32:39.265705 [info ] [MainThread]: 
[0m22:32:39.266609 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:32:39.273515 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:32:39.275212 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:32:39.276683 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:32:39.278127 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:32:39.278990 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:32:39.279867 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:32:41.274831 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_dimensions'
[0m22:32:41.275772 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:32:41.276597 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev'
[0m22:32:41.277905 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:32:41.278670 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_staging'
[0m22:32:41.280998 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:32:42.202134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd93f6ead-5875-4c49-a1c2-bc4360796cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F05D9C6D0>]}
[0m22:32:42.202907 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:32:42.209225 [debug] [Thread-3 (]: Began running node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:32:42.210036 [debug] [Thread-1 (]: Began running node model.glamira_analytics.stg_dim_location
[0m22:32:42.210663 [debug] [Thread-4 (]: Began running node model.glamira_analytics.stg_fx_rate
[0m22:32:42.211195 [debug] [Thread-2 (]: Began running node model.glamira_analytics.stg_dim_product
[0m22:32:42.212008 [info ] [Thread-3 (]: 3 of 15 START sql view model analytics_dev_staging.stg_fact_sales_order_tt ..... [RUN]
[0m22:32:42.212722 [info ] [Thread-1 (]: 1 of 15 START sql view model analytics_dev_staging.stg_dim_location ............ [RUN]
[0m22:32:42.213575 [info ] [Thread-4 (]: 4 of 15 START sql view model analytics_dev_staging.stg_fx_rate ................. [RUN]
[0m22:32:42.215529 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fact_sales_order_tt'
[0m22:32:42.214456 [info ] [Thread-2 (]: 2 of 15 START sql view model analytics_dev_staging.stg_dim_product ............. [RUN]
[0m22:32:42.216691 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_location'
[0m22:32:42.217447 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fx_rate'
[0m22:32:42.218003 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:32:42.218728 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_product'
[0m22:32:42.219346 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.stg_dim_location
[0m22:32:42.219893 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.stg_fx_rate
[0m22:32:42.233400 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m22:32:42.234264 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.stg_dim_product
[0m22:32:42.239899 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_location"
[0m22:32:42.244714 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.stg_fx_rate"
[0m22:32:42.251158 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_product"
[0m22:32:42.253169 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:32:42.293850 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m22:32:42.295229 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.stg_fx_rate
[0m22:32:42.296047 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.stg_dim_product
[0m22:32:42.296632 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.stg_dim_location
[0m22:32:42.302350 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.stg_fx_rate"
[0m22:32:42.306921 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_product"
[0m22:32:42.307892 [debug] [Thread-3 (]: On model.glamira_analytics.stg_fact_sales_order_tt: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fact_sales_order_tt"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
  OPTIONS()
  as WITH stg_fact_sales_order_tt__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`raw_layer`.`summary`
    WHERE collection = 'checkout_success'
)

/* 1. Remove failed URLs */
, stg_fact_sales_order_tt__remove_url_fail AS (
    SELECT *
    FROM stg_fact_sales_order_tt__source 
    WHERE current_url NOT LIKE 'file://%'
)

/* 2. Get Location Data (Since summary table is missing it) */
, stg_fact_sales_order_tt__location AS (
    -- We select distinct IPs to avoid duplicate rows during the join
    SELECT DISTINCT 
        ip,
        country_code,
        region,
        city
    FROM `stone-album-475912-b9`.`raw_layer`.`ip_location`
    WHERE country_code IS NOT NULL
)

/* 3. Join Summary with Location */
, stg_fact_sales_order_tt__joined AS (
    SELECT 
        s.*,
        l.country_code,
        l.region,
        l.city
    FROM stg_fact_sales_order_tt__remove_url_fail s
    LEFT JOIN stg_fact_sales_order_tt__location l
        ON s.ip = l.ip
)

/* 4. Unnest cart_products */
, stg_fact_sales_order_tt__unnest AS (
    SELECT 
        s.*, 
        cp
    FROM stg_fact_sales_order_tt__joined s
    CROSS JOIN UNNEST(s.cart_products) AS cp
)

, stg_fact_sales_order_tt__rename AS (
    SELECT
        SAFE_CAST(REGEXP_REPLACE(CAST(s.order_id AS STRING), r'\..*', '') AS INT64) AS order_id,
        
        1 AS quantity,

        SAFE_CAST(REGEXP_REPLACE(CAST(cp.product_id AS STRING), r'\..*', '') AS INT64) AS product_id,
        SAFE_CAST(REGEXP_REPLACE(CAST(s.user_id_db AS STRING), r'\..*', '') AS INT64) AS user_id,
        SAFE_CAST(REGEXP_REPLACE(CAST(s.store_id AS STRING), r'\..*', '') AS INT64) AS store_id,
        
        TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64)) AS time_stamp,
        DATETIME(TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64))) AS local_time,
        
        CASE 
            WHEN s.currency IN ('USD', 'USD $') THEN 'USD'
            WHEN s.currency = 'HKD $'    THEN 'HKD'
            WHEN s.currency = 'NZD $'    THEN 'NZD'
            WHEN s.currency = 'MXN $'    THEN 'MXN'
            WHEN s.currency = 'Kƒç'       THEN 'CZK'
            WHEN s.currency = 'Ft'       THEN 'HUF'
            WHEN s.currency = 'z≈Ç'       THEN 'PLN'
            WHEN s.currency = '‚Çπ'        THEN 'INR'
            WHEN s.currency = '–ª–≤.'      THEN 'BGN'
            WHEN s.currency = '‚Ç´'        THEN 'VND'
            WHEN s.currency = '‚Ç±'        THEN 'PHP'
            WHEN s.currency = '‚Ç≤'        THEN 'PYG'
            WHEN s.currency = 'CRC ‚Ç°'    THEN 'CRC'
            WHEN s.currency = 'COP $'    THEN 'COP'
            WHEN s.currency = 'BOB Bs'   THEN 'BOB'
            WHEN s.currency = 'GTQ Q'    THEN 'GTQ'
            WHEN s.currency = 'PEN S/.'  THEN 'PEN'
            WHEN s.currency = 'DOP $'    THEN 'DOP'
            WHEN s.currency = 'CLP'      THEN 'CLP'
            WHEN s.currency = 'Lei'      THEN 'RON'
            WHEN s.currency = 'UYU'      THEN 'UYU'
            WHEN s.currency = 'din.'     THEN 'RSD'
            WHEN s.currency = 'kn'       THEN 'HRK'
            WHEN s.currency = 'ÿØ.ŸÉ.'     THEN 'KWD'
            WHEN s.currency = 'CHF'      THEN 'CHF'
            WHEN s.currency = 'kr'       THEN 'SEK'
            WHEN s.currency = '‚Ç¨'        THEN 'EUR'
            WHEN s.currency = '¬£'        THEN 'GBP'
            WHEN s.currency = 'AU$'      THEN 'AUD'
            WHEN s.currency = 'CA$'      THEN 'CAD'
            WHEN s.currency = '¬•'        THEN 'JPY'
            ELSE 'USD' 
        END AS currency_code,

        CAST(cp.price * 1 AS NUMERIC) AS line_total,
        
        s.ip AS ip_address,

        FARM_FINGERPRINT(CONCAT(
            CAST(s.country_code AS STRING), 
            CAST(s.region AS STRING), 
            CAST(s.city AS STRING)
        )) AS location_id

    FROM stg_fact_sales_order_tt__unnest s
)

SELECT * FROM stg_fact_sales_order_tt__rename;


[0m22:32:42.313753 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_location"
[0m22:32:42.314903 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:32:42.316924 [debug] [Thread-4 (]: On model.glamira_analytics.stg_fx_rate: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fx_rate"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
  OPTIONS()
  as WITH source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev`.`exchange_rate_usd`
)

, renamed AS (
    SELECT
        CAST(currency AS STRING) AS currency_code
        ,CAST(rate_to_usd AS NUMERIC) AS rate_to_usd
        ,CAST(as_of_gmt AS TIMESTAMP) AS rate_timestamp
    FROM source
)

SELECT * FROM renamed;


[0m22:32:42.318059 [debug] [Thread-2 (]: On model.glamira_analytics.stg_dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_product"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
  OPTIONS()
  as WITH stg_dim_product__source AS (
    SELECT DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`product`
)

, stg_dim_product__rename AS (
    SELECT
        SAFE_CAST(product_id AS INT64) AS product_id,
        CAST(name AS STRING) AS product_name,
        CAST(url AS STRING) AS product_url,
        CAST(sku AS STRING) AS product_sku, 
        CAST(product_type AS STRING) AS product_type,
        CAST(category_name AS STRING) AS category_name,
        CAST(collection AS STRING) AS collection_name,
        SAFE_CAST(min_price AS NUMERIC) AS min_price,
        SAFE_CAST(max_price AS NUMERIC) AS max_price
    FROM stg_dim_product__source
    WHERE product_id IS NOT NULL
)

SELECT * FROM stg_dim_product__rename;


[0m22:32:42.319873 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:32:42.321236 [debug] [Thread-1 (]: On model.glamira_analytics.stg_dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_location"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
  OPTIONS()
  as WITH stg_dim_location__source AS (
    SELECT 
        DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`ip_location`
)

, stg_dim_location__rename AS (
    SELECT
        CAST(ip AS STRING) AS ip_address,
        CAST(country_code AS STRING) AS country_short_name,
        
        CAST(country_code AS STRING) AS country_long_name,
        
        CAST(region AS STRING) AS region_name,
        CAST(city AS STRING) AS city_name
    FROM stg_dim_location__source
    WHERE country_code <> '-' 
      AND country_code IS NOT NULL
)

, stg_dim_location__gen_key AS (
    SELECT
        FARM_FINGERPRINT(country_short_name || region_name || city_name) AS location_id,
        ip_address,
        country_short_name,
        country_long_name,
        region_name,
        city_name
    FROM stg_dim_location__rename
)

SELECT * FROM stg_dim_location__gen_key;


[0m22:32:42.322103 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:32:42.323845 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m22:32:43.510360 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:f6fab6eb-9316-4800-a18d-20d6ce0f32ff&page=queryresults
[0m22:32:43.512803 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:98d010e0-beb2-4f15-9485-8deea04d9e32&page=queryresults
[0m22:32:43.514414 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:2e10b39c-0c77-4d2a-989f-de35edd54dd9&page=queryresults
[0m22:32:43.919151 [debug] [Thread-1 (]: SQL status: OK in 0.405 seconds
[0m22:32:43.921791 [debug] [Thread-3 (]: SQL status: OK in 0.407 seconds
[0m22:32:44.041641 [debug] [Thread-4 (]: SQL status: OK in 0.529 seconds
[0m22:32:44.049581 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd93f6ead-5875-4c49-a1c2-bc4360796cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F05D3E150>]}
[0m22:32:44.050230 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd93f6ead-5875-4c49-a1c2-bc4360796cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F05ADBA10>]}
[0m22:32:44.050743 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd93f6ead-5875-4c49-a1c2-bc4360796cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F05ADB800>]}
[0m22:32:44.051740 [info ] [Thread-1 (]: 1 of 15 OK created sql view model analytics_dev_staging.stg_dim_location ....... [[32mCREATE VIEW (0 processed)[0m in 1.82s]
[0m22:32:44.052624 [info ] [Thread-3 (]: 3 of 15 OK created sql view model analytics_dev_staging.stg_fact_sales_order_tt  [[32mCREATE VIEW (0 processed)[0m in 1.83s]
[0m22:32:44.055049 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.stg_dim_location
[0m22:32:44.053888 [info ] [Thread-4 (]: 4 of 15 OK created sql view model analytics_dev_staging.stg_fx_rate ............ [[32mCREATE VIEW (0 processed)[0m in 1.83s]
[0m22:32:44.056178 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:32:44.057342 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.stg_fx_rate
[0m22:32:44.058068 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_location
[0m22:32:44.059164 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_date
[0m22:32:44.060513 [debug] [Thread-4 (]: Began running node model.glamira_analytics.dim_store
[0m22:32:44.059984 [info ] [Thread-1 (]: 5 of 15 START sql table model analytics_dev_dimensions.dim_location ............ [RUN]
[0m22:32:44.061704 [info ] [Thread-3 (]: 6 of 15 START sql table model analytics_dev_dimensions.dim_date ................ [RUN]
[0m22:32:44.063908 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_dim_location, now model.glamira_analytics.dim_location)
[0m22:32:44.062737 [info ] [Thread-4 (]: 7 of 15 START sql table model analytics_dev_dimensions.dim_store ............... [RUN]
[0m22:32:44.065091 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_fact_sales_order_tt, now model.glamira_analytics.dim_date)
[0m22:32:44.065885 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.dim_location
[0m22:32:44.066562 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_fx_rate, now model.glamira_analytics.dim_store)
[0m22:32:44.067181 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.dim_date
[0m22:32:44.071833 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.dim_location"
[0m22:32:44.072606 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.dim_store
[0m22:32:44.079631 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.dim_date"
[0m22:32:44.086180 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.dim_store"
[0m22:32:44.087768 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.dim_location
[0m22:32:44.103470 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:32:44.105246 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.dim_date
[0m22:32:44.106443 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.dim_store
[0m22:32:44.140489 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.dim_date"
[0m22:32:44.147449 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.dim_store"
[0m22:32:44.154741 [debug] [Thread-3 (]: On model.glamira_analytics.dim_date: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_date"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_date`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_date__source AS (
    SELECT DISTINCT 
        DATE(time_stamp) AS full_date
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
    WHERE time_stamp IS NOT NULL
)

, dim_date__format AS (
    SELECT
        CAST(FORMAT_DATE('%Y%m%d', full_date) AS INT64) AS date_key
        ,full_date AS date_day
        ,FORMAT_DATE('%A', full_date) AS day_name
        ,CASE
            WHEN FORMAT_DATE('%A', full_date) IN ('Saturday', 'Sunday') THEN TRUE
            ELSE FALSE
        END AS is_weekend
        ,CAST(FORMAT_DATE('%d', full_date) AS INT64) AS day_of_month
        ,FORMAT_DATE('%Y-%m', full_date) AS year_month
        ,CAST(FORMAT_DATE('%m', full_date) AS INT64) AS month_of_year
        ,CAST(FORMAT_DATE('%j', full_date) AS INT64) AS day_of_year
        ,CAST(FORMAT_DATE('%W', full_date) AS INT64) AS week_of_year
        ,CAST(FORMAT_DATE('%Q', full_date) AS INT64) AS quarter_of_year
        ,CAST(FORMAT_DATE('%Y', full_date) AS INT64) AS year_number
    FROM dim_date__source
)

SELECT 
    *
FROM dim_date__format
ORDER BY date_key
    );
  
[0m22:32:44.155678 [debug] [Thread-4 (]: On model.glamira_analytics.dim_store: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_store"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_store`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_store__source AS (
    SELECT DISTINCT 
        store_id
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
    WHERE store_id IS NOT NULL
)

, dim_store__add_key AS (
    SELECT
        FARM_FINGERPRINT(CAST(store_id AS STRING)) AS store_key
        ,CAST(store_id AS STRING) AS store_id
        ,CONCAT('Store ', CAST(store_id AS STRING)) AS store_name
    FROM dim_store__source 
)

SELECT 
    *
FROM dim_store__add_key
ORDER BY store_id
    );
  
[0m22:32:44.156514 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:32:44.157160 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:32:44.796518 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:bc813de0-62c7-4bd9-ae3b-3d6625385add&page=queryresults
[0m22:32:45.145689 [debug] [Thread-2 (]: SQL status: OK in 0.348 seconds
[0m22:32:45.150970 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd93f6ead-5875-4c49-a1c2-bc4360796cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F0650E6D0>]}
[0m22:32:45.152038 [info ] [Thread-2 (]: 2 of 15 OK created sql view model analytics_dev_staging.stg_dim_product ........ [[32mCREATE VIEW (0 processed)[0m in 2.93s]
[0m22:32:45.153321 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.stg_dim_product
[0m22:32:45.154002 [debug] [Thread-2 (]: Began running node model.glamira_analytics.dim_user
[0m22:32:45.154794 [info ] [Thread-2 (]: 8 of 15 START sql table model analytics_dev_dimensions.dim_user ................ [RUN]
[0m22:32:45.155687 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_dim_product, now model.glamira_analytics.dim_user)
[0m22:32:45.157546 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.dim_user
[0m22:32:45.161686 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.dim_user"
[0m22:32:45.164097 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.dim_location"
[0m22:32:45.166192 [debug] [Thread-1 (]: On model.glamira_analytics.dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_location"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_location`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_location__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
)

, dim_location__null_handle AS (
    SELECT
        location_id
        ,ip_address
        ,COALESCE(country_short_name, 'Undefined') AS country_code
        ,COALESCE(country_long_name, 'Undefined') AS country_name
        ,COALESCE(region_name, 'Undefined') AS region_name
        ,COALESCE(city_name, 'Undefined') AS city_name
    FROM dim_location__source 
)

, dim_location__add_key AS (
    SELECT
        -- Surrogate Key
        FARM_FINGERPRINT(CAST(location_id AS STRING)) AS location_key
        -- Natural Key
        ,CAST(location_id AS STRING) AS location_id
        ,ip_address
        ,country_code
        ,country_name
        ,region_name
        ,city_name
    FROM dim_location__null_handle
)

, dim_location__union_undefined AS (
    SELECT 
        * FROM dim_location__add_key

    UNION ALL

    SELECT 
        -1 AS location_key
        ,'-1' AS location_id
        ,'Undefined' AS ip_address
        ,'Undefined' AS country_code
        ,'Undefined' AS country_name
        ,'Undefined' AS region_name
        ,'Undefined' AS city_name
)

SELECT 
    *
FROM dim_location__union_undefined
    );
  
[0m22:32:45.170672 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.dim_user
[0m22:32:45.175536 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.dim_user"
[0m22:32:45.177470 [debug] [Thread-2 (]: On model.glamira_analytics.dim_user: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_user"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_user`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_user__source AS (
    SELECT DISTINCT 
        user_id
        ,email_address 
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
    WHERE user_id IS NOT NULL
)

, dim_user__add_key AS (
    SELECT
        -- Surrogate Key (combining ID and Email for uniqueness if needed, or just ID)
        FARM_FINGERPRINT(CAST(user_id AS STRING) || CAST(COALESCE(email_address, 'Undefined') AS STRING)) AS user_key
        -- Natural Key
        ,CAST(user_id AS STRING) AS user_id
        ,COALESCE(email_address, 'Undefined') AS email_address
    FROM dim_user__source 
)

, dim_user__union_undefined AS (
    SELECT 
        * FROM dim_user__add_key

    UNION ALL

    SELECT 
        -1 AS user_key
        ,'-1' AS user_id
        ,'Undefined' AS email_address
)

SELECT 
    *
FROM dim_user__union_undefined
    );
  
[0m22:32:45.178240 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:32:45.760518 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:7582d270-1a23-49c1-bd29-e9fbd43d9e7e&page=queryresults
[0m22:32:45.762835 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:f6255caa-5d2a-4af4-8309-d024dc246d5a&page=queryresults
[0m22:32:46.579253 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:0e6d03a0-15f6-468a-af9f-12adc4a9641a&page=queryresults
[0m22:32:46.787049 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:0e6d03a0-15f6-468a-af9f-12adc4a9641a&page=queryresults
[0m22:32:46.800301 [debug] [Thread-2 (]: Database Error in model dim_user (models\dimensions\dim_user.sql)
  Unrecognized name: email_address; Did you mean ip_address? at [17:10]
  compiled code at target\run\glamira_analytics\models\dimensions\dim_user.sql
[0m22:32:46.801114 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd93f6ead-5875-4c49-a1c2-bc4360796cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F066B0DE0>]}
[0m22:32:46.802041 [error] [Thread-2 (]: 8 of 15 ERROR creating sql table model analytics_dev_dimensions.dim_user ....... [[31mERROR[0m in 1.65s]
[0m22:32:46.803657 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.dim_user
[0m22:32:46.804656 [debug] [Thread-2 (]: Began running node model.glamira_analytics.fact_sales_order_tt
[0m22:32:46.806055 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.dim_user' to be skipped because of status 'error'.  Reason: Database Error in model dim_user (models\dimensions\dim_user.sql)
  Unrecognized name: email_address; Did you mean ip_address? at [17:10]
  compiled code at target\run\glamira_analytics\models\dimensions\dim_user.sql.
[0m22:32:46.807157 [info ] [Thread-2 (]: 9 of 15 START sql incremental model analytics_dev_dimensions.fact_sales_order_tt  [RUN]
[0m22:32:46.809799 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_user, now model.glamira_analytics.fact_sales_order_tt)
[0m22:32:46.810627 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.fact_sales_order_tt
[0m22:32:46.815108 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.fact_sales_order_tt"
[0m22:32:46.820810 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.fact_sales_order_tt
[0m22:32:46.882000 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.fact_sales_order_tt"
[0m22:32:46.883830 [debug] [Thread-2 (]: On model.glamira_analytics.fact_sales_order_tt: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.fact_sales_order_tt"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
      
    
    

    
    OPTIONS()
    as (
      

WITH fact_sales_order__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
)

, fact_sales_order__rank AS (
    SELECT 
        *
        ,RANK() OVER (
            PARTITION BY order_id, product_id 
            ORDER BY ip_address, quantity DESC, time_stamp DESC, price DESC
        ) AS record_rank
    FROM fact_sales_order__source
)

, fact_sales_order__filtered AS (
    SELECT 
        *
    FROM fact_sales_order__rank
    WHERE record_rank = 1
)

, fact_sales_order__final AS (
    SELECT 
        -- Primary Key for Fact
        FARM_FINGERPRINT(CONCAT(order_id, product_id, CAST(time_stamp AS STRING))) AS sales_order_key
        
        -- Foreign Keys (Must match Dimension Keys)
        ,COALESCE(CAST(FORMAT_DATE('%Y%m%d', DATE(time_stamp)) AS INT64), -1) AS date_key
        ,COALESCE(FARM_FINGERPRINT(CAST(product_id AS STRING)), -1) AS product_key
        ,COALESCE(FARM_FINGERPRINT(CAST(location_id AS STRING)), -1) AS location_key
        ,COALESCE(FARM_FINGERPRINT(CAST(user_id AS STRING) || CAST(email_address AS STRING)), -1) AS user_key
        ,COALESCE(FARM_FINGERPRINT(CAST(store_id AS STRING)), -1) AS store_key
        
        -- Natural Keys (Optional, good for debugging)
        ,order_id
        ,ip_address
        
        -- Measures
        ,quantity AS order_qty
        ,price AS unit_price_amount
        ,line_total AS total_amount
        ,time_stamp AS order_timestamp
        ,CAST(local_time AS STRING) AS local_time_str
        
    FROM fact_sales_order__filtered
)

SELECT 
    *
FROM fact_sales_order__final
    );
  
[0m22:32:46.884657 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:32:46.988176 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:52021c6b-695b-48b9-bca8-22bf3c310c70&page=queryresults
[0m22:32:48.216845 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:cabf0f72-a620-429e-ae2c-1d940a02a54d&page=queryresults
[0m22:32:48.422933 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:cabf0f72-a620-429e-ae2c-1d940a02a54d&page=queryresults
[0m22:32:48.431941 [debug] [Thread-2 (]: Database Error in model fact_sales_order_tt (models\dimensions\fact_sales_order_tt.sql)
  Unrecognized name: price at [26:66]
  compiled code at target\run\glamira_analytics\models\dimensions\fact_sales_order_tt.sql
[0m22:32:48.432763 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd93f6ead-5875-4c49-a1c2-bc4360796cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F05E1AF90>]}
[0m22:32:48.433637 [error] [Thread-2 (]: 9 of 15 ERROR creating sql incremental model analytics_dev_dimensions.fact_sales_order_tt  [[31mERROR[0m in 1.62s]
[0m22:32:48.434581 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.fact_sales_order_tt
[0m22:32:48.435234 [debug] [Thread-2 (]: Began running node model.glamira_analytics.dim_fx_rate_usd
[0m22:32:48.436173 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.fact_sales_order_tt' to be skipped because of status 'error'.  Reason: Database Error in model fact_sales_order_tt (models\dimensions\fact_sales_order_tt.sql)
  Unrecognized name: price at [26:66]
  compiled code at target\run\glamira_analytics\models\dimensions\fact_sales_order_tt.sql.
[0m22:32:48.437011 [info ] [Thread-2 (]: 10 of 15 START sql table model analytics_dev_dimensions.dim_fx_rate_usd ........ [RUN]
[0m22:32:48.438210 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.fact_sales_order_tt, now model.glamira_analytics.dim_fx_rate_usd)
[0m22:32:48.439087 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.dim_fx_rate_usd
[0m22:32:48.445329 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.dim_fx_rate_usd"
[0m22:32:48.447370 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.dim_fx_rate_usd
[0m22:32:48.450988 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:32:49.257197 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.dim_fx_rate_usd"
[0m22:32:49.259070 [debug] [Thread-2 (]: On model.glamira_analytics.dim_fx_rate_usd: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_fx_rate_usd"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_fx_rate_usd`
      
    
    

    
    OPTIONS()
    as (
      WITH stg_fx AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
)

SELECT
    currency_code AS from_currency_code
    ,'USD' AS to_currency_code
    ,rate_to_usd
    ,rate_timestamp
FROM stg_fx
    );
  
[0m22:32:49.853326 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:ccaa112e-f78c-4aed-ba0c-543bc7340dc3&page=queryresults
[0m22:32:51.490018 [debug] [Thread-2 (]: SQL status: OK in 1.636 seconds
[0m22:32:51.492868 [debug] [Thread-3 (]: SQL status: OK in 5.729 seconds
[0m22:32:51.698727 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd93f6ead-5875-4c49-a1c2-bc4360796cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F05E1A990>]}
[0m22:32:51.699808 [info ] [Thread-2 (]: 10 of 15 OK created sql table model analytics_dev_dimensions.dim_fx_rate_usd ... [[32mCREATE TABLE (34.0 rows, 1.3 KiB processed)[0m in 3.26s]
[0m22:32:51.701086 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.dim_fx_rate_usd
[0m22:32:51.701832 [debug] [Thread-2 (]: Began running node model.glamira_analytics.dim_product
[0m22:32:51.702708 [info ] [Thread-2 (]: 11 of 15 START sql table model analytics_dev_dimensions.dim_product ............ [RUN]
[0m22:32:51.703662 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_fx_rate_usd, now model.glamira_analytics.dim_product)
[0m22:32:51.704302 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.dim_product
[0m22:32:51.708458 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.dim_product"
[0m22:32:51.710157 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.dim_product
[0m22:32:51.713100 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:32:51.732013 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd93f6ead-5875-4c49-a1c2-bc4360796cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F064EBF50>]}
[0m22:32:51.733357 [info ] [Thread-3 (]: 6 of 15 OK created sql table model analytics_dev_dimensions.dim_date ........... [[32mCREATE TABLE (43.0 rows, 5.7 GiB processed)[0m in 7.67s]
[0m22:32:51.735270 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_date
[0m22:32:51.736366 [debug] [Thread-3 (]: Began running node model.glamira_analytics.mart_overall
[0m22:32:51.737068 [info ] [Thread-3 (]: 12 of 15 SKIP relation analytics_dev.mart_overall .............................. [[33mSKIP[0m]
[0m22:32:51.737866 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.mart_overall
[0m22:32:51.796249 [debug] [Thread-4 (]: SQL status: OK in 6.035 seconds
[0m22:32:52.004877 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd93f6ead-5875-4c49-a1c2-bc4360796cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F06604D70>]}
[0m22:32:52.006133 [info ] [Thread-4 (]: 7 of 15 OK created sql table model analytics_dev_dimensions.dim_store .......... [[32mCREATE TABLE (57.0 rows, 5.7 GiB processed)[0m in 7.94s]
[0m22:32:52.007633 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.dim_store
[0m22:32:52.618944 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.dim_product"
[0m22:32:52.620728 [debug] [Thread-2 (]: On model.glamira_analytics.dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_product"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_product__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
)

, dim_product__null_handle AS (
    SELECT
        product_id,
        COALESCE(product_name, 'Undefined') AS product_name,
        COALESCE(product_url, 'Undefined') AS product_url,
        COALESCE(product_sku, 'Undefined') AS product_sku,
        COALESCE(product_type, 'Undefined') AS product_type,
        COALESCE(NULLIF(TRIM(category_name), ''), 'Undefined') AS category_name, 
        COALESCE(NULLIF(TRIM(collection_name), ''), 'Undefined') AS collection_name,
        min_price,
        max_price
    FROM dim_product__source 
)

, dim_product__add_key AS (
    SELECT
        FARM_FINGERPRINT(CAST(product_id AS STRING)) AS product_key,
        *
    FROM dim_product__null_handle
)

, dim_product__union_undefined AS (
    SELECT 
        * FROM dim_product__add_key

    UNION ALL

    SELECT 
        -1 AS product_key,
        -1 AS product_id,
        'Undefined' AS product_name,
        'Undefined' AS product_url,
        'Undefined' AS product_sku,
        'Undefined' AS product_type,
        'Undefined' AS category_name,
        'Undefined' AS collection_name,
        0 AS min_price,
        0 AS max_price
)

SELECT * FROM dim_product__union_undefined
    );
  
[0m22:32:52.862637 [debug] [Thread-1 (]: SQL status: OK in 5.874 seconds
[0m22:32:53.056868 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd93f6ead-5875-4c49-a1c2-bc4360796cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F064EAA50>]}
[0m22:32:53.057990 [info ] [Thread-1 (]: 5 of 15 OK created sql table model analytics_dev_dimensions.dim_location ....... [[32mCREATE TABLE (2.1m rows, 189.5 MiB processed)[0m in 8.99s]
[0m22:32:53.059713 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_location
[0m22:32:53.061131 [debug] [Thread-3 (]: Began running node model.glamira_analytics.mart_country
[0m22:32:53.061918 [info ] [Thread-3 (]: 13 of 15 SKIP relation analytics_dev.mart_country .............................. [[33mSKIP[0m]
[0m22:32:53.062925 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.mart_country
[0m22:32:53.233421 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:36e1eebb-fd0e-413c-b991-17b92c5d5ba8&page=queryresults
[0m22:32:55.281151 [debug] [Thread-2 (]: SQL status: OK in 2.047 seconds
[0m22:32:55.456213 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd93f6ead-5875-4c49-a1c2-bc4360796cd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F06686030>]}
[0m22:32:55.457328 [info ] [Thread-2 (]: 11 of 15 OK created sql table model analytics_dev_dimensions.dim_product ....... [[32mCREATE TABLE (18.6k rows, 2.7 MiB processed)[0m in 3.75s]
[0m22:32:55.458619 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.dim_product
[0m22:32:55.459901 [debug] [Thread-4 (]: Began running node model.glamira_analytics.mart_product
[0m22:32:55.460657 [debug] [Thread-1 (]: Began running node model.glamira_analytics.mart_product_type
[0m22:32:55.461352 [info ] [Thread-4 (]: 14 of 15 SKIP relation analytics_dev.mart_product .............................. [[33mSKIP[0m]
[0m22:32:55.462925 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.mart_product
[0m22:32:55.461994 [info ] [Thread-1 (]: 15 of 15 SKIP relation analytics_dev.mart_product_type ......................... [[33mSKIP[0m]
[0m22:32:55.464231 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.mart_product_type
[0m22:32:55.466723 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:32:55.467801 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:32:55.468342 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:32:55.468844 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:32:55.469300 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:32:55.469762 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_dimensions' was properly closed.
[0m22:32:55.470250 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev' was properly closed.
[0m22:32:55.470897 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_staging' was properly closed.
[0m22:32:55.471716 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_date' was properly closed.
[0m22:32:55.472359 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_location' was properly closed.
[0m22:32:55.472873 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_store' was properly closed.
[0m22:32:55.473517 [debug] [MainThread]: Connection 'model.glamira_analytics.dim_product' was properly closed.
[0m22:32:55.474581 [info ] [MainThread]: 
[0m22:32:55.475548 [info ] [MainThread]: Finished running 1 incremental model, 10 table models, 4 view models in 0 hours 0 minutes and 16.21 seconds (16.21s).
[0m22:32:55.480058 [debug] [MainThread]: Command end result
[0m22:32:55.518664 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:32:55.522007 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:32:55.535635 [debug] [MainThread]: Wrote artifact RunExecutionResult to D:\Project 7\glamira_analytics\target\run_results.json
[0m22:32:55.536173 [info ] [MainThread]: 
[0m22:32:55.536902 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m22:32:55.537668 [info ] [MainThread]: 
[0m22:32:55.538522 [error] [MainThread]: [31mFailure in model dim_user (models\dimensions\dim_user.sql)[0m
[0m22:32:55.539356 [error] [MainThread]:   Database Error in model dim_user (models\dimensions\dim_user.sql)
  Unrecognized name: email_address; Did you mean ip_address? at [17:10]
  compiled code at target\run\glamira_analytics\models\dimensions\dim_user.sql
[0m22:32:55.540051 [info ] [MainThread]: 
[0m22:32:55.540833 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\dimensions\dim_user.sql
[0m22:32:55.541503 [info ] [MainThread]: 
[0m22:32:55.542552 [error] [MainThread]: [31mFailure in model fact_sales_order_tt (models\dimensions\fact_sales_order_tt.sql)[0m
[0m22:32:55.543982 [error] [MainThread]:   Database Error in model fact_sales_order_tt (models\dimensions\fact_sales_order_tt.sql)
  Unrecognized name: price at [26:66]
  compiled code at target\run\glamira_analytics\models\dimensions\fact_sales_order_tt.sql
[0m22:32:55.544776 [info ] [MainThread]: 
[0m22:32:55.545526 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\dimensions\fact_sales_order_tt.sql
[0m22:32:55.546134 [info ] [MainThread]: 
[0m22:32:55.546664 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=2 SKIP=4 NO-OP=0 TOTAL=15
[0m22:32:55.547733 [debug] [MainThread]: Command `dbt run` failed at 22:32:55.547574 after 28.83 seconds
[0m22:32:55.548224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F05E1AE10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F05BBB5F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027F066DCE30>]}
[0m22:32:55.548663 [debug] [MainThread]: Flushing usage events
[0m22:32:59.369687 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:44:21.875676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B982A78EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B983BDFED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B983BDFB10>]}


============================== 22:44:21.882987 | 9f235707-1bfa-44f9-88f5-d0805f5f2c32 ==============================
[0m22:44:21.882987 [info ] [MainThread]: Running with dbt=1.11.2
[0m22:44:21.884162 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'no_print': 'None', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'printer_width': '80', 'write_json': 'True', 'empty': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'fail_fast': 'False', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'indirect_selection': 'eager', 'use_colors': 'True', 'invocation_command': 'dbt run --full-refresh', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m22:44:31.577754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B982F11BA0>]}
[0m22:44:31.656613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B993837570>]}
[0m22:44:31.657501 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m22:44:32.514675 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m22:44:32.730551 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m22:44:32.731373 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\dimensions\fact_sales_order_tt.sql
[0m22:44:32.731878 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\dimensions\dim_user.sql
[0m22:44:33.074685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A33A9750>]}
[0m22:44:33.188667 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:44:33.191969 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:44:33.235788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B99386B110>]}
[0m22:44:33.236505 [info ] [MainThread]: Found 15 models, 1 seed, 3 sources, 537 macros
[0m22:44:33.237177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A32DB850>]}
[0m22:44:33.240248 [info ] [MainThread]: 
[0m22:44:33.240984 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:44:33.241617 [info ] [MainThread]: 
[0m22:44:33.242742 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:44:33.250843 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:44:33.252216 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:44:33.253162 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:44:33.254208 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:44:33.255070 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:44:33.255967 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:44:35.444932 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev'
[0m22:44:35.445785 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:44:35.446524 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_staging'
[0m22:44:35.447725 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:44:35.448488 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_dimensions'
[0m22:44:35.450256 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:44:36.461308 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A360B040>]}
[0m22:44:36.462090 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:44:36.468618 [debug] [Thread-1 (]: Began running node model.glamira_analytics.stg_dim_location
[0m22:44:36.469287 [debug] [Thread-3 (]: Began running node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:44:36.469961 [debug] [Thread-4 (]: Began running node model.glamira_analytics.stg_fx_rate
[0m22:44:36.470660 [debug] [Thread-2 (]: Began running node model.glamira_analytics.stg_dim_product
[0m22:44:36.471425 [info ] [Thread-1 (]: 1 of 15 START sql view model analytics_dev_staging.stg_dim_location ............ [RUN]
[0m22:44:36.472108 [info ] [Thread-3 (]: 3 of 15 START sql view model analytics_dev_staging.stg_fact_sales_order_tt ..... [RUN]
[0m22:44:36.473079 [info ] [Thread-4 (]: 4 of 15 START sql view model analytics_dev_staging.stg_fx_rate ................. [RUN]
[0m22:44:36.475071 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_location'
[0m22:44:36.474105 [info ] [Thread-2 (]: 2 of 15 START sql view model analytics_dev_staging.stg_dim_product ............. [RUN]
[0m22:44:36.476061 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fact_sales_order_tt'
[0m22:44:36.476925 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fx_rate'
[0m22:44:36.477556 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.stg_dim_location
[0m22:44:36.478247 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_product'
[0m22:44:36.478939 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:44:36.479597 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.stg_fx_rate
[0m22:44:36.490131 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_location"
[0m22:44:36.491037 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.stg_dim_product
[0m22:44:36.497998 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m22:44:36.503029 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.stg_fx_rate"
[0m22:44:36.509166 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_product"
[0m22:44:36.510934 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.stg_dim_location
[0m22:44:36.553853 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_location"
[0m22:44:36.554830 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:44:36.555990 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.stg_dim_product
[0m22:44:36.556987 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.stg_fx_rate
[0m22:44:36.562405 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m22:44:36.567191 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_product"
[0m22:44:36.572469 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.stg_fx_rate"
[0m22:44:36.573589 [debug] [Thread-1 (]: On model.glamira_analytics.stg_dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_location"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
  OPTIONS()
  as WITH stg_dim_location__source AS (
    SELECT 
        DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`ip_location`
)

, stg_dim_location__rename AS (
    SELECT
        CAST(ip AS STRING) AS ip_address,
        CAST(country_code AS STRING) AS country_short_name,
        
        CAST(country_code AS STRING) AS country_long_name,
        
        CAST(region AS STRING) AS region_name,
        CAST(city AS STRING) AS city_name
    FROM stg_dim_location__source
    WHERE country_code <> '-' 
      AND country_code IS NOT NULL
)

, stg_dim_location__gen_key AS (
    SELECT
        FARM_FINGERPRINT(country_short_name || region_name || city_name) AS location_id,
        ip_address,
        country_short_name,
        country_long_name,
        region_name,
        city_name
    FROM stg_dim_location__rename
)

SELECT * FROM stg_dim_location__gen_key;


[0m22:44:36.574889 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m22:44:36.577560 [debug] [Thread-2 (]: On model.glamira_analytics.stg_dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_product"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
  OPTIONS()
  as WITH stg_dim_product__source AS (
    SELECT DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`product`
)

, stg_dim_product__rename AS (
    SELECT
        SAFE_CAST(product_id AS INT64) AS product_id,
        CAST(name AS STRING) AS product_name,
        CAST(url AS STRING) AS product_url,
        CAST(sku AS STRING) AS product_sku, 
        CAST(product_type AS STRING) AS product_type,
        CAST(category_name AS STRING) AS category_name,
        CAST(collection AS STRING) AS collection_name,
        SAFE_CAST(min_price AS NUMERIC) AS min_price,
        SAFE_CAST(max_price AS NUMERIC) AS max_price
    FROM stg_dim_product__source
    WHERE product_id IS NOT NULL
)

SELECT * FROM stg_dim_product__rename;


[0m22:44:36.579274 [debug] [Thread-3 (]: On model.glamira_analytics.stg_fact_sales_order_tt: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fact_sales_order_tt"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
  OPTIONS()
  as WITH stg_fact_sales_order_tt__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`raw_layer`.`summary`
    WHERE collection = 'checkout_success'
)

/* 1. Remove failed URLs */
, stg_fact_sales_order_tt__remove_url_fail AS (
    SELECT *
    FROM stg_fact_sales_order_tt__source 
    WHERE current_url NOT LIKE 'file://%'
)

/* 2. Get Location Data (Since summary table is missing it) */
, stg_fact_sales_order_tt__location AS (
    -- We select distinct IPs to avoid duplicate rows during the join
    SELECT DISTINCT 
        ip,
        country_code,
        region,
        city
    FROM `stone-album-475912-b9`.`raw_layer`.`ip_location`
    WHERE country_code IS NOT NULL
)

/* 3. Join Summary with Location */
, stg_fact_sales_order_tt__joined AS (
    SELECT 
        s.*,
        l.country_code,
        l.region,
        l.city
    FROM stg_fact_sales_order_tt__remove_url_fail s
    LEFT JOIN stg_fact_sales_order_tt__location l
        ON s.ip = l.ip
)

/* 4. Unnest cart_products */
, stg_fact_sales_order_tt__unnest AS (
    SELECT 
        s.*, 
        cp
    FROM stg_fact_sales_order_tt__joined s
    CROSS JOIN UNNEST(s.cart_products) AS cp
)

, stg_fact_sales_order_tt__rename AS (
    SELECT
        SAFE_CAST(REGEXP_REPLACE(CAST(s.order_id AS STRING), r'\..*', '') AS INT64) AS order_id,
        
        1 AS quantity,

        SAFE_CAST(REGEXP_REPLACE(CAST(cp.product_id AS STRING), r'\..*', '') AS INT64) AS product_id,
        SAFE_CAST(REGEXP_REPLACE(CAST(s.user_id_db AS STRING), r'\..*', '') AS INT64) AS user_id,
        SAFE_CAST(REGEXP_REPLACE(CAST(s.store_id AS STRING), r'\..*', '') AS INT64) AS store_id,
        
        TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64)) AS time_stamp,
        DATETIME(TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64))) AS local_time,
        
        CASE 
            WHEN s.currency IN ('USD', 'USD $') THEN 'USD'
            WHEN s.currency = 'HKD $'    THEN 'HKD'
            WHEN s.currency = 'NZD $'    THEN 'NZD'
            WHEN s.currency = 'MXN $'    THEN 'MXN'
            WHEN s.currency = 'Kƒç'       THEN 'CZK'
            WHEN s.currency = 'Ft'       THEN 'HUF'
            WHEN s.currency = 'z≈Ç'       THEN 'PLN'
            WHEN s.currency = '‚Çπ'        THEN 'INR'
            WHEN s.currency = '–ª–≤.'      THEN 'BGN'
            WHEN s.currency = '‚Ç´'        THEN 'VND'
            WHEN s.currency = '‚Ç±'        THEN 'PHP'
            WHEN s.currency = '‚Ç≤'        THEN 'PYG'
            WHEN s.currency = 'CRC ‚Ç°'    THEN 'CRC'
            WHEN s.currency = 'COP $'    THEN 'COP'
            WHEN s.currency = 'BOB Bs'   THEN 'BOB'
            WHEN s.currency = 'GTQ Q'    THEN 'GTQ'
            WHEN s.currency = 'PEN S/.'  THEN 'PEN'
            WHEN s.currency = 'DOP $'    THEN 'DOP'
            WHEN s.currency = 'CLP'      THEN 'CLP'
            WHEN s.currency = 'Lei'      THEN 'RON'
            WHEN s.currency = 'UYU'      THEN 'UYU'
            WHEN s.currency = 'din.'     THEN 'RSD'
            WHEN s.currency = 'kn'       THEN 'HRK'
            WHEN s.currency = 'ÿØ.ŸÉ.'     THEN 'KWD'
            WHEN s.currency = 'CHF'      THEN 'CHF'
            WHEN s.currency = 'kr'       THEN 'SEK'
            WHEN s.currency = '‚Ç¨'        THEN 'EUR'
            WHEN s.currency = '¬£'        THEN 'GBP'
            WHEN s.currency = 'AU$'      THEN 'AUD'
            WHEN s.currency = 'CA$'      THEN 'CAD'
            WHEN s.currency = '¬•'        THEN 'JPY'
            ELSE 'USD' 
        END AS currency_code,

        CAST(cp.price * 1 AS NUMERIC) AS line_total,
        
        s.ip AS ip_address,

        FARM_FINGERPRINT(CONCAT(
            CAST(s.country_code AS STRING), 
            CAST(s.region AS STRING), 
            CAST(s.city AS STRING)
        )) AS location_id

    FROM stg_fact_sales_order_tt__unnest s
)

SELECT * FROM stg_fact_sales_order_tt__rename;


[0m22:44:36.580412 [debug] [Thread-4 (]: On model.glamira_analytics.stg_fx_rate: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fx_rate"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
  OPTIONS()
  as WITH source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev`.`exchange_rate_usd`
)

, renamed AS (
    SELECT
        CAST(currency AS STRING) AS currency_code
        ,CAST(rate_to_usd AS NUMERIC) AS rate_to_usd
        ,CAST(as_of_gmt AS TIMESTAMP) AS rate_timestamp
    FROM source
)

SELECT * FROM renamed;


[0m22:44:36.581654 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:44:36.582809 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:44:36.583708 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:44:38.195631 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:c97d261a-11ee-45ce-829c-9dda5c0267fd&page=queryresults
[0m22:44:38.196592 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:586930aa-6af2-485f-9fb0-387a1760ff77&page=queryresults
[0m22:44:38.197381 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:41ac4ce8-d7b1-4776-a648-0568339bce37&page=queryresults
[0m22:44:38.398175 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:168a38a4-3a86-43ad-9654-0a1eda713680&page=queryresults
[0m22:44:38.596968 [debug] [Thread-4 (]: SQL status: OK in 0.399 seconds
[0m22:44:38.598573 [debug] [Thread-1 (]: SQL status: OK in 0.400 seconds
[0m22:44:38.722722 [debug] [Thread-2 (]: SQL status: OK in 0.524 seconds
[0m22:44:38.729344 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A359E510>]}
[0m22:44:38.729982 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A334B540>]}
[0m22:44:38.731437 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B982EB0190>]}
[0m22:44:38.730992 [info ] [Thread-1 (]: 1 of 15 OK created sql view model analytics_dev_staging.stg_dim_location ....... [[32mCREATE VIEW (0 processed)[0m in 2.24s]
[0m22:44:38.732664 [info ] [Thread-4 (]: 4 of 15 OK created sql view model analytics_dev_staging.stg_fx_rate ............ [[32mCREATE VIEW (0 processed)[0m in 2.25s]
[0m22:44:38.734901 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.stg_dim_location
[0m22:44:38.733690 [info ] [Thread-2 (]: 2 of 15 OK created sql view model analytics_dev_staging.stg_dim_product ........ [[32mCREATE VIEW (0 processed)[0m in 2.25s]
[0m22:44:38.736096 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.stg_fx_rate
[0m22:44:38.737324 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.stg_dim_product
[0m22:44:38.738129 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_location
[0m22:44:38.739605 [debug] [Thread-4 (]: Began running node model.glamira_analytics.dim_fx_rate_usd
[0m22:44:38.739096 [info ] [Thread-1 (]: 5 of 15 START sql table model analytics_dev_dimensions.dim_location ............ [RUN]
[0m22:44:38.741722 [debug] [Thread-2 (]: Began running node model.glamira_analytics.dim_product
[0m22:44:38.740862 [info ] [Thread-4 (]: 6 of 15 START sql table model analytics_dev_dimensions.dim_fx_rate_usd ......... [RUN]
[0m22:44:38.742852 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_dim_location, now model.glamira_analytics.dim_location)
[0m22:44:38.744531 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_fx_rate, now model.glamira_analytics.dim_fx_rate_usd)
[0m22:44:38.743784 [info ] [Thread-2 (]: 7 of 15 START sql table model analytics_dev_dimensions.dim_product ............. [RUN]
[0m22:44:38.745558 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.dim_location
[0m22:44:38.746260 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.dim_fx_rate_usd
[0m22:44:38.747261 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_dim_product, now model.glamira_analytics.dim_product)
[0m22:44:38.751596 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.dim_location"
[0m22:44:38.756409 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.dim_fx_rate_usd"
[0m22:44:38.757294 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.dim_product
[0m22:44:38.761573 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.dim_product"
[0m22:44:38.762991 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.dim_location
[0m22:44:38.770720 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.dim_fx_rate_usd
[0m22:44:38.783192 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:44:38.786673 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:44:38.788165 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.dim_product
[0m22:44:38.793280 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:44:38.915146 [debug] [Thread-3 (]: SQL status: OK in 0.515 seconds
[0m22:44:38.921239 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A3CA3ED0>]}
[0m22:44:38.922361 [info ] [Thread-3 (]: 3 of 15 OK created sql view model analytics_dev_staging.stg_fact_sales_order_tt  [[32mCREATE VIEW (0 processed)[0m in 2.45s]
[0m22:44:38.923882 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:44:38.925124 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_date
[0m22:44:38.925893 [info ] [Thread-3 (]: 8 of 15 START sql table model analytics_dev_dimensions.dim_date ................ [RUN]
[0m22:44:38.926775 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_fact_sales_order_tt, now model.glamira_analytics.dim_date)
[0m22:44:38.927452 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.dim_date
[0m22:44:38.931386 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.dim_date"
[0m22:44:38.932838 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.dim_date
[0m22:44:38.935895 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:44:39.750695 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.dim_fx_rate_usd"
[0m22:44:39.753209 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.dim_product"
[0m22:44:39.755496 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.dim_location"
[0m22:44:39.757249 [debug] [Thread-4 (]: On model.glamira_analytics.dim_fx_rate_usd: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_fx_rate_usd"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_fx_rate_usd`
      
    
    

    
    OPTIONS()
    as (
      WITH stg_fx AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
)

SELECT
    currency_code AS from_currency_code
    ,'USD' AS to_currency_code
    ,rate_to_usd
    ,rate_timestamp
FROM stg_fx
    );
  
[0m22:44:39.758794 [debug] [Thread-2 (]: On model.glamira_analytics.dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_product"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_product__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
)

, dim_product__null_handle AS (
    SELECT
        product_id,
        COALESCE(product_name, 'Undefined') AS product_name,
        COALESCE(product_url, 'Undefined') AS product_url,
        COALESCE(product_sku, 'Undefined') AS product_sku,
        COALESCE(product_type, 'Undefined') AS product_type,
        COALESCE(NULLIF(TRIM(category_name), ''), 'Undefined') AS category_name, 
        COALESCE(NULLIF(TRIM(collection_name), ''), 'Undefined') AS collection_name,
        min_price,
        max_price
    FROM dim_product__source 
)

, dim_product__add_key AS (
    SELECT
        FARM_FINGERPRINT(CAST(product_id AS STRING)) AS product_key,
        *
    FROM dim_product__null_handle
)

, dim_product__union_undefined AS (
    SELECT 
        * FROM dim_product__add_key

    UNION ALL

    SELECT 
        -1 AS product_key,
        -1 AS product_id,
        'Undefined' AS product_name,
        'Undefined' AS product_url,
        'Undefined' AS product_sku,
        'Undefined' AS product_type,
        'Undefined' AS category_name,
        'Undefined' AS collection_name,
        0 AS min_price,
        0 AS max_price
)

SELECT * FROM dim_product__union_undefined
    );
  
[0m22:44:39.761432 [debug] [Thread-1 (]: On model.glamira_analytics.dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_location"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_location`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_location__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
)

, dim_location__null_handle AS (
    SELECT
        location_id
        ,ip_address
        ,COALESCE(country_short_name, 'Undefined') AS country_code
        ,COALESCE(country_long_name, 'Undefined') AS country_name
        ,COALESCE(region_name, 'Undefined') AS region_name
        ,COALESCE(city_name, 'Undefined') AS city_name
    FROM dim_location__source 
)

, dim_location__add_key AS (
    SELECT
        -- Surrogate Key
        FARM_FINGERPRINT(CAST(location_id AS STRING)) AS location_key
        -- Natural Key
        ,CAST(location_id AS STRING) AS location_id
        ,ip_address
        ,country_code
        ,country_name
        ,region_name
        ,city_name
    FROM dim_location__null_handle
)

, dim_location__union_undefined AS (
    SELECT 
        * FROM dim_location__add_key

    UNION ALL

    SELECT 
        -1 AS location_key
        ,'-1' AS location_id
        ,'Undefined' AS ip_address
        ,'Undefined' AS country_code
        ,'Undefined' AS country_name
        ,'Undefined' AS region_name
        ,'Undefined' AS city_name
)

SELECT 
    *
FROM dim_location__union_undefined
    );
  
[0m22:44:39.928434 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.dim_date"
[0m22:44:39.930151 [debug] [Thread-3 (]: On model.glamira_analytics.dim_date: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_date"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_date`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_date__source AS (
    SELECT DISTINCT 
        DATE(time_stamp) AS full_date
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
    WHERE time_stamp IS NOT NULL
)

, dim_date__format AS (
    SELECT
        CAST(FORMAT_DATE('%Y%m%d', full_date) AS INT64) AS date_key
        ,full_date AS date_day
        ,FORMAT_DATE('%A', full_date) AS day_name
        ,CASE
            WHEN FORMAT_DATE('%A', full_date) IN ('Saturday', 'Sunday') THEN TRUE
            ELSE FALSE
        END AS is_weekend
        ,CAST(FORMAT_DATE('%d', full_date) AS INT64) AS day_of_month
        ,FORMAT_DATE('%Y-%m', full_date) AS year_month
        ,CAST(FORMAT_DATE('%m', full_date) AS INT64) AS month_of_year
        ,CAST(FORMAT_DATE('%j', full_date) AS INT64) AS day_of_year
        ,CAST(FORMAT_DATE('%W', full_date) AS INT64) AS week_of_year
        ,CAST(FORMAT_DATE('%Q', full_date) AS INT64) AS quarter_of_year
        ,CAST(FORMAT_DATE('%Y', full_date) AS INT64) AS year_number
    FROM dim_date__source
)

SELECT 
    *
FROM dim_date__format
ORDER BY date_key
    );
  
[0m22:44:40.437830 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:6a903c03-8d68-4cec-a5b4-adec8046b41c&page=queryresults
[0m22:44:40.438678 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:0a7c6f3d-dfa7-45d7-bc02-e6765a5ad910&page=queryresults
[0m22:44:40.439515 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:9c7ccc61-204c-4af9-8bce-f6ba890a3635&page=queryresults
[0m22:44:40.744392 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:0a33a81e-1e7a-4fb9-af5f-557f898c40c4&page=queryresults
[0m22:44:42.485650 [debug] [Thread-2 (]: SQL status: OK in 2.045 seconds
[0m22:44:42.897968 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A3448B40>]}
[0m22:44:42.899085 [info ] [Thread-2 (]: 7 of 15 OK created sql table model analytics_dev_dimensions.dim_product ........ [[32mCREATE TABLE (18.6k rows, 2.7 MiB processed)[0m in 4.15s]
[0m22:44:42.901247 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.dim_product
[0m22:44:42.902080 [debug] [Thread-2 (]: Began running node model.glamira_analytics.dim_store
[0m22:44:42.902923 [info ] [Thread-2 (]: 9 of 15 START sql table model analytics_dev_dimensions.dim_store ............... [RUN]
[0m22:44:42.903809 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_product, now model.glamira_analytics.dim_store)
[0m22:44:42.904455 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.dim_store
[0m22:44:42.908523 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.dim_store"
[0m22:44:42.909838 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.dim_store
[0m22:44:42.921776 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:44:43.728026 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.dim_store"
[0m22:44:43.729662 [debug] [Thread-2 (]: On model.glamira_analytics.dim_store: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_store"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_store`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_store__source AS (
    SELECT DISTINCT 
        store_id
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
    WHERE store_id IS NOT NULL
)

, dim_store__add_key AS (
    SELECT
        FARM_FINGERPRINT(CAST(store_id AS STRING)) AS store_key
        ,CAST(store_id AS STRING) AS store_id
        ,CONCAT('Store ', CAST(store_id AS STRING)) AS store_name
    FROM dim_store__source 
)

SELECT 
    *
FROM dim_store__add_key
ORDER BY store_id
    );
  
[0m22:44:43.814932 [debug] [Thread-4 (]: SQL status: OK in 3.374 seconds
[0m22:44:44.124513 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A3C6F830>]}
[0m22:44:44.125606 [info ] [Thread-4 (]: 6 of 15 OK created sql table model analytics_dev_dimensions.dim_fx_rate_usd .... [[32mCREATE TABLE (34.0 rows, 1.3 KiB processed)[0m in 5.38s]
[0m22:44:44.128122 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.dim_fx_rate_usd
[0m22:44:44.128789 [debug] [Thread-4 (]: Began running node model.glamira_analytics.dim_user
[0m22:44:44.129549 [info ] [Thread-4 (]: 10 of 15 START sql table model analytics_dev_dimensions.dim_user ............... [RUN]
[0m22:44:44.130359 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_fx_rate_usd, now model.glamira_analytics.dim_user)
[0m22:44:44.130990 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.dim_user
[0m22:44:44.134489 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.dim_user"
[0m22:44:44.135789 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.dim_user
[0m22:44:44.139544 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.dim_user"
[0m22:44:44.140907 [debug] [Thread-4 (]: On model.glamira_analytics.dim_user: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_user"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_user`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_user__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
)

, dim_user__dedup AS (
    SELECT
        user_id,
        -- We select the most recent location for the user
        ARRAY_AGG(location_id ORDER BY time_stamp DESC LIMIT 1)[OFFSET(0)] AS location_id,
        MAX(time_stamp) AS last_active_at
    FROM dim_user__source
    WHERE user_id IS NOT NULL
    GROUP BY user_id
)

SELECT 
    user_id,
    location_id,
    last_active_at
FROM dim_user__dedup
    );
  
[0m22:44:44.141555 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:44:44.735395 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:cca837c3-e0c4-48db-b549-ff29319e0cd7&page=queryresults
[0m22:44:45.042208 [debug] [Thread-1 (]: SQL status: OK in 4.601 seconds
[0m22:44:45.353599 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A343E450>]}
[0m22:44:45.354682 [info ] [Thread-1 (]: 5 of 15 OK created sql table model analytics_dev_dimensions.dim_location ....... [[32mCREATE TABLE (2.1m rows, 189.5 MiB processed)[0m in 6.61s]
[0m22:44:45.355959 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_location
[0m22:44:45.356662 [debug] [Thread-1 (]: Began running node model.glamira_analytics.fact_sales_order_tt
[0m22:44:45.357549 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics_dev_dimensions.fact_sales_order_tt .... [RUN]
[0m22:44:45.358503 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_location, now model.glamira_analytics.fact_sales_order_tt)
[0m22:44:45.359170 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.fact_sales_order_tt
[0m22:44:45.363022 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.fact_sales_order_tt"
[0m22:44:45.364444 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.fact_sales_order_tt
[0m22:44:45.368674 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.fact_sales_order_tt"
[0m22:44:45.370256 [debug] [Thread-1 (]: On model.glamira_analytics.fact_sales_order_tt: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.fact_sales_order_tt"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
      
    
    

    
    OPTIONS()
    as (
      WITH fact_sales_order_tt__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
)

, fact_sales_order_tt__fields AS (
    SELECT
        order_id,
        product_id,
        user_id,
        store_id,
        location_id,
        time_stamp,
        local_time,
        currency_code,
        quantity,
        -- FIX: Use line_total instead of price
        line_total AS sales_amount,
        line_total AS gross_revenue
    FROM fact_sales_order_tt__source
)

SELECT * FROM fact_sales_order_tt__fields
    );
  
[0m22:44:45.371074 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:44:45.390621 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:b4502b1c-844d-4a91-a0f4-9ba8ad2fa5ce&page=queryresults
[0m22:44:46.065485 [debug] [Thread-3 (]: SQL status: OK in 5.320 seconds
[0m22:44:46.273917 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:666dd662-86d4-41e4-8d3c-6ece2c2367e7&page=queryresults
[0m22:44:46.288647 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A3D609B0>]}
[0m22:44:46.289749 [info ] [Thread-3 (]: 8 of 15 OK created sql table model analytics_dev_dimensions.dim_date ........... [[32mCREATE TABLE (43.0 rows, 5.7 GiB processed)[0m in 7.36s]
[0m22:44:46.291005 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_date
[0m22:44:50.062657 [debug] [Thread-4 (]: SQL status: OK in 4.671 seconds
[0m22:44:50.065780 [debug] [Thread-2 (]: SQL status: OK in 5.330 seconds
[0m22:44:50.067125 [debug] [Thread-1 (]: SQL status: OK in 3.792 seconds
[0m22:44:50.270750 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A3465C10>]}
[0m22:44:50.271843 [info ] [Thread-2 (]: 9 of 15 OK created sql table model analytics_dev_dimensions.dim_store .......... [[32mCREATE TABLE (57.0 rows, 5.7 GiB processed)[0m in 7.37s]
[0m22:44:50.273118 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.dim_store
[0m22:44:50.398959 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A368F110>]}
[0m22:44:50.400072 [info ] [Thread-4 (]: 10 of 15 OK created sql table model analytics_dev_dimensions.dim_user .......... [[32mCREATE TABLE (8.7k rows, 5.7 GiB processed)[0m in 6.27s]
[0m22:44:50.402044 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.dim_user
[0m22:44:50.406265 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A3D60FB0>]}
[0m22:44:50.407388 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics_dev_dimensions.fact_sales_order_tt  [[32mCREATE TABLE (31.4k rows, 6.0 GiB processed)[0m in 5.05s]
[0m22:44:50.408706 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.fact_sales_order_tt
[0m22:44:50.410036 [debug] [Thread-3 (]: Began running node model.glamira_analytics.mart_country
[0m22:44:50.410926 [debug] [Thread-4 (]: Began running node model.glamira_analytics.mart_product
[0m22:44:50.411792 [debug] [Thread-1 (]: Began running node model.glamira_analytics.mart_product_type
[0m22:44:50.412569 [debug] [Thread-2 (]: Began running node model.glamira_analytics.mart_overall
[0m22:44:50.413495 [info ] [Thread-3 (]: 12 of 15 START sql table model analytics_dev.mart_country ...................... [RUN]
[0m22:44:50.414627 [info ] [Thread-4 (]: 14 of 15 START sql table model analytics_dev.mart_product ...................... [RUN]
[0m22:44:50.415747 [info ] [Thread-1 (]: 15 of 15 START sql table model analytics_dev.mart_product_type ................. [RUN]
[0m22:44:50.418117 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_date, now model.glamira_analytics.mart_country)
[0m22:44:50.416697 [info ] [Thread-2 (]: 13 of 15 START sql table model analytics_dev.mart_overall ...................... [RUN]
[0m22:44:50.419293 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_user, now model.glamira_analytics.mart_product)
[0m22:44:50.419908 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.fact_sales_order_tt, now model.glamira_analytics.mart_product_type)
[0m22:44:50.420590 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.mart_country
[0m22:44:50.421619 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_store, now model.glamira_analytics.mart_overall)
[0m22:44:50.422560 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.mart_product
[0m22:44:50.423180 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.mart_product_type
[0m22:44:50.429541 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.mart_country"
[0m22:44:50.430262 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.mart_overall
[0m22:44:50.438292 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.mart_product"
[0m22:44:50.445390 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.mart_product_type"
[0m22:44:50.452044 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.mart_overall"
[0m22:44:50.459066 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.mart_overall
[0m22:44:50.463895 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.mart_overall"
[0m22:44:50.465446 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.mart_product
[0m22:44:50.466859 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.mart_country
[0m22:44:50.468122 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.mart_product_type
[0m22:44:50.472091 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.mart_product"
[0m22:44:50.476948 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.mart_country"
[0m22:44:50.481402 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.mart_product_type"
[0m22:44:50.482609 [debug] [Thread-2 (]: On model.glamira_analytics.mart_overall: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.mart_overall"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev`.`mart_overall`
      
    
    

    
    OPTIONS()
    as (
      

WITH fct AS (
    SELECT
        sales_order_key
        ,order_id
        ,date_key
        ,user_key
        ,total_amount -- was line_total_usd
    FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
)

, dim_date AS (
    SELECT
        date_key
        ,date_day
        ,year_month
    FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_date`
)

SELECT
    dim_date.year_month
    ,dim_date.date_day AS report_date
    ,COUNT(DISTINCT fct.order_id) AS total_orders
    ,ROUND(SUM(fct.total_amount), 2) AS total_revenue
    ,COUNT(DISTINCT fct.user_key) AS total_users
FROM fct
LEFT JOIN dim_date
    ON fct.date_key = dim_date.date_key
GROUP BY 1, 2
ORDER BY 2
    );
  
[0m22:44:50.484368 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:44:50.487051 [debug] [Thread-4 (]: On model.glamira_analytics.mart_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.mart_product"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev`.`mart_product`
      
    
    

    
    OPTIONS()
    as (
      

WITH fct AS (
    SELECT
        sales_order_key
        ,order_id
        ,product_key
        ,date_key
        ,user_key
        ,total_amount
    FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
)

, dim_date AS (
    SELECT
        date_key
        ,date_day
        ,year_month
    FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_date`
)

, dim_product AS (
    SELECT
        product_key
        ,product_id
        ,product_name
    FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
)

SELECT
    dim_date.year_month
    ,dim_date.date_day AS report_date
    ,dim_product.product_id
    ,dim_product.product_name
    ,COUNT(DISTINCT fct.order_id) AS total_orders
    ,ROUND(SUM(fct.total_amount), 2) AS total_revenue
    ,COUNT(DISTINCT fct.user_key) AS total_users
FROM fct
LEFT JOIN dim_date
    ON fct.date_key = dim_date.date_key
LEFT JOIN dim_product
    ON fct.product_key = dim_product.product_key
GROUP BY 1, 2, 3, 4
ORDER BY 2 DESC, 6 DESC
    );
  
[0m22:44:50.488267 [debug] [Thread-1 (]: On model.glamira_analytics.mart_product_type: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.mart_product_type"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev`.`mart_product_type`
      
    
    

    
    OPTIONS()
    as (
      

WITH fct AS (
    SELECT
        sales_order_key
        ,order_id
        ,product_key
        ,date_key
        ,user_key
        ,total_amount
    FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
)

, dim_date AS (
    SELECT
        date_key
        ,date_day
        ,year_month
    FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_date`
)

, dim_product AS (
    SELECT
        product_key
        ,product_type_name -- Renamed in Dim layer
    FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
)

SELECT
    dim_date.year_month
    ,dim_date.date_day AS report_date
    ,dim_product.product_type_name
    ,COUNT(DISTINCT fct.order_id) AS total_orders
    ,ROUND(SUM(fct.total_amount), 2) AS total_revenue
    ,COUNT(DISTINCT fct.user_key) AS total_users
FROM fct
LEFT JOIN dim_date
    ON fct.date_key = dim_date.date_key
LEFT JOIN dim_product
    ON fct.product_key = dim_product.product_key
GROUP BY 1, 2, 3
ORDER BY 2 DESC, 5 DESC
    );
  
[0m22:44:50.489132 [debug] [Thread-3 (]: On model.glamira_analytics.mart_country: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.mart_country"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev`.`mart_country`
      
    
    

    
    OPTIONS()
    as (
      

WITH fct AS (
    SELECT
        sales_order_key
        ,order_id
        ,location_key
        ,date_key
        ,user_key
        ,total_amount
    FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
)

, dim_date AS (
    SELECT
        date_key
        ,date_day
        ,year_month
    FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_date`
)

, dim_location AS (
    SELECT
        location_key
        ,country_name -- Renamed from country_long_name in Dim layer
    FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_location`
)

SELECT
    dim_date.year_month
    ,dim_date.date_day AS report_date
    ,dim_location.country_name
    ,COUNT(DISTINCT fct.order_id) AS total_orders
    ,ROUND(SUM(fct.total_amount), 2) AS total_revenue
    ,COUNT(DISTINCT fct.user_key) AS total_users
FROM fct
LEFT JOIN dim_date
    ON fct.date_key = dim_date.date_key
LEFT JOIN dim_location
    ON fct.location_key = dim_location.location_key
GROUP BY 1, 2, 3
ORDER BY 2 DESC, 5 DESC
    );
  
[0m22:44:50.489848 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:44:50.490846 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:44:50.491424 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:44:51.694113 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:87ac0db6-ed8b-4802-b292-e6e7a6a44846&page=queryresults
[0m22:44:51.696364 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:fdff1684-8f46-4f73-8568-372544dc5584&page=queryresults
[0m22:44:51.698357 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:2fa9f5c8-96e4-4621-bde6-94cdce5b9175&page=queryresults
[0m22:44:51.700126 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:c6d80fa8-c631-4238-af0f-946c799c7bde&page=queryresults
[0m22:44:51.901383 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:fdff1684-8f46-4f73-8568-372544dc5584&page=queryresults
[0m22:44:51.902538 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:2fa9f5c8-96e4-4621-bde6-94cdce5b9175&page=queryresults
[0m22:44:51.907613 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:c6d80fa8-c631-4238-af0f-946c799c7bde&page=queryresults
[0m22:44:51.908555 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:87ac0db6-ed8b-4802-b292-e6e7a6a44846&page=queryresults
[0m22:44:51.948941 [debug] [Thread-1 (]: Database Error in model mart_product_type (models\marts\mart_product_type.sql)
  Unrecognized name: sales_order_key at [18:9]
  compiled code at target\run\glamira_analytics\models\marts\mart_product_type.sql
[0m22:44:51.950709 [debug] [Thread-3 (]: Database Error in model mart_country (models\marts\mart_country.sql)
  Unrecognized name: sales_order_key at [18:9]
  compiled code at target\run\glamira_analytics\models\marts\mart_country.sql
[0m22:44:51.952578 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A3EBA150>]}
[0m22:44:51.954568 [debug] [Thread-2 (]: Database Error in model mart_overall (models\marts\mart_overall.sql)
  Unrecognized name: sales_order_key at [18:9]
  compiled code at target\run\glamira_analytics\models\marts\mart_overall.sql
[0m22:44:51.955505 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A3EBA450>]}
[0m22:44:51.961483 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A3EBA150>]}
[0m22:44:51.960375 [error] [Thread-1 (]: 15 of 15 ERROR creating sql table model analytics_dev.mart_product_type ........ [[31mERROR[0m in 1.53s]
[0m22:44:51.962995 [debug] [Thread-4 (]: Database Error in model mart_product (models\marts\mart_product.sql)
  Unrecognized name: sales_order_key at [18:9]
  compiled code at target\run\glamira_analytics\models\marts\mart_product.sql
[0m22:44:51.964090 [error] [Thread-3 (]: 12 of 15 ERROR creating sql table model analytics_dev.mart_country ............. [[31mERROR[0m in 1.54s]
[0m22:44:51.966140 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.mart_product_type
[0m22:44:51.965000 [error] [Thread-2 (]: 13 of 15 ERROR creating sql table model analytics_dev.mart_overall ............. [[31mERROR[0m in 1.54s]
[0m22:44:51.967292 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f235707-1bfa-44f9-88f5-d0805f5f2c32', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A3EBA150>]}
[0m22:44:51.968887 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.mart_country
[0m22:44:51.970129 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.mart_product_type' to be skipped because of status 'error'.  Reason: Database Error in model mart_product_type (models\marts\mart_product_type.sql)
  Unrecognized name: sales_order_key at [18:9]
  compiled code at target\run\glamira_analytics\models\marts\mart_product_type.sql.
[0m22:44:51.971057 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.mart_overall
[0m22:44:51.972013 [error] [Thread-4 (]: 14 of 15 ERROR creating sql table model analytics_dev.mart_product ............. [[31mERROR[0m in 1.55s]
[0m22:44:51.974204 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.mart_country' to be skipped because of status 'error'.  Reason: Database Error in model mart_country (models\marts\mart_country.sql)
  Unrecognized name: sales_order_key at [18:9]
  compiled code at target\run\glamira_analytics\models\marts\mart_country.sql.
[0m22:44:51.975366 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.mart_product
[0m22:44:51.976252 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.mart_overall' to be skipped because of status 'error'.  Reason: Database Error in model mart_overall (models\marts\mart_overall.sql)
  Unrecognized name: sales_order_key at [18:9]
  compiled code at target\run\glamira_analytics\models\marts\mart_overall.sql.
[0m22:44:51.977196 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.mart_product' to be skipped because of status 'error'.  Reason: Database Error in model mart_product (models\marts\mart_product.sql)
  Unrecognized name: sales_order_key at [18:9]
  compiled code at target\run\glamira_analytics\models\marts\mart_product.sql.
[0m22:44:51.979270 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:44:51.980818 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:44:51.981557 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:44:51.982110 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:44:51.982639 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:44:51.983231 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev' was properly closed.
[0m22:44:51.983803 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_staging' was properly closed.
[0m22:44:51.984456 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_dimensions' was properly closed.
[0m22:44:51.985140 [debug] [MainThread]: Connection 'model.glamira_analytics.mart_product_type' was properly closed.
[0m22:44:51.985772 [debug] [MainThread]: Connection 'model.glamira_analytics.mart_country' was properly closed.
[0m22:44:51.986316 [debug] [MainThread]: Connection 'model.glamira_analytics.mart_product' was properly closed.
[0m22:44:51.986795 [debug] [MainThread]: Connection 'model.glamira_analytics.mart_overall' was properly closed.
[0m22:44:51.987560 [info ] [MainThread]: 
[0m22:44:51.988279 [info ] [MainThread]: Finished running 11 table models, 4 view models in 0 hours 0 minutes and 18.74 seconds (18.74s).
[0m22:44:51.993771 [debug] [MainThread]: Command end result
[0m22:44:52.033632 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:44:52.037546 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:44:52.046287 [debug] [MainThread]: Wrote artifact RunExecutionResult to D:\Project 7\glamira_analytics\target\run_results.json
[0m22:44:52.046806 [info ] [MainThread]: 
[0m22:44:52.047501 [info ] [MainThread]: [31mCompleted with 4 errors, 0 partial successes, and 0 warnings:[0m
[0m22:44:52.048190 [info ] [MainThread]: 
[0m22:44:52.048903 [error] [MainThread]: [31mFailure in model mart_product_type (models\marts\mart_product_type.sql)[0m
[0m22:44:52.049629 [error] [MainThread]:   Database Error in model mart_product_type (models\marts\mart_product_type.sql)
  Unrecognized name: sales_order_key at [18:9]
  compiled code at target\run\glamira_analytics\models\marts\mart_product_type.sql
[0m22:44:52.050399 [info ] [MainThread]: 
[0m22:44:52.051279 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\marts\mart_product_type.sql
[0m22:44:52.051915 [info ] [MainThread]: 
[0m22:44:52.052874 [error] [MainThread]: [31mFailure in model mart_country (models\marts\mart_country.sql)[0m
[0m22:44:52.054109 [error] [MainThread]:   Database Error in model mart_country (models\marts\mart_country.sql)
  Unrecognized name: sales_order_key at [18:9]
  compiled code at target\run\glamira_analytics\models\marts\mart_country.sql
[0m22:44:52.055361 [info ] [MainThread]: 
[0m22:44:52.056566 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\marts\mart_country.sql
[0m22:44:52.057478 [info ] [MainThread]: 
[0m22:44:52.058485 [error] [MainThread]: [31mFailure in model mart_overall (models\marts\mart_overall.sql)[0m
[0m22:44:52.059645 [error] [MainThread]:   Database Error in model mart_overall (models\marts\mart_overall.sql)
  Unrecognized name: sales_order_key at [18:9]
  compiled code at target\run\glamira_analytics\models\marts\mart_overall.sql
[0m22:44:52.060581 [info ] [MainThread]: 
[0m22:44:52.061381 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\marts\mart_overall.sql
[0m22:44:52.061966 [info ] [MainThread]: 
[0m22:44:52.062645 [error] [MainThread]: [31mFailure in model mart_product (models\marts\mart_product.sql)[0m
[0m22:44:52.063548 [error] [MainThread]:   Database Error in model mart_product (models\marts\mart_product.sql)
  Unrecognized name: sales_order_key at [18:9]
  compiled code at target\run\glamira_analytics\models\marts\mart_product.sql
[0m22:44:52.064170 [info ] [MainThread]: 
[0m22:44:52.064982 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\marts\mart_product.sql
[0m22:44:52.065583 [info ] [MainThread]: 
[0m22:44:52.066181 [info ] [MainThread]: Done. PASS=11 WARN=0 ERROR=4 SKIP=0 NO-OP=0 TOTAL=15
[0m22:44:52.067743 [debug] [MainThread]: Command `dbt run` failed at 22:44:52.067489 after 30.44 seconds
[0m22:44:52.068488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A3F42990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A3F42C90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001B9A3F42ED0>]}
[0m22:44:52.069504 [debug] [MainThread]: Flushing usage events
[0m22:44:56.201479 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:46:53.162302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026092A68EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026093BCFED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026093BCFB10>]}


============================== 22:46:53.168800 | fa3adf51-b85b-44e9-810f-b1312099207b ==============================
[0m22:46:53.168800 [info ] [MainThread]: Running with dbt=1.11.2
[0m22:46:53.170089 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'no_print': 'None', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'printer_width': '80', 'write_json': 'True', 'empty': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'invocation_command': 'dbt run --full-refresh', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m22:47:02.928760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026092F01BA0>]}
[0m22:47:03.005656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B27A7570>]}
[0m22:47:03.006634 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m22:47:03.874170 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m22:47:04.113843 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 4 files changed.
[0m22:47:04.114663 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\marts\mart_country.sql
[0m22:47:04.115163 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\marts\mart_product_type.sql
[0m22:47:04.115637 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\marts\mart_overall.sql
[0m22:47:04.116096 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\marts\mart_product.sql
[0m22:47:04.464097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B3308B50>]}
[0m22:47:04.570333 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:47:04.573552 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:47:04.616349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B2743110>]}
[0m22:47:04.617392 [info ] [MainThread]: Found 15 models, 1 seed, 3 sources, 537 macros
[0m22:47:04.618470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260A35C8BB0>]}
[0m22:47:04.621694 [info ] [MainThread]: 
[0m22:47:04.622447 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:47:04.623382 [info ] [MainThread]: 
[0m22:47:04.624621 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:47:04.633847 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:47:04.634932 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:47:04.635807 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:47:04.636865 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:47:04.638040 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:47:04.672481 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:47:06.580974 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_dimensions'
[0m22:47:06.581821 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:47:06.582548 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_staging'
[0m22:47:06.583764 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:47:06.584527 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev'
[0m22:47:06.586789 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:47:07.500821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B352A1A0>]}
[0m22:47:07.501616 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:47:07.508196 [debug] [Thread-3 (]: Began running node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:47:07.508904 [debug] [Thread-4 (]: Began running node model.glamira_analytics.stg_fx_rate
[0m22:47:07.509553 [debug] [Thread-1 (]: Began running node model.glamira_analytics.stg_dim_location
[0m22:47:07.510245 [debug] [Thread-2 (]: Began running node model.glamira_analytics.stg_dim_product
[0m22:47:07.511124 [info ] [Thread-3 (]: 3 of 15 START sql view model analytics_dev_staging.stg_fact_sales_order_tt ..... [RUN]
[0m22:47:07.511808 [info ] [Thread-4 (]: 4 of 15 START sql view model analytics_dev_staging.stg_fx_rate ................. [RUN]
[0m22:47:07.512723 [info ] [Thread-1 (]: 1 of 15 START sql view model analytics_dev_staging.stg_dim_location ............ [RUN]
[0m22:47:07.514637 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fact_sales_order_tt'
[0m22:47:07.513639 [info ] [Thread-2 (]: 2 of 15 START sql view model analytics_dev_staging.stg_dim_product ............. [RUN]
[0m22:47:07.515721 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fx_rate'
[0m22:47:07.516529 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_location'
[0m22:47:07.517176 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:47:07.517924 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_product'
[0m22:47:07.518538 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.stg_fx_rate
[0m22:47:07.519146 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.stg_dim_location
[0m22:47:07.530961 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m22:47:07.531764 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.stg_dim_product
[0m22:47:07.535454 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.stg_fx_rate"
[0m22:47:07.541432 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_location"
[0m22:47:07.546932 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_product"
[0m22:47:07.548494 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:47:07.594451 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m22:47:07.595295 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.stg_fx_rate
[0m22:47:07.601545 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.stg_fx_rate"
[0m22:47:07.602272 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.stg_dim_product
[0m22:47:07.603142 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.stg_dim_location
[0m22:47:07.608134 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_product"
[0m22:47:07.613246 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_location"
[0m22:47:07.614319 [debug] [Thread-3 (]: On model.glamira_analytics.stg_fact_sales_order_tt: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fact_sales_order_tt"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
  OPTIONS()
  as WITH stg_fact_sales_order_tt__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`raw_layer`.`summary`
    WHERE collection = 'checkout_success'
)

/* 1. Remove failed URLs */
, stg_fact_sales_order_tt__remove_url_fail AS (
    SELECT *
    FROM stg_fact_sales_order_tt__source 
    WHERE current_url NOT LIKE 'file://%'
)

/* 2. Get Location Data (Since summary table is missing it) */
, stg_fact_sales_order_tt__location AS (
    -- We select distinct IPs to avoid duplicate rows during the join
    SELECT DISTINCT 
        ip,
        country_code,
        region,
        city
    FROM `stone-album-475912-b9`.`raw_layer`.`ip_location`
    WHERE country_code IS NOT NULL
)

/* 3. Join Summary with Location */
, stg_fact_sales_order_tt__joined AS (
    SELECT 
        s.*,
        l.country_code,
        l.region,
        l.city
    FROM stg_fact_sales_order_tt__remove_url_fail s
    LEFT JOIN stg_fact_sales_order_tt__location l
        ON s.ip = l.ip
)

/* 4. Unnest cart_products */
, stg_fact_sales_order_tt__unnest AS (
    SELECT 
        s.*, 
        cp
    FROM stg_fact_sales_order_tt__joined s
    CROSS JOIN UNNEST(s.cart_products) AS cp
)

, stg_fact_sales_order_tt__rename AS (
    SELECT
        SAFE_CAST(REGEXP_REPLACE(CAST(s.order_id AS STRING), r'\..*', '') AS INT64) AS order_id,
        
        1 AS quantity,

        SAFE_CAST(REGEXP_REPLACE(CAST(cp.product_id AS STRING), r'\..*', '') AS INT64) AS product_id,
        SAFE_CAST(REGEXP_REPLACE(CAST(s.user_id_db AS STRING), r'\..*', '') AS INT64) AS user_id,
        SAFE_CAST(REGEXP_REPLACE(CAST(s.store_id AS STRING), r'\..*', '') AS INT64) AS store_id,
        
        TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64)) AS time_stamp,
        DATETIME(TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64))) AS local_time,
        
        CASE 
            WHEN s.currency IN ('USD', 'USD $') THEN 'USD'
            WHEN s.currency = 'HKD $'    THEN 'HKD'
            WHEN s.currency = 'NZD $'    THEN 'NZD'
            WHEN s.currency = 'MXN $'    THEN 'MXN'
            WHEN s.currency = 'Kƒç'       THEN 'CZK'
            WHEN s.currency = 'Ft'       THEN 'HUF'
            WHEN s.currency = 'z≈Ç'       THEN 'PLN'
            WHEN s.currency = '‚Çπ'        THEN 'INR'
            WHEN s.currency = '–ª–≤.'      THEN 'BGN'
            WHEN s.currency = '‚Ç´'        THEN 'VND'
            WHEN s.currency = '‚Ç±'        THEN 'PHP'
            WHEN s.currency = '‚Ç≤'        THEN 'PYG'
            WHEN s.currency = 'CRC ‚Ç°'    THEN 'CRC'
            WHEN s.currency = 'COP $'    THEN 'COP'
            WHEN s.currency = 'BOB Bs'   THEN 'BOB'
            WHEN s.currency = 'GTQ Q'    THEN 'GTQ'
            WHEN s.currency = 'PEN S/.'  THEN 'PEN'
            WHEN s.currency = 'DOP $'    THEN 'DOP'
            WHEN s.currency = 'CLP'      THEN 'CLP'
            WHEN s.currency = 'Lei'      THEN 'RON'
            WHEN s.currency = 'UYU'      THEN 'UYU'
            WHEN s.currency = 'din.'     THEN 'RSD'
            WHEN s.currency = 'kn'       THEN 'HRK'
            WHEN s.currency = 'ÿØ.ŸÉ.'     THEN 'KWD'
            WHEN s.currency = 'CHF'      THEN 'CHF'
            WHEN s.currency = 'kr'       THEN 'SEK'
            WHEN s.currency = '‚Ç¨'        THEN 'EUR'
            WHEN s.currency = '¬£'        THEN 'GBP'
            WHEN s.currency = 'AU$'      THEN 'AUD'
            WHEN s.currency = 'CA$'      THEN 'CAD'
            WHEN s.currency = '¬•'        THEN 'JPY'
            ELSE 'USD' 
        END AS currency_code,

        CAST(cp.price * 1 AS NUMERIC) AS line_total,
        
        s.ip AS ip_address,

        FARM_FINGERPRINT(CONCAT(
            CAST(s.country_code AS STRING), 
            CAST(s.region AS STRING), 
            CAST(s.city AS STRING)
        )) AS location_id

    FROM stg_fact_sales_order_tt__unnest s
)

SELECT * FROM stg_fact_sales_order_tt__rename;


[0m22:47:07.615676 [debug] [Thread-4 (]: On model.glamira_analytics.stg_fx_rate: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fx_rate"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
  OPTIONS()
  as WITH source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev`.`exchange_rate_usd`
)

, renamed AS (
    SELECT
        CAST(currency AS STRING) AS currency_code
        ,CAST(rate_to_usd AS NUMERIC) AS rate_to_usd
        ,CAST(as_of_gmt AS TIMESTAMP) AS rate_timestamp
    FROM source
)

SELECT * FROM renamed;


[0m22:47:07.616620 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:47:07.617434 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:47:07.619035 [debug] [Thread-1 (]: On model.glamira_analytics.stg_dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_location"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
  OPTIONS()
  as WITH stg_dim_location__source AS (
    SELECT 
        DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`ip_location`
)

, stg_dim_location__rename AS (
    SELECT
        CAST(ip AS STRING) AS ip_address,
        CAST(country_code AS STRING) AS country_short_name,
        
        CAST(country_code AS STRING) AS country_long_name,
        
        CAST(region AS STRING) AS region_name,
        CAST(city AS STRING) AS city_name
    FROM stg_dim_location__source
    WHERE country_code <> '-' 
      AND country_code IS NOT NULL
)

, stg_dim_location__gen_key AS (
    SELECT
        FARM_FINGERPRINT(country_short_name || region_name || city_name) AS location_id,
        ip_address,
        country_short_name,
        country_long_name,
        region_name,
        city_name
    FROM stg_dim_location__rename
)

SELECT * FROM stg_dim_location__gen_key;


[0m22:47:07.621161 [debug] [Thread-2 (]: On model.glamira_analytics.stg_dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_product"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
  OPTIONS()
  as WITH stg_dim_product__source AS (
    SELECT DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`product`
)

, stg_dim_product__rename AS (
    SELECT
        SAFE_CAST(product_id AS INT64) AS product_id,
        CAST(name AS STRING) AS product_name,
        CAST(url AS STRING) AS product_url,
        CAST(sku AS STRING) AS product_sku, 
        CAST(product_type AS STRING) AS product_type,
        CAST(category_name AS STRING) AS category_name,
        CAST(collection AS STRING) AS collection_name,
        SAFE_CAST(min_price AS NUMERIC) AS min_price,
        SAFE_CAST(max_price AS NUMERIC) AS max_price
    FROM stg_dim_product__source
    WHERE product_id IS NOT NULL
)

SELECT * FROM stg_dim_product__rename;


[0m22:47:07.622425 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m22:47:07.624472 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:47:08.715724 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:b80cd77f-617b-470a-83d2-3526e70c0a27&page=queryresults
[0m22:47:08.716729 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:d3da5a97-75cf-49bd-9643-fa6ba4525a3d&page=queryresults
[0m22:47:08.718026 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:de2f4e82-670a-47bc-8301-b253135dda86&page=queryresults
[0m22:47:08.720218 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:ab8e6d52-3f28-4b67-8185-31f1d27714d9&page=queryresults
[0m22:47:09.124366 [debug] [Thread-2 (]: SQL status: OK in 0.405 seconds
[0m22:47:09.125259 [debug] [Thread-4 (]: SQL status: OK in 0.406 seconds
[0m22:47:09.126220 [debug] [Thread-1 (]: SQL status: OK in 0.409 seconds
[0m22:47:09.139252 [debug] [Thread-3 (]: SQL status: OK in 0.418 seconds
[0m22:47:09.250409 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B350DB50>]}
[0m22:47:09.251068 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B3563800>]}
[0m22:47:09.251712 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B3CA4260>]}
[0m22:47:09.253281 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000026092EA0190>]}
[0m22:47:09.252770 [info ] [Thread-1 (]: 1 of 15 OK created sql view model analytics_dev_staging.stg_dim_location ....... [[32mCREATE VIEW (0 processed)[0m in 1.72s]
[0m22:47:09.254292 [info ] [Thread-4 (]: 4 of 15 OK created sql view model analytics_dev_staging.stg_fx_rate ............ [[32mCREATE VIEW (0 processed)[0m in 1.73s]
[0m22:47:09.255571 [info ] [Thread-2 (]: 2 of 15 OK created sql view model analytics_dev_staging.stg_dim_product ........ [[32mCREATE VIEW (0 processed)[0m in 1.73s]
[0m22:47:09.258260 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.stg_dim_location
[0m22:47:09.259295 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.stg_fx_rate
[0m22:47:09.256974 [info ] [Thread-3 (]: 3 of 15 OK created sql view model analytics_dev_staging.stg_fact_sales_order_tt  [[32mCREATE VIEW (0 processed)[0m in 1.74s]
[0m22:47:09.260694 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.stg_dim_product
[0m22:47:09.262350 [debug] [Thread-4 (]: Began running node model.glamira_analytics.dim_fx_rate_usd
[0m22:47:09.263186 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_location
[0m22:47:09.264244 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:47:09.265191 [info ] [Thread-4 (]: 6 of 15 START sql table model analytics_dev_dimensions.dim_fx_rate_usd ......... [RUN]
[0m22:47:09.267080 [debug] [Thread-2 (]: Began running node model.glamira_analytics.dim_product
[0m22:47:09.266424 [info ] [Thread-1 (]: 5 of 15 START sql table model analytics_dev_dimensions.dim_location ............ [RUN]
[0m22:47:09.268413 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_fx_rate, now model.glamira_analytics.dim_fx_rate_usd)
[0m22:47:09.269338 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_date
[0m22:47:09.270827 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_dim_location, now model.glamira_analytics.dim_location)
[0m22:47:09.270173 [info ] [Thread-2 (]: 7 of 15 START sql table model analytics_dev_dimensions.dim_product ............. [RUN]
[0m22:47:09.272297 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.dim_fx_rate_usd
[0m22:47:09.273777 [info ] [Thread-3 (]: 8 of 15 START sql table model analytics_dev_dimensions.dim_date ................ [RUN]
[0m22:47:09.274804 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.dim_location
[0m22:47:09.275608 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_dim_product, now model.glamira_analytics.dim_product)
[0m22:47:09.279885 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.dim_fx_rate_usd"
[0m22:47:09.280666 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_fact_sales_order_tt, now model.glamira_analytics.dim_date)
[0m22:47:09.286878 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.dim_location"
[0m22:47:09.287824 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.dim_product
[0m22:47:09.289063 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.dim_date
[0m22:47:09.295076 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.dim_product"
[0m22:47:09.300218 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.dim_date"
[0m22:47:09.301587 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.dim_fx_rate_usd
[0m22:47:09.302524 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.dim_location
[0m22:47:09.320113 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:47:09.325323 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:47:09.327130 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.dim_product
[0m22:47:09.328199 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.dim_date
[0m22:47:09.333398 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:47:09.337778 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:47:10.289609 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.dim_product"
[0m22:47:10.308610 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.dim_fx_rate_usd"
[0m22:47:10.310960 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.dim_date"
[0m22:47:10.313349 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.dim_location"
[0m22:47:10.314810 [debug] [Thread-4 (]: On model.glamira_analytics.dim_fx_rate_usd: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_fx_rate_usd"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_fx_rate_usd`
      
    
    

    
    OPTIONS()
    as (
      WITH stg_fx AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
)

SELECT
    currency_code AS from_currency_code
    ,'USD' AS to_currency_code
    ,rate_to_usd
    ,rate_timestamp
FROM stg_fx
    );
  
[0m22:47:10.316174 [debug] [Thread-2 (]: On model.glamira_analytics.dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_product"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_product__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
)

, dim_product__null_handle AS (
    SELECT
        product_id,
        COALESCE(product_name, 'Undefined') AS product_name,
        COALESCE(product_url, 'Undefined') AS product_url,
        COALESCE(product_sku, 'Undefined') AS product_sku,
        COALESCE(product_type, 'Undefined') AS product_type,
        COALESCE(NULLIF(TRIM(category_name), ''), 'Undefined') AS category_name, 
        COALESCE(NULLIF(TRIM(collection_name), ''), 'Undefined') AS collection_name,
        min_price,
        max_price
    FROM dim_product__source 
)

, dim_product__add_key AS (
    SELECT
        FARM_FINGERPRINT(CAST(product_id AS STRING)) AS product_key,
        *
    FROM dim_product__null_handle
)

, dim_product__union_undefined AS (
    SELECT 
        * FROM dim_product__add_key

    UNION ALL

    SELECT 
        -1 AS product_key,
        -1 AS product_id,
        'Undefined' AS product_name,
        'Undefined' AS product_url,
        'Undefined' AS product_sku,
        'Undefined' AS product_type,
        'Undefined' AS category_name,
        'Undefined' AS collection_name,
        0 AS min_price,
        0 AS max_price
)

SELECT * FROM dim_product__union_undefined
    );
  
[0m22:47:10.318945 [debug] [Thread-1 (]: On model.glamira_analytics.dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_location"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_location`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_location__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
)

, dim_location__null_handle AS (
    SELECT
        location_id
        ,ip_address
        ,COALESCE(country_short_name, 'Undefined') AS country_code
        ,COALESCE(country_long_name, 'Undefined') AS country_name
        ,COALESCE(region_name, 'Undefined') AS region_name
        ,COALESCE(city_name, 'Undefined') AS city_name
    FROM dim_location__source 
)

, dim_location__add_key AS (
    SELECT
        -- Surrogate Key
        FARM_FINGERPRINT(CAST(location_id AS STRING)) AS location_key
        -- Natural Key
        ,CAST(location_id AS STRING) AS location_id
        ,ip_address
        ,country_code
        ,country_name
        ,region_name
        ,city_name
    FROM dim_location__null_handle
)

, dim_location__union_undefined AS (
    SELECT 
        * FROM dim_location__add_key

    UNION ALL

    SELECT 
        -1 AS location_key
        ,'-1' AS location_id
        ,'Undefined' AS ip_address
        ,'Undefined' AS country_code
        ,'Undefined' AS country_name
        ,'Undefined' AS region_name
        ,'Undefined' AS city_name
)

SELECT 
    *
FROM dim_location__union_undefined
    );
  
[0m22:47:10.320309 [debug] [Thread-3 (]: On model.glamira_analytics.dim_date: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_date"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_date`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_date__source AS (
    SELECT DISTINCT 
        DATE(time_stamp) AS full_date
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
    WHERE time_stamp IS NOT NULL
)

, dim_date__format AS (
    SELECT
        CAST(FORMAT_DATE('%Y%m%d', full_date) AS INT64) AS date_key
        ,full_date AS date_day
        ,FORMAT_DATE('%A', full_date) AS day_name
        ,CASE
            WHEN FORMAT_DATE('%A', full_date) IN ('Saturday', 'Sunday') THEN TRUE
            ELSE FALSE
        END AS is_weekend
        ,CAST(FORMAT_DATE('%d', full_date) AS INT64) AS day_of_month
        ,FORMAT_DATE('%Y-%m', full_date) AS year_month
        ,CAST(FORMAT_DATE('%m', full_date) AS INT64) AS month_of_year
        ,CAST(FORMAT_DATE('%j', full_date) AS INT64) AS day_of_year
        ,CAST(FORMAT_DATE('%W', full_date) AS INT64) AS week_of_year
        ,CAST(FORMAT_DATE('%Q', full_date) AS INT64) AS quarter_of_year
        ,CAST(FORMAT_DATE('%Y', full_date) AS INT64) AS year_number
    FROM dim_date__source
)

SELECT 
    *
FROM dim_date__format
ORDER BY date_key
    );
  
[0m22:47:11.068726 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:870dd441-656d-48f1-b865-05dc032bdd8d&page=queryresults
[0m22:47:11.070128 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:025e2366-9213-47dc-bff3-874656ca3fc1&page=queryresults
[0m22:47:11.084966 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:2a1bf122-d962-4b64-a969-786b9dcacb53&page=queryresults
[0m22:47:11.189731 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:e748d394-882d-4060-98bd-f6d7aa501d99&page=queryresults
[0m22:47:13.319984 [debug] [Thread-2 (]: SQL status: OK in 2.234 seconds
[0m22:47:13.629830 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B3D81400>]}
[0m22:47:13.630935 [info ] [Thread-2 (]: 7 of 15 OK created sql table model analytics_dev_dimensions.dim_product ........ [[32mCREATE TABLE (18.6k rows, 2.7 MiB processed)[0m in 4.35s]
[0m22:47:13.632170 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.dim_product
[0m22:47:13.632866 [debug] [Thread-2 (]: Began running node model.glamira_analytics.dim_store
[0m22:47:13.633719 [info ] [Thread-2 (]: 9 of 15 START sql table model analytics_dev_dimensions.dim_store ............... [RUN]
[0m22:47:13.634599 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_product, now model.glamira_analytics.dim_store)
[0m22:47:13.635280 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.dim_store
[0m22:47:13.638997 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.dim_store"
[0m22:47:13.640242 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.dim_store
[0m22:47:13.643514 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:47:14.450942 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.dim_store"
[0m22:47:14.452986 [debug] [Thread-2 (]: On model.glamira_analytics.dim_store: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_store"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_store`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_store__source AS (
    SELECT DISTINCT 
        store_id
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
    WHERE store_id IS NOT NULL
)

, dim_store__add_key AS (
    SELECT
        FARM_FINGERPRINT(CAST(store_id AS STRING)) AS store_key
        ,CAST(store_id AS STRING) AS store_id
        ,CONCAT('Store ', CAST(store_id AS STRING)) AS store_name
    FROM dim_store__source 
)

SELECT 
    *
FROM dim_store__add_key
ORDER BY store_id
    );
  
[0m22:47:14.547173 [debug] [Thread-4 (]: SQL status: OK in 3.357 seconds
[0m22:47:14.807313 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B3674D70>]}
[0m22:47:14.808412 [info ] [Thread-4 (]: 6 of 15 OK created sql table model analytics_dev_dimensions.dim_fx_rate_usd .... [[32mCREATE TABLE (34.0 rows, 1.3 KiB processed)[0m in 5.54s]
[0m22:47:14.810394 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.dim_fx_rate_usd
[0m22:47:14.811073 [debug] [Thread-4 (]: Began running node model.glamira_analytics.dim_user
[0m22:47:14.811896 [info ] [Thread-4 (]: 10 of 15 START sql table model analytics_dev_dimensions.dim_user ............... [RUN]
[0m22:47:14.812773 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_fx_rate_usd, now model.glamira_analytics.dim_user)
[0m22:47:14.813425 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.dim_user
[0m22:47:14.817378 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.dim_user"
[0m22:47:14.818726 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.dim_user
[0m22:47:14.821968 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:47:15.263617 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:fb88012a-f9dd-4d81-9cee-157645235f5f&page=queryresults
[0m22:47:15.674981 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.dim_user"
[0m22:47:15.676822 [debug] [Thread-4 (]: On model.glamira_analytics.dim_user: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_user"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_user`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_user__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
)

, dim_user__dedup AS (
    SELECT
        user_id,
        -- We select the most recent location for the user
        ARRAY_AGG(location_id ORDER BY time_stamp DESC LIMIT 1)[OFFSET(0)] AS location_id,
        MAX(time_stamp) AS last_active_at
    FROM dim_user__source
    WHERE user_id IS NOT NULL
    GROUP BY user_id
)

SELECT 
    user_id,
    location_id,
    last_active_at
FROM dim_user__dedup
    );
  
[0m22:47:15.776789 [debug] [Thread-1 (]: SQL status: OK in 4.705 seconds
[0m22:47:15.779029 [debug] [Thread-3 (]: SQL status: OK in 4.709 seconds
[0m22:47:15.983456 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B3BCB830>]}
[0m22:47:15.989020 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B3CC4B30>]}
[0m22:47:15.986416 [info ] [Thread-1 (]: 5 of 15 OK created sql table model analytics_dev_dimensions.dim_location ....... [[32mCREATE TABLE (2.1m rows, 189.5 MiB processed)[0m in 6.71s]
[0m22:47:15.991799 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_location
[0m22:47:15.990780 [info ] [Thread-3 (]: 8 of 15 OK created sql table model analytics_dev_dimensions.dim_date ........... [[32mCREATE TABLE (43.0 rows, 5.7 GiB processed)[0m in 6.71s]
[0m22:47:15.992823 [debug] [Thread-1 (]: Began running node model.glamira_analytics.fact_sales_order_tt
[0m22:47:15.993902 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_date
[0m22:47:15.994707 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics_dev_dimensions.fact_sales_order_tt .... [RUN]
[0m22:47:15.995598 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_location, now model.glamira_analytics.fact_sales_order_tt)
[0m22:47:15.996344 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.fact_sales_order_tt
[0m22:47:16.000428 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.fact_sales_order_tt"
[0m22:47:16.001825 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.fact_sales_order_tt
[0m22:47:16.006002 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:47:16.287364 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:0b1e4300-4b5e-44ca-987d-313b046b2b59&page=queryresults
[0m22:47:16.901553 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.fact_sales_order_tt"
[0m22:47:16.903272 [debug] [Thread-1 (]: On model.glamira_analytics.fact_sales_order_tt: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.fact_sales_order_tt"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
      
    
    

    
    OPTIONS()
    as (
      WITH fact_sales_order_tt__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
)

, fact_sales_order_tt__fields AS (
    SELECT
        order_id,
        product_id,
        user_id,
        store_id,
        location_id,
        time_stamp,
        local_time,
        currency_code,
        quantity,
        -- FIX: Use line_total instead of price
        line_total AS sales_amount,
        line_total AS gross_revenue
    FROM fact_sales_order_tt__source
)

SELECT * FROM fact_sales_order_tt__fields
    );
  
[0m22:47:17.412113 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:657e2eb8-5ba9-40bf-81ab-495174c02b19&page=queryresults
[0m22:47:20.790390 [debug] [Thread-1 (]: SQL status: OK in 3.377 seconds
[0m22:47:20.820500 [debug] [Thread-4 (]: SQL status: OK in 4.532 seconds
[0m22:47:20.823682 [debug] [Thread-2 (]: SQL status: OK in 5.559 seconds
[0m22:47:21.000658 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B3CC4B30>]}
[0m22:47:21.003394 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B3CC72F0>]}
[0m22:47:21.009724 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B3CC4B30>]}
[0m22:47:21.006956 [info ] [Thread-2 (]: 9 of 15 OK created sql table model analytics_dev_dimensions.dim_store .......... [[32mCREATE TABLE (57.0 rows, 5.7 GiB processed)[0m in 7.37s]
[0m22:47:21.011260 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics_dev_dimensions.fact_sales_order_tt  [[32mCREATE TABLE (31.4k rows, 6.0 GiB processed)[0m in 5.01s]
[0m22:47:21.013862 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.dim_store
[0m22:47:21.012414 [info ] [Thread-4 (]: 10 of 15 OK created sql table model analytics_dev_dimensions.dim_user .......... [[32mCREATE TABLE (8.7k rows, 5.7 GiB processed)[0m in 6.20s]
[0m22:47:21.015731 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.fact_sales_order_tt
[0m22:47:21.017302 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.dim_user
[0m22:47:21.018610 [debug] [Thread-1 (]: Began running node model.glamira_analytics.mart_product
[0m22:47:21.019368 [debug] [Thread-4 (]: Began running node model.glamira_analytics.mart_product_type
[0m22:47:21.020179 [debug] [Thread-3 (]: Began running node model.glamira_analytics.mart_country
[0m22:47:21.020801 [debug] [Thread-2 (]: Began running node model.glamira_analytics.mart_overall
[0m22:47:21.022120 [info ] [Thread-1 (]: 14 of 15 START sql view model analytics_dev.mart_product ....................... [RUN]
[0m22:47:21.023584 [info ] [Thread-4 (]: 15 of 15 START sql view model analytics_dev.mart_product_type .................. [RUN]
[0m22:47:21.024914 [info ] [Thread-3 (]: 12 of 15 START sql view model analytics_dev.mart_country ....................... [RUN]
[0m22:47:21.027245 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.fact_sales_order_tt, now model.glamira_analytics.mart_product)
[0m22:47:21.026075 [info ] [Thread-2 (]: 13 of 15 START sql view model analytics_dev.mart_overall ....................... [RUN]
[0m22:47:21.028064 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_user, now model.glamira_analytics.mart_product_type)
[0m22:47:21.028583 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_date, now model.glamira_analytics.mart_country)
[0m22:47:21.029118 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.mart_product
[0m22:47:21.029604 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_store, now model.glamira_analytics.mart_overall)
[0m22:47:21.030096 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.mart_product_type
[0m22:47:21.030571 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.mart_country
[0m22:47:21.035012 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.mart_product"
[0m22:47:21.035651 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.mart_overall
[0m22:47:21.040147 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.mart_product_type"
[0m22:47:21.044586 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.mart_country"
[0m22:47:21.048542 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.mart_overall"
[0m22:47:21.050060 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.mart_product
[0m22:47:21.051076 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.mart_product_type
[0m22:47:21.058110 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.mart_product"
[0m22:47:21.063068 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.mart_product_type"
[0m22:47:21.064276 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.mart_overall
[0m22:47:21.069270 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.mart_overall"
[0m22:47:21.070042 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.mart_country
[0m22:47:21.078997 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.mart_country"
[0m22:47:21.080063 [debug] [Thread-1 (]: On model.glamira_analytics.mart_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.mart_product"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev`.`mart_product`
  OPTIONS()
  as WITH mart_product__fact AS (
    SELECT * FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
)

, mart_product__dim AS (
    SELECT * FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
)

, mart_product__joined AS (
    SELECT
        f.order_id,
        f.sales_amount,
        f.quantity,
        f.time_stamp,
        p.product_name,
        p.category_name,
        p.collection_name
    FROM mart_product__fact f
    LEFT JOIN mart_product__dim p
        ON f.product_id = p.product_id
)

, mart_product__aggs AS (
    SELECT
        product_name,
        category_name,
        collection_name,
        COUNT(DISTINCT order_id) AS total_orders,
        SUM(sales_amount) AS total_revenue,
        SUM(quantity) AS total_quantity_sold
    FROM mart_product__joined
    GROUP BY 1, 2, 3
)

SELECT * FROM mart_product__aggs;


[0m22:47:21.081341 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:47:21.082269 [debug] [Thread-4 (]: On model.glamira_analytics.mart_product_type: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.mart_product_type"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev`.`mart_product_type`
  OPTIONS()
  as WITH mart_product_type__fact AS (
    SELECT * FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
)

, mart_product_type__dim AS (
    SELECT * FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
)

, mart_product_type__joined AS (
    SELECT
        f.order_id,
        f.sales_amount,
        p.product_type
    FROM mart_product_type__fact f
    LEFT JOIN mart_product_type__dim p
        ON f.product_id = p.product_id
)

, mart_product_type__aggs AS (
    SELECT
        product_type,
        COUNT(DISTINCT order_id) AS total_orders,
        SUM(sales_amount) AS total_revenue
    FROM mart_product_type__joined
    GROUP BY 1
)

SELECT * FROM mart_product_type__aggs;


[0m22:47:21.084011 [debug] [Thread-2 (]: On model.glamira_analytics.mart_overall: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.mart_overall"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev`.`mart_overall`
  OPTIONS()
  as WITH mart_overall__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
)

, mart_overall__aggs AS (
    SELECT
        DATE(time_stamp) AS date_day,
        COUNT(DISTINCT order_id) AS total_orders,
        SUM(sales_amount) AS total_revenue,
        SUM(quantity) AS total_items_sold
    FROM mart_overall__source
    GROUP BY 1
)

SELECT * FROM mart_overall__aggs;


[0m22:47:21.084872 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:47:21.086213 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:47:21.087729 [debug] [Thread-3 (]: On model.glamira_analytics.mart_country: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.mart_country"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev`.`mart_country`
  OPTIONS()
  as WITH mart_country__fact AS (
    SELECT * FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
)

, mart_country__dim AS (
    SELECT * FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_location`
)

, mart_country__joined AS (
    SELECT
        f.order_id,
        f.sales_amount,
        l.country_short_name,
        l.country_long_name,
        l.region_name,
        l.city_name
    FROM mart_country__fact f
    LEFT JOIN mart_country__dim l
        ON f.location_id = l.location_id
)

, mart_country__aggs AS (
    SELECT
        country_short_name,
        country_long_name,
        region_name,
        city_name,
        COUNT(DISTINCT order_id) AS total_orders,
        SUM(sales_amount) AS total_revenue
    FROM mart_country__joined
    GROUP BY 1, 2, 3, 4
)

SELECT * FROM mart_country__aggs;


[0m22:47:21.092456 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:47:22.327765 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:0def5307-2cad-454d-abe5-f32a6f477616&page=queryresults
[0m22:47:22.328816 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:6241e611-6e50-4044-92e2-8219cf33cdfb&page=queryresults
[0m22:47:22.329983 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:91d67111-d411-41e3-ad61-cdba0a540c19&page=queryresults
[0m22:47:22.331865 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:1b2d4d99-d0c3-414d-8397-f73e51045c84&page=queryresults
[0m22:47:22.532668 [error] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:0def5307-2cad-454d-abe5-f32a6f477616&page=queryresults
[0m22:47:22.573539 [debug] [Thread-3 (]: Database Error in model mart_country (models\marts\mart_country.sql)
  No matching signature for operator = for argument types: INT64, STRING
    Signature: T1 = T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, STRING} at [24:12]
  compiled code at target\run\glamira_analytics\models\marts\mart_country.sql
[0m22:47:22.576035 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B3E08530>]}
[0m22:47:22.578657 [error] [Thread-3 (]: 12 of 15 ERROR creating sql view model analytics_dev.mart_country .............. [[31mERROR[0m in 1.55s]
[0m22:47:22.581454 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.mart_country
[0m22:47:22.583266 [debug] [Thread-7 (]: Marking all children of 'model.glamira_analytics.mart_country' to be skipped because of status 'error'.  Reason: Database Error in model mart_country (models\marts\mart_country.sql)
  No matching signature for operator = for argument types: INT64, STRING
    Signature: T1 = T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, STRING} at [24:12]
  compiled code at target\run\glamira_analytics\models\marts\mart_country.sql.
[0m22:47:22.734994 [debug] [Thread-1 (]: SQL status: OK in 0.401 seconds
[0m22:47:22.737700 [debug] [Thread-4 (]: SQL status: OK in 0.402 seconds
[0m22:47:22.752378 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B3CC75F0>]}
[0m22:47:22.757262 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B351AE70>]}
[0m22:47:22.761697 [debug] [Thread-2 (]: SQL status: OK in 0.428 seconds
[0m22:47:22.759457 [info ] [Thread-1 (]: 14 of 15 OK created sql view model analytics_dev.mart_product .................. [[32mCREATE VIEW (0 processed)[0m in 1.72s]
[0m22:47:22.764269 [info ] [Thread-4 (]: 15 of 15 OK created sql view model analytics_dev.mart_product_type ............. [[32mCREATE VIEW (0 processed)[0m in 1.73s]
[0m22:47:22.778031 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa3adf51-b85b-44e9-810f-b1312099207b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B35C55B0>]}
[0m22:47:22.780573 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.mart_product
[0m22:47:22.782757 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.mart_product_type
[0m22:47:22.784822 [info ] [Thread-2 (]: 13 of 15 OK created sql view model analytics_dev.mart_overall .................. [[32mCREATE VIEW (0 processed)[0m in 1.75s]
[0m22:47:22.787910 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.mart_overall
[0m22:47:22.792655 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:47:22.794435 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:47:22.795373 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:47:22.796186 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:47:22.796992 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:47:22.797822 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_dimensions' was properly closed.
[0m22:47:22.798630 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_staging' was properly closed.
[0m22:47:22.799454 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev' was properly closed.
[0m22:47:22.800251 [debug] [MainThread]: Connection 'model.glamira_analytics.mart_country' was properly closed.
[0m22:47:22.801051 [debug] [MainThread]: Connection 'model.glamira_analytics.mart_product_type' was properly closed.
[0m22:47:22.801893 [debug] [MainThread]: Connection 'model.glamira_analytics.mart_product' was properly closed.
[0m22:47:22.802776 [debug] [MainThread]: Connection 'model.glamira_analytics.mart_overall' was properly closed.
[0m22:47:22.803913 [info ] [MainThread]: 
[0m22:47:22.806835 [info ] [MainThread]: Finished running 7 table models, 8 view models in 0 hours 0 minutes and 18.18 seconds (18.18s).
[0m22:47:22.819605 [debug] [MainThread]: Command end result
[0m22:47:22.924990 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:47:22.930125 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:47:22.950050 [debug] [MainThread]: Wrote artifact RunExecutionResult to D:\Project 7\glamira_analytics\target\run_results.json
[0m22:47:22.950988 [info ] [MainThread]: 
[0m22:47:22.952713 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m22:47:22.953993 [info ] [MainThread]: 
[0m22:47:22.955381 [error] [MainThread]: [31mFailure in model mart_country (models\marts\mart_country.sql)[0m
[0m22:47:22.957017 [error] [MainThread]:   Database Error in model mart_country (models\marts\mart_country.sql)
  No matching signature for operator = for argument types: INT64, STRING
    Signature: T1 = T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, STRING} at [24:12]
  compiled code at target\run\glamira_analytics\models\marts\mart_country.sql
[0m22:47:22.958611 [info ] [MainThread]: 
[0m22:47:22.960710 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\marts\mart_country.sql
[0m22:47:22.962260 [info ] [MainThread]: 
[0m22:47:22.964185 [info ] [MainThread]: Done. PASS=14 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=15
[0m22:47:22.967651 [debug] [MainThread]: Command `dbt run` failed at 22:47:22.967030 after 30.05 seconds
[0m22:47:22.969166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B3534770>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B3EA3FB0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000260B3EA3A10>]}
[0m22:47:22.970369 [debug] [MainThread]: Flushing usage events
[0m22:47:27.112737 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:48:56.473798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1ACB68EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1ADCCFED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1ADCCFB10>]}


============================== 22:48:56.480402 | e7e8770a-d771-4023-a58e-1cc28b1c2b52 ==============================
[0m22:48:56.480402 [info ] [MainThread]: Running with dbt=1.11.2
[0m22:48:56.481427 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'no_print': 'None', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'printer_width': '80', 'write_json': 'True', 'empty': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'fail_fast': 'False', 'debug': 'False', 'log_format': 'default', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'indirect_selection': 'eager', 'invocation_command': 'dbt run --full-refresh', 'use_colors': 'True', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m22:49:06.556833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1AD001BA0>]}
[0m22:49:06.640171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1BD803570>]}
[0m22:49:06.641119 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m22:49:07.509777 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m22:49:07.758863 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m22:49:07.759863 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\dimensions\dim_location.sql
[0m22:49:07.760549 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\marts\mart_country.sql
[0m22:49:08.128096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1CD47D750>]}
[0m22:49:08.240952 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:49:08.244058 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:49:08.284886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1BD887110>]}
[0m22:49:08.285531 [info ] [MainThread]: Found 15 models, 1 seed, 3 sources, 537 macros
[0m22:49:08.286195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1CD3AB310>]}
[0m22:49:08.289224 [info ] [MainThread]: 
[0m22:49:08.289895 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:49:08.290429 [info ] [MainThread]: 
[0m22:49:08.291145 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:49:08.301997 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:49:08.303214 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:49:08.304010 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:49:08.304879 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:49:08.305661 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:49:08.306696 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:49:10.288165 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_dimensions'
[0m22:49:10.288975 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:49:10.289681 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev'
[0m22:49:10.290874 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:49:10.292113 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_staging'
[0m22:49:10.293782 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:49:11.186853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1CD695A50>]}
[0m22:49:11.187607 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:49:11.194319 [debug] [Thread-3 (]: Began running node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:49:11.195064 [debug] [Thread-4 (]: Began running node model.glamira_analytics.stg_fx_rate
[0m22:49:11.195636 [debug] [Thread-1 (]: Began running node model.glamira_analytics.stg_dim_location
[0m22:49:11.196543 [debug] [Thread-2 (]: Began running node model.glamira_analytics.stg_dim_product
[0m22:49:11.197700 [info ] [Thread-3 (]: 3 of 15 START sql view model analytics_dev_staging.stg_fact_sales_order_tt ..... [RUN]
[0m22:49:11.198451 [info ] [Thread-4 (]: 4 of 15 START sql view model analytics_dev_staging.stg_fx_rate ................. [RUN]
[0m22:49:11.201150 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fact_sales_order_tt'
[0m22:49:11.199331 [info ] [Thread-1 (]: 1 of 15 START sql view model analytics_dev_staging.stg_dim_location ............ [RUN]
[0m22:49:11.202409 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fx_rate'
[0m22:49:11.200043 [info ] [Thread-2 (]: 2 of 15 START sql view model analytics_dev_staging.stg_dim_product ............. [RUN]
[0m22:49:11.203462 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:49:11.204218 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_location'
[0m22:49:11.204789 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.stg_fx_rate
[0m22:49:11.205626 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_product'
[0m22:49:11.219326 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m22:49:11.220012 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.stg_dim_location
[0m22:49:11.225843 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.stg_fx_rate"
[0m22:49:11.226726 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.stg_dim_product
[0m22:49:11.232284 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_location"
[0m22:49:11.238692 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_product"
[0m22:49:11.240254 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.stg_fx_rate
[0m22:49:11.247346 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.stg_dim_location
[0m22:49:11.262572 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:49:11.293700 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.stg_dim_product
[0m22:49:11.294968 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_location"
[0m22:49:11.298403 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.stg_fx_rate"
[0m22:49:11.302073 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m22:49:11.307825 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_product"
[0m22:49:11.310611 [debug] [Thread-4 (]: On model.glamira_analytics.stg_fx_rate: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fx_rate"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
  OPTIONS()
  as WITH source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev`.`exchange_rate_usd`
)

, renamed AS (
    SELECT
        CAST(currency AS STRING) AS currency_code
        ,CAST(rate_to_usd AS NUMERIC) AS rate_to_usd
        ,CAST(as_of_gmt AS TIMESTAMP) AS rate_timestamp
    FROM source
)

SELECT * FROM renamed;


[0m22:49:11.311853 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:49:11.312887 [debug] [Thread-1 (]: On model.glamira_analytics.stg_dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_location"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
  OPTIONS()
  as WITH stg_dim_location__source AS (
    SELECT 
        DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`ip_location`
)

, stg_dim_location__rename AS (
    SELECT
        CAST(ip AS STRING) AS ip_address,
        CAST(country_code AS STRING) AS country_short_name,
        
        CAST(country_code AS STRING) AS country_long_name,
        
        CAST(region AS STRING) AS region_name,
        CAST(city AS STRING) AS city_name
    FROM stg_dim_location__source
    WHERE country_code <> '-' 
      AND country_code IS NOT NULL
)

, stg_dim_location__gen_key AS (
    SELECT
        FARM_FINGERPRINT(country_short_name || region_name || city_name) AS location_id,
        ip_address,
        country_short_name,
        country_long_name,
        region_name,
        city_name
    FROM stg_dim_location__rename
)

SELECT * FROM stg_dim_location__gen_key;


[0m22:49:11.314891 [debug] [Thread-3 (]: On model.glamira_analytics.stg_fact_sales_order_tt: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fact_sales_order_tt"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
  OPTIONS()
  as WITH stg_fact_sales_order_tt__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`raw_layer`.`summary`
    WHERE collection = 'checkout_success'
)

/* 1. Remove failed URLs */
, stg_fact_sales_order_tt__remove_url_fail AS (
    SELECT *
    FROM stg_fact_sales_order_tt__source 
    WHERE current_url NOT LIKE 'file://%'
)

/* 2. Get Location Data (Since summary table is missing it) */
, stg_fact_sales_order_tt__location AS (
    -- We select distinct IPs to avoid duplicate rows during the join
    SELECT DISTINCT 
        ip,
        country_code,
        region,
        city
    FROM `stone-album-475912-b9`.`raw_layer`.`ip_location`
    WHERE country_code IS NOT NULL
)

/* 3. Join Summary with Location */
, stg_fact_sales_order_tt__joined AS (
    SELECT 
        s.*,
        l.country_code,
        l.region,
        l.city
    FROM stg_fact_sales_order_tt__remove_url_fail s
    LEFT JOIN stg_fact_sales_order_tt__location l
        ON s.ip = l.ip
)

/* 4. Unnest cart_products */
, stg_fact_sales_order_tt__unnest AS (
    SELECT 
        s.*, 
        cp
    FROM stg_fact_sales_order_tt__joined s
    CROSS JOIN UNNEST(s.cart_products) AS cp
)

, stg_fact_sales_order_tt__rename AS (
    SELECT
        SAFE_CAST(REGEXP_REPLACE(CAST(s.order_id AS STRING), r'\..*', '') AS INT64) AS order_id,
        
        1 AS quantity,

        SAFE_CAST(REGEXP_REPLACE(CAST(cp.product_id AS STRING), r'\..*', '') AS INT64) AS product_id,
        SAFE_CAST(REGEXP_REPLACE(CAST(s.user_id_db AS STRING), r'\..*', '') AS INT64) AS user_id,
        SAFE_CAST(REGEXP_REPLACE(CAST(s.store_id AS STRING), r'\..*', '') AS INT64) AS store_id,
        
        TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64)) AS time_stamp,
        DATETIME(TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64))) AS local_time,
        
        CASE 
            WHEN s.currency IN ('USD', 'USD $') THEN 'USD'
            WHEN s.currency = 'HKD $'    THEN 'HKD'
            WHEN s.currency = 'NZD $'    THEN 'NZD'
            WHEN s.currency = 'MXN $'    THEN 'MXN'
            WHEN s.currency = 'Kƒç'       THEN 'CZK'
            WHEN s.currency = 'Ft'       THEN 'HUF'
            WHEN s.currency = 'z≈Ç'       THEN 'PLN'
            WHEN s.currency = '‚Çπ'        THEN 'INR'
            WHEN s.currency = '–ª–≤.'      THEN 'BGN'
            WHEN s.currency = '‚Ç´'        THEN 'VND'
            WHEN s.currency = '‚Ç±'        THEN 'PHP'
            WHEN s.currency = '‚Ç≤'        THEN 'PYG'
            WHEN s.currency = 'CRC ‚Ç°'    THEN 'CRC'
            WHEN s.currency = 'COP $'    THEN 'COP'
            WHEN s.currency = 'BOB Bs'   THEN 'BOB'
            WHEN s.currency = 'GTQ Q'    THEN 'GTQ'
            WHEN s.currency = 'PEN S/.'  THEN 'PEN'
            WHEN s.currency = 'DOP $'    THEN 'DOP'
            WHEN s.currency = 'CLP'      THEN 'CLP'
            WHEN s.currency = 'Lei'      THEN 'RON'
            WHEN s.currency = 'UYU'      THEN 'UYU'
            WHEN s.currency = 'din.'     THEN 'RSD'
            WHEN s.currency = 'kn'       THEN 'HRK'
            WHEN s.currency = 'ÿØ.ŸÉ.'     THEN 'KWD'
            WHEN s.currency = 'CHF'      THEN 'CHF'
            WHEN s.currency = 'kr'       THEN 'SEK'
            WHEN s.currency = '‚Ç¨'        THEN 'EUR'
            WHEN s.currency = '¬£'        THEN 'GBP'
            WHEN s.currency = 'AU$'      THEN 'AUD'
            WHEN s.currency = 'CA$'      THEN 'CAD'
            WHEN s.currency = '¬•'        THEN 'JPY'
            ELSE 'USD' 
        END AS currency_code,

        CAST(cp.price * 1 AS NUMERIC) AS line_total,
        
        s.ip AS ip_address,

        FARM_FINGERPRINT(CONCAT(
            CAST(s.country_code AS STRING), 
            CAST(s.region AS STRING), 
            CAST(s.city AS STRING)
        )) AS location_id

    FROM stg_fact_sales_order_tt__unnest s
)

SELECT * FROM stg_fact_sales_order_tt__rename;


[0m22:49:11.315945 [debug] [Thread-2 (]: On model.glamira_analytics.stg_dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_product"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
  OPTIONS()
  as WITH stg_dim_product__source AS (
    SELECT DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`product`
)

, stg_dim_product__rename AS (
    SELECT
        SAFE_CAST(product_id AS INT64) AS product_id,
        CAST(name AS STRING) AS product_name,
        CAST(url AS STRING) AS product_url,
        CAST(sku AS STRING) AS product_sku, 
        CAST(product_type AS STRING) AS product_type,
        CAST(category_name AS STRING) AS category_name,
        CAST(collection AS STRING) AS collection_name,
        SAFE_CAST(min_price AS NUMERIC) AS min_price,
        SAFE_CAST(max_price AS NUMERIC) AS max_price
    FROM stg_dim_product__source
    WHERE product_id IS NOT NULL
)

SELECT * FROM stg_dim_product__rename;


[0m22:49:11.317200 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m22:49:11.318571 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:49:11.319451 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:49:12.331188 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:7949d837-f53c-4d9c-be9a-b9ef035a85bc&page=queryresults
[0m22:49:12.332212 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:c2351eaf-241b-490c-b646-b47b33edf64c&page=queryresults
[0m22:49:12.333016 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:914daf4b-c987-4b97-9ff0-562c7ec9b8af&page=queryresults
[0m22:49:12.334397 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:00b190e2-3c12-48af-b889-98979af038de&page=queryresults
[0m22:49:12.740016 [debug] [Thread-1 (]: SQL status: OK in 0.406 seconds
[0m22:49:12.740961 [debug] [Thread-3 (]: SQL status: OK in 0.405 seconds
[0m22:49:12.741721 [debug] [Thread-2 (]: SQL status: OK in 0.408 seconds
[0m22:49:12.742629 [debug] [Thread-4 (]: SQL status: OK in 0.407 seconds
[0m22:49:12.875848 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1CD748A10>]}
[0m22:49:12.876504 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1CDD48470>]}
[0m22:49:12.877033 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1CDD48520>]}
[0m22:49:12.878483 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1ACFA0190>]}
[0m22:49:12.878039 [info ] [Thread-2 (]: 2 of 15 OK created sql view model analytics_dev_staging.stg_dim_product ........ [[32mCREATE VIEW (0 processed)[0m in 1.66s]
[0m22:49:12.879682 [info ] [Thread-1 (]: 1 of 15 OK created sql view model analytics_dev_staging.stg_dim_location ....... [[32mCREATE VIEW (0 processed)[0m in 1.67s]
[0m22:49:12.880559 [info ] [Thread-4 (]: 4 of 15 OK created sql view model analytics_dev_staging.stg_fx_rate ............ [[32mCREATE VIEW (0 processed)[0m in 1.67s]
[0m22:49:12.882988 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.stg_dim_product
[0m22:49:12.881776 [info ] [Thread-3 (]: 3 of 15 OK created sql view model analytics_dev_staging.stg_fact_sales_order_tt  [[32mCREATE VIEW (0 processed)[0m in 1.67s]
[0m22:49:12.884128 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.stg_dim_location
[0m22:49:12.885047 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.stg_fx_rate
[0m22:49:12.886166 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:49:12.886874 [debug] [Thread-2 (]: Began running node model.glamira_analytics.dim_product
[0m22:49:12.887728 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_location
[0m22:49:12.889257 [debug] [Thread-4 (]: Began running node model.glamira_analytics.dim_date
[0m22:49:12.889933 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_fx_rate_usd
[0m22:49:12.888740 [info ] [Thread-2 (]: 5 of 15 START sql table model analytics_dev_dimensions.dim_product ............. [RUN]
[0m22:49:12.891073 [info ] [Thread-1 (]: 6 of 15 START sql table model analytics_dev_dimensions.dim_location ............ [RUN]
[0m22:49:12.892362 [info ] [Thread-4 (]: 7 of 15 START sql table model analytics_dev_dimensions.dim_date ................ [RUN]
[0m22:49:12.894872 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_dim_product, now model.glamira_analytics.dim_product)
[0m22:49:12.893899 [info ] [Thread-3 (]: 8 of 15 START sql table model analytics_dev_dimensions.dim_fx_rate_usd ......... [RUN]
[0m22:49:12.895855 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_dim_location, now model.glamira_analytics.dim_location)
[0m22:49:12.896491 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_fx_rate, now model.glamira_analytics.dim_date)
[0m22:49:12.897153 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.dim_product
[0m22:49:12.898160 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_fact_sales_order_tt, now model.glamira_analytics.dim_fx_rate_usd)
[0m22:49:12.899143 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.dim_location
[0m22:49:12.899894 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.dim_date
[0m22:49:12.903644 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.dim_product"
[0m22:49:12.904491 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.dim_fx_rate_usd
[0m22:49:12.911093 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.dim_location"
[0m22:49:12.916677 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.dim_date"
[0m22:49:12.922903 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.dim_fx_rate_usd"
[0m22:49:12.924602 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.dim_product
[0m22:49:12.942390 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:49:12.945893 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.dim_date
[0m22:49:12.946724 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.dim_fx_rate_usd
[0m22:49:12.947524 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.dim_location
[0m22:49:12.952335 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:49:12.956296 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:49:12.960434 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:49:13.899004 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.dim_date"
[0m22:49:13.901806 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.dim_product"
[0m22:49:13.903436 [debug] [Thread-4 (]: On model.glamira_analytics.dim_date: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_date"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_date`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_date__source AS (
    SELECT DISTINCT 
        DATE(time_stamp) AS full_date
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
    WHERE time_stamp IS NOT NULL
)

, dim_date__format AS (
    SELECT
        CAST(FORMAT_DATE('%Y%m%d', full_date) AS INT64) AS date_key
        ,full_date AS date_day
        ,FORMAT_DATE('%A', full_date) AS day_name
        ,CASE
            WHEN FORMAT_DATE('%A', full_date) IN ('Saturday', 'Sunday') THEN TRUE
            ELSE FALSE
        END AS is_weekend
        ,CAST(FORMAT_DATE('%d', full_date) AS INT64) AS day_of_month
        ,FORMAT_DATE('%Y-%m', full_date) AS year_month
        ,CAST(FORMAT_DATE('%m', full_date) AS INT64) AS month_of_year
        ,CAST(FORMAT_DATE('%j', full_date) AS INT64) AS day_of_year
        ,CAST(FORMAT_DATE('%W', full_date) AS INT64) AS week_of_year
        ,CAST(FORMAT_DATE('%Q', full_date) AS INT64) AS quarter_of_year
        ,CAST(FORMAT_DATE('%Y', full_date) AS INT64) AS year_number
    FROM dim_date__source
)

SELECT 
    *
FROM dim_date__format
ORDER BY date_key
    );
  
[0m22:49:13.905075 [debug] [Thread-2 (]: On model.glamira_analytics.dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_product"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_product__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
)

, dim_product__null_handle AS (
    SELECT
        product_id,
        COALESCE(product_name, 'Undefined') AS product_name,
        COALESCE(product_url, 'Undefined') AS product_url,
        COALESCE(product_sku, 'Undefined') AS product_sku,
        COALESCE(product_type, 'Undefined') AS product_type,
        COALESCE(NULLIF(TRIM(category_name), ''), 'Undefined') AS category_name, 
        COALESCE(NULLIF(TRIM(collection_name), ''), 'Undefined') AS collection_name,
        min_price,
        max_price
    FROM dim_product__source 
)

, dim_product__add_key AS (
    SELECT
        FARM_FINGERPRINT(CAST(product_id AS STRING)) AS product_key,
        *
    FROM dim_product__null_handle
)

, dim_product__union_undefined AS (
    SELECT 
        * FROM dim_product__add_key

    UNION ALL

    SELECT 
        -1 AS product_key,
        -1 AS product_id,
        'Undefined' AS product_name,
        'Undefined' AS product_url,
        'Undefined' AS product_sku,
        'Undefined' AS product_type,
        'Undefined' AS category_name,
        'Undefined' AS collection_name,
        0 AS min_price,
        0 AS max_price
)

SELECT * FROM dim_product__union_undefined
    );
  
[0m22:49:13.913813 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.dim_fx_rate_usd"
[0m22:49:13.915197 [debug] [Thread-3 (]: On model.glamira_analytics.dim_fx_rate_usd: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_fx_rate_usd"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_fx_rate_usd`
      
    
    

    
    OPTIONS()
    as (
      WITH stg_fx AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
)

SELECT
    currency_code AS from_currency_code
    ,'USD' AS to_currency_code
    ,rate_to_usd
    ,rate_timestamp
FROM stg_fx
    );
  
[0m22:49:13.967750 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.dim_location"
[0m22:49:13.969371 [debug] [Thread-1 (]: On model.glamira_analytics.dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_location"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_location`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_location__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
)

, dim_location__union_undefined AS (
    SELECT
        location_id,
        ip_address,
        country_short_name,
        country_long_name,
        region_name,
        city_name
    FROM dim_location__source

    UNION ALL

    SELECT
        -1 AS location_id,   -- FIX: Must be INT64 to match the Fact table
        'Undefined' AS ip_address,
        'Undefined' AS country_short_name,
        'Undefined' AS country_long_name,
        'Undefined' AS region_name,
        'Undefined' AS city_name
)

SELECT * FROM dim_location__union_undefined
    );
  
[0m22:49:14.581412 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:48ba7138-43a2-459a-b148-946610906c45&page=queryresults
[0m22:49:14.582305 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:ec5982ed-6083-4cea-9d73-8db776822309&page=queryresults
[0m22:49:14.683222 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:62f3710f-4943-490d-9069-5aee5bd5eeed&page=queryresults
[0m22:49:14.786634 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:5ca36224-5abf-4e14-958d-55c9428a0f34&page=queryresults
[0m22:49:16.423311 [debug] [Thread-3 (]: SQL status: OK in 1.636 seconds
[0m22:49:16.733231 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1CD7D2040>]}
[0m22:49:16.734315 [info ] [Thread-3 (]: 8 of 15 OK created sql table model analytics_dev_dimensions.dim_fx_rate_usd .... [[32mCREATE TABLE (34.0 rows, 1.3 KiB processed)[0m in 3.84s]
[0m22:49:16.736544 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_fx_rate_usd
[0m22:49:16.737381 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_store
[0m22:49:16.738239 [info ] [Thread-3 (]: 9 of 15 START sql table model analytics_dev_dimensions.dim_store ............... [RUN]
[0m22:49:16.739958 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_fx_rate_usd, now model.glamira_analytics.dim_store)
[0m22:49:16.740617 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.dim_store
[0m22:49:16.744809 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.dim_store"
[0m22:49:16.746264 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.dim_store
[0m22:49:16.754592 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:49:17.651881 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.dim_store"
[0m22:49:17.653459 [debug] [Thread-3 (]: On model.glamira_analytics.dim_store: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_store"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_store`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_store__source AS (
    SELECT DISTINCT 
        store_id
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
    WHERE store_id IS NOT NULL
)

, dim_store__add_key AS (
    SELECT
        FARM_FINGERPRINT(CAST(store_id AS STRING)) AS store_key
        ,CAST(store_id AS STRING) AS store_id
        ,CONCAT('Store ', CAST(store_id AS STRING)) AS store_name
    FROM dim_store__source 
)

SELECT 
    *
FROM dim_store__add_key
ORDER BY store_id
    );
  
[0m22:49:17.941580 [debug] [Thread-2 (]: SQL status: OK in 3.358 seconds
[0m22:49:18.165561 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1CD7C5430>]}
[0m22:49:18.166606 [info ] [Thread-2 (]: 5 of 15 OK created sql table model analytics_dev_dimensions.dim_product ........ [[32mCREATE TABLE (18.6k rows, 2.7 MiB processed)[0m in 5.27s]
[0m22:49:18.167807 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.dim_product
[0m22:49:18.168471 [debug] [Thread-2 (]: Began running node model.glamira_analytics.dim_user
[0m22:49:18.169274 [info ] [Thread-2 (]: 10 of 15 START sql table model analytics_dev_dimensions.dim_user ............... [RUN]
[0m22:49:18.170188 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_product, now model.glamira_analytics.dim_user)
[0m22:49:18.170871 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.dim_user
[0m22:49:18.174538 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.dim_user"
[0m22:49:18.175858 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.dim_user
[0m22:49:18.178987 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:49:18.385797 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:9f30d761-1a8c-4b12-9af8-0f8c403ec075&page=queryresults
[0m22:49:18.982063 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.dim_user"
[0m22:49:18.983870 [debug] [Thread-2 (]: On model.glamira_analytics.dim_user: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_user"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_user`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_user__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
)

, dim_user__dedup AS (
    SELECT
        user_id,
        -- We select the most recent location for the user
        ARRAY_AGG(location_id ORDER BY time_stamp DESC LIMIT 1)[OFFSET(0)] AS location_id,
        MAX(time_stamp) AS last_active_at
    FROM dim_user__source
    WHERE user_id IS NOT NULL
    GROUP BY user_id
)

SELECT 
    user_id,
    location_id,
    last_active_at
FROM dim_user__dedup
    );
  
[0m22:49:19.698270 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:fafbd121-7b9e-4c3a-9b1d-ed909de41440&page=queryresults
[0m22:49:20.252758 [debug] [Thread-1 (]: SQL status: OK in 5.569 seconds
[0m22:49:20.520105 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1CDE2C6B0>]}
[0m22:49:20.521181 [info ] [Thread-1 (]: 6 of 15 OK created sql table model analytics_dev_dimensions.dim_location ....... [[32mCREATE TABLE (2.1m rows, 189.5 MiB processed)[0m in 7.62s]
[0m22:49:20.523013 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_location
[0m22:49:20.523683 [debug] [Thread-1 (]: Began running node model.glamira_analytics.fact_sales_order_tt
[0m22:49:20.524540 [info ] [Thread-1 (]: 11 of 15 START sql table model analytics_dev_dimensions.fact_sales_order_tt .... [RUN]
[0m22:49:20.525424 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_location, now model.glamira_analytics.fact_sales_order_tt)
[0m22:49:20.526126 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.fact_sales_order_tt
[0m22:49:20.530179 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.fact_sales_order_tt"
[0m22:49:20.531572 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.fact_sales_order_tt
[0m22:49:20.535117 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:49:21.438595 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.fact_sales_order_tt"
[0m22:49:21.440222 [debug] [Thread-1 (]: On model.glamira_analytics.fact_sales_order_tt: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.fact_sales_order_tt"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
      
    
    

    
    OPTIONS()
    as (
      WITH fact_sales_order_tt__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
)

, fact_sales_order_tt__fields AS (
    SELECT
        order_id,
        product_id,
        user_id,
        store_id,
        location_id,
        time_stamp,
        local_time,
        currency_code,
        quantity,
        -- FIX: Use line_total instead of price
        line_total AS sales_amount,
        line_total AS gross_revenue
    FROM fact_sales_order_tt__source
)

SELECT * FROM fact_sales_order_tt__fields
    );
  
[0m22:49:21.846926 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:a2aac6bb-e55c-4c58-8989-440aea3502bc&page=queryresults
[0m22:49:23.998738 [debug] [Thread-3 (]: SQL status: OK in 5.612 seconds
[0m22:49:24.001044 [debug] [Thread-2 (]: SQL status: OK in 4.302 seconds
[0m22:49:24.204378 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1CDE2FEF0>]}
[0m22:49:24.205479 [info ] [Thread-2 (]: 10 of 15 OK created sql table model analytics_dev_dimensions.dim_user .......... [[32mCREATE TABLE (8.7k rows, 5.7 GiB processed)[0m in 6.03s]
[0m22:49:24.210206 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1CD50D8B0>]}
[0m22:49:24.211328 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.dim_user
[0m22:49:24.212365 [info ] [Thread-3 (]: 9 of 15 OK created sql table model analytics_dev_dimensions.dim_store .......... [[32mCREATE TABLE (57.0 rows, 5.7 GiB processed)[0m in 7.47s]
[0m22:49:24.213882 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_store
[0m22:49:26.058944 [debug] [Thread-4 (]: SQL status: OK in 11.476 seconds
[0m22:49:26.255003 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1CDE2D490>]}
[0m22:49:26.256141 [info ] [Thread-4 (]: 7 of 15 OK created sql table model analytics_dev_dimensions.dim_date ........... [[32mCREATE TABLE (43.0 rows, 5.7 GiB processed)[0m in 13.36s]
[0m22:49:26.257371 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.dim_date
[0m22:49:26.451341 [debug] [Thread-1 (]: SQL status: OK in 4.603 seconds
[0m22:49:26.762042 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1CDE2C2F0>]}
[0m22:49:26.763114 [info ] [Thread-1 (]: 11 of 15 OK created sql table model analytics_dev_dimensions.fact_sales_order_tt  [[32mCREATE TABLE (31.4k rows, 6.0 GiB processed)[0m in 6.24s]
[0m22:49:26.764390 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.fact_sales_order_tt
[0m22:49:26.765579 [debug] [Thread-4 (]: Began running node model.glamira_analytics.mart_product
[0m22:49:26.766268 [debug] [Thread-3 (]: Began running node model.glamira_analytics.mart_overall
[0m22:49:26.766896 [debug] [Thread-1 (]: Began running node model.glamira_analytics.mart_product_type
[0m22:49:26.768210 [debug] [Thread-2 (]: Began running node model.glamira_analytics.mart_country
[0m22:49:26.767693 [info ] [Thread-4 (]: 14 of 15 START sql view model analytics_dev.mart_product ....................... [RUN]
[0m22:49:26.769187 [info ] [Thread-3 (]: 13 of 15 START sql view model analytics_dev.mart_overall ....................... [RUN]
[0m22:49:26.770139 [info ] [Thread-1 (]: 15 of 15 START sql view model analytics_dev.mart_product_type .................. [RUN]
[0m22:49:26.772355 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_date, now model.glamira_analytics.mart_product)
[0m22:49:26.771314 [info ] [Thread-2 (]: 12 of 15 START sql view model analytics_dev.mart_country ....................... [RUN]
[0m22:49:26.773301 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_store, now model.glamira_analytics.mart_overall)
[0m22:49:26.774044 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.fact_sales_order_tt, now model.glamira_analytics.mart_product_type)
[0m22:49:26.774779 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.mart_product
[0m22:49:26.775434 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_user, now model.glamira_analytics.mart_country)
[0m22:49:26.776164 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.mart_overall
[0m22:49:26.777052 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.mart_product_type
[0m22:49:26.783286 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.mart_product"
[0m22:49:26.784183 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.mart_country
[0m22:49:26.788981 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.mart_overall"
[0m22:49:26.793100 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.mart_product_type"
[0m22:49:26.798026 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.mart_country"
[0m22:49:26.799955 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.mart_product
[0m22:49:26.805541 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.mart_product"
[0m22:49:26.806360 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.mart_overall
[0m22:49:26.807326 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.mart_country
[0m22:49:26.813049 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.mart_overall"
[0m22:49:26.813809 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.mart_product_type
[0m22:49:26.817837 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.mart_country"
[0m22:49:26.823390 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.mart_product_type"
[0m22:49:26.824335 [debug] [Thread-4 (]: On model.glamira_analytics.mart_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.mart_product"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev`.`mart_product`
  OPTIONS()
  as WITH mart_product__fact AS (
    SELECT * FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
)

, mart_product__dim AS (
    SELECT * FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
)

, mart_product__joined AS (
    SELECT
        f.order_id,
        f.sales_amount,
        f.quantity,
        f.time_stamp,
        p.product_name,
        p.category_name,
        p.collection_name
    FROM mart_product__fact f
    LEFT JOIN mart_product__dim p
        ON f.product_id = p.product_id
)

, mart_product__aggs AS (
    SELECT
        product_name,
        category_name,
        collection_name,
        COUNT(DISTINCT order_id) AS total_orders,
        SUM(sales_amount) AS total_revenue,
        SUM(quantity) AS total_quantity_sold
    FROM mart_product__joined
    GROUP BY 1, 2, 3
)

SELECT * FROM mart_product__aggs;


[0m22:49:26.825378 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:49:26.828541 [debug] [Thread-1 (]: On model.glamira_analytics.mart_product_type: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.mart_product_type"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev`.`mart_product_type`
  OPTIONS()
  as WITH mart_product_type__fact AS (
    SELECT * FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
)

, mart_product_type__dim AS (
    SELECT * FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
)

, mart_product_type__joined AS (
    SELECT
        f.order_id,
        f.sales_amount,
        p.product_type
    FROM mart_product_type__fact f
    LEFT JOIN mart_product_type__dim p
        ON f.product_id = p.product_id
)

, mart_product_type__aggs AS (
    SELECT
        product_type,
        COUNT(DISTINCT order_id) AS total_orders,
        SUM(sales_amount) AS total_revenue
    FROM mart_product_type__joined
    GROUP BY 1
)

SELECT * FROM mart_product_type__aggs;


[0m22:49:26.829654 [debug] [Thread-2 (]: On model.glamira_analytics.mart_country: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.mart_country"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev`.`mart_country`
  OPTIONS()
  as WITH mart_country__fact AS (
    SELECT * FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
)

, mart_country__dim AS (
    SELECT * FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_location`
)

, mart_country__joined AS (
    SELECT
        f.order_id,
        f.sales_amount,
        l.country_short_name,
        l.country_long_name,
        l.region_name,
        l.city_name
    FROM mart_country__fact f
    LEFT JOIN mart_country__dim l
        -- FIX: Casting both to STRING ensures they match regardless of data type
        ON CAST(f.location_id AS STRING) = CAST(l.location_id AS STRING)
)

, mart_country__aggs AS (
    SELECT
        country_short_name,
        country_long_name,
        region_name,
        city_name,
        COUNT(DISTINCT order_id) AS total_orders,
        SUM(sales_amount) AS total_revenue
    FROM mart_country__joined
    GROUP BY 1, 2, 3, 4
)

SELECT * FROM mart_country__aggs;


[0m22:49:26.830667 [debug] [Thread-3 (]: On model.glamira_analytics.mart_overall: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.mart_overall"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev`.`mart_overall`
  OPTIONS()
  as WITH mart_overall__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
)

, mart_overall__aggs AS (
    SELECT
        DATE(time_stamp) AS date_day,
        COUNT(DISTINCT order_id) AS total_orders,
        SUM(sales_amount) AS total_revenue,
        SUM(quantity) AS total_items_sold
    FROM mart_overall__source
    GROUP BY 1
)

SELECT * FROM mart_overall__aggs;


[0m22:49:26.831464 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:49:26.832374 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:49:26.833233 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:49:27.884235 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:21b24243-e522-45b0-af21-a16d16363de2&page=queryresults
[0m22:49:27.887400 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:c7ffcddd-f081-4ebf-9273-5b6be18aaf4c&page=queryresults
[0m22:49:27.888216 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:c9c4f1b9-e310-4c9e-b1bd-2bf77f586795&page=queryresults
[0m22:49:27.888957 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:766b9428-cfe6-471a-a42e-bb4f8d7f6d35&page=queryresults
[0m22:49:28.295029 [debug] [Thread-2 (]: SQL status: OK in 0.405 seconds
[0m22:49:28.295980 [debug] [Thread-4 (]: SQL status: OK in 0.406 seconds
[0m22:49:28.299351 [debug] [Thread-1 (]: SQL status: OK in 0.409 seconds
[0m22:49:28.300173 [debug] [Thread-3 (]: SQL status: OK in 0.414 seconds
[0m22:49:28.302541 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1AA58DA30>]}
[0m22:49:28.310782 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1CDF49130>]}
[0m22:49:28.315939 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1CDF4A150>]}
[0m22:49:28.318325 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e7e8770a-d771-4023-a58e-1cc28b1c2b52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1CDF48BF0>]}
[0m22:49:28.319322 [info ] [Thread-2 (]: 12 of 15 OK created sql view model analytics_dev.mart_country .................. [[32mCREATE VIEW (0 processed)[0m in 1.53s]
[0m22:49:28.320170 [info ] [Thread-4 (]: 14 of 15 OK created sql view model analytics_dev.mart_product .................. [[32mCREATE VIEW (0 processed)[0m in 1.54s]
[0m22:49:28.321278 [info ] [Thread-1 (]: 15 of 15 OK created sql view model analytics_dev.mart_product_type ............. [[32mCREATE VIEW (0 processed)[0m in 1.54s]
[0m22:49:28.323560 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.mart_country
[0m22:49:28.322435 [info ] [Thread-3 (]: 13 of 15 OK created sql view model analytics_dev.mart_overall .................. [[32mCREATE VIEW (0 processed)[0m in 1.55s]
[0m22:49:28.324678 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.mart_product
[0m22:49:28.326067 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.mart_product_type
[0m22:49:28.327352 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.mart_overall
[0m22:49:28.329657 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:49:28.330595 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:49:28.331108 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:49:28.331638 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:49:28.332457 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:49:28.333124 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_dimensions' was properly closed.
[0m22:49:28.333771 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev' was properly closed.
[0m22:49:28.334311 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_staging' was properly closed.
[0m22:49:28.334832 [debug] [MainThread]: Connection 'model.glamira_analytics.mart_overall' was properly closed.
[0m22:49:28.335354 [debug] [MainThread]: Connection 'model.glamira_analytics.mart_product' was properly closed.
[0m22:49:28.335824 [debug] [MainThread]: Connection 'model.glamira_analytics.mart_product_type' was properly closed.
[0m22:49:28.336237 [debug] [MainThread]: Connection 'model.glamira_analytics.mart_country' was properly closed.
[0m22:49:28.336781 [info ] [MainThread]: 
[0m22:49:28.337458 [info ] [MainThread]: Finished running 7 table models, 8 view models in 0 hours 0 minutes and 20.05 seconds (20.05s).
[0m22:49:28.344523 [debug] [MainThread]: Command end result
[0m22:49:28.383378 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:49:28.386328 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:49:28.395708 [debug] [MainThread]: Wrote artifact RunExecutionResult to D:\Project 7\glamira_analytics\target\run_results.json
[0m22:49:28.396246 [info ] [MainThread]: 
[0m22:49:28.397072 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:49:28.397805 [info ] [MainThread]: 
[0m22:49:28.398375 [info ] [MainThread]: Done. PASS=15 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=15
[0m22:49:28.399479 [debug] [MainThread]: Command `dbt run` succeeded at 22:49:28.399310 after 32.16 seconds
[0m22:49:28.399984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1CD763EF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1CDF496D0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001F1CDF4A030>]}
[0m22:49:28.400459 [debug] [MainThread]: Flushing usage events
[0m22:49:30.442485 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:52:39.564383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E54BED8EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E54D03FED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E54D03FB10>]}


============================== 22:52:39.570983 | 443683cd-9de2-4458-ad1c-bc85be5c5081 ==============================
[0m22:52:39.570983 [info ] [MainThread]: Running with dbt=1.11.2
[0m22:52:39.572053 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'no_print': 'None', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'write_json': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'empty': 'None', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'invocation_command': 'dbt test', 'indirect_selection': 'eager', 'use_colors': 'True', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m22:52:49.512247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '443683cd-9de2-4458-ad1c-bc85be5c5081', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E54C371BA0>]}
[0m22:52:49.590690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '443683cd-9de2-4458-ad1c-bc85be5c5081', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E56BCAB570>]}
[0m22:52:49.591542 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m22:52:50.470857 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m22:52:50.701979 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:52:50.703019 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\dimensions\schema.yml
[0m22:52:50.974204 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `relationships` defined on
'fact_sales_order_tt' in package 'glamira_analytics'
(models\dimensions\schema.yml). Arguments to generic tests should be nested
under the `arguments` property.
[0m22:52:50.975442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '443683cd-9de2-4458-ad1c-bc85be5c5081', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E56C7CC850>]}
[0m22:52:51.162011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '443683cd-9de2-4458-ad1c-bc85be5c5081', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E56C719D60>]}
[0m22:52:51.298617 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:52:51.302031 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:52:51.363642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '443683cd-9de2-4458-ad1c-bc85be5c5081', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E55CB18590>]}
[0m22:52:51.364291 [info ] [MainThread]: Found 15 models, 1 seed, 19 data tests, 3 sources, 537 macros
[0m22:52:51.364954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '443683cd-9de2-4458-ad1c-bc85be5c5081', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E56CA7BAD0>]}
[0m22:52:51.369177 [info ] [MainThread]: 
[0m22:52:51.369897 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:52:51.370865 [info ] [MainThread]: 
[0m22:52:51.371927 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:52:51.378893 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_staging'
[0m22:52:51.379880 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:52:51.380777 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev'
[0m22:52:51.382030 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:52:51.383203 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_dimensions'
[0m22:52:51.384463 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:52:53.481620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '443683cd-9de2-4458-ad1c-bc85be5c5081', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E56CAC4E90>]}
[0m22:52:53.482403 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:52:53.488796 [debug] [Thread-4 (]: Began running node test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3
[0m22:52:53.489516 [debug] [Thread-3 (]: Began running node test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3
[0m22:52:53.490119 [debug] [Thread-1 (]: Began running node test.glamira_analytics.not_null_dim_location_location_id.8635435d86
[0m22:52:53.490729 [debug] [Thread-2 (]: Began running node test.glamira_analytics.not_null_dim_product_product_id.02b1f06816
[0m22:52:53.491347 [info ] [Thread-4 (]: 4 of 19 START test not_null_dim_user_user_id ................................... [RUN]
[0m22:52:53.491893 [info ] [Thread-3 (]: 3 of 19 START test not_null_dim_product_product_key ............................ [RUN]
[0m22:52:53.492653 [info ] [Thread-1 (]: 1 of 19 START test not_null_dim_location_location_id ........................... [RUN]
[0m22:52:53.494385 [debug] [Thread-4 (]: Acquiring new bigquery connection 'test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3'
[0m22:52:53.493409 [info ] [Thread-2 (]: 2 of 19 START test not_null_dim_product_product_id ............................. [RUN]
[0m22:52:53.495389 [debug] [Thread-3 (]: Acquiring new bigquery connection 'test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3'
[0m22:52:53.496151 [debug] [Thread-1 (]: Acquiring new bigquery connection 'test.glamira_analytics.not_null_dim_location_location_id.8635435d86'
[0m22:52:53.496831 [debug] [Thread-4 (]: Began compiling node test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3
[0m22:52:53.497611 [debug] [Thread-2 (]: Acquiring new bigquery connection 'test.glamira_analytics.not_null_dim_product_product_id.02b1f06816'
[0m22:52:53.498244 [debug] [Thread-3 (]: Began compiling node test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3
[0m22:52:53.498839 [debug] [Thread-1 (]: Began compiling node test.glamira_analytics.not_null_dim_location_location_id.8635435d86
[0m22:52:53.517370 [debug] [Thread-4 (]: Writing injected SQL for node "test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3"
[0m22:52:53.518226 [debug] [Thread-2 (]: Began compiling node test.glamira_analytics.not_null_dim_product_product_id.02b1f06816
[0m22:52:53.523878 [debug] [Thread-3 (]: Writing injected SQL for node "test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3"
[0m22:52:53.531233 [debug] [Thread-1 (]: Writing injected SQL for node "test.glamira_analytics.not_null_dim_location_location_id.8635435d86"
[0m22:52:53.539892 [debug] [Thread-2 (]: Writing injected SQL for node "test.glamira_analytics.not_null_dim_product_product_id.02b1f06816"
[0m22:52:53.542183 [debug] [Thread-3 (]: Began executing node test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3
[0m22:52:53.577961 [debug] [Thread-3 (]: Writing runtime sql for node "test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3"
[0m22:52:53.578979 [debug] [Thread-1 (]: Began executing node test.glamira_analytics.not_null_dim_location_location_id.8635435d86
[0m22:52:53.579919 [debug] [Thread-4 (]: Began executing node test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3
[0m22:52:53.584072 [debug] [Thread-1 (]: Writing runtime sql for node "test.glamira_analytics.not_null_dim_location_location_id.8635435d86"
[0m22:52:53.584866 [debug] [Thread-2 (]: Began executing node test.glamira_analytics.not_null_dim_product_product_id.02b1f06816
[0m22:52:53.589866 [debug] [Thread-4 (]: Writing runtime sql for node "test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3"
[0m22:52:53.598799 [debug] [Thread-2 (]: Writing runtime sql for node "test.glamira_analytics.not_null_dim_product_product_id.02b1f06816"
[0m22:52:53.601284 [debug] [Thread-1 (]: On test.glamira_analytics.not_null_dim_location_location_id.8635435d86: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_dim_location_location_id.8635435d86"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select location_id
from `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_location`
where location_id is null



  
  
      
    ) dbt_internal_test
[0m22:52:53.602522 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m22:52:53.603427 [debug] [Thread-3 (]: On test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select product_key
from `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
where product_key is null



  
  
      
    ) dbt_internal_test
[0m22:52:53.605200 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:52:53.607549 [debug] [Thread-4 (]: On test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select user_id
from `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_user`
where user_id is null



  
  
      
    ) dbt_internal_test
[0m22:52:53.608922 [debug] [Thread-2 (]: On test.glamira_analytics.not_null_dim_product_product_id.02b1f06816: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_dim_product_product_id.02b1f06816"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select product_id
from `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
where product_id is null



  
  
      
    ) dbt_internal_test
[0m22:52:53.609693 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:52:53.611510 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:52:54.900536 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:b255101c-2dea-4b26-896c-913309d32ea7&page=queryresults
[0m22:52:54.903834 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:091d99a2-aa3c-41a2-b795-c5ac8d7ba93d&page=queryresults
[0m22:52:54.904721 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:01397c1e-bb36-4346-92e3-6483439b03a9&page=queryresults
[0m22:52:54.906953 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:a90b5ae0-08ba-45cb-ac99-47f3d871bd2d&page=queryresults
[0m22:52:55.109019 [debug] [Thread-2 (]: SQL status: OK in 0.203 seconds
[0m22:52:55.110367 [debug] [Thread-3 (]: SQL status: OK in 0.208 seconds
[0m22:52:55.111705 [debug] [Thread-1 (]: SQL status: OK in 0.206 seconds
[0m22:52:55.209745 [debug] [Thread-4 (]: SQL status: OK in 0.301 seconds
[0m22:52:55.643315 [info ] [Thread-3 (]: 3 of 19 PASS not_null_dim_product_product_key .................................. [[32mPASS[0m in 2.15s]
[0m22:52:55.645696 [debug] [Thread-3 (]: Finished running node test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3
[0m22:52:55.646930 [debug] [Thread-3 (]: Began running node test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43
[0m22:52:55.649843 [info ] [Thread-3 (]: 5 of 19 START test not_null_fact_sales_order_tt_location_id .................... [RUN]
[0m22:52:55.658677 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3, now test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43)
[0m22:52:55.659512 [debug] [Thread-3 (]: Began compiling node test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43
[0m22:52:55.655232 [info ] [Thread-1 (]: 1 of 19 PASS not_null_dim_location_location_id ................................. [[32mPASS[0m in 2.16s]
[0m22:52:55.669345 [debug] [Thread-3 (]: Writing injected SQL for node "test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43"
[0m22:52:55.657964 [info ] [Thread-4 (]: 4 of 19 PASS not_null_dim_user_user_id ......................................... [[32mPASS[0m in 2.16s]
[0m22:52:55.670627 [debug] [Thread-1 (]: Finished running node test.glamira_analytics.not_null_dim_location_location_id.8635435d86
[0m22:52:55.662325 [info ] [Thread-2 (]: 2 of 19 PASS not_null_dim_product_product_id ................................... [[32mPASS[0m in 2.16s]
[0m22:52:55.672840 [debug] [Thread-4 (]: Finished running node test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3
[0m22:52:55.674167 [debug] [Thread-1 (]: Began running node test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6
[0m22:52:55.675660 [debug] [Thread-2 (]: Finished running node test.glamira_analytics.not_null_dim_product_product_id.02b1f06816
[0m22:52:55.676821 [debug] [Thread-4 (]: Began running node test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1
[0m22:52:55.678777 [debug] [Thread-2 (]: Began running node test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f
[0m22:52:55.677835 [info ] [Thread-1 (]: 6 of 19 START test not_null_fact_sales_order_tt_order_id ....................... [RUN]
[0m22:52:55.681529 [debug] [Thread-3 (]: Began executing node test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43
[0m22:52:55.680379 [info ] [Thread-4 (]: 7 of 19 START test not_null_fact_sales_order_tt_product_id ..................... [RUN]
[0m22:52:55.684191 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_dim_location_location_id.8635435d86, now test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6)
[0m22:52:55.682570 [info ] [Thread-2 (]: 8 of 19 START test not_null_mart_overall_date_day .............................. [RUN]
[0m22:52:55.689419 [debug] [Thread-3 (]: Writing runtime sql for node "test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43"
[0m22:52:55.690262 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3, now test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1)
[0m22:52:55.691328 [debug] [Thread-1 (]: Began compiling node test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6
[0m22:52:55.692735 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_dim_product_product_id.02b1f06816, now test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f)
[0m22:52:55.694043 [debug] [Thread-4 (]: Began compiling node test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1
[0m22:52:55.703945 [debug] [Thread-1 (]: Writing injected SQL for node "test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6"
[0m22:52:55.705117 [debug] [Thread-2 (]: Began compiling node test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f
[0m22:52:55.711531 [debug] [Thread-3 (]: On test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select location_id
from `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
where location_id is null



  
  
      
    ) dbt_internal_test
[0m22:52:55.714610 [debug] [Thread-4 (]: Writing injected SQL for node "test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1"
[0m22:52:55.725835 [debug] [Thread-2 (]: Writing injected SQL for node "test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f"
[0m22:52:55.726920 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:52:55.728733 [debug] [Thread-1 (]: Began executing node test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6
[0m22:52:55.735482 [debug] [Thread-1 (]: Writing runtime sql for node "test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6"
[0m22:52:55.738223 [debug] [Thread-4 (]: Began executing node test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1
[0m22:52:55.744102 [debug] [Thread-4 (]: Writing runtime sql for node "test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1"
[0m22:52:55.744955 [debug] [Thread-2 (]: Began executing node test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f
[0m22:52:55.753227 [debug] [Thread-2 (]: Writing runtime sql for node "test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f"
[0m22:52:55.754531 [debug] [Thread-1 (]: On test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
where order_id is null



  
  
      
    ) dbt_internal_test
[0m22:52:55.756424 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:52:55.758242 [debug] [Thread-4 (]: On test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select product_id
from `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
where product_id is null



  
  
      
    ) dbt_internal_test
[0m22:52:55.760845 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:52:55.764693 [debug] [Thread-2 (]: On test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date_day
from `stone-album-475912-b9`.`analytics_dev`.`mart_overall`
where date_day is null



  
  
      
    ) dbt_internal_test
[0m22:52:55.766432 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:52:56.963437 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:333c9bfe-ed9a-4a93-bee6-84971ea2ca65&page=queryresults
[0m22:52:56.965951 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:327aeeef-b4d3-4717-90d6-f5c5ef51d00f&page=queryresults
[0m22:52:56.998917 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:c0894315-dcb4-49e6-ad89-2f8f18bec3ac&page=queryresults
[0m22:52:57.153078 [debug] [Thread-4 (]: SQL status: OK in 0.153 seconds
[0m22:52:57.154186 [debug] [Thread-1 (]: SQL status: OK in 0.187 seconds
[0m22:52:57.164705 [debug] [Thread-3 (]: SQL status: OK in 0.200 seconds
[0m22:52:57.298868 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:3c269311-aac9-4558-99ea-78ee6d91dea9&page=queryresults
[0m22:52:57.477796 [debug] [Thread-2 (]: SQL status: OK in 0.178 seconds
[0m22:52:57.512038 [info ] [Thread-1 (]: 6 of 19 PASS not_null_fact_sales_order_tt_order_id ............................. [[32mPASS[0m in 1.83s]
[0m22:52:57.513518 [debug] [Thread-1 (]: Finished running node test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6
[0m22:52:57.514384 [debug] [Thread-1 (]: Began running node test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b
[0m22:52:57.515331 [info ] [Thread-1 (]: 9 of 19 START test not_null_mart_product_type_product_type ..................... [RUN]
[0m22:52:57.516630 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6, now test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b)
[0m22:52:57.517529 [debug] [Thread-1 (]: Began compiling node test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b
[0m22:52:57.524300 [debug] [Thread-1 (]: Writing injected SQL for node "test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b"
[0m22:52:57.531136 [info ] [Thread-4 (]: 7 of 19 PASS not_null_fact_sales_order_tt_product_id ........................... [[32mPASS[0m in 1.84s]
[0m22:52:57.536186 [debug] [Thread-4 (]: Finished running node test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1
[0m22:52:57.537154 [debug] [Thread-1 (]: Began executing node test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b
[0m22:52:57.534241 [error] [Thread-3 (]: 5 of 19 FAIL 12382 not_null_fact_sales_order_tt_location_id .................... [[31mFAIL 12382[0m in 1.88s]
[0m22:52:57.538186 [debug] [Thread-4 (]: Began running node test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07
[0m22:52:57.542013 [debug] [Thread-1 (]: Writing runtime sql for node "test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b"
[0m22:52:57.543148 [debug] [Thread-3 (]: Finished running node test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43
[0m22:52:57.543909 [info ] [Thread-4 (]: 10 of 19 START test not_null_stg_dim_location_location_id ...................... [RUN]
[0m22:52:57.545202 [debug] [Thread-3 (]: Began running node test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15
[0m22:52:57.546003 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1, now test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07)
[0m22:52:57.547184 [debug] [Thread-4 (]: Began compiling node test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07
[0m22:52:57.546662 [info ] [Thread-3 (]: 11 of 19 START test not_null_stg_fact_sales_order_tt_location_id ............... [RUN]
[0m22:52:57.555229 [debug] [Thread-4 (]: Writing injected SQL for node "test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07"
[0m22:52:57.556005 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43, now test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15)
[0m22:52:57.557058 [debug] [Thread-3 (]: Began compiling node test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15
[0m22:52:57.558034 [debug] [Thread-1 (]: On test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select product_type
from `stone-album-475912-b9`.`analytics_dev`.`mart_product_type`
where product_type is null



  
  
      
    ) dbt_internal_test
[0m22:52:57.563741 [debug] [Thread-3 (]: Writing injected SQL for node "test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15"
[0m22:52:57.564540 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:52:57.566467 [debug] [Thread-4 (]: Began executing node test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07
[0m22:52:57.571752 [debug] [Thread-4 (]: Writing runtime sql for node "test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07"
[0m22:52:57.574248 [debug] [Thread-3 (]: Began executing node test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15
[0m22:52:57.578080 [debug] [Thread-3 (]: Writing runtime sql for node "test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15"
[0m22:52:57.580036 [debug] [Thread-4 (]: On test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select location_id
from `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
where location_id is null



  
  
      
    ) dbt_internal_test
[0m22:52:57.581061 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:52:57.581961 [debug] [Thread-3 (]: On test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select location_id
from `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
where location_id is null



  
  
      
    ) dbt_internal_test
[0m22:52:57.583900 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:52:57.807855 [info ] [Thread-2 (]: 8 of 19 PASS not_null_mart_overall_date_day .................................... [[32mPASS[0m in 2.12s]
[0m22:52:57.809326 [debug] [Thread-2 (]: Finished running node test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f
[0m22:52:57.810095 [debug] [Thread-2 (]: Began running node test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501
[0m22:52:57.810923 [info ] [Thread-2 (]: 12 of 19 START test not_null_stg_fact_sales_order_tt_order_id .................. [RUN]
[0m22:52:57.812263 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f, now test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501)
[0m22:52:57.813304 [debug] [Thread-2 (]: Began compiling node test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501
[0m22:52:57.819987 [debug] [Thread-2 (]: Writing injected SQL for node "test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501"
[0m22:52:57.821707 [debug] [Thread-2 (]: Began executing node test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501
[0m22:52:57.825123 [debug] [Thread-2 (]: Writing runtime sql for node "test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501"
[0m22:52:57.827535 [debug] [Thread-2 (]: On test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
where order_id is null



  
  
      
    ) dbt_internal_test
[0m22:52:57.828472 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:52:59.069952 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:cfc6915f-7563-44ee-a254-8e9d09f649a6&page=queryresults
[0m22:52:59.071806 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:8d194baa-3c33-4f70-88f9-a6578c3d93ad&page=queryresults
[0m22:52:59.236532 [debug] [Thread-4 (]: SQL status: OK in 0.164 seconds
[0m22:52:59.237795 [debug] [Thread-1 (]: SQL status: OK in 0.167 seconds
[0m22:52:59.537857 [info ] [Thread-4 (]: 10 of 19 PASS not_null_stg_dim_location_location_id ............................ [[32mPASS[0m in 1.99s]
[0m22:52:59.539359 [debug] [Thread-4 (]: Finished running node test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07
[0m22:52:59.540197 [debug] [Thread-4 (]: Began running node test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea
[0m22:52:59.541076 [info ] [Thread-4 (]: 13 of 19 START test relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_  [RUN]
[0m22:52:59.542086 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07, now test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea)
[0m22:52:59.542660 [debug] [Thread-4 (]: Began compiling node test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea
[0m22:52:59.551201 [debug] [Thread-4 (]: Writing injected SQL for node "test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea"
[0m22:52:59.553255 [debug] [Thread-4 (]: Began executing node test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea
[0m22:52:59.557477 [debug] [Thread-4 (]: Writing runtime sql for node "test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea"
[0m22:52:59.563758 [debug] [Thread-4 (]: On test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select location_id as from_field
    from `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
    where location_id is not null
),

parent as (
    select location_id as to_field
    from `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_location`
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m22:52:59.564870 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:52:59.647568 [error] [Thread-1 (]: 9 of 19 FAIL 1 not_null_mart_product_type_product_type ......................... [[31mFAIL 1[0m in 2.13s]
[0m22:52:59.649011 [debug] [Thread-1 (]: Finished running node test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b
[0m22:52:59.649904 [debug] [Thread-1 (]: Began running node test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed
[0m22:52:59.650948 [info ] [Thread-1 (]: 14 of 19 START test relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_  [RUN]
[0m22:52:59.652221 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b, now test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed)
[0m22:52:59.653132 [debug] [Thread-1 (]: Began compiling node test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed
[0m22:52:59.662731 [debug] [Thread-1 (]: Writing injected SQL for node "test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed"
[0m22:52:59.664177 [debug] [Thread-1 (]: Began executing node test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed
[0m22:52:59.667993 [debug] [Thread-1 (]: Writing runtime sql for node "test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed"
[0m22:52:59.670212 [debug] [Thread-1 (]: On test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select product_id as from_field
    from `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
    where product_id is not null
),

parent as (
    select product_id as to_field
    from `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m22:52:59.671171 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:53:00.067376 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:e4daa498-2f25-4e50-b933-8d5ffade63e6&page=queryresults
[0m22:53:00.328200 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:973e455f-a9ba-4942-a19b-93fd19ed4e1e&page=queryresults
[0m22:53:00.733557 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:6fd79ca1-4732-4156-98d4-285e22815ccc&page=queryresults
[0m22:53:00.949980 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:6a600c96-7094-4d5e-afa5-1be3b1b3669f&page=queryresults
[0m22:53:00.953602 [debug] [Thread-4 (]: SQL status: OK in 0.219 seconds
[0m22:53:01.141945 [debug] [Thread-1 (]: SQL status: OK in 0.191 seconds
[0m22:53:01.355348 [info ] [Thread-4 (]: 13 of 19 PASS relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_  [[32mPASS[0m in 1.81s]
[0m22:53:01.357326 [debug] [Thread-4 (]: Finished running node test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea
[0m22:53:01.358204 [debug] [Thread-4 (]: Began running node test.glamira_analytics.unique_dim_location_location_id.9acbee647a
[0m22:53:01.358888 [info ] [Thread-4 (]: 15 of 19 START test unique_dim_location_location_id ............................ [RUN]
[0m22:53:01.359837 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea, now test.glamira_analytics.unique_dim_location_location_id.9acbee647a)
[0m22:53:01.360588 [debug] [Thread-4 (]: Began compiling node test.glamira_analytics.unique_dim_location_location_id.9acbee647a
[0m22:53:01.377338 [debug] [Thread-4 (]: Writing injected SQL for node "test.glamira_analytics.unique_dim_location_location_id.9acbee647a"
[0m22:53:01.378634 [debug] [Thread-4 (]: Began executing node test.glamira_analytics.unique_dim_location_location_id.9acbee647a
[0m22:53:01.381935 [debug] [Thread-4 (]: Writing runtime sql for node "test.glamira_analytics.unique_dim_location_location_id.9acbee647a"
[0m22:53:01.388355 [debug] [Thread-4 (]: On test.glamira_analytics.unique_dim_location_location_id.9acbee647a: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.unique_dim_location_location_id.9acbee647a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with dbt_test__target as (

  select location_id as unique_field
  from `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_location`
  where location_id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m22:53:01.390233 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:53:01.419205 [debug] [Thread-2 (]: SQL status: OK in 1.090 seconds
[0m22:53:01.555457 [error] [Thread-1 (]: 14 of 19 FAIL 5411 relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_  [[31mFAIL 5411[0m in 1.90s]
[0m22:53:01.557510 [debug] [Thread-1 (]: Finished running node test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed
[0m22:53:01.558664 [debug] [Thread-1 (]: Began running node test.glamira_analytics.unique_dim_product_product_key.1753236bd0
[0m22:53:01.559540 [info ] [Thread-1 (]: 16 of 19 START test unique_dim_product_product_key ............................. [RUN]
[0m22:53:01.560944 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed, now test.glamira_analytics.unique_dim_product_product_key.1753236bd0)
[0m22:53:01.562142 [debug] [Thread-1 (]: Began compiling node test.glamira_analytics.unique_dim_product_product_key.1753236bd0
[0m22:53:01.571073 [debug] [Thread-1 (]: Writing injected SQL for node "test.glamira_analytics.unique_dim_product_product_key.1753236bd0"
[0m22:53:01.573160 [debug] [Thread-1 (]: Began executing node test.glamira_analytics.unique_dim_product_product_key.1753236bd0
[0m22:53:01.580716 [debug] [Thread-1 (]: Writing runtime sql for node "test.glamira_analytics.unique_dim_product_product_key.1753236bd0"
[0m22:53:01.584769 [debug] [Thread-3 (]: SQL status: OK in 1.516 seconds
[0m22:53:01.586155 [debug] [Thread-1 (]: On test.glamira_analytics.unique_dim_product_product_key.1753236bd0: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.unique_dim_product_product_key.1753236bd0"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with dbt_test__target as (

  select product_key as unique_field
  from `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
  where product_key is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m22:53:01.588560 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:53:01.865490 [info ] [Thread-2 (]: 12 of 19 PASS not_null_stg_fact_sales_order_tt_order_id ........................ [[32mPASS[0m in 4.05s]
[0m22:53:01.867891 [debug] [Thread-2 (]: Finished running node test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501
[0m22:53:01.868976 [debug] [Thread-2 (]: Began running node test.glamira_analytics.unique_dim_user_user_id.eff0a2a278
[0m22:53:01.869974 [info ] [Thread-2 (]: 17 of 19 START test unique_dim_user_user_id .................................... [RUN]
[0m22:53:01.871636 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501, now test.glamira_analytics.unique_dim_user_user_id.eff0a2a278)
[0m22:53:01.872652 [debug] [Thread-2 (]: Began compiling node test.glamira_analytics.unique_dim_user_user_id.eff0a2a278
[0m22:53:01.880885 [debug] [Thread-2 (]: Writing injected SQL for node "test.glamira_analytics.unique_dim_user_user_id.eff0a2a278"
[0m22:53:01.882649 [debug] [Thread-2 (]: Began executing node test.glamira_analytics.unique_dim_user_user_id.eff0a2a278
[0m22:53:01.886891 [debug] [Thread-2 (]: Writing runtime sql for node "test.glamira_analytics.unique_dim_user_user_id.eff0a2a278"
[0m22:53:01.892959 [debug] [Thread-2 (]: On test.glamira_analytics.unique_dim_user_user_id.eff0a2a278: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.unique_dim_user_user_id.eff0a2a278"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with dbt_test__target as (

  select user_id as unique_field
  from `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_user`
  where user_id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m22:53:01.894101 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:53:02.045522 [error] [Thread-3 (]: 11 of 19 FAIL 12382 not_null_stg_fact_sales_order_tt_location_id ............... [[31mFAIL 12382[0m in 4.49s]
[0m22:53:02.047469 [debug] [Thread-3 (]: Finished running node test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15
[0m22:53:02.048481 [debug] [Thread-3 (]: Began running node test.glamira_analytics.unique_mart_overall_date_day.53dd573753
[0m22:53:02.049297 [info ] [Thread-3 (]: 18 of 19 START test unique_mart_overall_date_day ............................... [RUN]
[0m22:53:02.050356 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15, now test.glamira_analytics.unique_mart_overall_date_day.53dd573753)
[0m22:53:02.051146 [debug] [Thread-3 (]: Began compiling node test.glamira_analytics.unique_mart_overall_date_day.53dd573753
[0m22:53:02.058074 [debug] [Thread-3 (]: Writing injected SQL for node "test.glamira_analytics.unique_mart_overall_date_day.53dd573753"
[0m22:53:02.059696 [debug] [Thread-3 (]: Began executing node test.glamira_analytics.unique_mart_overall_date_day.53dd573753
[0m22:53:02.064626 [debug] [Thread-3 (]: Writing runtime sql for node "test.glamira_analytics.unique_mart_overall_date_day.53dd573753"
[0m22:53:02.066534 [debug] [Thread-3 (]: On test.glamira_analytics.unique_mart_overall_date_day.53dd573753: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.unique_mart_overall_date_day.53dd573753"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with dbt_test__target as (

  select date_day as unique_field
  from `stone-album-475912-b9`.`analytics_dev`.`mart_overall`
  where date_day is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m22:53:02.067709 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:53:02.573918 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:c2c6de59-0a78-4dff-983b-0520e9cbccb9&page=queryresults
[0m22:53:02.651805 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:06de3b4d-21f8-45b9-b068-cf38aa3a9db9&page=queryresults
[0m22:53:02.778336 [debug] [Thread-4 (]: SQL status: OK in 0.203 seconds
[0m22:53:02.880525 [debug] [Thread-1 (]: SQL status: OK in 0.228 seconds
[0m22:53:02.901078 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:85a69919-8c74-4665-9ae3-f131451e70b9&page=queryresults
[0m22:53:03.084846 [debug] [Thread-2 (]: SQL status: OK in 0.183 seconds
[0m22:53:03.191854 [error] [Thread-4 (]: 15 of 19 FAIL 34573 unique_dim_location_location_id ............................ [[31mFAIL 34573[0m in 1.83s]
[0m22:53:03.193365 [debug] [Thread-4 (]: Finished running node test.glamira_analytics.unique_dim_location_location_id.9acbee647a
[0m22:53:03.194213 [debug] [Thread-4 (]: Began running node test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9
[0m22:53:03.194970 [info ] [Thread-4 (]: 19 of 19 START test unique_stg_dim_location_location_id ........................ [RUN]
[0m22:53:03.195982 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.unique_dim_location_location_id.9acbee647a, now test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9)
[0m22:53:03.196800 [debug] [Thread-4 (]: Began compiling node test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9
[0m22:53:03.204773 [debug] [Thread-4 (]: Writing injected SQL for node "test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9"
[0m22:53:03.206645 [debug] [Thread-4 (]: Began executing node test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9
[0m22:53:03.211714 [debug] [Thread-4 (]: Writing runtime sql for node "test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9"
[0m22:53:03.218177 [debug] [Thread-4 (]: On test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with dbt_test__target as (

  select location_id as unique_field
  from `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
  where location_id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m22:53:03.219651 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:53:03.229193 [info ] [Thread-1 (]: 16 of 19 PASS unique_dim_product_product_key ................................... [[32mPASS[0m in 1.67s]
[0m22:53:03.230588 [debug] [Thread-1 (]: Finished running node test.glamira_analytics.unique_dim_product_product_key.1753236bd0
[0m22:53:03.497626 [info ] [Thread-2 (]: 17 of 19 PASS unique_dim_user_user_id .......................................... [[32mPASS[0m in 1.63s]
[0m22:53:03.499386 [debug] [Thread-2 (]: Finished running node test.glamira_analytics.unique_dim_user_user_id.eff0a2a278
[0m22:53:03.613676 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:03990e93-e774-45fa-88e1-733762530201&page=queryresults
[0m22:53:03.801807 [debug] [Thread-3 (]: SQL status: OK in 0.187 seconds
[0m22:53:04.212367 [info ] [Thread-3 (]: 18 of 19 PASS unique_mart_overall_date_day ..................................... [[32mPASS[0m in 2.16s]
[0m22:53:04.214308 [debug] [Thread-3 (]: Finished running node test.glamira_analytics.unique_mart_overall_date_day.53dd573753
[0m22:53:05.541854 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:8e85a0e1-9dd2-4d74-8c20-9e0f89ad0241&page=queryresults
[0m22:53:08.306763 [debug] [Thread-4 (]: SQL status: OK in 2.764 seconds
[0m22:53:08.717941 [error] [Thread-4 (]: 19 of 19 FAIL 34573 unique_stg_dim_location_location_id ........................ [[31mFAIL 34573[0m in 5.52s]
[0m22:53:08.719265 [debug] [Thread-4 (]: Finished running node test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9
[0m22:53:08.721514 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:53:08.722463 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:53:08.722946 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_staging' was properly closed.
[0m22:53:08.723393 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev' was properly closed.
[0m22:53:08.723835 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_dimensions' was properly closed.
[0m22:53:08.724275 [debug] [MainThread]: Connection 'test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9' was properly closed.
[0m22:53:08.724721 [debug] [MainThread]: Connection 'test.glamira_analytics.unique_mart_overall_date_day.53dd573753' was properly closed.
[0m22:53:08.725206 [debug] [MainThread]: Connection 'test.glamira_analytics.unique_dim_product_product_key.1753236bd0' was properly closed.
[0m22:53:08.725681 [debug] [MainThread]: Connection 'test.glamira_analytics.unique_dim_user_user_id.eff0a2a278' was properly closed.
[0m22:53:08.726344 [info ] [MainThread]: 
[0m22:53:08.727276 [info ] [MainThread]: Finished running 19 data tests in 0 hours 0 minutes and 17.35 seconds (17.35s).
[0m22:53:08.734601 [debug] [MainThread]: Command end result
[0m22:53:08.787278 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:53:08.791150 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:53:08.802055 [debug] [MainThread]: Wrote artifact RunExecutionResult to D:\Project 7\glamira_analytics\target\run_results.json
[0m22:53:08.802647 [info ] [MainThread]: 
[0m22:53:08.803715 [info ] [MainThread]: [31mCompleted with 6 errors, 0 partial successes, and 0 warnings:[0m
[0m22:53:08.807544 [info ] [MainThread]: 
[0m22:53:08.808583 [error] [MainThread]: [31mFailure in test not_null_fact_sales_order_tt_location_id (models\dimensions\schema.yml)[0m
[0m22:53:08.809621 [error] [MainThread]:   Got 12382 results, configured to fail if != 0
[0m22:53:08.810235 [info ] [MainThread]: 
[0m22:53:08.810891 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\dimensions\schema.yml\not_null_fact_sales_order_tt_location_id.sql
[0m22:53:08.811540 [info ] [MainThread]: 
[0m22:53:08.812311 [error] [MainThread]: [31mFailure in test not_null_mart_product_type_product_type (models\dimensions\schema.yml)[0m
[0m22:53:08.813050 [error] [MainThread]:   Got 1 result, configured to fail if != 0
[0m22:53:08.813654 [info ] [MainThread]: 
[0m22:53:08.814619 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\dimensions\schema.yml\not_null_mart_product_type_product_type.sql
[0m22:53:08.815506 [info ] [MainThread]: 
[0m22:53:08.816535 [error] [MainThread]: [31mFailure in test relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_ (models\dimensions\schema.yml)[0m
[0m22:53:08.817965 [error] [MainThread]:   Got 5411 results, configured to fail if != 0
[0m22:53:08.818998 [info ] [MainThread]: 
[0m22:53:08.820105 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\dimensions\schema.yml\relationships_fact_sales_order_e27b9fdb44cab572a8d72ad080483046.sql
[0m22:53:08.820912 [info ] [MainThread]: 
[0m22:53:08.821809 [error] [MainThread]: [31mFailure in test not_null_stg_fact_sales_order_tt_location_id (models\dimensions\schema.yml)[0m
[0m22:53:08.822947 [error] [MainThread]:   Got 12382 results, configured to fail if != 0
[0m22:53:08.823724 [info ] [MainThread]: 
[0m22:53:08.824524 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\dimensions\schema.yml\not_null_stg_fact_sales_order_tt_location_id.sql
[0m22:53:08.825211 [info ] [MainThread]: 
[0m22:53:08.825919 [error] [MainThread]: [31mFailure in test unique_dim_location_location_id (models\dimensions\schema.yml)[0m
[0m22:53:08.826605 [error] [MainThread]:   Got 34573 results, configured to fail if != 0
[0m22:53:08.827148 [info ] [MainThread]: 
[0m22:53:08.827769 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\dimensions\schema.yml\unique_dim_location_location_id.sql
[0m22:53:08.828309 [info ] [MainThread]: 
[0m22:53:08.829086 [error] [MainThread]: [31mFailure in test unique_stg_dim_location_location_id (models\dimensions\schema.yml)[0m
[0m22:53:08.829988 [error] [MainThread]:   Got 34573 results, configured to fail if != 0
[0m22:53:08.830602 [info ] [MainThread]: 
[0m22:53:08.831232 [info ] [MainThread]:   compiled code at target\compiled\glamira_analytics\models\dimensions\schema.yml\unique_stg_dim_location_location_id.sql
[0m22:53:08.831785 [info ] [MainThread]: 
[0m22:53:08.832351 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=6 SKIP=0 NO-OP=0 TOTAL=19
[0m22:53:08.833286 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 2 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:53:08.835753 [debug] [MainThread]: Command `dbt test` failed at 22:53:08.835453 after 29.52 seconds
[0m22:53:08.836579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E56C8B2200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E56D344690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E56D344370>]}
[0m22:53:08.837163 [debug] [MainThread]: Flushing usage events
[0m22:53:10.554557 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:56:22.846603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027777F58EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000277790BFED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000277790BFB10>]}


============================== 22:56:22.853222 | d62436d6-b4c6-4b33-ae57-5effec44f668 ==============================
[0m22:56:22.853222 [info ] [MainThread]: Running with dbt=1.11.2
[0m22:56:22.854399 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'no_print': 'None', 'version_check': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'write_json': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'empty': 'False', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'invocation_command': 'dbt run --full-refresh', 'indirect_selection': 'eager', 'use_colors': 'True', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m22:56:34.617283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000277783F1BA0>]}
[0m22:56:34.696620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027718763570>]}
[0m22:56:34.697517 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m22:56:35.611743 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m22:56:35.911167 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 4 files changed.
[0m22:56:35.912140 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\staging\stg_fact_sales_order_tt.sql
[0m22:56:35.912840 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\dimensions\fact_sales_order_tt.sql
[0m22:56:35.913235 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\dimensions\dim_location.sql
[0m22:56:35.913742 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\staging\stg_dim_location.sql
[0m22:56:35.914168 [debug] [MainThread]: Partial parsing: updated file: glamira_analytics://models\dimensions\fact_sales_order_tt.sql
[0m22:56:36.479532 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `relationships` defined on
'fact_sales_order_tt' in package 'glamira_analytics'
(models\dimensions\schema.yml). Arguments to generic tests should be nested
under the `arguments` property.
[0m22:56:36.480689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027718CE5F50>]}
[0m22:56:36.655453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027718BABC50>]}
[0m22:56:36.797905 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:56:36.801341 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:56:36.843934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027718D53070>]}
[0m22:56:36.844667 [info ] [MainThread]: Found 15 models, 1 seed, 19 data tests, 3 sources, 537 macros
[0m22:56:36.845590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000277190718B0>]}
[0m22:56:36.851189 [info ] [MainThread]: 
[0m22:56:36.852005 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:56:36.852933 [info ] [MainThread]: 
[0m22:56:36.853949 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:56:36.863000 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:56:36.863873 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:56:36.865127 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:56:36.866402 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:56:36.867749 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9'
[0m22:56:36.868954 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:56:38.915982 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev'
[0m22:56:38.916866 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:56:38.917522 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_dimensions'
[0m22:56:38.919443 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:56:38.921458 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_staging'
[0m22:56:38.922313 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:56:39.938062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027718C32BD0>]}
[0m22:56:39.939015 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:56:39.946257 [debug] [Thread-4 (]: Began running node model.glamira_analytics.stg_fx_rate
[0m22:56:39.947040 [debug] [Thread-3 (]: Began running node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:56:39.947729 [debug] [Thread-1 (]: Began running node model.glamira_analytics.stg_dim_location
[0m22:56:39.948375 [debug] [Thread-2 (]: Began running node model.glamira_analytics.stg_dim_product
[0m22:56:39.949229 [info ] [Thread-4 (]: 4 of 15 START sql view model analytics_dev_staging.stg_fx_rate ................. [RUN]
[0m22:56:39.950047 [info ] [Thread-3 (]: 3 of 15 START sql view model analytics_dev_staging.stg_fact_sales_order_tt ..... [RUN]
[0m22:56:39.952830 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fx_rate'
[0m22:56:39.951082 [info ] [Thread-1 (]: 1 of 15 START sql view model analytics_dev_staging.stg_dim_location ............ [RUN]
[0m22:56:39.953822 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_fact_sales_order_tt'
[0m22:56:39.954502 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.stg_fx_rate
[0m22:56:39.951945 [info ] [Thread-2 (]: 2 of 15 START sql view model analytics_dev_staging.stg_dim_product ............. [RUN]
[0m22:56:39.955713 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_location'
[0m22:56:39.956640 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:56:39.968745 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.stg_fx_rate"
[0m22:56:39.969976 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.glamira_analytics.stg_dim_product'
[0m22:56:39.970752 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.stg_dim_location
[0m22:56:39.978029 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m22:56:39.979154 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.stg_dim_product
[0m22:56:39.983328 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_location"
[0m22:56:39.989378 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.stg_dim_product"
[0m22:56:39.990611 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.stg_fx_rate
[0m22:56:40.006191 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:56:40.067839 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.stg_fact_sales_order_tt"
[0m22:56:40.076013 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.stg_fx_rate"
[0m22:56:40.076969 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.stg_dim_product
[0m22:56:40.077865 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.stg_dim_location
[0m22:56:40.082272 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_product"
[0m22:56:40.087739 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.stg_dim_location"
[0m22:56:40.089198 [debug] [Thread-4 (]: On model.glamira_analytics.stg_fx_rate: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fx_rate"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
  OPTIONS()
  as WITH source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev`.`exchange_rate_usd`
)

, renamed AS (
    SELECT
        CAST(currency AS STRING) AS currency_code
        ,CAST(rate_to_usd AS NUMERIC) AS rate_to_usd
        ,CAST(as_of_gmt AS TIMESTAMP) AS rate_timestamp
    FROM source
)

SELECT * FROM renamed;


[0m22:56:40.091126 [debug] [Thread-3 (]: On model.glamira_analytics.stg_fact_sales_order_tt: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_fact_sales_order_tt"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
  OPTIONS()
  as WITH stg_fact_sales_order_tt__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`raw_layer`.`summary`
    WHERE collection = 'checkout_success'
)

, stg_fact_sales_order_tt__remove_url_fail AS (
    SELECT *
    FROM stg_fact_sales_order_tt__source 
    WHERE current_url NOT LIKE 'file://%'
)

/* Location Lookup */
, stg_fact_sales_order_tt__location AS (
    SELECT DISTINCT 
        ip,
        country_code,
        region,
        city
    FROM `stone-album-475912-b9`.`raw_layer`.`ip_location`
    WHERE country_code IS NOT NULL
)

, stg_fact_sales_order_tt__joined AS (
    SELECT 
        s.*,
        l.country_code,
        l.region,
        l.city
    FROM stg_fact_sales_order_tt__remove_url_fail s
    LEFT JOIN stg_fact_sales_order_tt__location l
        ON s.ip = l.ip
)

, stg_fact_sales_order_tt__unnest AS (
    SELECT 
        s.*, 
        cp
    FROM stg_fact_sales_order_tt__joined s
    CROSS JOIN UNNEST(s.cart_products) AS cp
)

, stg_fact_sales_order_tt__rename AS (
    SELECT
        SAFE_CAST(REGEXP_REPLACE(CAST(s.order_id AS STRING), r'\..*', '') AS INT64) AS order_id,
        1 AS quantity,
        SAFE_CAST(REGEXP_REPLACE(CAST(cp.product_id AS STRING), r'\..*', '') AS INT64) AS product_id,
        SAFE_CAST(REGEXP_REPLACE(CAST(s.user_id_db AS STRING), r'\..*', '') AS INT64) AS user_id,
        SAFE_CAST(REGEXP_REPLACE(CAST(s.store_id AS STRING), r'\..*', '') AS INT64) AS store_id,
        TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64)) AS time_stamp,
        DATETIME(TIMESTAMP_SECONDS(CAST(s.time_stamp AS INT64))) AS local_time,
        
        -- Currency logic (abbreviated for readability, assume standard case statement remains)
        CASE WHEN s.currency IN ('USD', 'USD $') THEN 'USD' ELSE s.currency END AS currency_code,

        CAST(cp.price * 1 AS NUMERIC) AS line_total,
        
        -- FIX: Use COALESCE to handle missing lookups
        COALESCE(s.country_code, 'Undefined') AS country_short,
        COALESCE(s.region, 'Undefined') AS region,
        COALESCE(s.city, 'Undefined') AS city

    FROM stg_fact_sales_order_tt__unnest s
)

, stg_fact_sales_order_tt__calc_key AS (
    SELECT
        *,
        -- FIX: If location is Undefined, use -1. Otherwise generate key.
        CASE 
            WHEN country_short = 'Undefined' THEN -1
            ELSE FARM_FINGERPRINT(country_short || region || city) 
        END AS location_id
    FROM stg_fact_sales_order_tt__rename
)

SELECT * FROM stg_fact_sales_order_tt__calc_key;


[0m22:56:40.092361 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:56:40.093101 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:56:40.096062 [debug] [Thread-2 (]: On model.glamira_analytics.stg_dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_product"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
  OPTIONS()
  as WITH stg_dim_product__source AS (
    SELECT DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`product`
)

, stg_dim_product__rename AS (
    SELECT
        SAFE_CAST(product_id AS INT64) AS product_id,
        CAST(name AS STRING) AS product_name,
        CAST(url AS STRING) AS product_url,
        CAST(sku AS STRING) AS product_sku, 
        CAST(product_type AS STRING) AS product_type,
        CAST(category_name AS STRING) AS category_name,
        CAST(collection AS STRING) AS collection_name,
        SAFE_CAST(min_price AS NUMERIC) AS min_price,
        SAFE_CAST(max_price AS NUMERIC) AS max_price
    FROM stg_dim_product__source
    WHERE product_id IS NOT NULL
)

SELECT * FROM stg_dim_product__rename;


[0m22:56:40.097278 [debug] [Thread-1 (]: On model.glamira_analytics.stg_dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.stg_dim_location"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
  OPTIONS()
  as WITH stg_dim_location__source AS (
    SELECT 
        DISTINCT *
    FROM `stone-album-475912-b9`.`raw_layer`.`ip_location`
)

, stg_dim_location__rename AS (
    SELECT
        -- Removed ip_address to ensure uniqueness by City
        CAST(country_code AS STRING) AS country_short_name,
        CAST(country_code AS STRING) AS country_long_name,
        CAST(region AS STRING) AS region_name,
        CAST(city AS STRING) AS city_name
    FROM stg_dim_location__source
    WHERE country_code <> '-' 
      AND country_code IS NOT NULL
)

, stg_dim_location__distinct AS (
    SELECT DISTINCT
        country_short_name,
        country_long_name,
        region_name,
        city_name
    FROM stg_dim_location__rename
)

, stg_dim_location__gen_key AS (
    SELECT
        FARM_FINGERPRINT(country_short_name || region_name || city_name) AS location_id,
        country_short_name,
        country_long_name,
        region_name,
        city_name
    FROM stg_dim_location__distinct
)

SELECT * FROM stg_dim_location__gen_key;


[0m22:56:40.098878 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:56:40.100067 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m22:56:41.459077 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:2e4859df-cc62-4012-a070-3f87a0005118&page=queryresults
[0m22:56:41.461670 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:a95baec7-b661-44c6-a873-62ecc9c77ce6&page=queryresults
[0m22:56:41.462538 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:5815af32-697c-4ca0-8168-4ca97492b76d&page=queryresults
[0m22:56:41.581260 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:bdcf85bd-3dc3-4d2d-9f14-3c20171c448d&page=queryresults
[0m22:56:41.869780 [debug] [Thread-4 (]: SQL status: OK in 0.409 seconds
[0m22:56:41.871071 [debug] [Thread-1 (]: SQL status: OK in 0.407 seconds
[0m22:56:41.871856 [debug] [Thread-2 (]: SQL status: OK in 0.409 seconds
[0m22:56:41.992827 [debug] [Thread-3 (]: SQL status: OK in 0.411 seconds
[0m22:56:41.999158 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027719111A70>]}
[0m22:56:41.999944 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000277197831B0>]}
[0m22:56:42.000430 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027719782FD0>]}
[0m22:56:42.002211 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027778386C50>]}
[0m22:56:42.001582 [info ] [Thread-1 (]: 1 of 15 OK created sql view model analytics_dev_staging.stg_dim_location ....... [[32mCREATE VIEW (0 processed)[0m in 2.03s]
[0m22:56:42.003689 [info ] [Thread-4 (]: 4 of 15 OK created sql view model analytics_dev_staging.stg_fx_rate ............ [[32mCREATE VIEW (0 processed)[0m in 2.04s]
[0m22:56:42.004881 [info ] [Thread-2 (]: 2 of 15 OK created sql view model analytics_dev_staging.stg_dim_product ........ [[32mCREATE VIEW (0 processed)[0m in 2.02s]
[0m22:56:42.008430 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.stg_dim_location
[0m22:56:42.006640 [info ] [Thread-3 (]: 3 of 15 OK created sql view model analytics_dev_staging.stg_fact_sales_order_tt  [[32mCREATE VIEW (0 processed)[0m in 2.04s]
[0m22:56:42.010269 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.stg_fx_rate
[0m22:56:42.012076 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.stg_dim_product
[0m22:56:42.013961 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.stg_fact_sales_order_tt
[0m22:56:42.015100 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_location
[0m22:56:42.016994 [debug] [Thread-3 (]: Began running node model.glamira_analytics.dim_date
[0m22:56:42.017903 [debug] [Thread-4 (]: Began running node model.glamira_analytics.dim_fx_rate_usd
[0m22:56:42.018660 [debug] [Thread-2 (]: Began running node model.glamira_analytics.dim_product
[0m22:56:42.019532 [info ] [Thread-1 (]: 5 of 15 START sql table model analytics_dev_dimensions.dim_location ............ [RUN]
[0m22:56:42.020401 [info ] [Thread-3 (]: 8 of 15 START sql table model analytics_dev_dimensions.dim_date ................ [RUN]
[0m22:56:42.021656 [info ] [Thread-4 (]: 6 of 15 START sql table model analytics_dev_dimensions.dim_fx_rate_usd ......... [RUN]
[0m22:56:42.023718 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_dim_location, now model.glamira_analytics.dim_location)
[0m22:56:42.022684 [info ] [Thread-2 (]: 7 of 15 START sql table model analytics_dev_dimensions.dim_product ............. [RUN]
[0m22:56:42.024839 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_fact_sales_order_tt, now model.glamira_analytics.dim_date)
[0m22:56:42.025712 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_fx_rate, now model.glamira_analytics.dim_fx_rate_usd)
[0m22:56:42.026713 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.dim_location
[0m22:56:42.027643 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.stg_dim_product, now model.glamira_analytics.dim_product)
[0m22:56:42.028570 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.dim_date
[0m22:56:42.029520 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.dim_fx_rate_usd
[0m22:56:42.036306 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.dim_location"
[0m22:56:42.037085 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.dim_product
[0m22:56:42.041608 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.dim_date"
[0m22:56:42.047384 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.dim_fx_rate_usd"
[0m22:56:42.053017 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.dim_product"
[0m22:56:42.054414 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.dim_location
[0m22:56:42.073401 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:56:42.075600 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.dim_date
[0m22:56:42.076980 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.dim_fx_rate_usd
[0m22:56:42.080841 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:56:42.084660 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:56:42.085955 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.dim_product
[0m22:56:42.092794 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:56:43.026362 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.dim_location"
[0m22:56:43.030595 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.dim_product"
[0m22:56:43.032939 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.dim_date"
[0m22:56:43.034527 [debug] [Thread-1 (]: On model.glamira_analytics.dim_location: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_location"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_location`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_location__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
)

, dim_location__union_undefined AS (
    SELECT
        location_id,
        country_short_name,
        country_long_name,
        region_name,
        city_name
    FROM dim_location__source

    UNION ALL

    SELECT
        -1 AS location_id,
        'Undefined' AS country_short_name,
        'Undefined' AS country_long_name,
        'Undefined' AS region_name,
        'Undefined' AS city_name
)

SELECT * FROM dim_location__union_undefined
    );
  
[0m22:56:43.036078 [debug] [Thread-2 (]: On model.glamira_analytics.dim_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_product"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_product__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_product`
)

, dim_product__null_handle AS (
    SELECT
        product_id,
        COALESCE(product_name, 'Undefined') AS product_name,
        COALESCE(product_url, 'Undefined') AS product_url,
        COALESCE(product_sku, 'Undefined') AS product_sku,
        COALESCE(product_type, 'Undefined') AS product_type,
        COALESCE(NULLIF(TRIM(category_name), ''), 'Undefined') AS category_name, 
        COALESCE(NULLIF(TRIM(collection_name), ''), 'Undefined') AS collection_name,
        min_price,
        max_price
    FROM dim_product__source 
)

, dim_product__add_key AS (
    SELECT
        FARM_FINGERPRINT(CAST(product_id AS STRING)) AS product_key,
        *
    FROM dim_product__null_handle
)

, dim_product__union_undefined AS (
    SELECT 
        * FROM dim_product__add_key

    UNION ALL

    SELECT 
        -1 AS product_key,
        -1 AS product_id,
        'Undefined' AS product_name,
        'Undefined' AS product_url,
        'Undefined' AS product_sku,
        'Undefined' AS product_type,
        'Undefined' AS category_name,
        'Undefined' AS collection_name,
        0 AS min_price,
        0 AS max_price
)

SELECT * FROM dim_product__union_undefined
    );
  
[0m22:56:43.038673 [debug] [Thread-3 (]: On model.glamira_analytics.dim_date: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_date"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_date`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_date__source AS (
    SELECT DISTINCT 
        DATE(time_stamp) AS full_date
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
    WHERE time_stamp IS NOT NULL
)

, dim_date__format AS (
    SELECT
        CAST(FORMAT_DATE('%Y%m%d', full_date) AS INT64) AS date_key
        ,full_date AS date_day
        ,FORMAT_DATE('%A', full_date) AS day_name
        ,CASE
            WHEN FORMAT_DATE('%A', full_date) IN ('Saturday', 'Sunday') THEN TRUE
            ELSE FALSE
        END AS is_weekend
        ,CAST(FORMAT_DATE('%d', full_date) AS INT64) AS day_of_month
        ,FORMAT_DATE('%Y-%m', full_date) AS year_month
        ,CAST(FORMAT_DATE('%m', full_date) AS INT64) AS month_of_year
        ,CAST(FORMAT_DATE('%j', full_date) AS INT64) AS day_of_year
        ,CAST(FORMAT_DATE('%W', full_date) AS INT64) AS week_of_year
        ,CAST(FORMAT_DATE('%Q', full_date) AS INT64) AS quarter_of_year
        ,CAST(FORMAT_DATE('%Y', full_date) AS INT64) AS year_number
    FROM dim_date__source
)

SELECT 
    *
FROM dim_date__format
ORDER BY date_key
    );
  
[0m22:56:43.048994 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.dim_fx_rate_usd"
[0m22:56:43.050811 [debug] [Thread-4 (]: On model.glamira_analytics.dim_fx_rate_usd: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_fx_rate_usd"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_fx_rate_usd`
      
    
    

    
    OPTIONS()
    as (
      WITH stg_fx AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fx_rate`
)

SELECT
    currency_code AS from_currency_code
    ,'USD' AS to_currency_code
    ,rate_to_usd
    ,rate_timestamp
FROM stg_fx
    );
  
[0m22:56:43.821596 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:43ef4994-3ce8-4764-9443-fe698cb58706&page=queryresults
[0m22:56:43.822919 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:980ba711-74ab-40a8-bd93-00c8fdff14bf&page=queryresults
[0m22:56:43.824196 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:7d33f41d-d709-4a94-a6d3-a943371c0cdc&page=queryresults
[0m22:56:43.825501 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:af5f0ce4-29a1-4874-90d6-f49e862e56b2&page=queryresults
[0m22:56:45.757236 [debug] [Thread-4 (]: SQL status: OK in 1.930 seconds
[0m22:56:45.759597 [debug] [Thread-1 (]: SQL status: OK in 1.936 seconds
[0m22:56:46.074779 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000277190E30B0>]}
[0m22:56:46.077263 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000277198F97F0>]}
[0m22:56:46.078333 [info ] [Thread-4 (]: 6 of 15 OK created sql table model analytics_dev_dimensions.dim_fx_rate_usd .... [[32mCREATE TABLE (34.0 rows, 1.3 KiB processed)[0m in 4.05s]
[0m22:56:46.081553 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.dim_fx_rate_usd
[0m22:56:46.080184 [info ] [Thread-1 (]: 5 of 15 OK created sql table model analytics_dev_dimensions.dim_location ....... [[32mCREATE TABLE (45.6k rows, 54.6 MiB processed)[0m in 4.05s]
[0m22:56:46.082422 [debug] [Thread-4 (]: Began running node model.glamira_analytics.dim_store
[0m22:56:46.083447 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_location
[0m22:56:46.085118 [debug] [Thread-1 (]: Began running node model.glamira_analytics.dim_user
[0m22:56:46.084368 [info ] [Thread-4 (]: 9 of 15 START sql table model analytics_dev_dimensions.dim_store ............... [RUN]
[0m22:56:46.087369 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_fx_rate_usd, now model.glamira_analytics.dim_store)
[0m22:56:46.086636 [info ] [Thread-1 (]: 10 of 15 START sql table model analytics_dev_dimensions.dim_user ............... [RUN]
[0m22:56:46.088816 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.dim_store
[0m22:56:46.090092 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_location, now model.glamira_analytics.dim_user)
[0m22:56:46.096254 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.dim_store"
[0m22:56:46.097713 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.dim_user
[0m22:56:46.105417 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.dim_user"
[0m22:56:46.107092 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.dim_store
[0m22:56:46.108662 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.dim_user
[0m22:56:46.113107 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:56:46.116303 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:56:46.268025 [debug] [Thread-2 (]: SQL status: OK in 2.441 seconds
[0m22:56:46.466148 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002771979B3B0>]}
[0m22:56:46.467352 [info ] [Thread-2 (]: 7 of 15 OK created sql table model analytics_dev_dimensions.dim_product ........ [[32mCREATE TABLE (18.6k rows, 2.7 MiB processed)[0m in 4.44s]
[0m22:56:46.469291 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.dim_product
[0m22:56:46.470529 [debug] [Thread-2 (]: Began running node model.glamira_analytics.fact_sales_order_tt
[0m22:56:46.471453 [info ] [Thread-2 (]: 11 of 15 START sql table model analytics_dev_dimensions.fact_sales_order_tt .... [RUN]
[0m22:56:46.472590 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_product, now model.glamira_analytics.fact_sales_order_tt)
[0m22:56:46.473743 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.fact_sales_order_tt
[0m22:56:46.479571 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.fact_sales_order_tt"
[0m22:56:46.481365 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.fact_sales_order_tt
[0m22:56:46.485121 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:56:46.916049 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.dim_user"
[0m22:56:46.917715 [debug] [Thread-1 (]: On model.glamira_analytics.dim_user: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_user"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_user`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_user__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
)

, dim_user__dedup AS (
    SELECT
        user_id,
        -- We select the most recent location for the user
        ARRAY_AGG(location_id ORDER BY time_stamp DESC LIMIT 1)[OFFSET(0)] AS location_id,
        MAX(time_stamp) AS last_active_at
    FROM dim_user__source
    WHERE user_id IS NOT NULL
    GROUP BY user_id
)

SELECT 
    user_id,
    location_id,
    last_active_at
FROM dim_user__dedup
    );
  
[0m22:56:46.945627 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.dim_store"
[0m22:56:46.947208 [debug] [Thread-4 (]: On model.glamira_analytics.dim_store: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.dim_store"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_store`
      
    
    

    
    OPTIONS()
    as (
      WITH dim_store__source AS (
    SELECT DISTINCT 
        store_id
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
    WHERE store_id IS NOT NULL
)

, dim_store__add_key AS (
    SELECT
        FARM_FINGERPRINT(CAST(store_id AS STRING)) AS store_key
        ,CAST(store_id AS STRING) AS store_id
        ,CONCAT('Store ', CAST(store_id AS STRING)) AS store_name
    FROM dim_store__source 
)

SELECT 
    *
FROM dim_store__add_key
ORDER BY store_id
    );
  
[0m22:56:47.293064 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.fact_sales_order_tt"
[0m22:56:47.294927 [debug] [Thread-2 (]: On model.glamira_analytics.fact_sales_order_tt: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.fact_sales_order_tt"} */

  
    

    create or replace table `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
      
    
    

    
    OPTIONS()
    as (
      WITH fact_sales_order_tt__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
)

, dim_product AS (
    SELECT product_id FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
)

, fact_sales_order_tt__check_integrity AS (
    SELECT
        f.order_id,
        
        -- FIX: If product doesn't exist in Dim, map to -1
        CASE 
            WHEN p.product_id IS NULL THEN -1
            ELSE f.product_id 
        END AS product_id,
        
        f.user_id,
        f.store_id,
        f.location_id,
        f.time_stamp,
        f.local_time,
        f.currency_code,
        f.quantity,
        f.line_total AS sales_amount,
        f.line_total AS gross_revenue
    FROM fact_sales_order_tt__source f
    LEFT JOIN dim_product p
        ON f.product_id = p.product_id
)

SELECT * FROM fact_sales_order_tt__check_integrity
    );
  
[0m22:56:47.701509 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:894216d5-d1f3-4d8a-b7f9-a0a2b3f1f739&page=queryresults
[0m22:56:47.702412 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:9c85f3df-179e-46ba-8636-b62ac4a1a058&page=queryresults
[0m22:56:48.008186 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:ba2b8aa7-5df6-4e1f-9e31-75eef124795e&page=queryresults
[0m22:56:49.236699 [debug] [Thread-3 (]: SQL status: OK in 5.414 seconds
[0m22:56:49.444697 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002771979AED0>]}
[0m22:56:49.445798 [info ] [Thread-3 (]: 8 of 15 OK created sql table model analytics_dev_dimensions.dim_date ........... [[32mCREATE TABLE (43.0 rows, 5.7 GiB processed)[0m in 7.42s]
[0m22:56:49.447102 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.dim_date
[0m22:56:52.600125 [debug] [Thread-1 (]: SQL status: OK in 4.897 seconds
[0m22:56:52.602556 [debug] [Thread-2 (]: SQL status: OK in 4.594 seconds
[0m22:56:54.123588 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000277198F8170>]}
[0m22:56:54.126104 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000277198F9E50>]}
[0m22:56:54.127176 [info ] [Thread-1 (]: 10 of 15 OK created sql table model analytics_dev_dimensions.dim_user .......... [[32mCREATE TABLE (8.7k rows, 5.7 GiB processed)[0m in 8.03s]
[0m22:56:54.129141 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.dim_user
[0m22:56:54.128139 [info ] [Thread-2 (]: 11 of 15 OK created sql table model analytics_dev_dimensions.fact_sales_order_tt  [[32mCREATE TABLE (31.4k rows, 6.0 GiB processed)[0m in 7.65s]
[0m22:56:54.130394 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.fact_sales_order_tt
[0m22:56:54.131414 [debug] [Thread-3 (]: Began running node model.glamira_analytics.mart_country
[0m22:56:54.132089 [debug] [Thread-1 (]: Began running node model.glamira_analytics.mart_overall
[0m22:56:54.132748 [debug] [Thread-2 (]: Began running node model.glamira_analytics.mart_product
[0m22:56:54.133577 [info ] [Thread-3 (]: 12 of 15 START sql view model analytics_dev.mart_country ....................... [RUN]
[0m22:56:54.134423 [info ] [Thread-1 (]: 13 of 15 START sql view model analytics_dev.mart_overall ....................... [RUN]
[0m22:56:54.136752 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_date, now model.glamira_analytics.mart_country)
[0m22:56:54.135715 [info ] [Thread-2 (]: 14 of 15 START sql view model analytics_dev.mart_product ....................... [RUN]
[0m22:56:54.137935 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_user, now model.glamira_analytics.mart_overall)
[0m22:56:54.138960 [debug] [Thread-3 (]: Began compiling node model.glamira_analytics.mart_country
[0m22:56:54.139726 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.fact_sales_order_tt, now model.glamira_analytics.mart_product)
[0m22:56:54.140419 [debug] [Thread-1 (]: Began compiling node model.glamira_analytics.mart_overall
[0m22:56:54.153876 [debug] [Thread-3 (]: Writing injected SQL for node "model.glamira_analytics.mart_country"
[0m22:56:54.154519 [debug] [Thread-2 (]: Began compiling node model.glamira_analytics.mart_product
[0m22:56:54.158215 [debug] [Thread-1 (]: Writing injected SQL for node "model.glamira_analytics.mart_overall"
[0m22:56:54.165098 [debug] [Thread-2 (]: Writing injected SQL for node "model.glamira_analytics.mart_product"
[0m22:56:54.166736 [debug] [Thread-3 (]: Began executing node model.glamira_analytics.mart_country
[0m22:56:54.171315 [debug] [Thread-3 (]: Writing runtime sql for node "model.glamira_analytics.mart_country"
[0m22:56:54.172411 [debug] [Thread-1 (]: Began executing node model.glamira_analytics.mart_overall
[0m22:56:54.178822 [debug] [Thread-1 (]: Writing runtime sql for node "model.glamira_analytics.mart_overall"
[0m22:56:54.179665 [debug] [Thread-2 (]: Began executing node model.glamira_analytics.mart_product
[0m22:56:54.185275 [debug] [Thread-2 (]: Writing runtime sql for node "model.glamira_analytics.mart_product"
[0m22:56:54.186564 [debug] [Thread-3 (]: On model.glamira_analytics.mart_country: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.mart_country"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev`.`mart_country`
  OPTIONS()
  as WITH mart_country__fact AS (
    SELECT * FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
)

, mart_country__dim AS (
    SELECT * FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_location`
)

, mart_country__joined AS (
    SELECT
        f.order_id,
        f.sales_amount,
        l.country_short_name,
        l.country_long_name,
        l.region_name,
        l.city_name
    FROM mart_country__fact f
    LEFT JOIN mart_country__dim l
        -- FIX: Casting both to STRING ensures they match regardless of data type
        ON CAST(f.location_id AS STRING) = CAST(l.location_id AS STRING)
)

, mart_country__aggs AS (
    SELECT
        country_short_name,
        country_long_name,
        region_name,
        city_name,
        COUNT(DISTINCT order_id) AS total_orders,
        SUM(sales_amount) AS total_revenue
    FROM mart_country__joined
    GROUP BY 1, 2, 3, 4
)

SELECT * FROM mart_country__aggs;


[0m22:56:54.187750 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:56:54.188676 [debug] [Thread-1 (]: On model.glamira_analytics.mart_overall: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.mart_overall"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev`.`mart_overall`
  OPTIONS()
  as WITH mart_overall__source AS (
    SELECT *
    FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
)

, mart_overall__aggs AS (
    SELECT
        DATE(time_stamp) AS date_day,
        COUNT(DISTINCT order_id) AS total_orders,
        SUM(sales_amount) AS total_revenue,
        SUM(quantity) AS total_items_sold
    FROM mart_overall__source
    GROUP BY 1
)

SELECT * FROM mart_overall__aggs;


[0m22:56:54.190350 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:56:54.193219 [debug] [Thread-2 (]: On model.glamira_analytics.mart_product: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.mart_product"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev`.`mart_product`
  OPTIONS()
  as WITH mart_product__fact AS (
    SELECT * FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
)

, mart_product__dim AS (
    SELECT * FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
)

, mart_product__joined AS (
    SELECT
        f.order_id,
        f.sales_amount,
        f.quantity,
        f.time_stamp,
        p.product_name,
        p.category_name,
        p.collection_name
    FROM mart_product__fact f
    LEFT JOIN mart_product__dim p
        ON f.product_id = p.product_id
)

, mart_product__aggs AS (
    SELECT
        product_name,
        category_name,
        collection_name,
        COUNT(DISTINCT order_id) AS total_orders,
        SUM(sales_amount) AS total_revenue,
        SUM(quantity) AS total_quantity_sold
    FROM mart_product__joined
    GROUP BY 1, 2, 3
)

SELECT * FROM mart_product__aggs;


[0m22:56:54.194329 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:56:54.213559 [debug] [Thread-4 (]: SQL status: OK in 6.510 seconds
[0m22:56:55.062811 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000277198F8410>]}
[0m22:56:55.064253 [info ] [Thread-4 (]: 9 of 15 OK created sql table model analytics_dev_dimensions.dim_store .......... [[32mCREATE TABLE (57.0 rows, 5.7 GiB processed)[0m in 8.98s]
[0m22:56:55.065712 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.dim_store
[0m22:56:55.066832 [debug] [Thread-4 (]: Began running node model.glamira_analytics.mart_product_type
[0m22:56:55.067987 [info ] [Thread-4 (]: 15 of 15 START sql view model analytics_dev.mart_product_type .................. [RUN]
[0m22:56:55.068877 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.glamira_analytics.dim_store, now model.glamira_analytics.mart_product_type)
[0m22:56:55.069439 [debug] [Thread-4 (]: Began compiling node model.glamira_analytics.mart_product_type
[0m22:56:55.075687 [debug] [Thread-4 (]: Writing injected SQL for node "model.glamira_analytics.mart_product_type"
[0m22:56:55.077748 [debug] [Thread-4 (]: Began executing node model.glamira_analytics.mart_product_type
[0m22:56:55.084830 [debug] [Thread-4 (]: Writing runtime sql for node "model.glamira_analytics.mart_product_type"
[0m22:56:55.086972 [debug] [Thread-4 (]: On model.glamira_analytics.mart_product_type: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "model.glamira_analytics.mart_product_type"} */


  create or replace view `stone-album-475912-b9`.`analytics_dev`.`mart_product_type`
  OPTIONS()
  as WITH mart_product_type__fact AS (
    SELECT * FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
)

, mart_product_type__dim AS (
    SELECT * FROM `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
)

, mart_product_type__joined AS (
    SELECT
        f.order_id,
        f.sales_amount,
        p.product_type
    FROM mart_product_type__fact f
    LEFT JOIN mart_product_type__dim p
        ON f.product_id = p.product_id
)

, mart_product_type__aggs AS (
    SELECT
        product_type,
        COUNT(DISTINCT order_id) AS total_orders,
        SUM(sales_amount) AS total_revenue
    FROM mart_product_type__joined
    GROUP BY 1
)

SELECT * FROM mart_product_type__aggs;


[0m22:56:55.088022 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:56:56.395013 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:e7652fbf-b90f-4056-822b-88229569f039&page=queryresults
[0m22:56:56.396276 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:088809ba-18cf-4132-8c75-6b03ab6671cb&page=queryresults
[0m22:56:56.397173 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:1698c2af-680f-49a8-833b-33480696d645&page=queryresults
[0m22:56:57.508078 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:7d367cec-8ae0-462b-97c3-b2f67cd475dc&page=queryresults
[0m22:56:57.931232 [debug] [Thread-1 (]: SQL status: OK in 1.532 seconds
[0m22:56:57.935240 [debug] [Thread-2 (]: SQL status: OK in 1.539 seconds
[0m22:56:57.936071 [debug] [Thread-3 (]: SQL status: OK in 1.538 seconds
[0m22:56:57.942475 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000277198F9610>]}
[0m22:56:57.945241 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000277198FB590>]}
[0m22:56:57.950100 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000277198FBE30>]}
[0m22:56:57.950971 [info ] [Thread-1 (]: 13 of 15 OK created sql view model analytics_dev.mart_overall .................. [[32mCREATE VIEW (0 processed)[0m in 3.80s]
[0m22:56:57.952557 [info ] [Thread-2 (]: 14 of 15 OK created sql view model analytics_dev.mart_product .................. [[32mCREATE VIEW (0 processed)[0m in 3.81s]
[0m22:56:57.954360 [info ] [Thread-3 (]: 12 of 15 OK created sql view model analytics_dev.mart_country .................. [[32mCREATE VIEW (0 processed)[0m in 3.81s]
[0m22:56:57.955745 [debug] [Thread-1 (]: Finished running node model.glamira_analytics.mart_overall
[0m22:56:57.956806 [debug] [Thread-2 (]: Finished running node model.glamira_analytics.mart_product
[0m22:56:57.957842 [debug] [Thread-3 (]: Finished running node model.glamira_analytics.mart_country
[0m22:56:58.193244 [debug] [Thread-4 (]: SQL status: OK in 0.683 seconds
[0m22:56:58.198456 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd62436d6-b4c6-4b33-ae57-5effec44f668', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000277198FBE30>]}
[0m22:56:58.199527 [info ] [Thread-4 (]: 15 of 15 OK created sql view model analytics_dev.mart_product_type ............. [[32mCREATE VIEW (0 processed)[0m in 3.13s]
[0m22:56:58.200874 [debug] [Thread-4 (]: Finished running node model.glamira_analytics.mart_product_type
[0m22:56:58.203305 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:56:58.204226 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:56:58.204656 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:56:58.205047 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:56:58.205446 [debug] [MainThread]: Connection 'list_stone-album-475912-b9' was properly closed.
[0m22:56:58.205804 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev' was properly closed.
[0m22:56:58.206158 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_dimensions' was properly closed.
[0m22:56:58.206516 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_staging' was properly closed.
[0m22:56:58.206873 [debug] [MainThread]: Connection 'model.glamira_analytics.mart_product_type' was properly closed.
[0m22:56:58.207211 [debug] [MainThread]: Connection 'model.glamira_analytics.mart_country' was properly closed.
[0m22:56:58.207543 [debug] [MainThread]: Connection 'model.glamira_analytics.mart_overall' was properly closed.
[0m22:56:58.207912 [debug] [MainThread]: Connection 'model.glamira_analytics.mart_product' was properly closed.
[0m22:56:58.208424 [info ] [MainThread]: 
[0m22:56:58.209340 [info ] [MainThread]: Finished running 7 table models, 8 view models in 0 hours 0 minutes and 21.35 seconds (21.35s).
[0m22:56:58.215816 [debug] [MainThread]: Command end result
[0m22:56:58.277610 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:56:58.281533 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:56:58.291306 [debug] [MainThread]: Wrote artifact RunExecutionResult to D:\Project 7\glamira_analytics\target\run_results.json
[0m22:56:58.292026 [info ] [MainThread]: 
[0m22:56:58.293021 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:56:58.293985 [info ] [MainThread]: 
[0m22:56:58.294818 [info ] [MainThread]: Done. PASS=15 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=15
[0m22:56:58.296067 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 2 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m22:56:58.297633 [debug] [MainThread]: Command `dbt run` succeeded at 22:56:58.297444 after 35.69 seconds
[0m22:56:58.298208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027718B06150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027719987B30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000027719987FB0>]}
[0m22:56:58.298722 [debug] [MainThread]: Flushing usage events
[0m22:57:06.110172 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:57:10.167786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024CBDA78EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024CBEBDFED0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024CBEBDFB10>]}


============================== 22:57:10.174847 | 59a17939-5b26-458a-91b3-47d5ccd76bf8 ==============================
[0m22:57:10.174847 [info ] [MainThread]: Running with dbt=1.11.2
[0m22:57:10.176206 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'no_print': 'None', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'write_json': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'empty': 'None', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'fail_fast': 'False', 'profiles_dir': 'C:\\Users\\ngtru\\.dbt', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'indirect_selection': 'eager', 'invocation_command': 'dbt test', 'use_colors': 'True', 'use_experimental_parser': 'False', 'log_path': 'D:\\Project 7\\glamira_analytics\\logs'}
[0m22:57:20.307542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '59a17939-5b26-458a-91b3-47d5ccd76bf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024CBDF11BA0>]}
[0m22:57:20.389415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '59a17939-5b26-458a-91b3-47d5ccd76bf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024CCE603570>]}
[0m22:57:20.390631 [info ] [MainThread]: Registered adapter: bigquery=1.11.0
[0m22:57:21.302148 [debug] [MainThread]: checksum: 3d40d8bbe1bef07db1c24822f2dbfff8bc07f2a48ed4fe2658a40653aec0b54b, vars: {}, profile: , target: , version: 1.11.2
[0m22:57:21.552492 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:57:21.553034 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m22:57:21.553391 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:57:21.640811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '59a17939-5b26-458a-91b3-47d5ccd76bf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024CCE761050>]}
[0m22:57:21.791288 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:57:21.794722 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:57:21.848115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '59a17939-5b26-458a-91b3-47d5ccd76bf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024CDE5394F0>]}
[0m22:57:21.848802 [info ] [MainThread]: Found 15 models, 1 seed, 19 data tests, 3 sources, 537 macros
[0m22:57:21.849711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '59a17939-5b26-458a-91b3-47d5ccd76bf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024CDE406510>]}
[0m22:57:21.856156 [info ] [MainThread]: 
[0m22:57:21.857071 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:57:21.857877 [info ] [MainThread]: 
[0m22:57:21.859142 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:57:21.868010 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_staging'
[0m22:57:21.868816 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:57:21.869690 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev_dimensions'
[0m22:57:21.870726 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:57:21.871663 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_stone-album-475912-b9_analytics_dev'
[0m22:57:21.872655 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:57:27.927858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '59a17939-5b26-458a-91b3-47d5ccd76bf8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024CDE596270>]}
[0m22:57:27.929171 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:57:27.935740 [debug] [Thread-1 (]: Began running node test.glamira_analytics.not_null_dim_location_location_id.8635435d86
[0m22:57:27.936807 [debug] [Thread-3 (]: Began running node test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3
[0m22:57:27.937457 [debug] [Thread-4 (]: Began running node test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3
[0m22:57:27.938174 [debug] [Thread-2 (]: Began running node test.glamira_analytics.not_null_dim_product_product_id.02b1f06816
[0m22:57:27.938768 [info ] [Thread-1 (]: 1 of 19 START test not_null_dim_location_location_id ........................... [RUN]
[0m22:57:27.939401 [info ] [Thread-3 (]: 3 of 19 START test not_null_dim_product_product_key ............................ [RUN]
[0m22:57:27.942013 [debug] [Thread-1 (]: Acquiring new bigquery connection 'test.glamira_analytics.not_null_dim_location_location_id.8635435d86'
[0m22:57:27.940290 [info ] [Thread-4 (]: 4 of 19 START test not_null_dim_user_user_id ................................... [RUN]
[0m22:57:27.943319 [debug] [Thread-3 (]: Acquiring new bigquery connection 'test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3'
[0m22:57:27.941061 [info ] [Thread-2 (]: 2 of 19 START test not_null_dim_product_product_id ............................. [RUN]
[0m22:57:27.944194 [debug] [Thread-1 (]: Began compiling node test.glamira_analytics.not_null_dim_location_location_id.8635435d86
[0m22:57:27.944961 [debug] [Thread-4 (]: Acquiring new bigquery connection 'test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3'
[0m22:57:27.945570 [debug] [Thread-3 (]: Began compiling node test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3
[0m22:57:27.946236 [debug] [Thread-2 (]: Acquiring new bigquery connection 'test.glamira_analytics.not_null_dim_product_product_id.02b1f06816'
[0m22:57:27.972021 [debug] [Thread-1 (]: Writing injected SQL for node "test.glamira_analytics.not_null_dim_location_location_id.8635435d86"
[0m22:57:27.972674 [debug] [Thread-4 (]: Began compiling node test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3
[0m22:57:27.980207 [debug] [Thread-3 (]: Writing injected SQL for node "test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3"
[0m22:57:27.981197 [debug] [Thread-2 (]: Began compiling node test.glamira_analytics.not_null_dim_product_product_id.02b1f06816
[0m22:57:27.988666 [debug] [Thread-4 (]: Writing injected SQL for node "test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3"
[0m22:57:28.003268 [debug] [Thread-2 (]: Writing injected SQL for node "test.glamira_analytics.not_null_dim_product_product_id.02b1f06816"
[0m22:57:28.004887 [debug] [Thread-1 (]: Began executing node test.glamira_analytics.not_null_dim_location_location_id.8635435d86
[0m22:57:28.006167 [debug] [Thread-3 (]: Began executing node test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3
[0m22:57:28.040976 [debug] [Thread-4 (]: Began executing node test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3
[0m22:57:28.050117 [debug] [Thread-3 (]: Writing runtime sql for node "test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3"
[0m22:57:28.051047 [debug] [Thread-1 (]: Writing runtime sql for node "test.glamira_analytics.not_null_dim_location_location_id.8635435d86"
[0m22:57:28.054880 [debug] [Thread-4 (]: Writing runtime sql for node "test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3"
[0m22:57:28.055499 [debug] [Thread-2 (]: Began executing node test.glamira_analytics.not_null_dim_product_product_id.02b1f06816
[0m22:57:28.062321 [debug] [Thread-2 (]: Writing runtime sql for node "test.glamira_analytics.not_null_dim_product_product_id.02b1f06816"
[0m22:57:28.063910 [debug] [Thread-1 (]: On test.glamira_analytics.not_null_dim_location_location_id.8635435d86: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_dim_location_location_id.8635435d86"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select location_id
from `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_location`
where location_id is null



  
  
      
    ) dbt_internal_test
[0m22:57:28.064972 [debug] [Thread-4 (]: On test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select user_id
from `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_user`
where user_id is null



  
  
      
    ) dbt_internal_test
[0m22:57:28.066195 [debug] [Thread-3 (]: On test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select product_key
from `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
where product_key is null



  
  
      
    ) dbt_internal_test
[0m22:57:28.067161 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m22:57:28.068303 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:57:28.069320 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:57:28.070087 [debug] [Thread-2 (]: On test.glamira_analytics.not_null_dim_product_product_id.02b1f06816: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_dim_product_product_id.02b1f06816"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select product_id
from `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
where product_id is null



  
  
      
    ) dbt_internal_test
[0m22:57:28.073443 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:57:30.207360 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:81253236-2261-4d45-b126-489e8e21d125&page=queryresults
[0m22:57:30.211155 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:14abafbc-3e45-47d5-ac96-1289ec201943&page=queryresults
[0m22:57:30.213132 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:74330fd3-2ad6-4970-a14a-93705f986374&page=queryresults
[0m22:57:30.215382 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:7029d7a5-f812-4e20-8474-cc4f29316a17&page=queryresults
[0m22:57:30.990625 [debug] [Thread-4 (]: SQL status: OK in 0.777 seconds
[0m22:57:30.993322 [debug] [Thread-3 (]: SQL status: OK in 0.784 seconds
[0m22:57:30.994260 [debug] [Thread-1 (]: SQL status: OK in 0.782 seconds
[0m22:57:30.995148 [debug] [Thread-2 (]: SQL status: OK in 0.779 seconds
[0m22:57:31.992069 [info ] [Thread-4 (]: 4 of 19 PASS not_null_dim_user_user_id ......................................... [[32mPASS[0m in 4.05s]
[0m22:57:31.999086 [debug] [Thread-4 (]: Finished running node test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3
[0m22:57:31.996289 [info ] [Thread-3 (]: 3 of 19 PASS not_null_dim_product_product_key .................................. [[32mPASS[0m in 4.05s]
[0m22:57:32.000180 [debug] [Thread-4 (]: Began running node test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43
[0m22:57:31.998380 [info ] [Thread-2 (]: 2 of 19 PASS not_null_dim_product_product_id ................................... [[32mPASS[0m in 4.05s]
[0m22:57:32.001454 [debug] [Thread-3 (]: Finished running node test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3
[0m22:57:32.003551 [debug] [Thread-2 (]: Finished running node test.glamira_analytics.not_null_dim_product_product_id.02b1f06816
[0m22:57:32.002063 [info ] [Thread-4 (]: 5 of 19 START test not_null_fact_sales_order_tt_location_id .................... [RUN]
[0m22:57:32.005113 [debug] [Thread-3 (]: Began running node test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6
[0m22:57:32.006189 [debug] [Thread-2 (]: Began running node test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1
[0m22:57:32.007212 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_dim_user_user_id.4b202b08a3, now test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43)
[0m22:57:32.008002 [info ] [Thread-3 (]: 6 of 19 START test not_null_fact_sales_order_tt_order_id ....................... [RUN]
[0m22:57:32.010753 [debug] [Thread-4 (]: Began compiling node test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43
[0m22:57:32.009598 [info ] [Thread-2 (]: 7 of 19 START test not_null_fact_sales_order_tt_product_id ..................... [RUN]
[0m22:57:32.012690 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_dim_product_product_key.f0e1d838d3, now test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6)
[0m22:57:32.020884 [debug] [Thread-4 (]: Writing injected SQL for node "test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43"
[0m22:57:32.021670 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_dim_product_product_id.02b1f06816, now test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1)
[0m22:57:32.022210 [debug] [Thread-3 (]: Began compiling node test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6
[0m22:57:32.022811 [debug] [Thread-2 (]: Began compiling node test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1
[0m22:57:32.030006 [debug] [Thread-3 (]: Writing injected SQL for node "test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6"
[0m22:57:32.037852 [debug] [Thread-2 (]: Writing injected SQL for node "test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1"
[0m22:57:32.039091 [debug] [Thread-4 (]: Began executing node test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43
[0m22:57:32.045638 [debug] [Thread-4 (]: Writing runtime sql for node "test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43"
[0m22:57:32.046764 [debug] [Thread-3 (]: Began executing node test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6
[0m22:57:32.051053 [debug] [Thread-3 (]: Writing runtime sql for node "test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6"
[0m22:57:32.051677 [debug] [Thread-2 (]: Began executing node test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1
[0m22:57:32.057264 [debug] [Thread-2 (]: Writing runtime sql for node "test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1"
[0m22:57:32.058396 [debug] [Thread-4 (]: On test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select location_id
from `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
where location_id is null



  
  
      
    ) dbt_internal_test
[0m22:57:32.059870 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:57:32.061160 [debug] [Thread-3 (]: On test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
where order_id is null



  
  
      
    ) dbt_internal_test
[0m22:57:32.062820 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:57:32.065110 [debug] [Thread-2 (]: On test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select product_id
from `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
where product_id is null



  
  
      
    ) dbt_internal_test
[0m22:57:32.066070 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:57:32.273837 [info ] [Thread-1 (]: 1 of 19 PASS not_null_dim_location_location_id ................................. [[32mPASS[0m in 4.33s]
[0m22:57:32.275348 [debug] [Thread-1 (]: Finished running node test.glamira_analytics.not_null_dim_location_location_id.8635435d86
[0m22:57:32.276143 [debug] [Thread-1 (]: Began running node test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f
[0m22:57:32.276835 [info ] [Thread-1 (]: 8 of 19 START test not_null_mart_overall_date_day .............................. [RUN]
[0m22:57:32.277717 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_dim_location_location_id.8635435d86, now test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f)
[0m22:57:32.278369 [debug] [Thread-1 (]: Began compiling node test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f
[0m22:57:32.284447 [debug] [Thread-1 (]: Writing injected SQL for node "test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f"
[0m22:57:32.285989 [debug] [Thread-1 (]: Began executing node test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f
[0m22:57:32.289328 [debug] [Thread-1 (]: Writing runtime sql for node "test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f"
[0m22:57:32.290727 [debug] [Thread-1 (]: On test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select date_day
from `stone-album-475912-b9`.`analytics_dev`.`mart_overall`
where date_day is null



  
  
      
    ) dbt_internal_test
[0m22:57:32.291499 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:57:34.258954 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:c00ee5e4-2994-4844-94a6-dd77dcec95b8&page=queryresults
[0m22:57:34.260362 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:322b5422-cf5b-48e2-aeb8-678a5fade01c&page=queryresults
[0m22:57:34.261632 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:d51a5339-d0a9-43fc-b722-14a2bd7897d1&page=queryresults
[0m22:57:34.677089 [debug] [Thread-2 (]: SQL status: OK in 0.415 seconds
[0m22:57:34.678442 [debug] [Thread-3 (]: SQL status: OK in 0.416 seconds
[0m22:57:34.850426 [debug] [Thread-4 (]: SQL status: OK in 0.591 seconds
[0m22:57:35.910398 [info ] [Thread-2 (]: 7 of 19 PASS not_null_fact_sales_order_tt_product_id ........................... [[32mPASS[0m in 3.89s]
[0m22:57:35.915030 [debug] [Thread-2 (]: Finished running node test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1
[0m22:57:35.913386 [info ] [Thread-3 (]: 6 of 19 PASS not_null_fact_sales_order_tt_order_id ............................. [[32mPASS[0m in 3.90s]
[0m22:57:35.916376 [debug] [Thread-2 (]: Began running node test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b
[0m22:57:35.917599 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:78155503-c17b-4047-90be-0edda7d37fd3&page=queryresults
[0m22:57:35.918560 [debug] [Thread-3 (]: Finished running node test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6
[0m22:57:35.919337 [info ] [Thread-2 (]: 9 of 19 START test not_null_mart_product_type_product_type ..................... [RUN]
[0m22:57:35.920753 [debug] [Thread-3 (]: Began running node test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07
[0m22:57:35.922471 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_fact_sales_order_tt_product_id.40cec482e1, now test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b)
[0m22:57:35.923730 [info ] [Thread-3 (]: 10 of 19 START test not_null_stg_dim_location_location_id ...................... [RUN]
[0m22:57:35.925235 [debug] [Thread-2 (]: Began compiling node test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b
[0m22:57:35.926376 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_fact_sales_order_tt_order_id.1fe5094fc6, now test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07)
[0m22:57:35.934560 [debug] [Thread-2 (]: Writing injected SQL for node "test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b"
[0m22:57:35.935475 [debug] [Thread-3 (]: Began compiling node test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07
[0m22:57:35.940631 [debug] [Thread-3 (]: Writing injected SQL for node "test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07"
[0m22:57:35.942086 [debug] [Thread-2 (]: Began executing node test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b
[0m22:57:35.948682 [debug] [Thread-2 (]: Writing runtime sql for node "test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b"
[0m22:57:35.949564 [debug] [Thread-3 (]: Began executing node test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07
[0m22:57:35.953529 [debug] [Thread-3 (]: Writing runtime sql for node "test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07"
[0m22:57:35.954777 [debug] [Thread-2 (]: On test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select product_type
from `stone-album-475912-b9`.`analytics_dev`.`mart_product_type`
where product_type is null



  
  
      
    ) dbt_internal_test
[0m22:57:35.955641 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:57:35.957726 [debug] [Thread-3 (]: On test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select location_id
from `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
where location_id is null



  
  
      
    ) dbt_internal_test
[0m22:57:35.959255 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:57:36.665063 [debug] [Thread-1 (]: SQL status: OK in 0.745 seconds
[0m22:57:36.668722 [info ] [Thread-4 (]: 5 of 19 PASS not_null_fact_sales_order_tt_location_id .......................... [[32mPASS[0m in 4.66s]
[0m22:57:36.670702 [debug] [Thread-4 (]: Finished running node test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43
[0m22:57:36.672025 [debug] [Thread-4 (]: Began running node test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15
[0m22:57:36.673013 [info ] [Thread-4 (]: 11 of 19 START test not_null_stg_fact_sales_order_tt_location_id ............... [RUN]
[0m22:57:36.674204 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_fact_sales_order_tt_location_id.8e855bac43, now test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15)
[0m22:57:36.675013 [debug] [Thread-4 (]: Began compiling node test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15
[0m22:57:36.684464 [debug] [Thread-4 (]: Writing injected SQL for node "test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15"
[0m22:57:36.686428 [debug] [Thread-4 (]: Began executing node test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15
[0m22:57:36.691584 [debug] [Thread-4 (]: Writing runtime sql for node "test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15"
[0m22:57:36.693666 [debug] [Thread-4 (]: On test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select location_id
from `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
where location_id is null



  
  
      
    ) dbt_internal_test
[0m22:57:36.694754 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:57:37.788904 [info ] [Thread-1 (]: 8 of 19 PASS not_null_mart_overall_date_day .................................... [[32mPASS[0m in 5.51s]
[0m22:57:37.790339 [debug] [Thread-1 (]: Finished running node test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f
[0m22:57:37.791040 [debug] [Thread-1 (]: Began running node test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501
[0m22:57:37.791728 [info ] [Thread-1 (]: 12 of 19 START test not_null_stg_fact_sales_order_tt_order_id .................. [RUN]
[0m22:57:37.796402 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_mart_overall_date_day.8d5d17b78f, now test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501)
[0m22:57:37.797348 [debug] [Thread-1 (]: Began compiling node test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501
[0m22:57:37.803998 [debug] [Thread-1 (]: Writing injected SQL for node "test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501"
[0m22:57:37.805765 [debug] [Thread-1 (]: Began executing node test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501
[0m22:57:37.810863 [debug] [Thread-1 (]: Writing runtime sql for node "test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501"
[0m22:57:37.812884 [debug] [Thread-1 (]: On test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from `stone-album-475912-b9`.`analytics_dev_staging`.`stg_fact_sales_order_tt`
where order_id is null



  
  
      
    ) dbt_internal_test
[0m22:57:37.814045 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:57:38.276841 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:eb7e899b-bbbc-4778-b77a-0d74f81ce381&page=queryresults
[0m22:57:38.278216 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:65dc20c8-2efd-4538-aa9b-c49267718db0&page=queryresults
[0m22:57:38.915448 [debug] [Thread-2 (]: SQL status: OK in 0.638 seconds
[0m22:57:38.916670 [debug] [Thread-3 (]: SQL status: OK in 0.638 seconds
[0m22:57:40.139141 [info ] [Thread-2 (]: 9 of 19 PASS not_null_mart_product_type_product_type ........................... [[32mPASS[0m in 4.22s]
[0m22:57:40.142958 [debug] [Thread-2 (]: Finished running node test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b
[0m22:57:40.141686 [info ] [Thread-3 (]: 10 of 19 PASS not_null_stg_dim_location_location_id ............................ [[32mPASS[0m in 4.22s]
[0m22:57:40.143902 [debug] [Thread-2 (]: Began running node test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea
[0m22:57:40.144881 [debug] [Thread-3 (]: Finished running node test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07
[0m22:57:40.146071 [debug] [Thread-3 (]: Began running node test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed
[0m22:57:40.145522 [info ] [Thread-2 (]: 13 of 19 START test relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_  [RUN]
[0m22:57:40.148010 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_mart_product_type_product_type.be20bddd9b, now test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea)
[0m22:57:40.146781 [info ] [Thread-3 (]: 14 of 19 START test relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_  [RUN]
[0m22:57:40.149247 [debug] [Thread-2 (]: Began compiling node test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea
[0m22:57:40.150231 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_stg_dim_location_location_id.a6d8c47b07, now test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed)
[0m22:57:40.176504 [debug] [Thread-2 (]: Writing injected SQL for node "test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea"
[0m22:57:40.177114 [debug] [Thread-3 (]: Began compiling node test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed
[0m22:57:40.187535 [debug] [Thread-3 (]: Writing injected SQL for node "test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed"
[0m22:57:40.188746 [debug] [Thread-2 (]: Began executing node test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea
[0m22:57:40.192742 [debug] [Thread-2 (]: Writing runtime sql for node "test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea"
[0m22:57:40.193928 [debug] [Thread-3 (]: Began executing node test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed
[0m22:57:40.197690 [debug] [Thread-3 (]: Writing runtime sql for node "test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed"
[0m22:57:40.198911 [debug] [Thread-2 (]: On test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select location_id as from_field
    from `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
    where location_id is not null
),

parent as (
    select location_id as to_field
    from `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_location`
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m22:57:40.199893 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:57:40.202239 [debug] [Thread-3 (]: On test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with child as (
    select product_id as from_field
    from `stone-album-475912-b9`.`analytics_dev_dimensions`.`fact_sales_order_tt`
    where product_id is not null
),

parent as (
    select product_id as to_field
    from `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
)

select
    from_field

from child
left join parent
    on child.from_field = parent.to_field

where parent.to_field is null



  
  
      
    ) dbt_internal_test
[0m22:57:40.203406 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:57:40.408337 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:b8d90b52-42cf-4687-afa6-aca6d19bd714&page=queryresults
[0m22:57:42.510822 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:31e55673-5be5-4509-a557-8510609250b6&page=queryresults
[0m22:57:43.001819 [debug] [Thread-4 (]: SQL status: OK in 2.592 seconds
[0m22:57:43.285321 [debug] [Thread-1 (]: SQL status: OK in 0.773 seconds
[0m22:57:43.770183 [info ] [Thread-4 (]: 11 of 19 PASS not_null_stg_fact_sales_order_tt_location_id ..................... [[32mPASS[0m in 7.10s]
[0m22:57:43.772277 [debug] [Thread-4 (]: Finished running node test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15
[0m22:57:43.773008 [debug] [Thread-4 (]: Began running node test.glamira_analytics.unique_dim_location_location_id.9acbee647a
[0m22:57:43.774031 [info ] [Thread-4 (]: 15 of 19 START test unique_dim_location_location_id ............................ [RUN]
[0m22:57:43.775738 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_stg_fact_sales_order_tt_location_id.9facb13f15, now test.glamira_analytics.unique_dim_location_location_id.9acbee647a)
[0m22:57:43.776851 [debug] [Thread-4 (]: Began compiling node test.glamira_analytics.unique_dim_location_location_id.9acbee647a
[0m22:57:43.785989 [debug] [Thread-4 (]: Writing injected SQL for node "test.glamira_analytics.unique_dim_location_location_id.9acbee647a"
[0m22:57:43.787446 [debug] [Thread-4 (]: Began executing node test.glamira_analytics.unique_dim_location_location_id.9acbee647a
[0m22:57:43.791010 [debug] [Thread-4 (]: Writing runtime sql for node "test.glamira_analytics.unique_dim_location_location_id.9acbee647a"
[0m22:57:43.792921 [debug] [Thread-4 (]: On test.glamira_analytics.unique_dim_location_location_id.9acbee647a: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.unique_dim_location_location_id.9acbee647a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with dbt_test__target as (

  select location_id as unique_field
  from `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_location`
  where location_id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m22:57:43.794047 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:57:44.350022 [info ] [Thread-1 (]: 12 of 19 PASS not_null_stg_fact_sales_order_tt_order_id ........................ [[32mPASS[0m in 6.55s]
[0m22:57:44.351507 [debug] [Thread-1 (]: Finished running node test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501
[0m22:57:44.352222 [debug] [Thread-1 (]: Began running node test.glamira_analytics.unique_dim_product_product_key.1753236bd0
[0m22:57:44.352915 [info ] [Thread-1 (]: 16 of 19 START test unique_dim_product_product_key ............................. [RUN]
[0m22:57:44.353887 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.not_null_stg_fact_sales_order_tt_order_id.27e082e501, now test.glamira_analytics.unique_dim_product_product_key.1753236bd0)
[0m22:57:44.354545 [debug] [Thread-1 (]: Began compiling node test.glamira_analytics.unique_dim_product_product_key.1753236bd0
[0m22:57:44.361536 [debug] [Thread-1 (]: Writing injected SQL for node "test.glamira_analytics.unique_dim_product_product_key.1753236bd0"
[0m22:57:44.362971 [debug] [Thread-1 (]: Began executing node test.glamira_analytics.unique_dim_product_product_key.1753236bd0
[0m22:57:44.368755 [debug] [Thread-1 (]: Writing runtime sql for node "test.glamira_analytics.unique_dim_product_product_key.1753236bd0"
[0m22:57:44.370896 [debug] [Thread-1 (]: On test.glamira_analytics.unique_dim_product_product_key.1753236bd0: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.unique_dim_product_product_key.1753236bd0"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with dbt_test__target as (

  select product_key as unique_field
  from `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_product`
  where product_key is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m22:57:44.372017 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:57:46.660612 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:acfd9626-b58f-44f9-b3c4-e963091f8572&page=queryresults
[0m22:57:47.040784 [debug] [Thread-4 (]: SQL status: OK in 0.379 seconds
[0m22:57:47.312725 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:50b723f7-d328-4f7c-9fbd-d6348c15c417&page=queryresults
[0m22:57:47.313726 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:ad93590b-c1af-4e60-81e2-41ee4132145f&page=queryresults
[0m22:57:47.314498 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:32d0ec65-538d-4c5c-be70-d97b611ab121&page=queryresults
[0m22:57:48.211802 [debug] [Thread-2 (]: SQL status: OK in 0.896 seconds
[0m22:57:48.214072 [debug] [Thread-3 (]: SQL status: OK in 0.899 seconds
[0m22:57:48.215418 [debug] [Thread-1 (]: SQL status: OK in 0.899 seconds
[0m22:57:49.477486 [info ] [Thread-4 (]: 15 of 19 PASS unique_dim_location_location_id .................................. [[32mPASS[0m in 5.70s]
[0m22:57:49.481299 [debug] [Thread-4 (]: Finished running node test.glamira_analytics.unique_dim_location_location_id.9acbee647a
[0m22:57:49.482846 [debug] [Thread-4 (]: Began running node test.glamira_analytics.unique_dim_user_user_id.eff0a2a278
[0m22:57:49.483740 [info ] [Thread-4 (]: 17 of 19 START test unique_dim_user_user_id .................................... [RUN]
[0m22:57:49.486331 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.unique_dim_location_location_id.9acbee647a, now test.glamira_analytics.unique_dim_user_user_id.eff0a2a278)
[0m22:57:49.487576 [debug] [Thread-4 (]: Began compiling node test.glamira_analytics.unique_dim_user_user_id.eff0a2a278
[0m22:57:49.499175 [debug] [Thread-4 (]: Writing injected SQL for node "test.glamira_analytics.unique_dim_user_user_id.eff0a2a278"
[0m22:57:49.501026 [debug] [Thread-4 (]: Began executing node test.glamira_analytics.unique_dim_user_user_id.eff0a2a278
[0m22:57:49.505730 [debug] [Thread-4 (]: Writing runtime sql for node "test.glamira_analytics.unique_dim_user_user_id.eff0a2a278"
[0m22:57:49.507269 [debug] [Thread-4 (]: On test.glamira_analytics.unique_dim_user_user_id.eff0a2a278: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.unique_dim_user_user_id.eff0a2a278"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with dbt_test__target as (

  select user_id as unique_field
  from `stone-album-475912-b9`.`analytics_dev_dimensions`.`dim_user`
  where user_id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m22:57:49.508016 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:57:50.291392 [info ] [Thread-1 (]: 16 of 19 PASS unique_dim_product_product_key ................................... [[32mPASS[0m in 5.94s]
[0m22:57:50.300261 [debug] [Thread-1 (]: Finished running node test.glamira_analytics.unique_dim_product_product_key.1753236bd0
[0m22:57:50.294720 [info ] [Thread-2 (]: 13 of 19 PASS relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_  [[32mPASS[0m in 10.15s]
[0m22:57:50.301490 [debug] [Thread-1 (]: Began running node test.glamira_analytics.unique_mart_overall_date_day.53dd573753
[0m22:57:50.298923 [info ] [Thread-3 (]: 14 of 19 PASS relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_  [[32mPASS[0m in 10.15s]
[0m22:57:50.303012 [debug] [Thread-2 (]: Finished running node test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea
[0m22:57:50.304759 [debug] [Thread-3 (]: Finished running node test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed
[0m22:57:50.303779 [info ] [Thread-1 (]: 18 of 19 START test unique_mart_overall_date_day ............................... [RUN]
[0m22:57:50.306221 [debug] [Thread-2 (]: Began running node test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9
[0m22:57:50.307504 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.unique_dim_product_product_key.1753236bd0, now test.glamira_analytics.unique_mart_overall_date_day.53dd573753)
[0m22:57:50.308983 [debug] [Thread-1 (]: Began compiling node test.glamira_analytics.unique_mart_overall_date_day.53dd573753
[0m22:57:50.308286 [info ] [Thread-2 (]: 19 of 19 START test unique_stg_dim_location_location_id ........................ [RUN]
[0m22:57:50.317948 [debug] [Thread-1 (]: Writing injected SQL for node "test.glamira_analytics.unique_mart_overall_date_day.53dd573753"
[0m22:57:50.318934 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.glamira_analytics.relationships_fact_sales_order_tt_location_id__location_id__ref_dim_location_.a79fb8b4ea, now test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9)
[0m22:57:50.319904 [debug] [Thread-2 (]: Began compiling node test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9
[0m22:57:50.329887 [debug] [Thread-2 (]: Writing injected SQL for node "test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9"
[0m22:57:50.331481 [debug] [Thread-1 (]: Began executing node test.glamira_analytics.unique_mart_overall_date_day.53dd573753
[0m22:57:50.335552 [debug] [Thread-1 (]: Writing runtime sql for node "test.glamira_analytics.unique_mart_overall_date_day.53dd573753"
[0m22:57:50.336628 [debug] [Thread-2 (]: Began executing node test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9
[0m22:57:50.340365 [debug] [Thread-2 (]: Writing runtime sql for node "test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9"
[0m22:57:50.341528 [debug] [Thread-1 (]: On test.glamira_analytics.unique_mart_overall_date_day.53dd573753: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.unique_mart_overall_date_day.53dd573753"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with dbt_test__target as (

  select date_day as unique_field
  from `stone-album-475912-b9`.`analytics_dev`.`mart_overall`
  where date_day is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m22:57:50.342501 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:57:50.344948 [debug] [Thread-2 (]: On test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9: /* {"app": "dbt", "dbt_version": "1.11.2", "profile_name": "glamira_analytics", "target_name": "dev", "node_id": "test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with dbt_test__target as (

  select location_id as unique_field
  from `stone-album-475912-b9`.`analytics_dev_staging`.`stg_dim_location`
  where location_id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m22:57:50.346381 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:57:52.378001 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:e8cb0348-bb2a-4409-b473-c84ef3e8695b&page=queryresults
[0m22:57:53.086125 [debug] [Thread-4 (]: SQL status: OK in 0.707 seconds
[0m22:57:53.591319 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:2e2cf6be-592e-4e1b-8c3d-ccf6d129294f&page=queryresults
[0m22:57:54.864551 [debug] [Thread-2 (]: SQL status: OK in 1.272 seconds
[0m22:57:54.867102 [info ] [Thread-4 (]: 17 of 19 PASS unique_dim_user_user_id .......................................... [[32mPASS[0m in 5.38s]
[0m22:57:54.868664 [debug] [Thread-4 (]: Finished running node test.glamira_analytics.unique_dim_user_user_id.eff0a2a278
[0m22:57:56.770682 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=stone-album-475912-b9&j=bq:asia-southeast1:8e00acab-3d1a-4df7-b2f7-1a2b7beffea1&page=queryresults
[0m22:57:56.773323 [info ] [Thread-2 (]: 19 of 19 PASS unique_stg_dim_location_location_id .............................. [[32mPASS[0m in 6.45s]
[0m22:57:56.775369 [debug] [Thread-2 (]: Finished running node test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9
[0m22:57:57.605872 [debug] [Thread-1 (]: SQL status: OK in 0.832 seconds
[0m22:58:02.240449 [info ] [Thread-1 (]: 18 of 19 PASS unique_mart_overall_date_day ..................................... [[32mPASS[0m in 11.93s]
[0m22:58:02.242005 [debug] [Thread-1 (]: Finished running node test.glamira_analytics.unique_mart_overall_date_day.53dd573753
[0m22:58:02.244430 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:58:02.245422 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:58:02.245911 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_staging' was properly closed.
[0m22:58:02.246359 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev_dimensions' was properly closed.
[0m22:58:02.246799 [debug] [MainThread]: Connection 'list_stone-album-475912-b9_analytics_dev' was properly closed.
[0m22:58:02.247238 [debug] [MainThread]: Connection 'test.glamira_analytics.unique_mart_overall_date_day.53dd573753' was properly closed.
[0m22:58:02.247688 [debug] [MainThread]: Connection 'test.glamira_analytics.relationships_fact_sales_order_tt_product_id__product_id__ref_dim_product_.977d52e3ed' was properly closed.
[0m22:58:02.248124 [debug] [MainThread]: Connection 'test.glamira_analytics.unique_dim_user_user_id.eff0a2a278' was properly closed.
[0m22:58:02.248555 [debug] [MainThread]: Connection 'test.glamira_analytics.unique_stg_dim_location_location_id.d848897cc9' was properly closed.
[0m22:58:02.249087 [info ] [MainThread]: 
[0m22:58:02.249951 [info ] [MainThread]: Finished running 19 data tests in 0 hours 0 minutes and 40.39 seconds (40.39s).
[0m22:58:02.257864 [debug] [MainThread]: Command end result
[0m22:58:02.311901 [debug] [MainThread]: Wrote artifact WritableManifest to D:\Project 7\glamira_analytics\target\manifest.json
[0m22:58:02.315199 [debug] [MainThread]: Wrote artifact SemanticManifest to D:\Project 7\glamira_analytics\target\semantic_manifest.json
[0m22:58:02.325103 [debug] [MainThread]: Wrote artifact RunExecutionResult to D:\Project 7\glamira_analytics\target\run_results.json
[0m22:58:02.325632 [info ] [MainThread]: 
[0m22:58:02.326831 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:58:02.328433 [info ] [MainThread]: 
[0m22:58:02.329655 [info ] [MainThread]: Done. PASS=19 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=19
[0m22:58:02.331104 [debug] [MainThread]: Command `dbt test` succeeded at 22:58:02.330900 after 52.33 seconds
[0m22:58:02.335093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024CBE8FB950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024CDE4E4AA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024CDE4E4940>]}
[0m22:58:02.336195 [debug] [MainThread]: Flushing usage events
[0m22:58:11.177958 [debug] [MainThread]: An error was encountered while trying to flush usage events
