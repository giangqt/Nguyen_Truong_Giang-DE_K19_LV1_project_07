version: 2

models:
  # ----------------------------------------------------------------------------
  # STAGING LAYER (Raw data cleaning)
  # ----------------------------------------------------------------------------
  - name: stg_fact_sales_order_tt
    description: "Cleaned sales data with one row per line item."
    columns:
      - name: order_id
        description: "Original Order ID from source."
        tests:
          - not_null
      - name: location_id
        tests:
          - not_null
      - name: line_total
        description: "Price of the specific item."

  - name: stg_dim_location
    description: "Unique list of locations generated from IP addresses."
    columns:
      - name: location_id
        tests:
          - unique
          - not_null

  # ----------------------------------------------------------------------------
  # DIMENSIONS / CORE LAYER (The clean Star Schema)
  # ----------------------------------------------------------------------------
  - name: dim_product
    description: "Product dimension containing names, categories, and prices."
    columns:
      - name: product_key
        description: "Surrogate key for the product."
        tests:
          - unique
          - not_null
      - name: product_id
        tests:
          - not_null

  - name: dim_location
    description: "Location dimension derived from IP lookups."
    columns:
      - name: location_id
        tests:
          - unique
          - not_null
      - name: country_short_name
        description: "2-letter ISO country code."

  - name: dim_user
    description: "User dimension with last active timestamps."
    columns:
      - name: user_id
        tests:
          - unique
          - not_null
      - name: last_active_at
        description: "Timestamp of the user's most recent activity."

  - name: fact_sales_order_tt
    description: "Transactional fact table. Granularity: One row per product per order."
    columns:
      - name: order_id
        tests:
          - not_null
      - name: product_id
        tests:
          - not_null
          - relationships:
              to: ref('dim_product')
              field: product_id
      - name: location_id
        tests:
          - not_null
          - relationships:
              to: ref('dim_location')
              field: location_id
      - name: sales_amount
        description: "Total value of the line item."

  # ----------------------------------------------------------------------------
  # MARTS (Final Reporting Tables)
  # ----------------------------------------------------------------------------
  - name: mart_overall
    description: "High-level daily summary of revenue and orders."
    columns:
      - name: date_day
        tests:
          - unique
          - not_null
      - name: total_revenue
        description: "Sum of all sales for the day."

  - name: mart_product
    description: "Performance metrics aggregated by product name and category."
    columns:
      - name: product_name
        description: "Name of the product."
      - name: total_revenue
        description: "Total revenue generated by this product."

  - name: mart_country
    description: "Performance metrics aggregated by country and city."
    columns:
      - name: country_short_name
        description: "Country code."
      - name: total_orders
        description: "Count of unique orders from this location."

  - name: mart_product_type
    description: "Revenue breakdown by product type."
    columns:
      - name: product_type
        tests:
          - not_null